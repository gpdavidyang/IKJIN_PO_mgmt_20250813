<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì´ë©”ì¼ ë°œì†¡ í…ŒìŠ¤íŠ¸</title>
    <style>
        body { font-family: 'Malgun Gothic', sans-serif; padding: 20px; }
        .container { max-width: 800px; margin: 0 auto; }
        button { padding: 10px 20px; margin: 10px; border: none; border-radius: 5px; cursor: pointer; }
        .test-btn { background-color: #007bff; color: white; }
        .result { margin: 20px 0; padding: 15px; border-radius: 5px; }
        .success { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .info { background-color: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        input { padding: 8px; margin: 5px; width: 300px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ ë„¤ì´ë²„ SMTP í…ŒìŠ¤íŠ¸</h1>
        
        <div class="info result">
            <strong>ğŸ“‹ í˜„ì¬ ì„¤ì •:</strong><br>
            â€¢ SMTP í˜¸ìŠ¤íŠ¸: smtp.naver.com<br>
            â€¢ SMTP í¬íŠ¸: 587<br>
            â€¢ ì‚¬ìš©ì: david1611@naver.com<br>
            â€¢ ë¹„ë°€ë²ˆí˜¸: ******* (ì„¤ì •ë¨)
        </div>

        <h3>ğŸ“§ í…ŒìŠ¤íŠ¸ ì´ë©”ì¼ ë°œì†¡</h3>
        <div>
            <label>ìˆ˜ì‹ ì ì´ë©”ì¼:</label><br>
            <input type="email" id="testEmail" value="davidswyang@gmail.com" placeholder="ìˆ˜ì‹ ì ì´ë©”ì¼">
            <button class="test-btn" onclick="sendTestEmail()">í…ŒìŠ¤íŠ¸ ì´ë©”ì¼ ë°œì†¡</button>
        </div>

        <h3>ğŸ”— SMTP ì—°ê²° í…ŒìŠ¤íŠ¸</h3>
        <button class="test-btn" onclick="testConnection()">ì—°ê²° í…ŒìŠ¤íŠ¸</button>

        <div id="result"></div>
    </div>

    <script>
        function showResult(message, type = 'info') {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = `<div class="${type} result">${message}</div>`;
        }

        async function testConnection() {
            showResult('ğŸ” ì—°ê²° í…ŒìŠ¤íŠ¸ ì¤‘...', 'info');
            
            try {
                // ì‹¤ì œë¡œëŠ” ë°±ì—”ë“œê°€ í•„ìš”í•˜ì§€ë§Œ, í”„ë¡ íŠ¸ì—”ë“œì—ì„œ ê°„ì ‘ í…ŒìŠ¤íŠ¸
                const response = await fetch('/api/auth/user');
                if (response.ok) {
                    showResult('âœ… ì„œë²„ ì—°ê²° í™•ì¸ë¨. ì´ì œ ì‹¤ì œ ì´ë©”ì¼ ë°œì†¡ì„ í…ŒìŠ¤íŠ¸í•´ë³´ì„¸ìš”.', 'success');
                } else {
                    showResult('âŒ ì„œë²„ ì—°ê²° ì‹¤íŒ¨. ê°œë°œ ì„œë²„ê°€ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸í•˜ì„¸ìš”.', 'error');
                }
            } catch (error) {
                showResult(`âŒ ì—°ê²° í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ${error.message}`, 'error');
            }
        }

        async function sendTestEmail() {
            const email = document.getElementById('testEmail').value;
            if (!email) {
                showResult('âŒ ìˆ˜ì‹ ì ì´ë©”ì¼ì„ ì…ë ¥í•˜ì„¸ìš”.', 'error');
                return;
            }

            showResult('ğŸ“§ í…ŒìŠ¤íŠ¸ ì´ë©”ì¼ ë°œì†¡ ì¤‘...', 'info');

            try {
                // ì‹¤ì œ ë°œì£¼ì„œ ìƒì„± APIë¥¼ ì‚¬ìš©í•˜ì—¬ ì´ë©”ì¼ ë°œì†¡ í…ŒìŠ¤íŠ¸
                const testOrderData = {
                    orderNumber: 'EMAIL-TEST-001',
                    projectName: 'ì´ë©”ì¼ í…ŒìŠ¤íŠ¸ í”„ë¡œì íŠ¸',
                    vendorName: 'í…ŒìŠ¤íŠ¸ ê±°ë˜ì²˜',
                    vendorEmail: email,
                    totalAmount: 1000000,
                    items: [{
                        name: 'í…ŒìŠ¤íŠ¸ í’ˆëª©',
                        specification: 'í…ŒìŠ¤íŠ¸ìš©',
                        quantity: 1,
                        unitPrice: 1000000,
                        unit: 'EA'
                    }]
                };

                // send-email API ì§ì ‘ í˜¸ì¶œ
                const response = await fetch('/api/orders/send-email', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        orderData: testOrderData,
                        pdfUrl: null,
                        recipients: [email]
                    })
                });

                const result = await response.json();

                if (response.ok) {
                    showResult(`âœ… í…ŒìŠ¤íŠ¸ ì´ë©”ì¼ ë°œì†¡ ì„±ê³µ!<br>
                        ğŸ“§ ìˆ˜ì‹ ì: ${email}<br>
                        ğŸ†” ë©”ì‹œì§€ ID: ${result.messageId || 'N/A'}<br>
                        ğŸ‰ ë„¤ì´ë²„ SMTPê°€ ì •ìƒ ì‘ë™í•©ë‹ˆë‹¤!`, 'success');
                } else {
                    showResult(`âŒ ì´ë©”ì¼ ë°œì†¡ ì‹¤íŒ¨:<br>${result.error || result.message}`, 'error');
                }
            } catch (error) {
                showResult(`âŒ ì´ë©”ì¼ ë°œì†¡ ì¤‘ ì˜¤ë¥˜: ${error.message}<br>
                    ğŸ’¡ ê°€ëŠ¥í•œ ì›ì¸:<br>
                    â€¢ ë„¤ì´ë²„ ê³„ì • ì¸ì¦ ì •ë³´ ì˜¤ë¥˜<br>
                    â€¢ 2ë‹¨ê³„ ì¸ì¦ ë¯¸ì„¤ì •<br>
                    â€¢ IMAP/POP3 ì„¤ì • ë¹„í™œì„±í™”`, 'error');
            }
        }
    </script>
</body>
</html>