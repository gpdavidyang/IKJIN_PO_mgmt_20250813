import{n as _,e as Z,r as n,k as J,j as s,M as Q,a8 as L,I as Y,a9 as $,ah as d,y as E,B as g,o as M,ak as R,a7 as D,F as z}from"./index-Dk3hXMtA-1757249019526.js";import{D as ee,a as se,b as te,c as ae,d as le,e as ie}from"./dialog-DJpPGuAj-1757249019526.js";import{T as re}from"./textarea-Bw3xrfBV-1757249019526.js";import{C as ce}from"./checkbox-DscLMVnx-1757249019526.js";import{T as ne}from"./triangle-alert-flkmn2gU-1757249019526.js";import{S as oe}from"./send-5062TDw6-1757249019526.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=_("File",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}]]);function ge({open:p,onOpenChange:j,orderData:r,onSendEmail:O,attachments:u}){const{toast:y}=Z(),[i,o]=n.useState({to:r.vendorEmail?[r.vendorEmail]:[""],cc:[],subject:`ë°œì£¼ì„œ ì „ì†¡ - ${r.orderNumber}`,message:"",selectedAttachmentIds:[]}),[N,w]=n.useState(!1),[S,m]=n.useState([]),[h,C]=n.useState(""),[x,I]=n.useState(""),[v,b]=n.useState([]),[P,T]=n.useState(!1);n.useEffect(()=>{p&&(u?(console.log("ğŸ“ Using provided attachments:",u.length),b(u.map(e=>({...e,isSelected:!1})))):r.orderId&&(console.log("ğŸ“ No provided attachments, fetching from API for order:",r.orderId),W()))},[p,r.orderId,u]);const W=async()=>{if(r.orderId){T(!0);try{console.log("ğŸ“ Fetching attachments for order:",r.orderId);const e=await J("GET",`/api/orders/${r.orderId}/attachments`);if(Array.isArray(e)){const t=e.map(a=>({id:a.id,originalName:a.originalName,filePath:a.filePath,fileSize:a.fileSize,mimeType:a.mimeType,isSelected:!1}));b(t);const l=t.filter(a=>a.mimeType?.includes("pdf")||a.originalName?.toLowerCase().endsWith(".pdf")||a.mimeType?.includes("excel")||a.mimeType?.includes("spreadsheet")||a.originalName?.toLowerCase().endsWith(".xlsx")||a.originalName?.toLowerCase().endsWith(".xls")).map(a=>a.id);o(a=>({...a,selectedAttachmentIds:l})),console.log("ğŸ“ Loaded attachments:",{total:t.length,autoSelected:l.length})}else b([]),console.log("ğŸ“ No attachments found for order:",r.orderId)}catch(e){console.error("âŒ Failed to fetch attachments:",e),y({title:"ì²¨ë¶€íŒŒì¼ ì¡°íšŒ ì‹¤íŒ¨",description:"ì²¨ë¶€íŒŒì¼ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.",variant:"destructive"})}finally{T(!1)}}},f=e=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e),k=()=>{h&&f(h)?i.to.includes(h)||(o(e=>({...e,to:[...e.to.filter(t=>t!==""),h]})),C(""),m(e=>e.filter(t=>!t.includes("ìˆ˜ì‹ ì")))):m(e=>[...e,"ì˜¬ë°”ë¥¸ ì´ë©”ì¼ ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš”."])},A=()=>{x&&f(x)&&(i.cc?.includes(x)||(o(e=>({...e,cc:[...e.cc||[],x]})),I("")))},F=(e,t)=>{o(l=>({...l,[t]:l[t]?.filter(a=>a!==e)||[]}))},B=e=>{o(t=>{const l=t.selectedAttachmentIds,c=l.includes(e)?l.filter(G=>G!==e):[...l,e];return{...t,selectedAttachmentIds:c}})},U=e=>{if(!e)return"";const t=e/(1024*1024);return t>1?`${t.toFixed(1)}MB`:`${Math.round(e/1024)}KB`},K=(e,t)=>e?.includes("pdf")||t?.toLowerCase().endsWith(".pdf")?s.jsx(z,{className:"h-4 w-4 text-red-500"}):e?.includes("excel")||e?.includes("spreadsheet")||t?.toLowerCase().endsWith(".xlsx")||t?.toLowerCase().endsWith(".xls")?s.jsx(X,{className:"h-4 w-4 text-green-600"}):s.jsx(X,{className:"h-4 w-4 text-gray-500"}),q=()=>{const e=[];return(!i.to.length||i.to.every(a=>!a.trim()))&&e.push("ìµœì†Œ í•˜ë‚˜ì˜ ìˆ˜ì‹ ì ì´ë©”ì¼ì„ ì…ë ¥í•˜ì„¸ìš”."),i.to.filter(a=>a&&!f(a)).length>0&&e.push("ìˆ˜ì‹ ì ì´ë©”ì¼ ì£¼ì†Œê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤."),(i.cc?.filter(a=>a&&!f(a))||[]).length>0&&e.push("ì°¸ì¡° ì´ë©”ì¼ ì£¼ì†Œê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤."),i.subject.trim()||e.push("ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”."),m(e),e.length===0},H=async()=>{if(q()){w(!0),m([]);try{console.log("ğŸ“§ Sending email with data:",{to:i.to,cc:i.cc,subject:i.subject,message:i.message,selectedAttachmentIds:i.selectedAttachmentIds}),await O(i),j(!1)}catch(e){console.error("âŒ Email sending error:",e);let t="ì´ë©”ì¼ ë°œì†¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.",l=[];if(e?.response?.data){const c=e.response.data;if(c.message&&(t=c.message),c.errors&&Array.isArray(c.errors)?l=c.errors:c.details&&(l=[c.details]),c.code)switch(c.code){case"EAUTH":l.push("ì´ë©”ì¼ ê³„ì • ì¸ì¦ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•˜ì„¸ìš”.");break;case"ECONNECTION":case"ETIMEDOUT":l.push("ì´ë©”ì¼ ì„œë²„ì— ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë„¤íŠ¸ì›Œí¬ ìƒíƒœë¥¼ í™•ì¸í•˜ì„¸ìš”.");break;case"EMESSAGE":l.push("ì´ë©”ì¼ ë‚´ìš©ì— ì˜¤ë¥˜ê°€ ìˆìŠµë‹ˆë‹¤. ì…ë ¥ ë‚´ìš©ì„ í™•ì¸í•˜ì„¸ìš”.");break;case"EENVELOPE":l.push("ìˆ˜ì‹ ì ë˜ëŠ” ë°œì‹ ì ì´ë©”ì¼ ì£¼ì†Œì— ì˜¤ë¥˜ê°€ ìˆìŠµë‹ˆë‹¤.");break;default:c.code&&l.push(`ì´ë©”ì¼ ì„œë²„ ì˜¤ë¥˜: ${c.code}`)}(t.includes("attachment")||t.includes("ì²¨ë¶€"))&&l.push("ì²¨ë¶€íŒŒì¼ ì²˜ë¦¬ ì¤‘ ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. íŒŒì¼ í¬ê¸°ë‚˜ í˜•ì‹ì„ í™•ì¸í•˜ì„¸ìš”."),t.includes("invalid")&&t.includes("email")&&l.push("ìœ íš¨í•˜ì§€ ì•Šì€ ì´ë©”ì¼ ì£¼ì†Œê°€ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤.")}else e?.message&&(t=e.message);(e?.code==="NETWORK_ERROR"||e?.name==="NetworkError")&&(t="ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì— ë¬¸ì œê°€ ìˆìŠµë‹ˆë‹¤.",l.push("ì¸í„°ë„· ì—°ê²°ì„ í™•ì¸í•˜ê³  ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”.")),(e?.code==="TIMEOUT_ERROR"||e?.message?.includes("timeout"))&&(t="ì´ë©”ì¼ ë°œì†¡ ì‹œê°„ì´ ì´ˆê³¼ë˜ì—ˆìŠµë‹ˆë‹¤.",l.push("ì„œë²„ê°€ ì‘ë‹µí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”."));const a=[t,...l].filter(Boolean);m(a),y({title:"ì´ë©”ì¼ ë°œì†¡ ì‹¤íŒ¨",description:l.length>0?l[0]:t,variant:"destructive"})}finally{w(!1)}}},V=`ì•ˆë…•í•˜ì„¸ìš”.

${r.vendorName} ë‹´ë‹¹ìë‹˜ê»˜ ë°œì£¼ì„œë¥¼ ì „ì†¡ë“œë¦½ë‹ˆë‹¤.

â–  ë°œì£¼ ì •ë³´
- ë°œì£¼ë²ˆí˜¸: ${r.orderNumber}
- ë°œì£¼ì¼ì: ${r.orderDate}
- í˜„ì¥ëª…: ${r.siteName||"N/A"}
- ë°œì£¼ê¸ˆì•¡: ${r.totalAmount.toLocaleString()}ì›

ì²¨ë¶€ëœ ë°œì£¼ì„œë¥¼ í™•ì¸í•˜ì‹œê³ , ë‚©ê¸°ì¼ì •ì— ë§ì¶° ì§„í–‰ ë¶€íƒë“œë¦½ë‹ˆë‹¤.

ê°ì‚¬í•©ë‹ˆë‹¤.`;return s.jsx(ee,{open:p,onOpenChange:j,children:s.jsxs(se,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[s.jsxs(te,{children:[s.jsxs(ae,{className:"flex items-center gap-2",children:[s.jsx(Q,{className:"h-5 w-5"}),"ë°œì£¼ì„œ ì´ë©”ì¼ ë°œì†¡"]}),s.jsxs(le,{children:[r.vendorName,"ì—ê²Œ ë°œì£¼ì„œ ",r.orderNumber,"ë¥¼ ì´ë©”ì¼ë¡œ ì „ì†¡í•©ë‹ˆë‹¤."]})]}),s.jsxs(L,{className:"border-blue-200 bg-blue-50",children:[s.jsx(Y,{className:"h-4 w-4 text-blue-600"}),s.jsxs($,{className:"text-blue-800",children:[s.jsx("strong",{children:"ğŸ“§ ì•ˆë‚´:"})," ë°œì£¼ìƒì„±ì´ ë˜ì—ˆë”ë¼ë„ ë°œì£¼ ì´ë©”ì¼ ì „ì†¡ ë²„íŠ¼ì´ í´ë¦­ë˜ì–´ì•¼ 'ë°œì£¼ì™„ë£Œ' ìƒíƒœë¡œ ë³€ê²½ë©ë‹ˆë‹¤."]})]}),s.jsxs("div",{className:"space-y-4",children:[S.length>0&&s.jsxs(L,{variant:"destructive",className:"border-red-200 bg-red-50",children:[s.jsx(ne,{className:"h-4 w-4 text-red-600"}),s.jsx($,{className:"text-red-800",children:s.jsxs("div",{className:"space-y-1",children:[s.jsx("div",{className:"font-semibold text-sm",children:"âš ï¸ ì´ë©”ì¼ ë°œì†¡ ì‹¤íŒ¨"}),s.jsx("ul",{className:"list-disc list-inside space-y-1 text-sm",children:S.map((e,t)=>s.jsx("li",{className:"break-words",children:e},t))}),s.jsx("div",{className:"text-xs text-red-600 mt-2 pt-1 border-t border-red-200",children:"ğŸ’¡ ë¬¸ì œê°€ ì§€ì†ë˜ë©´ ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•˜ì„¸ìš”."})]})})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(d,{htmlFor:"to-email",children:"ìˆ˜ì‹ ì *"}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx(E,{id:"to-email",type:"email",placeholder:"example@company.com",value:h,onChange:e=>C(e.target.value),onKeyPress:e=>e.key==="Enter"&&k()}),s.jsx(g,{type:"button",onClick:k,variant:"outline",size:"sm",children:"ì¶”ê°€"})]}),s.jsx("div",{className:"flex flex-wrap gap-2",children:i.to.filter(e=>e.trim()).map((e,t)=>s.jsxs(M,{variant:"secondary",className:"flex items-center gap-1",children:[e,s.jsx(R,{className:"h-3 w-3 cursor-pointer hover:text-red-500",onClick:()=>F(e,"to")})]},t))})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(d,{htmlFor:"cc-email",children:"ì°¸ì¡° (ì„ íƒ)"}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx(E,{id:"cc-email",type:"email",placeholder:"cc@company.com",value:x,onChange:e=>I(e.target.value),onKeyPress:e=>e.key==="Enter"&&A()}),s.jsx(g,{type:"button",onClick:A,variant:"outline",size:"sm",children:"ì¶”ê°€"})]}),s.jsx("div",{className:"flex flex-wrap gap-2",children:i.cc?.map((e,t)=>s.jsxs(M,{variant:"outline",className:"flex items-center gap-1",children:[e,s.jsx(R,{className:"h-3 w-3 cursor-pointer hover:text-red-500",onClick:()=>F(e,"cc")})]},t))})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(d,{htmlFor:"subject",children:"ì œëª© *"}),s.jsx(E,{id:"subject",value:i.subject,onChange:e=>o(t=>({...t,subject:e.target.value})),placeholder:"ë°œì£¼ì„œ ì „ì†¡ - PO-XXXX-XXX"})]}),s.jsxs("div",{className:"space-y-3",children:[s.jsx(d,{className:"text-base font-medium",children:"ì²¨ë¶€íŒŒì¼"}),P?s.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[s.jsx(D,{className:"h-4 w-4 animate-spin"}),"ì²¨ë¶€íŒŒì¼ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘..."]}):v.length===0?s.jsxs("div",{className:"text-sm text-muted-foreground p-4 border border-dashed rounded-lg text-center",children:[s.jsx(z,{className:"h-8 w-8 mx-auto mb-2 text-gray-400"}),"ì´ ë°œì£¼ì„œì— ì²¨ë¶€ëœ íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤."]}):s.jsxs("div",{className:"space-y-2 max-h-64 overflow-y-auto border rounded-lg p-3",children:[s.jsxs("div",{className:"text-xs font-medium text-muted-foreground mb-2",children:["ì´ ",v.length,"ê°œì˜ íŒŒì¼ì´ ì²¨ë¶€ë˜ì–´ ìˆìŠµë‹ˆë‹¤"]}),v.map(e=>{const t=i.selectedAttachmentIds.includes(e.id);return s.jsxs("div",{className:`flex items-center space-x-3 p-2 rounded-md hover:bg-gray-50 transition-colors ${t?"bg-blue-50 border border-blue-200":"border border-gray-200"}`,children:[s.jsx(ce,{id:`attach-${e.id}`,checked:t,onCheckedChange:()=>B(e.id)}),s.jsxs("div",{className:"flex items-center space-x-2 flex-1 min-w-0",children:[K(e.mimeType,e.originalName),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx(d,{htmlFor:`attach-${e.id}`,className:"text-sm font-medium cursor-pointer block truncate",title:e.originalName,children:e.originalName}),e.fileSize&&s.jsxs("div",{className:"text-xs text-muted-foreground",children:[U(e.fileSize),e.mimeType&&s.jsxs("span",{className:"ml-2",children:["â€¢ ",e.mimeType.split("/")[1]?.toUpperCase()]})]})]})]})]},e.id)}),i.selectedAttachmentIds.length>0&&s.jsx("div",{className:"pt-2 border-t border-gray-200",children:s.jsxs("div",{className:"text-xs text-blue-600 font-medium",children:["âœ“ ",i.selectedAttachmentIds.length,"ê°œ íŒŒì¼ì´ ì„ íƒë˜ì—ˆìŠµë‹ˆë‹¤"]})})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(d,{htmlFor:"message",children:"ë©”ì‹œì§€ (ì„ íƒ)"}),s.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"ì´ ë©”ì‹œì§€ëŠ” ì´ë©”ì¼ ë³¸ë¬¸ì— í¬í•¨ë˜ì–´ ìˆ˜ì‹ ìì—ê²Œ ì „ë‹¬ë©ë‹ˆë‹¤."}),s.jsx(re,{id:"message",value:i.message||V,onChange:e=>o(t=>({...t,message:e.target.value})),placeholder:"ì¶”ê°€ ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”...",rows:8,className:"resize-none"})]})]}),s.jsxs(ie,{children:[s.jsx(g,{variant:"outline",onClick:()=>j(!1),disabled:N,children:"ì·¨ì†Œ"}),s.jsx(g,{onClick:H,disabled:N,children:N?s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"ë°œì†¡ ì¤‘..."]}):s.jsxs(s.Fragment,{children:[s.jsx(oe,{className:"h-4 w-4 mr-2"}),"ì´ë©”ì¼ ë°œì†¡"]})})]})]})})}export{ge as E};
