import{d as T,e as A,h as C,r as j,j as e,al as N,o as v,F as p,Z as L,B as f,T as k,I as E,k as M,K as b}from"./index-F0V4iaOu-1757246496717.js";import{A as R,f as U,a as B,b as P,c as S,d as z,e as I,g as O,h as W}from"./alert-dialog-Cmn9oN8L-1757246496717.js";import{C as q}from"./calendar-C6guIs9S-1757246496717.js";import{D as K}from"./download-IRpE6z47-1757246496717.js";import{f as H}from"./format-Wwhs3QHM-1757246496717.js";const Q=async(n,i,g)=>{console.log(`ğŸ”½ Starting download for attachment ${n}, filename: ${i}, mimeType: ${g}`);try{const a=`/api/attachments/${n}/download?download=true`;console.log("ğŸ“ Download URL:",a);const m=g?.toLowerCase().includes("pdf")||i.toLowerCase().endsWith(".pdf"),s=await fetch(a,{method:"GET",credentials:"include",headers:{Accept:m?"application/pdf":"*/*"}});if(!s.ok){const t=await s.text();throw console.error("Download response error:",t),new Error(`ë‹¤ìš´ë¡œë“œ ì‹¤íŒ¨: ${s.status}`)}const h=await s.blob(),l=window.URL.createObjectURL(h);if(m)console.log("ğŸ“„ File is PDF - opening in new tab and downloading"),window.open(l,"_blank"),console.log("âœ… Opened PDF in new tab for viewing"),setTimeout(()=>{const t=document.createElement("a");t.href=l,t.download=i,t.style.display="none",document.body.appendChild(t),t.click(),setTimeout(()=>{document.body.removeChild(t),window.URL.revokeObjectURL(l)},100),console.log("âœ… PDF download triggered")},500);else{console.log("ğŸ“ File download - triggering download");const t=document.createElement("a");t.href=l,t.download=i,t.style.display="none",document.body.appendChild(t),t.click(),setTimeout(()=>{document.body.removeChild(t),window.URL.revokeObjectURL(l)},100),console.log("âœ… File download triggered")}return!0}catch(a){throw console.error("âŒ Download error:",a),a}},G=(n,i,g)=>{const a=g?.toLowerCase().includes("pdf")||n.toLowerCase().endsWith(".pdf");i(a?{title:"ë‹¤ìš´ë¡œë“œ ë° ë¯¸ë¦¬ë³´ê¸°",description:`${n} íŒŒì¼ì´ ìƒˆ íƒ­ì—ì„œ ì—´ë¦¬ê³  ë‹¤ìš´ë¡œë“œ í´ë”ì— ì €ì¥ë©ë‹ˆë‹¤.`}:{title:"ë‹¤ìš´ë¡œë“œ ì™„ë£Œ",description:`${n} íŒŒì¼ì´ ë‹¤ìš´ë¡œë“œ í´ë”ì— ì €ì¥ë©ë‹ˆë‹¤.`})};function Y({attachments:n,orderId:i}){const{user:g}=T(),{toast:a}=A(),{theme:m}=C(),s=m==="dark",[h,l]=j.useState(null),[t,u]=j.useState(null),w=g?.role==="admin";console.log("ğŸ” AttachedFilesInfo - COMPONENT CALLED!",{attachments:n,orderId:i}),console.log("ğŸ” AttachedFilesInfo - received attachments:",n);const x=n.map(r=>{const o=r.mimeType?.toLowerCase()||"",d=r.originalName?.toLowerCase()||"";let c="other",y=p;return o.includes("excel")||o.includes("spreadsheet")||d.endsWith(".xlsx")||d.endsWith(".xls")||d.endsWith(".xlsm")?(c="excel",y=N):(o.includes("pdf")||d.endsWith(".pdf"))&&(c="pdf",y=p),console.log("ğŸ” Processing attachment:",{originalName:r.originalName,mimeType:r.mimeType,fileName:d,fileType:c}),{...r,fileType:c,icon:y}});if(console.log("ğŸ“Š AttachedFilesInfo - attached files:",x),x.length===0)return console.log("âš ï¸ AttachedFilesInfo - No attached files found, component will not render"),null;console.log("âœ… AttachedFilesInfo - Rendering component with",x.length,"attached files");const D=async r=>{l(r.id);try{await Q(r.id,r.originalName,r.mimeType),G(r.originalName,a,r.mimeType)}catch(o){console.error("Download error:",o),a({title:"ë‹¤ìš´ë¡œë“œ ì‹¤íŒ¨",description:o instanceof Error?o.message:"ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.",variant:"destructive"})}finally{l(null)}},$=async r=>{if(!w){a({title:"ê¶Œí•œ ì—†ìŒ",description:"ê´€ë¦¬ìë§Œ íŒŒì¼ì„ ì‚­ì œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.",variant:"destructive"});return}u(r.id);try{await M("DELETE",`/api/attachments/${r.id}`),await b.invalidateQueries({queryKey:[`/api/orders/${i}`]}),await b.invalidateQueries({queryKey:["orders-optimized"]}),await b.invalidateQueries({queryKey:["/api/orders"]}),a({title:"íŒŒì¼ ì‚­ì œ ì™„ë£Œ",description:`${r.originalName} íŒŒì¼ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.`})}catch(o){console.error("Delete error:",o),a({title:"íŒŒì¼ ì‚­ì œ ì‹¤íŒ¨",description:o instanceof Error?o.message:"ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.",variant:"destructive"})}finally{u(null)}},F=r=>{if(r===0)return"0 B";const o=1024,d=["B","KB","MB","GB"],c=Math.floor(Math.log(r)/Math.log(o));return parseFloat((r/Math.pow(o,c)).toFixed(2))+" "+d[c]};return e.jsxs("div",{className:`shadow-sm rounded-lg border transition-colors ${s?"bg-gray-800 border-gray-700":"bg-white border-gray-200"}`,children:[e.jsx("div",{className:`p-6 border-b transition-colors ${s?"border-gray-700":"border-gray-200"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:`p-2 rounded-lg mr-3 transition-colors ${s?"bg-green-900/20":"bg-green-50"}`,children:e.jsx(N,{className:`h-5 w-5 transition-colors ${s?"text-green-400":"text-green-600"}`})}),e.jsxs("div",{children:[e.jsx("h3",{className:`text-lg font-semibold transition-colors ${s?"text-white":"text-gray-900"}`,children:"ì²¨ë¶€ ëœ íŒŒì¼"}),e.jsxs("span",{className:`text-sm transition-colors ${s?"text-gray-400":"text-gray-500"}`,children:["ë°œì£¼ì„œì™€ ê´€ë ¨ëœ ì²¨ë¶€ íŒŒì¼ (",x.length,"ê°œ)"]})]})]}),e.jsxs(v,{variant:"outline",className:`transition-colors ${s?"border-blue-600 text-blue-400":"border-blue-200 text-blue-700 bg-blue-50"}`,children:[e.jsx(p,{className:"h-3 w-3 mr-1"}),"ì²¨ë¶€íŒŒì¼"]})]})}),e.jsxs("div",{className:"p-6 space-y-4",children:[x.map(r=>e.jsx("div",{className:`border rounded-lg p-4 transition-all hover:shadow-md ${s?"border-gray-600 hover:border-gray-500 bg-gray-750":"border-gray-200 hover:border-gray-300 bg-gray-50/50"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0 flex-1",children:[e.jsx("div",{className:`p-2 rounded-lg transition-colors ${r.fileType==="excel"?s?"bg-green-900/30":"bg-green-100":r.fileType==="pdf"?s?"bg-red-900/30":"bg-red-100":s?"bg-gray-900/30":"bg-gray-100"}`,children:e.jsx(r.icon,{className:`h-5 w-5 transition-colors ${r.fileType==="excel"?s?"text-green-400":"text-green-600":r.fileType==="pdf"?s?"text-red-400":"text-red-600":s?"text-gray-400":"text-gray-600"}`})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:`font-medium text-sm truncate transition-colors ${s?"text-gray-200":"text-gray-900"}`,title:r.originalName,children:r.originalName}),e.jsx(v,{variant:"secondary",className:"text-xs",children:r.fileType==="excel"?"Excel":r.fileType==="pdf"?"PDF":"íŒŒì¼"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-2 text-xs",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(p,{className:`h-3 w-3 transition-colors ${s?"text-gray-500":"text-gray-400"}`}),e.jsx("span",{className:`transition-colors ${s?"text-gray-400":"text-gray-600"}`,children:F(r.fileSize)})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(L,{className:`h-3 w-3 transition-colors ${s?"text-gray-500":"text-gray-400"}`}),e.jsx("span",{className:`transition-colors ${s?"text-gray-400":"text-gray-600"}`,children:r.uploadedBy||"ì•Œ ìˆ˜ ì—†ìŒ"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(q,{className:`h-3 w-3 transition-colors ${s?"text-gray-500":"text-gray-400"}`}),e.jsx("span",{className:`transition-colors ${s?"text-gray-400":"text-gray-600"}`,children:H(new Date(r.uploadedAt),"yyyy.MM.dd HH:mm")})]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 ml-4",children:[e.jsx(f,{variant:"outline",size:"sm",onClick:()=>D(r),disabled:h===r.id,className:`h-8 px-3 text-xs transition-colors ${s?"border-gray-600 text-gray-300 hover:bg-gray-700 hover:border-green-500 hover:text-green-400":"border-gray-300 text-gray-700 hover:bg-green-50 hover:border-green-300 hover:text-green-700"}`,children:h===r.id?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-current mr-1"}),"ë‹¤ìš´ë¡œë“œ ì¤‘..."]}):e.jsxs(e.Fragment,{children:[e.jsx(K,{className:"h-3 w-3 mr-1"}),"ë‹¤ìš´ë¡œë“œ"]})}),w&&e.jsxs(R,{children:[e.jsx(U,{asChild:!0,children:e.jsx(f,{variant:"outline",size:"sm",disabled:t===r.id,className:`h-8 px-3 text-xs transition-colors ${s?"border-red-600 text-red-400 hover:bg-red-900/20 hover:border-red-500":"border-red-300 text-red-700 hover:bg-red-50 hover:border-red-400"}`,children:t===r.id?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-current mr-1"}),"ì‚­ì œ ì¤‘..."]}):e.jsxs(e.Fragment,{children:[e.jsx(k,{className:"h-3 w-3 mr-1"}),"ì‚­ì œ"]})})}),e.jsxs(B,{className:s?"bg-gray-800 border-gray-700":"",children:[e.jsxs(P,{children:[e.jsx(S,{className:s?"text-white":"",children:"íŒŒì¼ ì‚­ì œ í™•ì¸"}),e.jsxs(z,{className:s?"text-gray-400":"",children:[e.jsx("strong",{children:r.originalName})," íŒŒì¼ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?",e.jsx("br",{}),"ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìœ¼ë©°, íŒŒì¼ì´ ì˜êµ¬ì ìœ¼ë¡œ ì‚­ì œë©ë‹ˆë‹¤."]})]}),e.jsxs(I,{children:[e.jsx(O,{className:s?"border-gray-600 text-gray-300 hover:bg-gray-700":"",children:"ì·¨ì†Œ"}),e.jsx(W,{onClick:()=>$(r),className:"bg-red-600 hover:bg-red-700 text-white",children:"ì‚­ì œ"})]})]})]})]})]})},r.id)),e.jsx("div",{className:`mt-4 p-3 rounded-lg border border-dashed transition-colors ${s?"border-gray-600 bg-gray-750":"border-gray-300 bg-gray-50"}`,children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(E,{className:`h-4 w-4 mt-0.5 flex-shrink-0 transition-colors ${s?"text-blue-400":"text-blue-600"}`}),e.jsxs("div",{className:"text-xs space-y-1",children:[e.jsx("p",{className:`font-medium transition-colors ${s?"text-blue-400":"text-blue-600"}`,children:"ì²¨ë¶€ íŒŒì¼ ì •ë³´"}),e.jsx("p",{className:`transition-colors ${s?"text-gray-400":"text-gray-600"}`,children:"ì´ ì„¹ì…˜ì—ëŠ” ë°œì£¼ì„œì™€ ê´€ë ¨ëœ ëª¨ë“  ì²¨ë¶€ íŒŒì¼ì´ í‘œì‹œë©ë‹ˆë‹¤. Excel íŒŒì¼, PDF ë¬¸ì„œ ë“± ë‹¤ì–‘í•œ í˜•íƒœì˜ íŒŒì¼ì„ ë‹¤ìš´ë¡œë“œí•˜ì—¬ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤."})]})]})})]})]})}export{Y as A,Q as d,G as s};
