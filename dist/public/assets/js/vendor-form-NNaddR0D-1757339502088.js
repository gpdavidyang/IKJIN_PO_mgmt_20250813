import{r as b,j as e,an as h,O as q,af as R,aK as X,aL as Y,I as _,aM as G,ac as L,H as Z,y as U,bX as ee,E as se,S as ae,z as te,A as re,D as ie,G as le,aZ as x,e as ne,aS as oe,a_ as ce,s as B,k as H,B as O,P as de,X as me}from"./index-BHt0qwks-1757339502088.js";import{D as ue,a as xe,b as he,c as pe}from"./dialog-Ccv_HLN2-1757339502088.js";import{T as ge}from"./textarea-D6OEVGQ--1757339502088.js";import{C as J}from"./circle-check-BH1GzbZj-1757339502088.js";import{i as K}from"./authUtils-CcDzk6i0-1757339502088.js";import"./index-Bqg5ZJRK-1757339502088.js";function I({label:A,name:C,value:p="",onChange:a,onBlur:d,type:c="text",placeholder:P,required:l=!1,disabled:f=!1,readOnly:g=!1,error:y,success:E,helperText:N,tooltip:n,autoComplete:i,maxLength:w,rows:T=3,validating:t=!1,autoSave:r=!1,onAutoSave:j,className:m,labelClassName:D,inputClassName:V}){const[k,F]=b.useState(!1),[$,s]=b.useState(null),[u,M]=b.useState(!1),v=`field-${C}`,o=!!y,z=E&&!o;b.useEffect(()=>{if(r&&p&&j){$&&clearTimeout($);const S=setTimeout(async()=>{M(!0),await j(),M(!1)},1500);s(S)}return()=>{$&&clearTimeout($)}},[p,r,j]);const Q=()=>{const S={id:v,name:C,value:p,onChange:W=>a?.(W.target.value),onBlur:d,placeholder:P,required:l,disabled:f,readOnly:g,autoComplete:i,maxLength:w,className:h("transition-all duration-200",o&&"border-red-500 focus:border-red-500 focus:ring-red-500",z&&"border-green-500 focus:border-green-500 focus:ring-green-500",V),"aria-invalid":o,"aria-describedby":o?`${v}-error`:N?`${v}-helper`:void 0};return c==="textarea"?e.jsx(ge,{...S,rows:T,className:h(S.className,"resize-none")}):c==="password"?e.jsxs("div",{className:"relative",children:[e.jsx(U,{...S,type:k?"text":"password",className:h(S.className,"pr-10")}),e.jsx("button",{type:"button",onClick:()=>F(!k),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-700 transition-colors",tabIndex:-1,children:k?e.jsx(ee,{className:"h-4 w-4"}):e.jsx(se,{className:"h-4 w-4"})})]}):e.jsx(U,{...S,type:c})};return e.jsxs("div",{className:h("space-y-2",m),children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs(q,{htmlFor:v,className:h("text-sm font-medium",o&&"text-red-600",z&&"text-green-600",D),children:[A,l&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),n&&e.jsx(R,{children:e.jsxs(X,{children:[e.jsx(Y,{asChild:!0,children:e.jsx(_,{className:"h-3.5 w-3.5 text-gray-400 cursor-help"})}),e.jsx(G,{children:e.jsx("p",{className:"max-w-xs text-sm",children:n})})]})}),r&&u&&e.jsxs("div",{className:"ml-auto flex items-center gap-1 text-xs text-gray-500",children:[e.jsx(L,{className:"h-3 w-3 animate-spin"}),e.jsx("span",{children:"저장 중..."})]})]}),e.jsxs("div",{className:"relative",children:[Q(),(t||o||z)&&c!=="password"&&e.jsxs("div",{className:"absolute right-3 top-1/2 -translate-y-1/2",children:[t&&e.jsx(L,{className:"h-4 w-4 animate-spin text-gray-400"}),o&&!t&&e.jsx(Z,{className:"h-4 w-4 text-red-500"}),z&&!t&&e.jsx(J,{className:"h-4 w-4 text-green-500"})]})]}),(N||o)&&e.jsx("div",{id:o?`${v}-error`:`${v}-helper`,className:h("text-sm",o?"text-red-600":"text-gray-500"),role:o?"alert":void 0,children:o?y:N}),c==="textarea"&&w&&e.jsxs("div",{className:"text-xs text-gray-500 text-right",children:[p.length," / ",w]})]})}function je({label:A,name:C,value:p="",onChange:a,onBlur:d,options:c,placeholder:P="선택하세요",required:l=!1,disabled:f=!1,error:g,success:y,helperText:E,tooltip:N,validating:n=!1,className:i,labelClassName:w,selectClassName:T}){const t=`field-${C}`,r=!!g,j=y&&!r;return e.jsxs("div",{className:h("space-y-2",i),children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs(q,{htmlFor:t,className:h("text-sm font-medium",r&&"text-red-600",j&&"text-green-600",w),children:[A,l&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),N&&e.jsx(R,{children:e.jsxs(X,{children:[e.jsx(Y,{asChild:!0,children:e.jsx(_,{className:"h-3.5 w-3.5 text-gray-400 cursor-help"})}),e.jsx(G,{children:e.jsx("p",{className:"max-w-xs text-sm",children:N})})]})})]}),e.jsxs("div",{className:"relative",children:[e.jsxs(ae,{value:p,onValueChange:a,disabled:f,required:l,children:[e.jsx(te,{id:t,onBlur:d,className:h("transition-all duration-200",r&&"border-red-500 focus:border-red-500 focus:ring-red-500",j&&"border-green-500 focus:border-green-500 focus:ring-green-500",T),"aria-invalid":r,"aria-describedby":r?`${t}-error`:E?`${t}-helper`:void 0,children:e.jsx(re,{placeholder:P})}),e.jsx(ie,{children:c.map(m=>e.jsx(le,{value:m.value,disabled:m.disabled,children:m.label},m.value))})]}),(n||r||j)&&e.jsxs("div",{className:"absolute right-10 top-1/2 -translate-y-1/2 pointer-events-none",children:[n&&e.jsx(L,{className:"h-4 w-4 animate-spin text-gray-400"}),r&&!n&&e.jsx(Z,{className:"h-4 w-4 text-red-500"}),j&&!n&&e.jsx(J,{className:"h-4 w-4 text-green-500"})]})]}),(E||r)&&e.jsx("div",{id:r?`${t}-error`:`${t}-helper`,className:h("text-sm",r?"text-red-600":"text-gray-500"),role:r?"alert":void 0,children:r?g:E})]})}const be=x.object({name:x.string().min(1,"거래처명을 입력하세요"),businessNumber:x.string().optional(),contactPerson:x.string().min(1,"담당자명을 입력하세요"),email:x.string().email("올바른 이메일 주소를 입력하세요"),phone:x.string().optional(),address:x.string().optional(),businessType:x.string().optional(),aliases:x.array(x.string()).optional()});function Se({isOpen:A,onClose:C,onSuccess:p,vendor:a}){const{toast:d}=ne(),[c,P]=b.useState(!1),[l,f]=b.useState([]),[g,y]=b.useState(""),{register:E,handleSubmit:N,reset:n,setValue:i,watch:w,formState:{errors:T}}=oe({resolver:ce(be),defaultValues:{name:"",businessNumber:"",contactPerson:"",email:"",phone:"",address:"",businessType:"",aliases:[]}}),t=w(),[r,j]=b.useState({}),m=B({mutationFn:async s=>await H("POST","/api/vendors",s),onSuccess:()=>{d({title:"성공",description:"거래처가 추가되었습니다."}),p(),F()},onError:s=>{if(K(s)){d({title:"Unauthorized",description:"You are logged out. Logging in again...",variant:"destructive"}),setTimeout(()=>{window.location.href="/api/login"},500);return}d({title:"오류",description:"거래처 추가에 실패했습니다.",variant:"destructive"})}}),D=B({mutationFn:async s=>await H("PUT",`/api/vendors/${a.id}`,s),onSuccess:()=>{d({title:"성공",description:"거래처가 수정되었습니다."}),p(),F()},onError:s=>{if(K(s)){d({title:"Unauthorized",description:"You are logged out. Logging in again...",variant:"destructive"}),setTimeout(()=>{window.location.href="/api/login"},500);return}d({title:"오류",description:"거래처 수정에 실패했습니다.",variant:"destructive"})}});b.useEffect(()=>{a?(n({name:a.name||"",businessNumber:a.businessNumber||"",contactPerson:a.contactPerson||"",email:a.email||"",phone:a.phone||"",address:a.address||"",businessType:a.businessType||"",aliases:a.aliases||[]}),f(a.aliases||[])):(n({name:"",businessNumber:"",contactPerson:"",email:"",phone:"",address:"",businessType:"",aliases:[]}),f([]))},[a,n]);const V=()=>{if(g.trim()&&!l.includes(g.trim())){const s=[...l,g.trim()];f(s),i("aliases",s),y("")}},k=s=>{const u=l.filter((M,v)=>v!==s);f(u),i("aliases",u)},F=()=>{n(),C()},$=s=>{P(!0);const u={...s,aliases:l};a?D.mutate(u):m.mutate(u),P(!1)};return e.jsx(ue,{open:A,onOpenChange:F,children:e.jsxs(xe,{className:"sm:max-w-lg max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsx(he,{className:"flex-shrink-0",children:e.jsx(pe,{children:a?"거래처 수정":"거래처 추가"})}),e.jsx("div",{className:"flex-1 overflow-y-auto pr-2 -mr-2",children:e.jsxs("form",{onSubmit:N($),className:"space-y-6",children:[e.jsx(I,{label:"거래처명",name:"name",value:t.name,onChange:s=>i("name",s),required:!0,error:T.name?.message,placeholder:"거래처명을 입력하세요",helperText:"정확한 거래처명을 입력해주세요",validating:r.name}),e.jsx(I,{label:"사업자등록번호",name:"businessNumber",value:t.businessNumber,onChange:s=>i("businessNumber",s),placeholder:"123-45-67890",helperText:"'-'를 포함하여 입력해주세요"}),e.jsx(I,{label:"담당자명",name:"contactPerson",value:t.contactPerson,onChange:s=>i("contactPerson",s),required:!0,error:T.contactPerson?.message,placeholder:"담당자명을 입력하세요"}),e.jsx(I,{label:"이메일",name:"email",type:"email",value:t.email,onChange:s=>i("email",s),required:!0,error:T.email?.message,placeholder:"example@company.com",helperText:"업무용 이메일 주소를 입력해주세요",validating:r.email}),e.jsx(I,{label:"연락처",name:"phone",type:"tel",value:t.phone,onChange:s=>i("phone",s),placeholder:"02-1234-5678",helperText:"하이픈(-)을 포함하여 입력해주세요"}),e.jsx(I,{label:"주소",name:"address",type:"textarea",value:t.address,onChange:s=>i("address",s),placeholder:"주소를 입력하세요",rows:3,maxLength:200}),e.jsx(je,{label:"업종",name:"businessType",value:t.businessType,onChange:s=>i("businessType",s),placeholder:"업종을 선택하세요",options:[{value:"construction",label:"건설업"},{value:"manufacturing",label:"제조업"},{value:"service",label:"서비스업"},{value:"wholesale",label:"도매업"},{value:"retail",label:"소매업"},{value:"other",label:"기타"}],helperText:"주요 업종을 선택해주세요"}),e.jsxs("div",{children:[e.jsx(q,{htmlFor:"aliases",children:"별칭 (선택사항)"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(U,{id:"newAlias",value:g,onChange:s=>y(s.target.value),placeholder:"별칭 입력 (예: (주)익진, 주식회사 익진)",onKeyPress:s=>{s.key==="Enter"&&(s.preventDefault(),V())}}),e.jsx(O,{type:"button",size:"sm",onClick:V,className:"px-3",children:e.jsx(de,{className:"h-4 w-4"})})]}),l.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:l.map((s,u)=>e.jsxs("div",{className:"flex items-center gap-1 bg-gray-100 px-2 py-1 rounded-md text-sm",children:[e.jsx("span",{children:s}),e.jsx("button",{type:"button",onClick:()=>k(u),className:"text-gray-500 hover:text-red-500",children:e.jsx(me,{className:"h-3 w-3"})})]},u))}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"거래처명의 다양한 표기법을 추가하여 자동 매칭이 가능합니다."})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4 border-t border-border mt-6 pt-6",children:[e.jsx(O,{type:"button",variant:"outline",onClick:F,disabled:c,children:"취소"}),e.jsx(O,{type:"submit",disabled:c||m.isPending||D.isPending,className:"min-w-[80px]",children:c||m.isPending||D.isPending?e.jsxs(e.Fragment,{children:[e.jsx(L,{className:"h-4 w-4 mr-2 animate-spin"}),"저장 중..."]}):a?"수정":"추가"})]})]})})]})})}export{Se as VendorForm};
