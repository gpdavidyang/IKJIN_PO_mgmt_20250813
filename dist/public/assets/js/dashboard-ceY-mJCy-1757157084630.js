import{d as O,e as T,u as R,g as V,h as P,r as p,i as U,j as e,z as E,F as $,f as g,l as j,C as K,a as w,bI as C,m as F}from"./index-C_jNirXW-1757157084630.js";import{D as M}from"./dashboard-skeleton-3xHPET_--1757157084630.js";import{AdvancedPieChart as z}from"./advanced-chart-QExVIOjJ-1757157084630.js";import{useRealTimeData as B}from"./dashboard-widgets-BHiOjNXk-1757157084630.js";import{A as Y}from"./activity-DcV6nNrt-1757157084630.js";import{P as y}from"./package-B8pd5py--1757157084630.js";import{D as X}from"./dollar-sign-BCvOd-SE-1757157084630.js";import{U as G}from"./users-Cys9AQWH-1757157084630.js";import{T as A}from"./trending-up-Ir9okTzv-1757157084630.js";import{R as I,B as Q,C as W,X as _,Y as q,T as H,a as J}from"./PieChart-Bo9z92qp-1757157084630.js";import"./download-MAbNT2z1-1757157084630.js";import"./AreaChart-GWnH7AXg-1757157084630.js";import"./refresh-cw-CbRhwiWc-1757157084630.js";import"./index-BxZvnpVn-1757157084630.js";function ge(){const{user:n,isLoading:f}=O(),{toast:v}=T(),[,l]=R();V();const{theme:S}=P(),t=S==="dark";p.useEffect(()=>{if(!f&&!n){v({title:"Unauthorized",description:"You are logged out. Redirecting to login...",variant:"destructive"}),setTimeout(()=>{l("/login")},500);return}},[n,f,v]);const{data:i,isLoading:k,error:h}=U();p.useEffect(()=>{h&&console.error("Dashboard data fetch error:",h),i&&console.log("Dashboard data loaded:",i)},[i,h]);const r=i?.statistics||{},N=i?.recentOrders||[],c=i?.monthlyStats||[];i?.statusStats;const d=i?.orderStatusStats||[],x=i?.projectStats||[],m=i?.categoryStats||[];r.activeProjects;const{data:u,loading:b,refresh:D}=B(r,async()=>(await(await fetch("/api/dashboard/unified")).json()).statistics||{},3e4,!!n);u.totalOrders||r.totalOrders,r.totalOrders,u.totalAmount||r.totalAmount,r.totalAmount,u.completedOrders||r.completedOrders,r.completedOrders;const o=k;return o?e.jsx(M,{}):n?e.jsx("div",{className:`p-2 min-h-screen transition-colors ${t?"bg-gray-900":"bg-gray-50"}`,children:e.jsxs("div",{className:"max-w-[1366px] mx-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("div",{children:e.jsx("h1",{className:`text-sm font-semibold transition-colors ${t?"text-gray-100":"text-gray-900"}`,children:"대시보드"})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:D,disabled:b,className:`text-xs flex items-center gap-1 px-1 py-0.5 rounded transition-colors ${t?"text-gray-400 hover:text-gray-300 hover:bg-gray-700":"text-gray-500 hover:text-gray-700 hover:bg-gray-100"}`,children:[e.jsx(Y,{className:`h-3 w-3 ${b?"animate-spin":""}`}),b?"업데이트":"새로고침"]}),e.jsx("span",{className:`text-xs transition-colors ${t?"text-gray-400":"text-gray-500"}`,children:new Date().toLocaleTimeString("ko-KR",{hour:"2-digit",minute:"2-digit"})})]})]}),e.jsxs("div",{className:"grid grid-cols-6 gap-1 mb-2",children:[e.jsx("div",{className:`rounded border p-2 hover:shadow-sm transition-all cursor-pointer ${t?"bg-blue-900/20 border-blue-700 hover:bg-blue-900/30":"bg-blue-50/30 border-blue-300 hover:bg-blue-50/50"}`,onClick:()=>l("/orders?status=completed"),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:`w-6 h-6 rounded-full flex items-center justify-center ${t?"bg-green-900/30":"bg-green-100"}`,children:e.jsx(y,{className:`h-3 w-3 ${t?"text-green-400":"text-green-600"}`})}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:`text-lg font-bold transition-colors ${t?"text-gray-100":"text-gray-900"}`,children:r.completedOrders||0}),e.jsx("div",{className:`text-xs transition-colors ${t?"text-gray-400":"text-gray-500"}`,children:"발주완료"})]})]})}),e.jsx("div",{className:`rounded border p-2 hover:shadow-sm transition-all cursor-pointer ${t?"bg-blue-900/20 border-blue-700 hover:bg-blue-900/30":"bg-blue-50/30 border-blue-300 hover:bg-blue-50/50"}`,onClick:()=>l("/orders?filter=urgent"),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:`w-6 h-6 rounded-full flex items-center justify-center ${t?"bg-red-900/30":"bg-red-100"}`,children:e.jsx(E,{className:`h-3 w-3 ${t?"text-red-400":"text-red-600"}`})}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:`text-lg font-bold transition-colors ${t?"text-gray-100":"text-gray-900"}`,children:r.urgentOrders||0}),e.jsx("div",{className:`text-xs transition-colors ${t?"text-gray-400":"text-gray-500"}`,children:"긴급발주"})]})]})}),e.jsx("div",{className:`rounded border p-2 transition-colors ${t?"bg-blue-900/20 border-blue-700":"bg-blue-50/30 border-blue-300"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:`w-6 h-6 rounded-full flex items-center justify-center ${t?"bg-blue-800/30":"bg-blue-100"}`,children:e.jsx($,{className:`h-3 w-3 ${t?"text-blue-400":"text-blue-600"}`})}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:`text-lg font-bold transition-colors ${t?"text-gray-100":"text-gray-900"}`,children:r.totalOrders||0}),e.jsx("div",{className:`text-xs transition-colors ${t?"text-gray-400":"text-gray-500"}`,children:"총발주서"})]})]})}),e.jsx("div",{className:`rounded border p-2 transition-colors ${t?"bg-blue-900/20 border-blue-700":"bg-blue-50/30 border-blue-300"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:`w-6 h-6 rounded-full flex items-center justify-center ${t?"bg-emerald-900/30":"bg-emerald-100"}`,children:e.jsx(X,{className:`h-3 w-3 ${t?"text-emerald-400":"text-emerald-600"}`})}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:`text-sm font-bold transition-colors ${t?"text-blue-400":"text-blue-600"}`,children:g(r.totalAmount||0).replace("₩","").replace(",000,000","M")}),e.jsx("div",{className:`text-xs transition-colors ${t?"text-gray-400":"text-gray-500"}`,children:"총금액"})]})]})}),e.jsx("div",{className:`rounded border p-2 transition-colors ${t?"bg-blue-900/20 border-blue-700":"bg-blue-50/30 border-blue-300"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:`w-6 h-6 rounded-full flex items-center justify-center ${t?"bg-purple-900/30":"bg-purple-100"}`,children:e.jsx(j,{className:`h-3 w-3 ${t?"text-purple-400":"text-purple-600"}`})}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:`text-lg font-bold transition-colors ${t?"text-gray-100":"text-gray-900"}`,children:r.activeProjects||0}),e.jsx("div",{className:`text-xs transition-colors ${t?"text-gray-400":"text-gray-500"}`,children:"활성현장"})]})]})}),e.jsx("div",{className:`rounded border p-2 transition-colors ${t?"bg-blue-900/20 border-blue-700":"bg-blue-50/30 border-blue-300"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:`w-6 h-6 rounded-full flex items-center justify-center ${t?"bg-indigo-900/30":"bg-indigo-100"}`,children:e.jsx(G,{className:`h-3 w-3 ${t?"text-indigo-400":"text-indigo-600"}`})}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:`text-lg font-bold transition-colors ${t?"text-gray-100":"text-gray-900"}`,children:r.activeVendors||0}),e.jsx("div",{className:`text-xs transition-colors ${t?"text-gray-400":"text-gray-500"}`,children:"활성거래처"})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-1",children:[e.jsxs("div",{className:"space-y-1",children:[!o&&c&&Array.isArray(c)&&c.length>0?(()=>{const s=c.map(a=>({month:a.month.replace("-","/"),orders:Number(a.count)||0}));return e.jsxs("div",{className:`rounded border p-2 transition-colors ${t?"bg-gray-800 border-gray-600":"bg-white border-blue-300"}`,children:[e.jsxs("div",{className:"flex items-center gap-1 mb-2",children:[e.jsx(A,{className:`h-3 w-3 transition-colors ${t?"text-gray-400":"text-gray-600"}`}),e.jsx("h3",{className:`text-xs font-semibold transition-colors ${t?"text-gray-100":"text-gray-900"}`,children:"월별 발주 통계"})]}),e.jsx("div",{className:"h-[140px] w-full",children:e.jsx(I,{width:"100%",height:"100%",children:e.jsxs(Q,{data:s,margin:{top:5,right:5,left:5,bottom:5},children:[e.jsx(W,{strokeDasharray:"2 2",stroke:"#f3f4f6"}),e.jsx(_,{dataKey:"month",fontSize:9,axisLine:!1,tickLine:!1}),e.jsx(q,{fontSize:9,axisLine:!1,tickLine:!1}),e.jsx(H,{formatter:a=>[`${a}건`,"발주 건수"]}),e.jsx(J,{dataKey:"orders",fill:"#3b82f6",radius:[2,2,0,0]})]})})})]})})():e.jsxs("div",{className:`rounded border p-2 transition-colors ${t?"bg-gray-800 border-gray-600":"bg-white border-blue-300"}`,children:[e.jsxs("div",{className:"flex items-center gap-1 mb-2",children:[e.jsx(A,{className:`h-3 w-3 transition-colors ${t?"text-gray-400":"text-gray-600"}`}),e.jsx("h3",{className:`text-xs font-semibold transition-colors ${t?"text-gray-100":"text-gray-900"}`,children:"월별 발주 통계"})]}),e.jsx("div",{className:`h-[140px] flex items-center justify-center transition-colors ${t?"text-gray-400":"text-gray-500"}`,children:e.jsxs("div",{className:"text-center",children:[e.jsx(K,{className:`h-6 w-6 mx-auto mb-1 transition-colors ${t?"text-gray-600":"text-gray-300"}`}),e.jsx("p",{className:"text-xs",children:"데이터 준비 중..."})]})})]}),e.jsxs("div",{className:`rounded border p-2 transition-colors ${t?"bg-gray-800 border-gray-600":"bg-white border-blue-300"}`,children:[e.jsxs("div",{className:"flex items-center gap-1 mb-2",children:[e.jsx(y,{className:`h-3 w-3 transition-colors ${t?"text-gray-400":"text-gray-600"}`}),e.jsx("h3",{className:`text-xs font-semibold transition-colors ${t?"text-gray-100":"text-gray-900"}`,children:"발주상태분포"})]}),o?e.jsx("div",{className:`h-[140px] flex items-center justify-center transition-colors ${t?"text-gray-400":"text-gray-500"}`,children:e.jsxs("div",{className:"text-center",children:[e.jsx(y,{className:`h-6 w-6 mx-auto mb-1 transition-colors ${t?"text-gray-600":"text-gray-300"}`}),e.jsx("p",{className:"text-xs",children:"데이터 준비 중..."})]})}):e.jsx("div",{className:"h-[140px] w-full",children:e.jsx(z,{data:[{name:"임시저장",value:d.find(s=>s.status==="draft")?.count||0,status:"draft"},{name:"발주생성",value:d.find(s=>s.status==="created")?.count||0,status:"created"},{name:"발주완료",value:d.find(s=>s.status==="sent")?.count||0,status:"sent"},{name:"납품완료",value:d.find(s=>s.status==="delivered")?.count||0,status:"delivered"}],dataKey:"value",nameKey:"name",height:140,showExport:!1,showLabels:!1,showLegend:!1,innerRadius:20,outerRadius:45,colors:["#6b7280","#f59e0b","#3b82f6","#10b981"],formatValue:s=>`${s}건`})})]})]}),e.jsxs("div",{className:`rounded border p-2 transition-colors ${t?"bg-gray-800 border-gray-600":"bg-white border-gray-200"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(j,{className:`h-3 w-3 transition-colors ${t?"text-gray-400":"text-gray-600"}`}),e.jsx("h3",{className:`text-xs font-semibold transition-colors ${t?"text-gray-100":"text-gray-900"}`,children:"현장별 발주 현황"})]}),e.jsx("span",{className:`text-xs transition-colors ${t?"text-gray-400":"text-gray-500"}`,children:"상위 10개"})]}),e.jsx("div",{className:"h-[260px] overflow-y-auto",children:!o&&x&&Array.isArray(x)&&x.length>0?e.jsx("div",{className:"space-y-1",children:x.slice(0,10).map((s,a)=>e.jsxs("div",{className:`flex items-center justify-between p-1.5 rounded cursor-pointer transition-colors ${t?"hover:bg-gray-700":"hover:bg-gray-50"}`,onClick:()=>l(`/projects/${s.id}`),children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-1",children:[e.jsx("span",{className:`text-xs font-medium w-4 text-center transition-colors ${t?"text-gray-400":"text-gray-600"}`,children:a+1}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("div",{className:`text-xs font-medium truncate transition-colors ${t?"text-gray-100":"text-gray-900"}`,title:s.projectName,children:s.projectName}),e.jsxs("div",{className:`text-xs transition-colors ${t?"text-gray-400":"text-gray-500"}`,children:[s.orderCount,"건"]})]})]}),e.jsx("div",{className:"text-right",children:e.jsx("div",{className:`text-xs font-semibold transition-colors ${t?"text-blue-400":"text-blue-600"}`,children:g(s.totalAmount||0).replace("₩","").replace(",000,000","M")})})]},a))}):e.jsx("div",{className:`h-[240px] flex items-center justify-center transition-colors ${t?"text-gray-400":"text-gray-500"}`,children:e.jsxs("div",{className:"text-center",children:[e.jsx(j,{className:`h-6 w-6 mx-auto mb-1 transition-colors ${t?"text-gray-600":"text-gray-300"}`}),e.jsx("p",{className:"text-xs",children:"데이터 준비 중..."})]})})})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:`rounded border p-2 transition-colors ${t?"bg-gray-800 border-gray-600":"bg-white border-gray-200"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(w,{className:`h-3 w-3 transition-colors ${t?"text-gray-400":"text-gray-600"}`}),e.jsx("h3",{className:`text-xs font-semibold transition-colors ${t?"text-gray-100":"text-gray-900"}`,children:"최근 발주서"})]}),e.jsx("button",{onClick:()=>l("/orders"),className:`text-xs font-medium transition-colors ${t?"text-blue-400 hover:text-blue-300":"text-blue-600 hover:text-blue-800"}`,children:"전체보기"})]}),e.jsx("div",{className:"h-[120px] overflow-y-auto",children:!o&&N.length>0?e.jsx("div",{className:"space-y-1",children:N.slice(0,6).map((s,a)=>e.jsxs("div",{className:`flex items-center justify-between p-1 rounded cursor-pointer transition-colors ${t?"hover:bg-gray-700":"hover:bg-gray-50"}`,children:[e.jsxs("div",{className:"min-w-0 flex-1",onClick:()=>l(`/orders/${s.id}`),children:[e.jsx("div",{className:`text-xs font-medium truncate transition-colors ${t?"text-gray-100":"text-gray-900"}`,children:s.orderNumber}),e.jsx("div",{className:`text-xs transition-colors ${t?"text-gray-400":"text-gray-500"}`,children:s.vendor?.name})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"text-right",children:e.jsx("div",{className:`text-xs font-semibold transition-colors ${t?"text-blue-400":"text-blue-600"}`,children:g(s.totalAmount||0).replace("₩","").replace(",000,000","M")})}),(s.orderStatus||s.status,s.orderStatus?s.orderStatus!=="draft"&&["created","sent","delivered"].includes(s.orderStatus):s.status!=="draft"&&["approved","sent","completed"].includes(s.status))&&e.jsx("button",{onClick:L=>{L.stopPropagation(),window.open(`/api/orders/${s.id}/download-pdf`,"_blank")},className:`p-1 rounded transition-colors ${t?"text-orange-400 hover:bg-orange-900/20 hover:text-orange-300":"text-orange-500 hover:bg-orange-50 hover:text-orange-700"}`,title:"PDF 다운로드",children:e.jsx($,{className:"h-3 w-3"})})]})]},a))}):e.jsx("div",{className:`h-[100px] flex items-center justify-center transition-colors ${t?"text-gray-400":"text-gray-500"}`,children:e.jsxs("div",{className:"text-center",children:[e.jsx(w,{className:`h-6 w-6 mx-auto mb-1 transition-colors ${t?"text-gray-600":"text-gray-300"}`}),e.jsx("p",{className:"text-xs",children:"데이터 준비 중..."})]})})})]}),e.jsxs("div",{className:`rounded border p-2 transition-colors ${t?"bg-gray-800 border-gray-600":"bg-white border-gray-200"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(C,{className:`h-3 w-3 transition-colors ${t?"text-gray-400":"text-gray-600"}`}),e.jsx("h3",{className:`text-xs font-semibold transition-colors ${t?"text-gray-100":"text-gray-900"}`,children:"품목 분류"})]}),e.jsx("button",{onClick:()=>l("/category-management"),className:`text-xs font-medium transition-colors ${t?"text-blue-400 hover:text-blue-300":"text-blue-600 hover:text-blue-800"}`,children:"관리"})]}),e.jsx("div",{className:"h-[120px] overflow-y-auto",children:!o&&m&&Array.isArray(m)&&m.length>0?e.jsx("div",{className:"space-y-1",children:m.slice(0,6).sort((s,a)=>a.totalAmount-s.totalAmount).map((s,a)=>e.jsxs("div",{className:`flex items-center justify-between p-1 rounded cursor-pointer transition-colors ${t?"hover:bg-gray-700":"hover:bg-gray-50"}`,children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:`text-xs font-medium transition-colors ${t?"text-gray-100":"text-gray-900"}`,children:s.majorCategory}),s.middleCategory!=="미분류"&&e.jsxs(e.Fragment,{children:[e.jsx(F,{className:`h-2 w-2 transition-colors ${t?"text-gray-500":"text-gray-400"}`}),e.jsx("span",{className:`text-xs truncate transition-colors ${t?"text-gray-400":"text-gray-600"}`,children:s.middleCategory})]})]}),e.jsxs("div",{className:`text-xs transition-colors ${t?"text-gray-400":"text-gray-500"}`,children:[s.orderCount,"건"]})]}),e.jsx("div",{className:"text-right",children:e.jsx("div",{className:`text-xs font-semibold transition-colors ${t?"text-blue-400":"text-blue-600"}`,children:g(s.totalAmount).replace("₩","").replace(",000,000","M")})})]},a))}):e.jsx("div",{className:`h-[100px] flex items-center justify-center transition-colors ${t?"text-gray-400":"text-gray-500"}`,children:e.jsxs("div",{className:"text-center",children:[e.jsx(C,{className:`h-6 w-6 mx-auto mb-1 transition-colors ${t?"text-gray-600":"text-gray-300"}`}),e.jsx("p",{className:"text-xs",children:"데이터 준비 중..."})]})})})]})]})]})]})}):null}export{ge as default};
