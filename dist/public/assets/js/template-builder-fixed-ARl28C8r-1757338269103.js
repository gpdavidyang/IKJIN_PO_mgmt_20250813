import{j as e,w as C,e as ee,r as y,q as se,o as ae,B as b,E as te,L as O,N as q,x as H,aa as L,O as x,S as $,z as A,A as z,y as N,D as M,G as u,a5 as le,a6 as re,a7 as F,a8 as Y,P as J,T as B,aL as V,K as ie}from"./index-Cjl45-Cd-1757338269103.js";import{T as K}from"./textarea-D2Rq_Euv-1757338269103.js";import{S as ne}from"./save-Bl6fpJBB-1757338269103.js";function de({config:i,data:T=[]}){const D=T.length>0?T:Array.from({length:Math.min(i.rowsCount,10)},(n,d)=>Array.from({length:i.columns.length},(m,g)=>{const c=i.columns[g];return c.data==="no"?d+1:c.type==="numeric"?0:c.type==="checkbox"?!1:(c.type==="image","")})),_=(n,d)=>d.type==="numeric"?typeof n=="number"?n.toLocaleString():n||"0":d.type==="checkbox"?n?"☑":"☐":d.type==="image"?n?"📷":"":d.type==="date"?n||"YYYY-MM-DD":n||"";return e.jsxs(C,{className:"p-1",children:[e.jsx("div",{className:"border rounded-lg overflow-auto max-h-96",children:e.jsxs("table",{className:"w-full text-xs border-collapse",children:[e.jsx("thead",{className:"bg-gray-50 sticky top-0",children:e.jsxs("tr",{children:[e.jsx("th",{className:"w-12 p-2 border border-gray-300 text-center font-medium bg-gray-100",children:"#"}),i.colHeaders.map((n,d)=>e.jsx("th",{className:"p-2 border border-gray-300 text-left font-medium bg-gray-50",style:{width:i.columns[d]?.width||100,minWidth:i.columns[d]?.width||100},children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium",children:n}),e.jsx("span",{className:"text-xs text-gray-500 font-normal",children:i.columns[d]?.type||"text"})]})},d))]})}),e.jsx("tbody",{children:D.map((n,d)=>e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"w-12 p-2 border border-gray-300 text-center text-gray-500 bg-gray-50 font-medium",children:d+1}),i.columns.map((m,g)=>e.jsx("td",{className:`p-2 border border-gray-300 ${m.readOnly?"bg-gray-50":"bg-white"} ${m.type==="numeric"?"text-right":"text-left"}`,style:{width:m.width||100,minWidth:m.width||100},children:e.jsx("div",{className:"truncate",children:_(n[g],m)})},g))]},d))})]})}),e.jsxs("div",{className:"mt-2 p-2 bg-blue-50 border-t text-xs text-blue-800",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"총 컬럼:"})," ",i.columns.length,"개"]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"총 행:"})," ",i.rowsCount,"개"]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"표시:"})," ",Math.min(i.rowsCount,10),"행"]})]}),e.jsx("div",{className:"mt-1 text-blue-600",children:"💡 실제 스프레드시트에서는 수식, 이미지, 드롭다운 등 모든 기능이 지원됩니다"})]})]})}const r={card:"border border-border/50 shadow-sm",section:"space-y-1",label:"text-xs font-medium text-muted-foreground",input:"h-7 text-xs",button:"h-7 text-xs px-2",textarea:"min-h-[60px] text-xs resize-none",select:"h-7 text-xs"};function xe({templateId:i,onSave:T,onCancel:D}){const{toast:_}=ee(),[n,d]=y.useState(""),[m,g]=y.useState("handsontable"),[c,v]=y.useState([]),[l,w]=y.useState({colHeaders:["품목명","수량","단가","총액","규격","비고"],columns:[{data:"itemName",title:"품목명",type:"text",width:150},{data:"quantity",title:"수량",type:"numeric",width:80},{data:"unitPrice",title:"단가",type:"numeric",width:100},{data:"totalAmount",title:"총액",type:"numeric",width:120,readOnly:!0},{data:"specification",title:"규격",type:"text",width:120},{data:"notes",title:"비고",type:"text",width:150}],rowsCount:10,formulas:{},validationRules:{},customStyles:{},settings:{}}),[P,R]=y.useState(!1),[Q,E]=y.useState(!1),{data:o}=se({queryKey:["/api/order-templates",i],queryFn:()=>fetch(`/api/order-templates/${i}`,{credentials:"include"}).then(s=>s.json()),enabled:!!i});y.useEffect(()=>{if(o&&i){console.log("Loading template data:",o),d(o.templateName||"");const s=o.templateType==="material_extrusion"||o.templateType==="panel_manufacturing"?"general":o.templateType;if(g(s||"handsontable"),o.fieldsConfig)try{const a=typeof o.fieldsConfig=="string"?JSON.parse(o.fieldsConfig):o.fieldsConfig;if(console.log("Parsed fieldsConfig:",a),o.templateType==="general"||o.templateType==="material_extrusion"||o.templateType==="panel_manufacturing"){if(a.fields&&Array.isArray(a.fields))v(a.fields),console.log("Loaded fields:",a.fields);else if(a&&Array.isArray(a))v(a),console.log("Loaded fields (direct array):",a);else if(a.item_fields||a.basic_fields||a.extrusion_list||a.schedule_fields||a.specification_fields||a.color_breakdown||a.material_fields||a.panel_breakdown||a.delivery_schedule||a.insulation_details){const t=[];let p=0;[{key:"basic_fields",name:"기본 정보",data:a.basic_fields},{key:"item_fields",name:"품목 정보",data:a.item_fields},{key:"extrusion_list",name:"압출 목록",data:a.extrusion_list},{key:"schedule_fields",name:"일정 정보",data:a.schedule_fields},{key:"specification_fields",name:"사양 정보",data:a.specification_fields},{key:"color_breakdown",name:"색상 분류",data:a.color_breakdown},{key:"material_fields",name:"재료 정보",data:a.material_fields},{key:"panel_breakdown",name:"판넬 분류",data:a.panel_breakdown},{key:"delivery_schedule",name:"배송 일정",data:a.delivery_schedule},{key:"insulation_details",name:"단열재 상세",data:a.insulation_details}].forEach(j=>{j.data&&Object.entries(j.data).forEach(([h,I])=>{t.push({id:`${j.key}_${h}`,fieldType:h.includes("date")?"date":h.includes("amount")||h.includes("price")||h.includes("quantity")||h.includes("count")||h.includes("weight")||h.includes("kg")||h.includes("area")||h==="quantity"?"number":"text",fieldName:h,label:I,placeholder:"",required:!0,validation:{},options:[],gridPosition:{row:Math.floor(p/3),col:p%3,span:1},sectionName:j.name,sortOrder:p++})})}),v(t),console.log("Converted legacy fields:",t)}}else o.templateType==="handsontable"&&(a.handsontableConfig?w(a.handsontableConfig):a.columns&&w(a))}catch(a){console.error("Error parsing fieldsConfig:",a)}o.handsontableConfig&&w(o.handsontableConfig)}},[o,i]);const W=()=>{const s={id:`field_${Date.now()}`,fieldType:"text",fieldName:`field_${c.length+1}`,label:`필드 ${c.length+1}`,placeholder:"",required:!1,validation:{},options:[],gridPosition:{row:0,col:0,span:1},sectionName:"기본",sortOrder:c.length};v([...c,s])},G=s=>{v(c.filter(a=>a.id!==s))},k=(s,a)=>{v(c.map(t=>t.id===s?{...t,...a}:t))},U=()=>{const s={data:`col_${l.columns.length}`,title:`컬럼 ${l.columns.length+1}`,type:"text",width:100};w({...l,colHeaders:[...l.colHeaders,s.title],columns:[...l.columns,s]})},X=s=>{const a=l.columns.filter((p,f)=>f!==s),t=l.colHeaders.filter((p,f)=>f!==s);w({...l,colHeaders:t,columns:a})},S=(s,a)=>{const t=l.columns.map((j,h)=>h===s?{...j,...a}:j),p=l.colHeaders.map((j,h)=>h===s&&a.title?a.title:j),f={...l,colHeaders:p,columns:t};console.log("updateColumn called:",{index:s,updates:a,newConfig:f}),w(f)},Z=async()=>{if(!n.trim()){_({title:"오류",description:"템플릿 이름을 입력하세요.",variant:"destructive"});return}E(!0);try{const s={templateName:n,templateType:m,fieldsConfig:JSON.stringify(m==="general"?{fields:c}:{handsontableConfig:l}),handsontableConfig:m==="handsontable"?l:void 0,isActive:!0};i?await fetch(`/api/order-templates/${i}`,{method:"PUT",body:JSON.stringify(s),headers:{"Content-Type":"application/json"},credentials:"include"}):await fetch("/api/order-templates",{method:"POST",body:JSON.stringify(s),headers:{"Content-Type":"application/json"},credentials:"include"}),ie.invalidateQueries({queryKey:["/api/order-templates"]}),T&&T(s),_({title:"성공",description:"템플릿이 저장되었습니다."})}catch(s){console.error("Template save error:",s),_({title:"오류",description:"템플릿 저장 중 오류가 발생했습니다.",variant:"destructive"})}finally{E(!1)}};return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between p-2 border-b",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("h2",{className:"text-sm font-semibold",children:"템플릿 빌더"}),e.jsx(ae,{variant:m==="handsontable"?"default":"secondary",className:"text-xs",children:m==="handsontable"?"시트유형":"일반폼"})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsxs(b,{variant:"outline",size:"sm",onClick:()=>R(!P),className:r.button,children:[e.jsx(te,{className:"w-3 h-3 mr-1"}),"미리보기"]}),e.jsxs(b,{onClick:Z,disabled:Q,size:"sm",className:r.button,children:[e.jsx(ne,{className:"w-3 h-3 mr-1"}),"저장"]}),D&&e.jsx(b,{variant:"outline",onClick:D,size:"sm",className:r.button,children:"취소"})]})]}),P?e.jsx("div",{className:"h-[calc(100vh-200px)]",children:e.jsxs(C,{className:"h-full",children:[e.jsx(O,{className:"pb-2",children:e.jsxs(q,{className:"text-sm",children:["템플릿 미리보기 - ",n]})}),e.jsx(H,{children:e.jsx(L,{className:"h-[calc(100vh-280px)]",children:m==="general"?e.jsx("div",{className:"space-y-4",children:c.length===0?e.jsx("div",{className:"text-center text-muted-foreground text-sm py-8",children:"필드를 추가하여 폼을 구성하세요"}):e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsx("div",{className:"grid grid-cols-3 gap-4",children:c.map(s=>e.jsxs("div",{className:"space-y-2",children:[e.jsxs(x,{className:"text-sm font-medium",children:[s.label||s.fieldName,s.required&&e.jsx("span",{className:"text-red-500",children:"*"})]}),s.fieldType==="textarea"?e.jsx(K,{placeholder:s.placeholder,className:"h-20",disabled:!0}):s.fieldType==="select"?e.jsx($,{disabled:!0,children:e.jsx(A,{children:e.jsx(z,{placeholder:s.placeholder})})}):e.jsx(N,{type:s.fieldType==="number"?"number":s.fieldType==="date"?"date":"text",placeholder:s.placeholder,disabled:!0})]},s.id))})})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"text-lg font-medium",children:"시트유형 미리보기"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"실제 스프레드시트 구조 및 데이터 타입"})]}),e.jsx(de,{config:l})]})})})]})}):e.jsxs("div",{className:"grid grid-cols-12 gap-2 h-[calc(100vh-200px)]",children:[e.jsx("div",{className:"col-span-4 border-r pr-2",children:e.jsx(L,{className:"h-full",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs(C,{className:r.card,children:[e.jsx(O,{className:"pb-1",children:e.jsx(q,{className:"text-xs",children:"기본 설정"})}),e.jsxs(H,{className:"space-y-1.5",children:[e.jsxs("div",{className:r.section,children:[e.jsx(x,{className:r.label,children:"템플릿 이름"}),e.jsx(N,{value:n,onChange:s=>d(s.target.value),placeholder:"템플릿 이름 입력",className:r.input})]}),e.jsxs("div",{className:r.section,children:[e.jsx(x,{className:r.label,children:"템플릿 유형"}),e.jsxs($,{value:m,onValueChange:s=>g(s),children:[e.jsx(A,{className:r.input,children:e.jsx(z,{})}),e.jsxs(M,{children:[e.jsx(u,{value:"general",children:"일반폼"}),e.jsx(u,{value:"handsontable",children:"시트폼"})]})]})]})]})]}),e.jsxs(le,{value:m,className:"w-full",children:[e.jsxs(re,{className:"grid w-full grid-cols-2 h-7",children:[e.jsx(F,{value:"general",className:"text-xs h-5",children:"일반폼"}),e.jsx(F,{value:"handsontable",className:"text-xs h-5",children:"시트폼"})]}),e.jsx(Y,{value:"general",className:"space-y-2 mt-2",children:e.jsxs(C,{className:r.card,children:[e.jsx(O,{className:"pb-1",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(q,{className:"text-xs",children:"필드 관리"}),e.jsxs(b,{size:"sm",onClick:W,className:r.button,children:[e.jsx(J,{className:"w-3 h-3 mr-1"}),"추가"]})]})}),e.jsx(H,{className:"space-y-2",children:c.map((s,a)=>e.jsxs("div",{className:"p-2 border rounded space-y-1.5",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(x,{className:"text-xs font-medium",children:["필드 ",a+1]}),e.jsx(b,{size:"sm",variant:"outline",onClick:()=>G(s.id),className:"h-6 w-6 p-0",children:e.jsx(B,{className:"w-3 h-3"})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-1",children:[e.jsxs("div",{children:[e.jsx(x,{className:"text-xs text-muted-foreground",children:"필드명"}),e.jsx(N,{value:s.fieldName,onChange:t=>k(s.id,{fieldName:t.target.value}),className:r.input})]}),e.jsxs("div",{children:[e.jsx(x,{className:"text-xs text-muted-foreground",children:"라벨"}),e.jsx(N,{value:s.label,onChange:t=>k(s.id,{label:t.target.value}),className:r.input})]})]}),e.jsxs("div",{children:[e.jsx(x,{className:"text-xs text-muted-foreground",children:"유형"}),e.jsxs($,{value:s.fieldType,onValueChange:t=>k(s.id,{fieldType:t}),children:[e.jsx(A,{className:r.input,children:e.jsx(z,{})}),e.jsxs(M,{children:[e.jsx(u,{value:"text",children:"텍스트"}),e.jsx(u,{value:"number",children:"숫자"}),e.jsx(u,{value:"date",children:"날짜"}),e.jsx(u,{value:"select",children:"선택"}),e.jsx(u,{value:"textarea",children:"긴텍스트"})]})]})]}),e.jsxs("div",{children:[e.jsx(x,{className:"text-xs text-muted-foreground",children:"플레이스홀더"}),e.jsx(N,{value:s.placeholder,onChange:t=>k(s.id,{placeholder:t.target.value}),className:r.input})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(V,{checked:s.required,onCheckedChange:t=>k(s.id,{required:t})}),e.jsx(x,{className:"text-xs",children:"필수"})]})]},s.id))})]})}),e.jsx(Y,{value:"handsontable",className:"space-y-2 mt-2",children:e.jsxs(C,{className:r.card,children:[e.jsx(O,{className:"pb-1",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(q,{className:"text-xs",children:"컬럼 관리"}),e.jsxs(b,{size:"sm",onClick:U,className:r.button,children:[e.jsx(J,{className:"w-3 h-3 mr-1"}),"추가"]})]})}),e.jsx(H,{className:"space-y-2",children:l.columns.map((s,a)=>e.jsxs("div",{className:"p-2 border rounded space-y-1.5",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(x,{className:"text-xs font-medium",children:["컬럼 ",a+1]}),e.jsx(b,{size:"sm",variant:"outline",onClick:()=>X(a),className:"h-6 w-6 p-0",children:e.jsx(B,{className:"w-3 h-3"})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-1",children:[e.jsxs("div",{children:[e.jsx(x,{className:"text-xs text-muted-foreground",children:"제목"}),e.jsx(N,{value:s.title,onChange:t=>S(a,{title:t.target.value}),className:r.input})]}),e.jsxs("div",{children:[e.jsx(x,{className:"text-xs text-muted-foreground",children:"데이터"}),e.jsx(N,{value:s.data,onChange:t=>S(a,{data:t.target.value}),className:r.input})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-1",children:[e.jsxs("div",{children:[e.jsx(x,{className:"text-xs text-muted-foreground",children:"유형"}),e.jsxs($,{value:s.type,onValueChange:t=>S(a,{type:t}),children:[e.jsx(A,{className:r.input,children:e.jsx(z,{})}),e.jsxs(M,{children:[e.jsx(u,{value:"text",children:"텍스트"}),e.jsx(u,{value:"numeric",children:"숫자"}),e.jsx(u,{value:"date",children:"날짜"}),e.jsx(u,{value:"dropdown",children:"드롭다운"}),e.jsx(u,{value:"checkbox",children:"체크박스"})]})]})]}),e.jsxs("div",{children:[e.jsx(x,{className:"text-xs text-muted-foreground",children:"너비"}),e.jsx(N,{type:"number",value:s.width||100,onChange:t=>S(a,{width:parseInt(t.target.value)}),className:r.input})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(V,{checked:s.readOnly||!1,onCheckedChange:t=>S(a,{readOnly:t})}),e.jsx(x,{className:"text-xs",children:"읽기전용"})]})]},a))})]})})]})]})})}),e.jsx("div",{className:"col-span-8",children:e.jsxs(C,{className:"h-full",children:[e.jsx(O,{className:"pb-2",children:e.jsx(q,{className:"text-sm",children:"미리보기"})}),e.jsx(H,{children:e.jsx(L,{className:"h-[calc(100vh-300px)]",children:m==="general"?e.jsx("div",{className:"space-y-2",children:c.length===0?e.jsx("div",{className:"text-center text-muted-foreground text-sm py-8",children:"필드를 추가하여 폼을 구성하세요"}):e.jsx("div",{className:"grid grid-cols-3 gap-2",children:c.map(s=>e.jsxs("div",{className:"space-y-1",children:[e.jsxs(x,{className:r.label,children:[s.label||s.fieldName,s.required&&e.jsx("span",{className:"text-red-500",children:"*"})]}),s.fieldType==="textarea"?e.jsx(K,{placeholder:s.placeholder,className:"h-16 text-xs",disabled:!0}):s.fieldType==="select"?e.jsx($,{disabled:!0,children:e.jsx(A,{className:r.input,children:e.jsx(z,{placeholder:s.placeholder})})}):e.jsx(N,{type:s.fieldType==="number"?"number":s.fieldType==="date"?"date":"text",placeholder:s.placeholder,className:r.input,disabled:!0})]},s.id))})}):e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"시트유형 실시간 미리보기"}),e.jsx("div",{className:"border rounded-lg overflow-hidden",children:e.jsxs("table",{className:"w-full text-xs",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"w-8 p-1 border-r text-center font-medium",children:"#"}),l.colHeaders.map((s,a)=>e.jsx("th",{className:"p-1 border-r text-left font-medium",style:{width:l.columns[a]?.width||100},children:s},a))]})}),e.jsx("tbody",{children:Array.from({length:Math.min(l.rowsCount,5)},(s,a)=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"p-1 border-r text-center bg-gray-50 font-medium",children:a+1}),l.columns.map((t,p)=>e.jsx("td",{className:"p-1 border-r",children:e.jsx("div",{className:"text-gray-400 text-xs",children:t.type==="numeric"?"0":t.type==="checkbox"?"☐":t.type==="date"?"YYYY-MM-DD":t.type==="dropdown"?"선택▼":t.type==="image"?"📷":`${t.title} 값`})},p))]},a))})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[e.jsxs("div",{className:"p-2 bg-blue-50 rounded",children:[e.jsx("div",{className:"font-medium text-blue-800",children:"컬럼 수"}),e.jsxs("div",{className:"text-blue-600",children:[l.columns.length,"개"]})]}),e.jsxs("div",{className:"p-2 bg-green-50 rounded",children:[e.jsx("div",{className:"font-medium text-green-800",children:"행 수"}),e.jsxs("div",{className:"text-green-600",children:[l.rowsCount,"행"]})]})]}),e.jsxs("div",{className:"mt-4 p-3 bg-blue-50 rounded-lg border-l-4 border-blue-500",children:[e.jsx("h4",{className:"font-medium text-blue-900 mb-2",children:"시트유형 구성 완료"}),e.jsxs("div",{className:"text-sm text-blue-800 grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"컬럼:"})," ",l.columns.length,"개"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"행:"})," ",l.rowsCount,"개"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"수식:"})," ",Object.keys(l.formulas).length,"개"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"검증:"})," ",Object.keys(l.validationRules).length,"개"]})]})]})]})})})]})})]})]})}export{xe as T};
