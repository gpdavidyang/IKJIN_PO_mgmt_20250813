import{r as g,q as he,w as ge,K as h,j as e,s as ie,M as Q,n as q,b as re,z,B as b,F as I,X as ne,l as Y,I as pe,S as ue,d as je,u as ce,t as fe,N as Ne,h as ve}from"./index-BE2444o0-1757210537008.js";import{OrderForm as ye}from"./order-form-DeEUdMAK-1757210537008.js";import{A as V,a as R}from"./alert-D1nuQdGq-1757210537008.js";import{P as be}from"./progress-bqVJq0kS-1757210537008.js";import{r as we,u as Ee}from"./xlsx-ocdEQCFM-1757210537008.js";import{C as Se}from"./checkbox-BhgHmGcq-1757210537008.js";import{E as De}from"./email-send-dialog-CvjJFfDO-1757210537008.js";import{M as Z}from"./mail-Cwa0pRly-1757210537008.js";import{S as Ce}from"./save-F-Hg-7JL-1757210537008.js";import{C as te}from"./calendar--V0_Jv-k-1757210537008.js";import{P as oe}from"./package-DmDTzF33-1757210537008.js";import{H as Oe}from"./hash-DxpaNdLk-1757210537008.js";import{D as ke,a as Fe,b as Pe,c as $e,d as Te,e as Ae}from"./dialog-1Gd9x-z8-1757210537008.js";import{D as de}from"./download-TiW_MVN8-1757210537008.js";import{R as Le}from"./refresh-cw-B134e1UF-1757210537008.js";import{U as me}from"./upload-ThDJ-7Y7-1757210537008.js";import{I as ee}from"./info-CH01k-l_-1757210537008.js";import{T as Ve,a as Re,b as ae,c as le}from"./tabs-QlThG8s3-1757210537008.js";import"./textarea-DxzJ7OCB-1757210537008.js";import"./select-6uSRIfuf-1757210537008.js";import"./index-CqvkDEJc-1757210537008.js";import"./chevron-down-CBeDqd3L-1757210537008.js";import"./chevron-up-CQfQhCpG-1757210537008.js";import"./table-2dg2sd3I-1757210537008.js";import"./authUtils-CcDzk6i0-1757210537008.js";import"./trash-2-CAnCbkZ2-1757210537008.js";import"./triangle-alert-CMbD--an-1757210537008.js";import"./send-BcZ8y3hD-1757210537008.js";import"./index-Cyhoz9Bg-1757210537008.js";function Ue({orders:x,onOrderUpdate:N,onOrderRemove:r,onSingleOrderSave:f,file:v}){const[y,j]=g.useState(null),[S,k]=g.useState(""),[w,F]=g.useState(x.reduce((t,s,a)=>({...t,[a]:!0}),{})),[p,u]=g.useState(null),[i,P]=g.useState(null),[$,T]=g.useState(!1),D=he({mutationFn:async({order:t,sendEmail:s,index:a,isDraft:n=!1})=>{const l=new FormData;v&&l.append("excelFile",v),l.append("orders",JSON.stringify([t])),l.append("sendEmail",s.toString()),l.append("isDraft",n.toString());const o=await fetch("/api/orders/bulk-create-simple",{method:"POST",credentials:"include",body:l});if(!o.ok){const m=await o.text();throw new Error(m||"Failed to save order")}return o.json()},onSuccess:async(t,s)=>{await ge.invalidateQueries({predicate:a=>a.queryKey.some(l=>typeof l=="string"&&(l.includes("orders")||l.includes("/api/orders")))}),s.isDraft?(h({title:"ì„ì‹œì €ì¥ ì™„ë£Œ",description:"ë°œì£¼ì„œê°€ 'ì„ì‹œì €ì¥' ìƒíƒœë¡œ ì €ì¥ë˜ì–´ ì‘ì—… ëª©ë¡ì—ì„œ ì œê±°ë˜ì—ˆìŠµë‹ˆë‹¤. ë°œì£¼ì„œ ê´€ë¦¬ í™”ë©´ì—ì„œ ì–¸ì œë“ ì§€ ì¡°íšŒ, ìˆ˜ì •, ìŠ¹ì¸ìš”ì²­ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤."}),r(s.index,!0)):s.sendEmail?(P({...t,originalOrder:s.order,originalIndex:s.index}),T(!0),h({title:"ë°œì£¼ì„œ ìƒì„± ì™„ë£Œ",description:"ë°œì£¼ì„œê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤. ì´ë©”ì¼ì„ ì‘ì„±í•´ì£¼ì„¸ìš”."})):(h({title:"ë°œì£¼ì„œ ìƒì„± ì™„ë£Œ",description:"ë°œì£¼ì„œê°€ ì„±ê³µì ìœ¼ë¡œ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤. ìƒì„±ëœ ë°œì£¼ì„œëŠ” ë°œì£¼ì„œ ê´€ë¦¬ í™”ë©´ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤."}),r(s.index,!0))},onError:t=>{h({title:"ë°œì£¼ì„œ ìƒì„± ì‹¤íŒ¨",description:t.message||"ë°œì£¼ì„œ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.",variant:"destructive"})},onSettled:()=>{u(null)}}),A=(t,s)=>{j(t),k(s||"")},K=t=>{f?f(t,w[t]):(u(t),D.mutate({order:x[t],sendEmail:w[t],index:t}))},W=t=>{u(t),D.mutate({order:x[t],sendEmail:!1,index:t,isDraft:!0})},U=(t,s)=>{F(a=>({...a,[t]:s}))},B=(t,s,a)=>{const l={...x[t]};if(s.startsWith("item.")){const[,o]=s.split("."),m=l.items[0]||{};["quantity","unitPrice"].includes(o)?(m[o]=parseFloat(a)||0,m.quantity&&m.unitPrice&&(m.totalAmount=m.quantity*m.unitPrice)):m[o]=a,l.items=[m]}else l[s]=a;l.errors=[],l.vendorName||l.errors.push("ê±°ë˜ì²˜ëª… í•„ìˆ˜"),l.vendorEmail||l.errors.push("ì´ë©”ì¼ í•„ìˆ˜"),l.projectName||l.errors.push("í”„ë¡œì íŠ¸ í•„ìˆ˜"),l.isValid=l.errors.length===0,N(t,l),j(null)},H=(t,s,a)=>{t.key==="Enter"?(t.preventDefault(),B(s,a,S)):t.key==="Escape"&&j(null)},d=({cellId:t,value:s,orderIndex:a,field:n,type:l="text",icon:o,label:m,className:L=""})=>y===t?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-xs text-gray-500 w-20",children:[m,":"]}),e.jsx(pe,{type:l,value:S,onChange:C=>k(C.target.value),onKeyDown:C=>H(C,a,n),onBlur:()=>B(a,n,S),className:Q("h-7 px-2 py-0 text-xs flex-1",L),autoFocus:!0})]}):e.jsxs("div",{className:"flex items-center gap-2 p-1 rounded cursor-pointer hover:bg-gray-50 group",onClick:()=>A(t,s),children:[o&&e.jsx("div",{className:"text-gray-400 w-4",children:o}),e.jsxs("span",{className:"text-xs text-gray-500 min-w-[80px]",children:[m,":"]}),e.jsx("span",{className:Q("text-xs flex-1",!s&&"text-gray-400 italic"),children:s||"ì…ë ¥"})]}),X=async t=>{try{const s=await fetch("/api/orders/send-email-simple",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({to:t.to,cc:t.cc,subject:t.subject,body:t.body,orderData:{orderId:i?.orderId||i?.orderIds?.[0],orderNumber:i?.orderNumber,projectName:i?.projectName,vendorName:i?.vendorName,location:i?.location,orderDate:i?.orderDate,deliveryDate:i?.deliveryDate,totalAmount:i?.totalAmount,excelFilePath:i?.excelFilePath},attachPdf:t.attachPdf,attachExcel:t.attachExcel})}),a=await s.json();s.ok?a.message&&a.message.includes("ê°œë°œ ëª¨ë“œ")?h({title:"ì´ë©”ì¼ í…ŒìŠ¤íŠ¸ ëª¨ë“œ",description:"SMTP ì„¤ì •ì´ ì—†ì–´ ì‹¤ì œ ì´ë©”ì¼ì€ ë°œì†¡ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ë°œì£¼ì„œëŠ” ì •ìƒì ìœ¼ë¡œ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.",variant:"default"}):h({title:"ì´ë©”ì¼ ë°œì†¡ ì™„ë£Œ",description:"ë°œì£¼ì„œì™€ ì´ë©”ì¼ì´ ì„±ê³µì ìœ¼ë¡œ ë°œì†¡ë˜ì—ˆìŠµë‹ˆë‹¤."}):h({title:"ì´ë©”ì¼ ë°œì†¡ ì‹¤íŒ¨",description:a.error||"ì´ë©”ì¼ì€ ë°œì†¡ë˜ì§€ ì•Šì•˜ì§€ë§Œ ë°œì£¼ì„œëŠ” ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.",variant:"destructive"}),i?.originalIndex!==void 0&&r(i.originalIndex,!0)}catch(s){console.error("ì´ë©”ì¼ ë°œì†¡ ì˜¤ë¥˜:",s),h({title:"ì´ë©”ì¼ ë°œì†¡ ì‹¤íŒ¨",description:"ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë°œì£¼ì„œëŠ” ì •ìƒì ìœ¼ë¡œ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.",variant:"destructive"}),i?.originalIndex!==void 0&&r(i.originalIndex,!0)}finally{T(!1),P(null)}},_=()=>{T(!1),i?.originalIndex!==void 0&&r(i.originalIndex,!0),P(null)};return e.jsxs("div",{className:"space-y-4",children:[x.map((t,s)=>{const a=x[s].items[0]||{},n=(a.quantity||0)*(a.unitPrice||0);return e.jsxs(ie,{className:Q("p-4 relative",t.isValid===!1&&"border-red-300 bg-red-50/30"),children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(q,{variant:"outline",className:"text-xs",children:["#",s+1]}),e.jsx(q,{variant:t.isValid?"default":"destructive",className:"text-xs h-5",children:t.isValid?e.jsxs(e.Fragment,{children:[e.jsx(re,{className:"h-3 w-3 mr-1"}),"ìœ íš¨"]}):e.jsxs(e.Fragment,{children:[e.jsx(z,{className:"h-3 w-3 mr-1"}),"ê²€ì¦ í•„ìš”"]})}),t.errors&&t.errors.length>0&&e.jsxs("span",{className:"text-xs text-red-600",children:["(",t.errors.join(", "),")"]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Se,{id:`email-${s}`,checked:w[s],onCheckedChange:l=>U(s,l),disabled:p===s}),e.jsxs("label",{htmlFor:`email-${s}`,className:"text-xs text-gray-600 cursor-pointer",children:[e.jsx(Z,{className:"h-3 w-3 inline mr-1"}),"ì´ë©”ì¼ ë°œì†¡"]})]}),e.jsxs(b,{onClick:()=>K(s),disabled:!t.isValid||p===s,size:"sm",className:"bg-blue-600 hover:bg-blue-700 text-xs",children:[e.jsx(I,{className:"h-3 w-3 mr-1"}),p===s?"ìƒì„± ì¤‘...":"ë°œì£¼ì„œ ìƒì„±"]}),e.jsxs(b,{onClick:()=>W(s),disabled:!t.isValid||p===s,size:"sm",variant:"outline",className:"text-xs",children:[e.jsx(Ce,{className:"h-3 w-3 mr-1"}),p===s?"ì €ì¥ ì¤‘...":"ì„ì‹œì €ì¥"]}),e.jsx(b,{variant:"ghost",size:"icon",className:"h-6 w-6 text-gray-400 hover:text-red-600",onClick:()=>r(s),children:e.jsx(ne,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 mb-3",children:[e.jsx(d,{cellId:`${s}-orderDate`,value:t.orderDate,orderIndex:s,field:"orderDate",label:"ë°œì£¼ì¼ì",icon:e.jsx(te,{className:"h-3 w-3"})}),e.jsx(d,{cellId:`${s}-deliveryDate`,value:t.deliveryDate,orderIndex:s,field:"deliveryDate",label:"ë‚©ê¸°ì¼ì",icon:e.jsx(te,{className:"h-3 w-3"})}),e.jsx(d,{cellId:`${s}-vendor`,value:t.vendorName,orderIndex:s,field:"vendorName",label:"ê±°ë˜ì²˜ëª…",icon:e.jsx(Y,{className:"h-3 w-3"})}),e.jsx(d,{cellId:`${s}-vendorEmail`,value:t.vendorEmail,orderIndex:s,field:"vendorEmail",label:"ê±°ë˜ì²˜ ì´ë©”ì¼",type:"email",icon:e.jsx(Z,{className:"h-3 w-3"})})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 mb-3",children:[e.jsx(d,{cellId:`${s}-deliveryPlace`,value:t.deliveryPlace,orderIndex:s,field:"deliveryPlace",label:"ë‚©í’ˆì²˜ëª…",icon:e.jsx(Y,{className:"h-3 w-3"})}),e.jsx(d,{cellId:`${s}-deliveryEmail`,value:t.deliveryEmail,orderIndex:s,field:"deliveryEmail",label:"ë‚©í’ˆì²˜ ì´ë©”ì¼",type:"email",icon:e.jsx(Z,{className:"h-3 w-3"})}),e.jsx(d,{cellId:`${s}-project`,value:t.projectName,orderIndex:s,field:"projectName",label:"í”„ë¡œì íŠ¸ëª…",icon:e.jsx(Y,{className:"h-3 w-3"})})]}),e.jsx("div",{className:"border-t pt-3",children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-6 gap-3",children:[e.jsx(d,{cellId:`${s}-itemName`,value:a.itemName,orderIndex:s,field:"item.itemName",label:"í’ˆëª©ëª…",icon:e.jsx(oe,{className:"h-3 w-3"})}),e.jsx(d,{cellId:`${s}-spec`,value:a.specification,orderIndex:s,field:"item.specification",label:"ê·œê²©"}),e.jsx(d,{cellId:`${s}-qty`,value:a.quantity,orderIndex:s,field:"item.quantity",label:"ìˆ˜ëŸ‰",type:"number",icon:e.jsx(Oe,{className:"h-3 w-3"})}),e.jsx(d,{cellId:`${s}-price`,value:a.unitPrice,orderIndex:s,field:"item.unitPrice",label:"ë‹¨ê°€",type:"number"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-gray-500",children:"ì´ê¸ˆì•¡:"}),e.jsxs("span",{className:"text-sm font-medium",children:[n.toLocaleString(),"ì›"]})]}),e.jsx(d,{cellId:`${s}-remarks`,value:a.remarks,orderIndex:s,field:"item.remarks",label:"ë¹„ê³ "})]})}),e.jsx("div",{className:"mt-3 pt-3 border-t",children:e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsx(d,{cellId:`${s}-majorCategory`,label:"ëŒ€ë¶„ë¥˜",value:t.majorCategory||"",orderIndex:s,field:"majorCategory",className:"h-7"}),e.jsx(d,{cellId:`${s}-middleCategory`,label:"ì¤‘ë¶„ë¥˜",value:t.middleCategory||"",orderIndex:s,field:"middleCategory",className:"h-7"}),e.jsx(d,{cellId:`${s}-minorCategory`,label:"ì†Œë¶„ë¥˜",value:t.minorCategory||"",orderIndex:s,field:"minorCategory",className:"h-7"})]})})]},s)}),x.length===0&&e.jsx("div",{className:"text-center py-12 text-gray-500",children:"ì—…ë¡œë“œëœ ë°œì£¼ì„œê°€ ì—†ìŠµë‹ˆë‹¤."}),$&&i&&e.jsx(De,{open:$,onOpenChange:t=>{t||_()},orderData:{orderNumber:i.orderNumber||"BULK-ORDER",vendorName:i?.originalOrder?.vendorName||"Unknown",vendorEmail:i?.originalOrder?.vendorEmail||"",orderDate:new Date().toLocaleDateString(),totalAmount:i.totalAmount||0,siteName:i?.originalOrder?.projectName||"ì¼ê´„ ë°œì£¼ì„œ"},onSendEmail:X})]})}function Be({isOpen:x,onClose:N,errors:r,onRetry:f,onDownloadTemplate:v}){return e.jsx(ke,{open:x,onOpenChange:N,children:e.jsxs(Fe,{className:"sm:max-w-[500px] max-h-[80vh]",children:[e.jsxs(Pe,{children:[e.jsxs($e,{className:"flex items-center gap-2 text-red-600",children:[e.jsx(z,{className:"h-5 w-5"}),"Excel í•„ë“œëª… ì˜¤ë¥˜"]}),e.jsx(Te,{children:"ì—…ë¡œë“œí•œ íŒŒì¼ì˜ í•„ë“œëª…ì´ í‘œì¤€ í˜•ì‹ê³¼ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤."})]}),e.jsx(ue,{className:"max-h-[300px] rounded-md border p-4 bg-red-50",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"font-medium text-sm text-red-900 mb-3",children:"âŒ ì˜ëª»ëœ í•„ë“œëª…:"}),r.map((y,j)=>e.jsxs("div",{className:"text-sm text-red-700 ml-4",children:["â€¢ ",y]},j))]})}),e.jsxs("div",{className:"rounded-lg bg-blue-50 p-3 mt-2",children:[e.jsx("p",{className:"text-sm text-blue-900 font-medium mb-2",children:"âœ… í•´ê²° ë°©ë²•:"}),e.jsxs("ol",{className:"text-sm text-blue-700 space-y-1 ml-4",children:[e.jsx("li",{children:"1. í‘œì¤€ í…œí”Œë¦¿ì„ ë‹¤ìš´ë¡œë“œí•˜ì„¸ìš”"}),e.jsx("li",{children:"2. í…œí”Œë¦¿ì˜ í•„ë“œëª…ì„ ì •í™•íˆ ì‚¬ìš©í•˜ì„¸ìš”"}),e.jsx("li",{children:"3. í•„ë“œëª…ì„ ìˆ˜ì • í›„ ë‹¤ì‹œ ì—…ë¡œë“œí•˜ì„¸ìš”"})]})]}),e.jsxs(Ae,{className:"gap-2",children:[v&&e.jsxs(b,{onClick:v,variant:"outline",className:"gap-2",children:[e.jsx(de,{className:"h-4 w-4"}),"í…œí”Œë¦¿ ë‹¤ìš´ë¡œë“œ"]}),f&&e.jsxs(b,{onClick:f,variant:"default",className:"gap-2",children:[e.jsx(Le,{className:"h-4 w-4"}),"ë‹¤ì‹œ ì‹œë„"]}),e.jsx(b,{onClick:N,variant:"secondary",children:"ë‹«ê¸°"})]})]})})}function _e(){je();const[,x]=ce(),N=g.useRef(null),[r,f]=g.useState(null),[v,y]=g.useState(!1),[j,S]=g.useState([]),[k,w]=g.useState(!1),[F,p]=g.useState(0),[u,i]=g.useState([]),[P,$]=g.useState([]),[T,D]=g.useState(!1),A=a=>{a.preventDefault(),a.stopPropagation(),a.type==="dragenter"||a.type==="dragover"?y(!0):a.type==="dragleave"&&y(!1)},K=a=>{if(a.preventDefault(),a.stopPropagation(),y(!1),a.dataTransfer.files&&a.dataTransfer.files[0]){const n=a.dataTransfer.files[0];U(n)}},W=a=>{a.target.files&&a.target.files[0]&&U(a.target.files[0])},U=a=>{const n=a.name.toLowerCase();if(!n.endsWith(".xlsx")&&!n.endsWith(".xls")&&!n.endsWith(".xlsm")){h({title:"íŒŒì¼ í˜•ì‹ ì˜¤ë¥˜",description:"ì—‘ì…€ íŒŒì¼(.xlsx, .xls, .xlsm)ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.",variant:"destructive"});return}f(a),B(a)},B=async a=>{w(!0),p(20);try{const n=await a.arrayBuffer();p(40);const l=we(n,{type:"array"});p(60);const o=l.SheetNames[0],m=l.Sheets[o],L=Ee.sheet_to_json(m,{header:1});if(p(80),L.length===0)throw new Error("ì—‘ì…€ íŒŒì¼ì´ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.");const se=L[0],C=["ë°œì£¼ì¼ì","ë‚©ê¸°ì¼ì","ê±°ë˜ì²˜ëª…","ê±°ë˜ì²˜ ì´ë©”ì¼","ë‚©í’ˆì²˜ëª…","ë‚©í’ˆì²˜ ì´ë©”ì¼","í”„ë¡œì íŠ¸ëª…","ëŒ€ë¶„ë¥˜","ì¤‘ë¶„ë¥˜","ì†Œë¶„ë¥˜","í’ˆëª©ëª…","ê·œê²©","ìˆ˜ëŸ‰","ë‹¨ê°€","ì´ê¸ˆì•¡","ë¹„ê³ "],J=[],xe=new Map;for(let c=0;c<C.length;c++){const E=C[c],O=se[c]?.toString().trim();!O||O!==E?J.push(`ì»¬ëŸ¼ ${c+1}: "${O||"(ë¹ˆê°’)"}" â†’ ì˜¬ë°”ë¥¸ í•„ë“œëª…: "${E}"`):xe.set(E,c)}if(J.length>0){$(J),D(!0),w(!1);return}const G=L.slice(1).filter(c=>c&&c.some(E=>E)).map((c,E)=>{const O=M=>M?typeof M=="number"?new Date((M-25569)*86400*1e3).toISOString().split("T")[0]:M.toString().trim():"";return{rowIndex:E+2,orderDate:O(c[0]),deliveryDate:O(c[1]),vendorName:c[2]?.toString().trim(),vendorEmail:c[3]?.toString().trim(),deliveryPlace:c[4]?.toString().trim(),deliveryEmail:c[5]?.toString().trim(),projectName:c[6]?.toString().trim(),majorCategory:c[7]?.toString().trim(),middleCategory:c[8]?.toString().trim(),minorCategory:c[9]?.toString().trim(),items:[{itemName:c[10]?.toString().trim(),specification:c[11]?.toString().trim(),quantity:parseFloat(c[12])||0,unitPrice:parseFloat(c[13])||0,totalAmount:parseFloat(c[14])||0,remarks:c[15]?.toString().trim()}],isValid:!0,errors:[]}});S(G),i(G),p(100),h({title:"ì—‘ì…€ íŒŒì¼ ë¡œë”© ì™„ë£Œ",description:`ë°œì£¼ì„œ ìƒì„±ì„ ìœ„í•´ ${G.length}ê°œì˜ ë°ì´í„°ê°€ ì„±ê³µì ìœ¼ë¡œ ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤. ê° í•­ëª©ì„ í™•ì¸í•˜ê³  ìˆ˜ì •í•œ í›„ 'ëª¨ë‘ ì €ì¥' ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.`})}catch(n){console.error("Excel parsing error:",n);const l=n instanceof Error?n.message:"ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.";l.includes("í—¤ë”ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤")?h({title:"ì—‘ì…€ í•„ë“œ ê²€ì¦ ì‹¤íŒ¨",description:l,variant:"destructive"}):h({title:"íŒŒì¼ íŒŒì‹± ì‹¤íŒ¨",description:l,variant:"destructive"})}finally{w(!1),setTimeout(()=>p(0),1e3)}},H=(a,n)=>{const l=[...u];l[a]=n,i(l)},d=(a,n=!1)=>{const l=u.filter((o,m)=>m!==a);if(i(l),l.length===0&&j.length>0){h({title:"ëª¨ë“  ì²˜ë¦¬ ì™„ë£Œ",description:`${j.length}ê°œì˜ ë°œì£¼ì„œê°€ ëª¨ë‘ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤. ë°œì£¼ì„œ ê´€ë¦¬ í™”ë©´ìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤.`}),setTimeout(()=>x("/orders"),1500);return}n||h({title:"í•­ëª© ì œê±°",description:"ì„ íƒí•œ í•­ëª©ì´ ëª©ë¡ì—ì„œ ì œê±°ë˜ì—ˆìŠµë‹ˆë‹¤."})},X=()=>{f(null),S([]),i([]),p(0)},_=()=>{N.current?.click()},t=async()=>{try{const n=await(await fetch("/api/excel-template/download")).blob(),l=window.URL.createObjectURL(n),o=document.createElement("a");o.href=l,o.download="PO_Excel_Template.xlsx",document.body.appendChild(o),o.click(),window.URL.revokeObjectURL(l),document.body.removeChild(o),h({title:"í…œí”Œë¦¿ ë‹¤ìš´ë¡œë“œ ì™„ë£Œ",description:"í‘œì¤€ Excel í…œí”Œë¦¿ì„ ë‹¤ìš´ë¡œë“œí–ˆìŠµë‹ˆë‹¤."})}catch(a){console.error("Template download error:",a),h({title:"ë‹¤ìš´ë¡œë“œ ì‹¤íŒ¨",description:"í…œí”Œë¦¿ ë‹¤ìš´ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.",variant:"destructive"})}},s=()=>{D(!1),$([]),_()};return e.jsxs("div",{className:"space-y-6",children:[u.length===0&&e.jsx(ie,{children:e.jsxs(fe,{className:"p-8",children:[e.jsx("input",{ref:N,type:"file",accept:".xlsx,.xls,.xlsm",onChange:W,className:"hidden"}),e.jsxs("div",{className:`border-2 border-dashed rounded-lg p-12 text-center transition-colors ${v?"border-blue-500 bg-blue-50":"border-gray-300 hover:border-gray-400"}`,onDragEnter:A,onDragLeave:A,onDragOver:A,onDrop:K,children:[e.jsx(me,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-lg font-medium text-gray-700",children:"ì—‘ì…€ íŒŒì¼ì„ ë“œë˜ê·¸í•˜ê±°ë‚˜ í´ë¦­í•˜ì—¬ ì—…ë¡œë“œ"}),e.jsx("p",{className:"text-sm text-gray-500",children:"DB ê²€ì¦ ì—†ì´ ë°”ë¡œ í¸ì§‘ ê°€ëŠ¥í•œ ë°œì£¼ì„œë¡œ ë³€í™˜ë©ë‹ˆë‹¤"}),e.jsx("p",{className:"text-xs text-gray-400",children:".xlsx, .xls, .xlsm íŒŒì¼ ì§€ì›"})]}),e.jsxs("div",{className:"flex items-center justify-center gap-3 mt-6",children:[e.jsx(b,{onClick:_,disabled:k,size:"lg",children:k?"ì²˜ë¦¬ ì¤‘...":"íŒŒì¼ ì„ íƒ"}),e.jsxs(b,{onClick:t,variant:"outline",size:"lg",className:"gap-2",children:[e.jsx(de,{className:"h-4 w-4"}),"í…œí”Œë¦¿ ë‹¤ìš´ë¡œë“œ"]})]})]}),F>0&&e.jsxs("div",{className:"mt-6 space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm text-gray-600",children:[e.jsx("span",{children:"íŒŒì¼ ì²˜ë¦¬ ì¤‘..."}),e.jsxs("span",{children:[F,"%"]})]}),e.jsx(be,{value:F,className:"h-2"})]}),r&&e.jsxs(V,{className:"mt-6",children:[e.jsx(Ne,{className:"h-4 w-4"}),e.jsxs(R,{children:[e.jsx("strong",{children:r.name})," (",(r.size/1024).toFixed(1)," KB)"]})]}),e.jsxs(V,{className:"mt-6 bg-yellow-50 border-yellow-200",children:[e.jsx(z,{className:"h-4 w-4 text-yellow-600"}),e.jsxs(R,{children:[e.jsx("strong",{className:"text-yellow-900",children:"ğŸ’¡ ì§ì ‘ìŠ¹ì¸(Direct Approval) ë°©ì‹ìœ¼ë¡œ ì²˜ë¦¬ë©ë‹ˆë‹¤"}),e.jsxs("ul",{className:"list-disc list-inside mt-2 text-sm text-yellow-800 space-y-1",children:[e.jsx("li",{children:"ë³„ë„ì˜ ìŠ¹ì¸ ì ˆì°¨ ì—†ì´ ë°”ë¡œ ë°œì£¼ì„œê°€ ìƒì„±ë©ë‹ˆë‹¤. ì¦‰ì‹œ ë°œì†¡ ê°€ëŠ¥í•œ ìƒíƒœê°€ ë©ë‹ˆë‹¤."}),e.jsx("li",{children:"ëŒ€ëŸ‰ ë°œì£¼ ì²˜ë¦¬ë¥¼ ìœ„í•´ ìŠ¹ì¸ ë‹¨ê³„ë¥¼ ìƒëµí•˜ê³  ì‹ ì†í•˜ê²Œ ì²˜ë¦¬ë©ë‹ˆë‹¤."}),e.jsx("li",{children:"ìŠ¹ì¸ ê¶Œí•œê³¼ ë¬´ê´€í•˜ê²Œ ëª¨ë“  ì‚¬ìš©ìê°€ ì—‘ì…€ ì—…ë¡œë“œ ì‹œ ì§ì ‘ìŠ¹ì¸ìœ¼ë¡œ ì²˜ë¦¬ë©ë‹ˆë‹¤."})]})]})]}),e.jsxs(V,{className:"mt-6",children:[e.jsx(z,{className:"h-4 w-4"}),e.jsxs(R,{children:[e.jsx("strong",{children:"ì—‘ì…€ ì‹¬í”Œ ì—…ë¡œë“œ íŠ¹ì§•:"}),e.jsxs("ul",{className:"list-disc list-inside mt-2 text-sm space-y-1",children:[e.jsx("li",{children:"DB ê°’ê³¼ ë¹„êµ/ë³´ì • ê³¼ì • ì—†ìŒ"}),e.jsx("li",{children:"ì—‘ì…€ ë°ì´í„°ë¥¼ ê·¸ëŒ€ë¡œ í‘œì‹œ"}),e.jsx("li",{children:"ëª¨ë“  í•„ë“œë¥¼ ì§ì ‘ ìˆ˜ì • ê°€ëŠ¥"}),e.jsx("li",{children:"ì—¬ëŸ¬ ë°œì£¼ì„œë¥¼ í•œë²ˆì— í¸ì§‘ ë° ì €ì¥"})]})]})]}),e.jsxs(V,{className:"mt-6 bg-blue-50 border-blue-200",children:[e.jsx(ee,{className:"h-4 w-4 text-blue-600"}),e.jsx(R,{children:e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"font-semibold text-blue-900 mb-2",children:"ğŸ“‹ í•„ìˆ˜ Excel í•„ë“œëª… (ì •í™•íˆ ì¼ì¹˜í•´ì•¼ í•¨)"}),e.jsxs("div",{className:"grid grid-cols-2 gap-x-4 gap-y-1 text-xs text-blue-800",children:[e.jsxs("div",{children:["â€¢ ",e.jsx("strong",{children:"ê¸°ë³¸ ì •ë³´:"})," ë°œì£¼ì¼ì, ë‚©ê¸°ì¼ì"]}),e.jsxs("div",{children:["â€¢ ",e.jsx("strong",{children:"ê±°ë˜ì²˜:"})," ê±°ë˜ì²˜ëª…, ê±°ë˜ì²˜ ì´ë©”ì¼"]}),e.jsxs("div",{children:["â€¢ ",e.jsx("strong",{children:"ë‚©í’ˆì²˜:"})," ë‚©í’ˆì²˜ëª…, ë‚©í’ˆì²˜ ì´ë©”ì¼"]}),e.jsxs("div",{children:["â€¢ ",e.jsx("strong",{children:"í”„ë¡œì íŠ¸:"})," í”„ë¡œì íŠ¸ëª…"]}),e.jsxs("div",{children:["â€¢ ",e.jsx("strong",{children:"ë¶„ë¥˜:"})," ëŒ€ë¶„ë¥˜, ì¤‘ë¶„ë¥˜, ì†Œë¶„ë¥˜"]}),e.jsxs("div",{children:["â€¢ ",e.jsx("strong",{children:"í’ˆëª©:"})," í’ˆëª©ëª…, ê·œê²©, ìˆ˜ëŸ‰, ë‹¨ê°€, ì´ê¸ˆì•¡, ë¹„ê³ "]})]})]})})]})]})}),u.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"sticky top-0 z-10 bg-white border rounded-lg shadow-sm p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(ee,{className:"h-4 w-4"}),e.jsx("span",{children:"ê° ë°œì£¼ì„œë¥¼ ê°œë³„ì ìœ¼ë¡œ ê²€í† í•˜ê³  ì €ì¥í•˜ì„¸ìš”"})]}),e.jsxs("div",{className:"text-xs text-gray-500",children:["ì²˜ë¦¬ ì§„í–‰ë¥ : ",j.length-u.length,"/",j.length,"ê°œ ì™„ë£Œ"]})]}),e.jsxs(b,{onClick:X,variant:"outline",size:"lg",children:[e.jsx(ne,{className:"h-4 w-4 mr-2"}),"ì „ì²´ ì´ˆê¸°í™”"]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(q,{variant:"secondary",className:"px-3 py-1",children:[e.jsx(oe,{className:"h-3 w-3 mr-1"}),u.length,"ê°œ ëŒ€ê¸°ì¤‘"]}),e.jsxs(q,{variant:"success",className:"px-3 py-1 bg-green-100 text-green-700",children:[e.jsx(re,{className:"h-3 w-3 mr-1"}),j.length-u.length,"ê°œ ì™„ë£Œ"]})]})]})}),e.jsx(Ue,{orders:u,onOrderUpdate:H,onOrderRemove:d,file:r})]}),e.jsx(Be,{isOpen:T,onClose:()=>D(!1),errors:P,onRetry:s,onDownloadTemplate:t})]})}const Me={EXCEL_UPLOAD:!0,HANDSONTABLE:!1,APPROVAL_WORKFLOW:!1,ADVANCED_PERMISSIONS:!1};function qe(x){return Me[x]}function vs(){const[,x]=ce(),{theme:N}=ve(),r=N==="dark",f=qe("EXCEL_UPLOAD");console.log("ğŸ” Create Order Debug Info:",{isExcelUploadEnabled:f,VITE_ENVIRONMENT:"production",VITE_ENABLE_EXCEL_UPLOAD:"true",NODE_ENV:void 0,timestamp:new Date().toISOString()});const v=()=>{x("/orders")},y=()=>{x("/orders")};return e.jsx("div",{className:`min-h-screen transition-colors ${r?"bg-gray-900":"bg-gray-50"}`,children:e.jsxs("div",{className:"max-w-[1366px] mx-auto p-6 space-y-6 pb-20",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(I,{className:"h-5 w-5 text-blue-600"}),e.jsxs("div",{children:[e.jsx("h1",{className:`text-2xl font-bold transition-colors ${r?"text-white":"text-gray-900"}`,children:"ë°œì£¼ì„œ ì‘ì„±"}),e.jsx("p",{className:`text-sm mt-1 transition-colors ${r?"text-gray-400":"text-gray-600"}`,children:"ìƒˆë¡œìš´ ë°œì£¼ì„œë¥¼ ì‘ì„±í•˜ê±°ë‚˜ Excel íŒŒì¼ì„ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”"})]})]})}),e.jsxs(V,{className:`mb-6 transition-colors ${r?"bg-gray-800 border-gray-700":"bg-white border-gray-200"}`,children:[e.jsx(ee,{className:`h-4 w-4 ${r?"text-blue-400":"text-blue-600"}`}),e.jsx(R,{className:r?"text-gray-300":"text-gray-700",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:`font-medium ${r?"text-white":"text-gray-900"}`,children:"ğŸ“‹ ì‚¬ìš©íŒ"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:`font-medium ${r?"text-blue-400":"text-blue-600"}`,children:"Excel ì—…ë¡œë“œ:"})," ëŒ€ëŸ‰ ë°œì£¼ì„œ, ë°˜ë³µ ì—…ë¬´, ìë™í™” ì²˜ë¦¬ì— ì í•© (50ê±´+ ê¶Œì¥)"]}),e.jsxs("div",{children:[e.jsx("span",{className:`font-medium ${r?"text-green-400":"text-green-600"}`,children:"ì¼ë°˜ í¼ ì‘ì„±:"})," ì†ŒëŸ‰ ë°œì£¼ì„œ, ì„¸ë°€í•œ ì¡°ì •, ì¦‰ì‹œ ì²˜ë¦¬ì— ì í•© (10ê±´ ì´í•˜ ê¶Œì¥)"]})]})]})})]}),e.jsxs(Ve,{defaultValue:"form",className:"w-full",children:[e.jsxs(Re,{className:`grid w-full grid-cols-2 transition-colors ${r?"bg-gray-800 border-gray-700":"bg-gray-100"}`,children:[e.jsxs(ae,{value:"form",className:`flex items-center gap-2 transition-colors ${r?"data-[state=active]:bg-gray-700 data-[state=active]:text-white hover:bg-gray-750":"data-[state=active]:bg-white data-[state=active]:text-gray-900"}`,children:[e.jsx(I,{className:"h-4 w-4"}),"ì§ì ‘ ì…ë ¥"]}),e.jsxs(ae,{value:"simple",className:`flex items-center gap-2 transition-colors ${r?"data-[state=active]:bg-gray-700 data-[state=active]:text-white hover:bg-gray-750":"data-[state=active]:bg-white data-[state=active]:text-gray-900"}`,children:[e.jsx(me,{className:"h-4 w-4"}),"ì—‘ì…€ ì—…ë¡œë“œ ì…ë ¥"]})]}),e.jsx(le,{value:"form",className:"mt-6",children:e.jsx(ye,{onSuccess:v,onCancel:y})}),e.jsx(le,{value:"simple",className:"mt-6",children:e.jsx(_e,{})})]})]})})}export{vs as default};
