import{h as S,r as h,j as e,w as j,a3 as v,a4 as g,aZ as P,x as p,y as F,B as o,o as u,a0 as m,a1 as x}from"./index-BV8YMSqX-1757225239193.js";import{P as $}from"./page-header-DunZ6-Tb-1757225239193.js";function E(){const{theme:f}=S(),r=f==="dark",[i,N]=h.useState(null),[c,d]=h.useState(!1),[a,n]=h.useState(null),b=s=>{const l=s.target.files?.[0];l&&(N(l),n(null))},y=async()=>{if(!i){alert("파일을 선택해주세요.");return}d(!0),n(null);try{const s=new FormData;s.append("excel",i);const t=await(await fetch("/api/excel-automation/parse-input-sheet",{method:"POST",body:s})).json();n(t)}catch(s){console.error("업로드 오류:",s),n({success:!1,error:"파일 업로드 중 오류가 발생했습니다."})}finally{d(!1)}},w=async()=>{if(!i){alert("파일을 선택해주세요.");return}d(!0);try{const s=new FormData;s.append("excel",i);const t=await(await fetch("/api/excel-automation/debug-excel",{method:"POST",body:s})).json();console.log("디버그 결과:",t),alert("디버그 정보가 콘솔에 출력되었습니다. 서버 로그를 확인해보세요.")}catch(s){console.error("디버그 오류:",s),alert("디버그 중 오류가 발생했습니다.")}finally{d(!1)}},V=async()=>{if(!i){alert("파일을 선택해주세요.");return}d(!0),n(null);try{const s=new FormData;s.append("excel",i);const t=await(await fetch("/api/excel-automation/simple-parse",{method:"POST",body:s})).json();console.log("간단 파싱 결과:",t),n({success:t.success,data:t.success?{rows:t.data.sampleData||[],validation:{isValid:!0,errors:[],warnings:[],totalRows:t.data.totalRows||0},meta:{uploadedBy:"test",uploadedAt:new Date().toISOString(),filename:i.name}}:void 0,error:t.error})}catch(s){console.error("간단 파싱 오류:",s),n({success:!1,error:"간단 파싱 중 오류가 발생했습니다."})}finally{d(!1)}},C=async()=>{if(!i){alert("파일을 선택해주세요.");return}d(!0),n(null);try{const s=new FormData;s.append("excel",i);const t=await(await fetch("/api/excel-automation/parse-and-validate",{method:"POST",body:s})).json();console.log("파싱+검증 결과:",t),t.success?n({success:!0,data:{rows:t.data.parsing.data||[],validation:{isValid:!0,errors:[],warnings:[],totalRows:t.data.parsing.totalRows||0},meta:{uploadedBy:"test",uploadedAt:t.data.meta.uploadedAt,filename:t.data.meta.filename},vendorValidation:t.data.validation},error:void 0}):n({success:!1,error:t.error||"파싱 및 검증 중 오류가 발생했습니다."})}catch(s){console.error("파싱+검증 오류:",s),n({success:!1,error:"파싱 및 검증 중 오류가 발생했습니다."})}finally{d(!1)}};return e.jsx("div",{className:`min-h-screen transition-colors ${r?"bg-gray-900":"bg-gray-50"}`,children:e.jsxs("div",{className:"max-w-[1366px] mx-auto p-6 space-y-6",children:[e.jsx($,{title:"엑셀 템플릿 자동화 테스트",description:"Input 시트의 A:P 열을 파싱하여 JSON으로 변환하는 기능을 테스트합니다."}),e.jsxs(j,{children:[e.jsxs(v,{children:[e.jsx(g,{children:"1단계: 엑셀 파일 업로드"}),e.jsx(P,{children:"'Input' 시트가 포함된 Excel 파일을 업로드하세요."})]}),e.jsxs(p,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(F,{type:"file",accept:".xlsx,.xls",onChange:b,className:"flex-1"}),e.jsx(o,{onClick:y,disabled:!i||c,className:"min-w-24",children:c?"파싱중...":"파싱하기"}),e.jsx(o,{onClick:V,disabled:!i||c,variant:"secondary",className:"min-w-24",children:"📊 간단파싱"}),e.jsx(o,{onClick:C,disabled:!i||c,variant:"default",className:"min-w-32 bg-blue-600 hover:bg-blue-700",children:"🔍 파싱+검증"}),e.jsx(o,{onClick:w,disabled:!i||c,variant:"outline",className:"min-w-24",children:"🐛 디버그"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx(o,{variant:"outline",onClick:()=>window.open("/api/excel-automation/sample-excel","_blank"),className:"w-auto",children:"📥 샘플 Excel 파일 다운로드"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"테스트용 샘플 파일을 다운로드하여 기능을 확인해보세요."})]}),i&&e.jsxs("div",{className:"text-sm text-muted-foreground",children:["선택된 파일: ",i.name," (",(i.size/1024/1024).toFixed(2)," MB)"]})]})]}),a&&e.jsxs(j,{children:[e.jsx(v,{children:e.jsxs(g,{className:"flex items-center gap-2",children:["파싱 결과",e.jsx(u,{variant:a.success?"default":"destructive",children:a.success?"성공":"실패"})]})}),e.jsx(p,{className:"space-y-4",children:a.success&&a.data?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 p-4 bg-muted rounded-lg",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",children:"총 행 수"}),e.jsxs("div",{className:"text-lg",children:[a.data.validation.totalRows,"개"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",children:"오류"}),e.jsxs("div",{className:"text-lg text-red-600",children:[a.data.validation.errors.length,"개"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",children:"경고"}),e.jsxs("div",{className:"text-lg text-yellow-600",children:[a.data.validation.warnings.length,"개"]})]})]}),a.data.validation.errors.length>0&&e.jsx(m,{variant:"destructive",children:e.jsxs(x,{children:[e.jsx("div",{className:"font-medium mb-2",children:"오류 목록:"}),e.jsx("ul",{className:"list-disc list-inside space-y-1",children:a.data.validation.errors.map((s,l)=>e.jsx("li",{className:"text-sm",children:s},l))})]})}),a.data.validation.warnings.length>0&&e.jsx(m,{variant:"default",children:e.jsxs(x,{children:[e.jsx("div",{className:"font-medium mb-2",children:"경고 목록:"}),e.jsx("ul",{className:"list-disc list-inside space-y-1",children:a.data.validation.warnings.map((s,l)=>e.jsx("li",{className:"text-sm",children:s},l))})]})}),a.data.vendorValidation&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"font-medium text-lg",children:"🔍 거래처 검증 결과 (Phase 2)"}),e.jsxs("div",{className:`grid grid-cols-1 md:grid-cols-4 gap-4 p-4 rounded-lg transition-colors ${r?"bg-blue-900/20 border border-blue-800":"bg-blue-50"}`,children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",children:"거래처 검증"}),e.jsxs("div",{className:`text-lg transition-colors ${r?"text-blue-400":"text-blue-600"}`,children:[a.data.vendorValidation.vendorValidations.filter(s=>s.exists).length," / ",a.data.vendorValidation.vendorValidations.length]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",children:"납품처 검증"}),e.jsxs("div",{className:`text-lg transition-colors ${r?"text-blue-400":"text-blue-600"}`,children:[a.data.vendorValidation.deliveryValidations.filter(s=>s.exists).length," / ",a.data.vendorValidation.deliveryValidations.length]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",children:"이메일 충돌"}),e.jsxs("div",{className:`text-lg transition-colors ${r?"text-red-400":"text-red-600"}`,children:[a.data.vendorValidation.emailConflicts.filter(s=>s.type==="conflict").length,"개"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium",children:"추천 업체"}),e.jsxs("div",{className:`text-lg transition-colors ${r?"text-green-400":"text-green-600"}`,children:[a.data.vendorValidation.vendorValidations.reduce((s,l)=>s+l.suggestions.length,0),"개"]})]})]}),a.data.vendorValidation.vendorValidations.length>0&&e.jsxs("div",{children:[e.jsx("div",{className:"font-medium mb-2",children:"거래처명 검증 상세:"}),a.data.vendorValidation.vendorValidations.some(s=>!s.exists&&s.suggestions.length>0&&s.suggestions[0].phone==="02-0000-0000")&&e.jsx(m,{variant:"default",className:"mb-4",children:e.jsxs(x,{children:["⚠️ ",e.jsx("strong",{children:"폴백 모드"}),": 데이터베이스 연결 문제로 인해 샘플 추천 데이터를 표시합니다."]})}),e.jsx("div",{className:"space-y-2",children:a.data.vendorValidation.vendorValidations.map((s,l)=>e.jsxs("div",{className:"border rounded p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"font-medium",children:s.vendorName}),e.jsx(u,{variant:s.exists?"default":"secondary",children:s.exists?"✅ 존재":"❌ 없음"}),!s.exists&&s.suggestions.length>0&&s.suggestions[0].phone==="02-0000-0000"&&e.jsx(u,{variant:"outline",className:"text-xs",children:"🔄 폴백"})]}),s.exactMatch&&e.jsxs("div",{className:`text-sm mb-2 transition-colors ${r?"text-green-400":"text-green-700"}`,children:["📍 매칭: ",s.exactMatch.name," (담당자: ",s.exactMatch.contactPerson,")"]}),s.suggestions.length>0&&e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"font-medium mb-1",children:"💡 유사 업체 추천:"}),s.suggestions.slice(0,3).map((t,D)=>e.jsxs("div",{className:`text-xs ml-2 transition-colors ${r?"text-gray-400":"text-gray-600"}`,children:["• ",t.name," (유사도: ",(t.similarity*100).toFixed(1),"%)",t.phone==="02-0000-0000"&&e.jsx("span",{className:`ml-1 transition-colors ${r?"text-orange-400":"text-orange-500"}`,children:"[샘플]"})]},D))]})]},l))})]}),a.data.vendorValidation.emailConflicts.filter(s=>s.type==="conflict").length>0&&e.jsx(m,{variant:"destructive",children:e.jsxs(x,{children:[e.jsx("div",{className:"font-medium mb-2",children:"📧 이메일 충돌 발견:"}),a.data.vendorValidation.emailConflicts.filter(s=>s.type==="conflict").map((s,l)=>e.jsxs("div",{className:"text-sm mb-2",children:[e.jsxs("div",{className:"font-medium",children:[s.vendorName,":"]}),e.jsxs("div",{children:["Excel: ",s.excelEmail]}),e.jsxs("div",{children:["DB: ",s.dbEmail]})]},l))]})})]}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium mb-2",children:"파싱된 데이터 (JSON):"}),e.jsx("div",{className:"bg-muted p-4 rounded-lg overflow-x-auto",children:e.jsx("pre",{className:"text-sm whitespace-pre-wrap",children:JSON.stringify(a.data.rows,null,2)})})]})]}):e.jsx(m,{variant:"destructive",children:e.jsx(x,{children:a.error||"알 수 없는 오류가 발생했습니다."})})})]})]})})}export{E as default};
