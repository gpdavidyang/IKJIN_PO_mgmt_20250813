import{d as L,e as U,u as _,y as B,r as p,p as C,q as k,j as s,B as t,F as m,n as S,t as l,G as r,H as i,l as q,v as c,f as o,U as O,A as F,k as j,L as z,E as Q,w as h}from"./index-CwqdaVoE-1757133510813.js";import{D as G,a as H,b as I,c as R}from"./dialog-D8Mm7Z0m-1757133510813.js";import{A as W}from"./arrow-left-DPU1qMsk-1757133510813.js";import{M as J}from"./map-pin-DpkQT9Pk-1757133510813.js";import{P as M}from"./package-DqTWRkpb-1757133510813.js";import{S as V}from"./send-p-xBA2iL-1757133510813.js";import{S as X}from"./square-pen-OIgWMaVd-1757133510813.js";import{P as Y}from"./printer-YRxZS2On-1757133510813.js";import{D as Z}from"./download-DIaw-pey-1757133510813.js";import{E as ss}from"./external-link-EKpFMjed-1757133510813.js";import{f as N}from"./format-DaWO9lR4-1757133510813.js";import"./index-DU0jevUn-1757133510813.js";function hs(){L();const{toast:d}=U(),[,y]=_(),$=B(),[E,u]=p.useState(!1),[n,g]=p.useState(null),[f,w]=p.useState(!1),x=parseInt($.id),{data:e,isLoading:K}=C({queryKey:[`/api/orders/${x}`]}),{data:T}=C({queryKey:["/api/order-statuses"]}),b=k({mutationFn:async()=>{await j("POST",`/api/orders/${x}/approve`)},onSuccess:()=>{d({title:"발주서 승인",description:"발주서가 성공적으로 승인되었습니다."}),h.invalidateQueries({queryKey:["/api/orders"]}),h.invalidateQueries({queryKey:[`/api/orders/${x}`]})},onError:a=>{d({title:"승인 실패",description:"발주서 승인 중 오류가 발생했습니다.",variant:"destructive"})}}),v=k({mutationFn:async()=>{await j("POST",`/api/orders/${x}/send`)},onSuccess:()=>{d({title:"발주서 전송",description:"발주서가 성공적으로 전송되었습니다."}),h.invalidateQueries({queryKey:["/api/orders"]}),h.invalidateQueries({queryKey:[`/api/orders/${x}`]})},onError:a=>{d({title:"전송 실패",description:"발주서 전송 중 오류가 발생했습니다.",variant:"destructive"})}});if(K)return s.jsx("div",{className:"flex items-center justify-center h-64",children:s.jsx("div",{className:"text-lg",children:"로딩 중..."})});if(!e)return s.jsx("div",{className:"flex items-center justify-center h-64",children:s.jsx("div",{className:"text-lg text-gray-500",children:"발주서를 찾을 수 없습니다."})});const P=e.status==="draft"?"bg-gray-500":e.status==="pending"?"bg-yellow-500":e.status==="approved"?"bg-green-500":e.status==="sent"?"bg-blue-500":"bg-gray-500",D=T?.find(a=>a.code===e.status)?.name||e.status;return s.jsx("div",{className:"min-h-screen bg-gray-50",children:s.jsxs("div",{className:"max-w-[1366px] mx-auto p-6 space-y-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-6",children:[s.jsxs("div",{className:"flex items-center space-x-4",children:[s.jsxs(t,{variant:"ghost",size:"sm",onClick:()=>y("/orders"),className:"flex items-center space-x-2 h-8",children:[s.jsx(W,{className:"h-4 w-4"}),s.jsx("span",{children:"돌아가기"})]}),s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx(m,{className:"h-5 w-5 text-blue-600"}),s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:e.orderNumber}),s.jsx("p",{className:"text-sm text-gray-500",children:"표준 발주서 상세"})]})]})]}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(S,{className:`${P} text-white text-xs px-2 py-1`,children:D}),s.jsx("span",{className:"text-xs text-gray-500",children:e.orderDate?N(new Date(e.orderDate),"yyyy. M. d."):""})]})]}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4",children:[s.jsxs("div",{className:"lg:col-span-2 space-y-4",children:[s.jsxs(l,{className:"shadow-sm",children:[s.jsx(r,{className:"bg-gray-50 py-3 px-4",children:s.jsxs(i,{className:"flex items-center space-x-2 text-lg font-semibold",children:[s.jsx(q,{className:"h-5 w-5 text-blue-600"}),s.jsx("span",{children:"기본 정보"})]})}),s.jsx(c,{className:"px-4 py-3",children:s.jsxs("div",{className:"grid grid-cols-2 gap-x-8 gap-y-2 text-xs",children:[s.jsxs("div",{className:"flex",children:[s.jsx("span",{className:"text-gray-600 w-20",children:"발주번호:"}),s.jsx("span",{className:"font-medium",children:e.orderNumber})]}),s.jsxs("div",{className:"flex",children:[s.jsx("span",{className:"text-gray-600 w-20",children:"발주일:"}),s.jsx("span",{children:e.orderDate?N(new Date(e.orderDate),"yyyy-MM-dd"):"-"})]}),s.jsxs("div",{className:"flex",children:[s.jsx("span",{className:"text-gray-600 w-20",children:"납기희망일:"}),s.jsx("span",{children:e.deliveryDate?N(new Date(e.deliveryDate),"yyyy-MM-dd"):"-"})]}),s.jsxs("div",{className:"flex",children:[s.jsx("span",{className:"text-gray-600 w-20",children:"합계:"}),s.jsx("span",{className:"font-semibold text-blue-600",children:o(e.totalAmount)})]})]})})]}),s.jsxs(l,{className:"shadow-sm",children:[s.jsx(r,{className:"bg-gray-50 py-3 px-4",children:s.jsxs(i,{className:"flex items-center space-x-2 text-lg font-semibold",children:[s.jsx(J,{className:"h-5 w-5 text-blue-600"}),s.jsx("span",{children:"현장 정보"})]})}),s.jsx(c,{className:"px-4 py-3",children:e.project?s.jsxs("div",{className:"grid grid-cols-2 gap-x-8 gap-y-2 text-xs",children:[s.jsxs("div",{className:"flex",children:[s.jsx("span",{className:"text-gray-600 w-20",children:"현장명:"}),s.jsx("span",{className:"font-medium",children:e.project.projectName})]}),s.jsxs("div",{className:"flex",children:[s.jsx("span",{className:"text-gray-600 w-20",children:"현장코드:"}),s.jsx("span",{children:e.project.projectCode})]}),s.jsxs("div",{className:"flex col-span-2",children:[s.jsx("span",{className:"text-gray-600 w-20",children:"현장주소:"}),s.jsx("span",{children:e.project.location})]})]}):s.jsx("p",{className:"text-xs text-gray-500",children:"현장 정보가 없습니다."})})]}),s.jsxs(l,{className:"shadow-sm",children:[s.jsx(r,{className:"bg-gray-50 py-3 px-4",children:s.jsxs(i,{className:"flex items-center space-x-2 text-lg font-semibold",children:[s.jsx(q,{className:"h-5 w-5 text-blue-600"}),s.jsx("span",{children:"납품처"})]})}),s.jsx(c,{className:"px-4 py-3",children:e.vendor?s.jsxs("div",{className:"grid grid-cols-2 gap-x-8 gap-y-2 text-xs",children:[s.jsxs("div",{className:"flex",children:[s.jsx("span",{className:"text-gray-600 w-20",children:"업체명:"}),s.jsx("span",{className:"font-medium",children:e.vendor.name})]}),s.jsxs("div",{className:"flex",children:[s.jsx("span",{className:"text-gray-600 w-20",children:"대표자:"}),s.jsx("span",{children:e.vendor.representative||"-"})]}),s.jsxs("div",{className:"flex",children:[s.jsx("span",{className:"text-gray-600 w-20",children:"사업자번호:"}),s.jsx("span",{children:e.vendor.businessNumber})]}),s.jsxs("div",{className:"flex",children:[s.jsx("span",{className:"text-gray-600 w-20",children:"연락처:"}),s.jsx("span",{children:e.vendor.phone})]})]}):s.jsx("p",{className:"text-xs text-gray-500",children:"거래처 정보가 없습니다."})})]}),s.jsxs(l,{className:"shadow-sm",children:[s.jsx(r,{className:"bg-gray-50 py-3 px-4",children:s.jsxs(i,{className:"flex items-center space-x-2 text-lg font-semibold",children:[s.jsx(O,{className:"h-5 w-5 text-blue-600"}),s.jsx("span",{children:"담당자"})]})}),s.jsx(c,{className:"px-4 py-3",children:s.jsxs("div",{className:"grid grid-cols-2 gap-x-8 gap-y-2 text-xs",children:[s.jsxs("div",{className:"flex",children:[s.jsx("span",{className:"text-gray-600 w-20",children:"본사 담당자:"}),s.jsx("span",{className:"font-medium",children:e.user?.name||"-"})]}),s.jsxs("div",{className:"flex",children:[s.jsx("span",{className:"text-gray-600 w-20",children:"인수 담당자:"}),s.jsx("span",{children:"현장 담당자"})]})]})})]}),s.jsxs(l,{className:"shadow-sm",children:[s.jsx(r,{className:"bg-gray-50 py-3 px-4",children:s.jsxs(i,{className:"flex items-center justify-between text-sm font-semibold",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(M,{className:"h-5 w-5 text-blue-600"}),s.jsx("span",{children:"품목 리스트"})]}),s.jsxs("span",{className:"text-blue-600",children:["총 합계 ",o(e.totalAmount)]})]})}),s.jsx(c,{className:"px-0 py-3",children:e.items&&e.items.length>0?s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full text-xs",children:[s.jsx("thead",{className:"bg-gray-50",children:s.jsxs("tr",{className:"border-b border-gray-200",children:[s.jsx("th",{className:"text-left py-2 px-4 font-medium text-gray-600",children:"품목명"}),s.jsx("th",{className:"text-center py-2 px-4 font-medium text-gray-600",children:"규격"}),s.jsx("th",{className:"text-center py-2 px-4 font-medium text-gray-600",children:"수량"}),s.jsx("th",{className:"text-center py-2 px-4 font-medium text-gray-600",children:"단위"}),s.jsx("th",{className:"text-right py-2 px-4 font-medium text-gray-600",children:"단가"}),s.jsx("th",{className:"text-right py-2 px-4 font-medium text-gray-600",children:"금액"}),s.jsx("th",{className:"text-center py-2 px-4 font-medium text-gray-600",children:"비고"})]})}),s.jsx("tbody",{children:e.items.map((a,A)=>s.jsxs("tr",{className:"border-b border-gray-100 hover:bg-gray-50",children:[s.jsx("td",{className:"py-2 px-4 font-medium",children:a.itemName||a.item_name}),s.jsx("td",{className:"py-2 px-4 text-center",children:a.specification||"-"}),s.jsx("td",{className:"py-2 px-4 text-center",children:typeof a.quantity=="number"?a.quantity.toLocaleString():a.quantity||"-"}),s.jsx("td",{className:"py-2 px-4 text-center",children:"개"}),s.jsx("td",{className:"py-2 px-4 text-right font-semibold text-blue-600",children:o(a.unitPrice||a.unit_price)}),s.jsx("td",{className:"py-2 px-4 text-right font-semibold text-blue-600",children:o(a.totalAmount||a.total_amount)}),s.jsx("td",{className:"py-2 px-4 text-center text-gray-500",children:a.notes?a.notes.split("/").join(" "):"-"})]},A))})]})}):s.jsxs("div",{className:"text-center py-8 text-gray-500",children:[s.jsx(M,{className:"h-8 w-8 mx-auto mb-2 text-gray-300"}),s.jsx("p",{className:"text-xs",children:"등록된 품목이 없습니다."})]})})]}),e.notes&&s.jsxs(l,{className:"shadow-sm",children:[s.jsx(r,{className:"bg-gray-50 py-3 px-4",children:s.jsxs(i,{className:"flex items-center space-x-2 text-lg font-semibold",children:[s.jsx(m,{className:"h-5 w-5 text-blue-600"}),s.jsx("span",{children:"특이사항"})]})}),s.jsx(c,{className:"px-4 py-3",children:s.jsx("p",{className:"text-xs text-gray-700 leading-relaxed",children:e.notes})})]}),s.jsxs(l,{className:"shadow-sm",children:[s.jsx(r,{className:"bg-gray-50 py-3 px-4",children:s.jsxs(i,{className:"flex items-center space-x-2 text-lg font-semibold",children:[s.jsx(m,{className:"h-5 w-5 text-blue-600"}),s.jsx("span",{children:"첨부파일"})]})}),s.jsx(c,{className:"px-4 py-3",children:e.attachments&&e.attachments.length>0?s.jsx("div",{className:"space-y-2",children:e.attachments.map(a=>s.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded text-xs",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(m,{className:"h-3 w-3 text-blue-600"}),s.jsx("span",{children:a.originalName}),s.jsxs("span",{className:"text-gray-500",children:["(",(a.fileSize/1024).toFixed(1)," KB)"]})]}),s.jsx(t,{size:"sm",variant:"outline",className:"h-6 px-2 text-xs",onClick:()=>window.open(`/api/attachments/${a.id}`,"_blank"),children:"다운로드"})]},a.id))}):s.jsx("p",{className:"text-xs text-gray-500",children:"첨부된 파일이 없습니다."})})]})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs(l,{className:"shadow-sm",children:[s.jsx(r,{className:"bg-gray-50 py-3 px-4",children:s.jsxs(i,{className:"flex items-center space-x-2 text-lg font-semibold",children:[s.jsx(F,{className:"h-5 w-5 text-blue-600"}),s.jsx("span",{children:"승인 상태"})]})}),s.jsx(c,{className:"px-4 py-3",children:s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{children:[s.jsx("label",{className:"text-xs font-medium text-gray-600 block mb-1",children:"현재 상태"}),s.jsx(S,{className:`${P} text-white text-xs`,children:D})]}),e.status==="pending"&&s.jsxs(t,{onClick:()=>b.mutate(),disabled:b.isPending,className:"w-full h-8 text-xs",size:"sm",children:[s.jsx(F,{className:"h-3 w-3 mr-1"}),"승인"]}),e.status==="approved"&&s.jsxs(t,{onClick:()=>v.mutate(),disabled:v.isPending,className:"w-full h-8 text-xs",size:"sm",children:[s.jsx(V,{className:"h-3 w-3 mr-1"}),"전송"]})]})})]}),s.jsxs(l,{className:"shadow-sm",children:[s.jsx(r,{className:"bg-gray-50 py-3 px-4",children:s.jsxs(i,{className:"flex items-center space-x-2 text-lg font-semibold",children:[s.jsx(m,{className:"h-5 w-5 text-blue-600"}),s.jsx("span",{children:"작업"})]})}),s.jsxs(c,{className:"px-4 py-3 space-y-2",children:[s.jsx(t,{variant:"outline",size:"sm",onClick:async()=>{w(!0);try{const a=await j("POST","/api/orders/generate-pdf",{orderData:e});a.pdfUrl&&(g(a.pdfUrl),u(!0))}catch(a){console.error("PDF 생성 오류:",a),d({title:"PDF 생성 실패",description:"PDF 생성 중 오류가 발생했습니다.",variant:"destructive"})}finally{w(!1)}},disabled:f,className:"w-full h-8 text-xs justify-start",children:f?s.jsxs(s.Fragment,{children:[s.jsx(z,{className:"h-3 w-3 mr-2 animate-spin"})," PDF 생성 중..."]}):s.jsxs(s.Fragment,{children:[s.jsx(Q,{className:"h-3 w-3 mr-2"})," PDF 미리보기"]})}),s.jsxs(t,{variant:"outline",size:"sm",onClick:()=>y(`/orders/${x}/edit`),className:"w-full h-8 text-xs justify-start",children:[s.jsx(X,{className:"h-3 w-3 mr-2"}),"발주서 수정"]}),s.jsxs(t,{variant:"outline",size:"sm",onClick:()=>window.print(),className:"w-full h-8 text-xs justify-start",children:[s.jsx(Y,{className:"h-3 w-3 mr-2"}),"인쇄"]})]})]})]})]}),s.jsx(G,{open:E,onOpenChange:a=>{u(a),a||g(null)},children:s.jsxs(H,{className:"max-w-5xl max-h-[90vh] p-0",children:[s.jsx(I,{className:"px-6 py-4 border-b",children:s.jsxs(R,{className:"flex items-center justify-between",children:[s.jsx("span",{children:"발주서 미리보기"}),s.jsxs("div",{className:"flex gap-2",children:[s.jsxs(t,{variant:"outline",size:"sm",onClick:()=>{n&&window.open(`${n}?download=true`,"_blank")},disabled:!n,children:[s.jsx(Z,{className:"h-4 w-4 mr-2"}),"다운로드"]}),s.jsxs(t,{variant:"outline",size:"sm",onClick:()=>{n&&window.open(n,"_blank")},disabled:!n,children:[s.jsx(ss,{className:"h-4 w-4 mr-2"}),"새 탭에서 열기"]})]})]})}),s.jsx("div",{className:"w-full h-[75vh] bg-gray-100",children:n?s.jsx("iframe",{src:n,className:"w-full h-full border-0",title:"PDF Preview"}):s.jsx("div",{className:"flex items-center justify-center h-full",children:s.jsx(z,{className:"h-8 w-8 animate-spin text-gray-400"})})})]})})]})})}export{hs as default};
