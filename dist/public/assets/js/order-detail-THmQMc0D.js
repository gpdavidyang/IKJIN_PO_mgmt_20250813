import{u as ge,a as L,b as D,j as e}from"./chunk-D67rGsji.js";import{r as T}from"./chunk-BgLp_VvL.js";import{u as Ne}from"./chunk-CFxRDIMf.js";import{l as ce,C as z,h as P,i as _,g as Q,B as c,L as j,I as C,k as be,f as U}from"./chunk-DV-F1ehd.js";import{B as g}from"./chunk-Bw5QEQRA.js";import{D as ee,m as we,a as se,b as te,c as ie,S as X,h as Y,i as J,j as Z,k,f as V,g as N,n as Se,o as qe,p as oe,r as O,s as Ce,t as K,q as xe}from"./chunk-bdHBeqB0.js";import{F as ae,I as De,ap as le,aq as he,b as E,N as de,ar as me,as as ue,y as pe,z as ke,at as Ae,K as Fe,d as Te,a3 as ze,au as Pe,av as _e,a2 as Qe,a as Ie,D as Me,aw as Re}from"./chunk-CVirgo2y.js";import{f as q}from"./chunk-CZez8RVl.js";import{k as $}from"./chunk-BNjaABKX.js";import{C as je}from"./chunk-Qrbxos93.js";function Be({orderId:r}){const{toast:l}=ce(),d=ge(),[h,u]=T.useState(!1),[y,x]=T.useState(null),{data:t=[],isLoading:I}=L({queryKey:["/api/invoices",r],queryFn:async()=>await(await N("GET",`/api/invoices?orderId=${r}`)).json()}),{data:w=[]}=L({queryKey:["/api/verification-logs",r],queryFn:async()=>await(await N("GET",`/api/verification-logs?orderId=${r}`)).json()}),v=D({mutationFn:async s=>{const n=await fetch("/api/invoices",{method:"POST",body:s});if(!n.ok)throw new Error("Failed to upload invoice");return n.json()},onSuccess:()=>{d.invalidateQueries({queryKey:["/api/invoices",r]}),d.invalidateQueries({queryKey:["/api/verification-logs",r]}),u(!1),x(null),l({title:"ì„±ê³µ",description:"ì²­êµ¬ì„œê°€ ì—…ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤."})},onError:()=>{l({title:"ì˜¤ë¥˜",description:"ì²­êµ¬ì„œ ì—…ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.",variant:"destructive"})}}),A=D({mutationFn:async s=>await(await N("POST",`/api/invoices/${s}/verify`)).json(),onSuccess:()=>{d.invalidateQueries({queryKey:["/api/invoices",r]}),d.invalidateQueries({queryKey:["/api/verification-logs",r]}),l({title:"ì„±ê³µ",description:"ì²­êµ¬ì„œê°€ ê²€ì¦ë˜ì—ˆìŠµë‹ˆë‹¤."})},onError:()=>{l({title:"ì˜¤ë¥˜",description:"ì²­êµ¬ì„œ ê²€ì¦ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.",variant:"destructive"})}}),S=D({mutationFn:async s=>await(await N("POST",`/api/invoices/${s}/issue-tax`)).json(),onSuccess:()=>{d.invalidateQueries({queryKey:["/api/invoices",r]}),l({title:"ì„±ê³µ",description:"ì„¸ê¸ˆê³„ì‚°ì„œê°€ ë°œí–‰ë˜ì—ˆìŠµë‹ˆë‹¤."})},onError:()=>{l({title:"ì˜¤ë¥˜",description:"ì„¸ê¸ˆê³„ì‚°ì„œ ë°œí–‰ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.",variant:"destructive"})}}),f=D({mutationFn:async s=>await(await N("POST",`/api/invoices/${s}/cancel-tax`)).json(),onSuccess:()=>{d.invalidateQueries({queryKey:["/api/invoices",r]}),l({title:"ì„±ê³µ",description:"ì„¸ê¸ˆê³„ì‚°ì„œ ë°œí–‰ì´ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤."})},onError:()=>{l({title:"ì˜¤ë¥˜",description:"ì„¸ê¸ˆê³„ì‚°ì„œ ë°œí–‰ ì·¨ì†Œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.",variant:"destructive"})}}),H=s=>{s.preventDefault();const n=new FormData(s.currentTarget);n.set("orderId",r.toString()),y&&n.set("file",y),v.mutate(n)},M=s=>{switch(s){case"pending":return e.jsx(g,{variant:"secondary",children:"ê²€í† ì¤‘"});case"verified":return e.jsx(g,{variant:"default",children:"ê²€ì¦ì™„ë£Œ"});case"paid":return e.jsx(g,{variant:"outline",children:"ì§€ê¸‰ì™„ë£Œ"});default:return e.jsx(g,{variant:"secondary",children:s})}},R=s=>{switch(s){case"invoice":return e.jsx(g,{variant:"outline",children:"ì²­êµ¬ì„œ"});case"tax_invoice":return e.jsx(g,{variant:"outline",children:"ì„¸ê¸ˆê³„ì‚°ì„œ"});default:return e.jsx(g,{variant:"outline",children:s})}};return I?e.jsxs(z,{children:[e.jsx(P,{children:e.jsxs(_,{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"h-5 w-5"}),"ì²­êµ¬ì„œ ê´€ë¦¬"]})}),e.jsx(Q,{children:e.jsx("div",{className:"text-center py-4",children:"ë¡œë”© ì¤‘..."})})]}):e.jsxs(z,{children:[e.jsx(P,{className:"pb-2",children:e.jsxs(_,{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[e.jsx(ae,{className:"h-4 w-4"}),"ì²­êµ¬ì„œ ê´€ë¦¬"]}),e.jsxs(ee,{open:h,onOpenChange:u,children:[e.jsx(we,{asChild:!0,children:e.jsxs(c,{size:"sm",children:[e.jsx(De,{className:"h-3 w-3 mr-1"}),e.jsx("span",{className:"text-xs",children:"ì²­êµ¬ì„œ ì—…ë¡œë“œ"})]})}),e.jsxs(se,{children:[e.jsx(te,{children:e.jsx(ie,{children:"ì²­êµ¬ì„œ ì—…ë¡œë“œ"})}),e.jsxs("form",{onSubmit:H,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"invoiceNumber",children:"ì²­êµ¬ì„œ ë²ˆí˜¸"}),e.jsx(C,{id:"invoiceNumber",name:"invoiceNumber",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"invoiceType",children:"ìœ í˜•"}),e.jsxs(X,{name:"invoiceType",defaultValue:"invoice",children:[e.jsx(Y,{children:e.jsx(J,{})}),e.jsxs(Z,{children:[e.jsx(k,{value:"invoice",children:"ì²­êµ¬ì„œ"}),e.jsx(k,{value:"tax_invoice",children:"ì„¸ê¸ˆê³„ì‚°ì„œ"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"issueDate",children:"ë°œí–‰ì¼"}),e.jsx(C,{id:"issueDate",name:"issueDate",type:"date",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"dueDate",children:"ë§ˆê°ì¼"}),e.jsx(C,{id:"dueDate",name:"dueDate",type:"date"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"totalAmount",children:"ì´ê¸ˆì•¡"}),e.jsx(C,{id:"totalAmount",name:"totalAmount",type:"number",step:"0.01",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"vatAmount",children:"ë¶€ê°€ì„¸"}),e.jsx(C,{id:"vatAmount",name:"vatAmount",type:"number",step:"0.01",defaultValue:"0"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"file",children:"ì²¨ë¶€íŒŒì¼"}),e.jsx(C,{id:"file",type:"file",accept:".pdf,.jpg,.jpeg,.png",onChange:s=>x(s.target.files?.[0]||null)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"notes",children:"ë©”ëª¨"}),e.jsx(V,{id:"notes",name:"notes",rows:3})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(c,{type:"button",variant:"outline",onClick:()=>u(!1),children:"ì·¨ì†Œ"}),e.jsx(c,{type:"submit",disabled:v.isPending,children:v.isPending?"ì—…ë¡œë“œ ì¤‘...":"ì—…ë¡œë“œ"})]})]})]})]})]})}),e.jsxs(Q,{className:"p-3",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"border-2 border-blue-200 rounded-lg p-3 bg-blue-50 dark:bg-blue-900/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(le,{className:"h-4 w-4 text-blue-600"}),e.jsx("span",{className:"text-sm font-semibold text-blue-800 dark:text-blue-200",children:"ì„¸ê¸ˆê³„ì‚°ì„œ ë°œí–‰ ê´€ë¦¬"}),t.length===0?e.jsx(g,{variant:"outline",className:"text-xs border-blue-300 text-blue-700",children:"ì²­êµ¬ì„œ ì—…ë¡œë“œ í•„ìš”"}):t.some(s=>s.taxInvoiceIssued)?e.jsxs(g,{variant:"default",className:"text-xs bg-green-600",children:[e.jsx(he,{className:"h-2 w-2 mr-1"}),"ë°œí–‰ì™„ë£Œ"]}):e.jsx(g,{variant:"secondary",className:"text-xs",children:"ë¯¸ë°œí–‰"})]}),e.jsx("div",{className:"text-xs text-blue-600 dark:text-blue-300",children:t.length===0?"ì²­êµ¬ì„œë¥¼ ë¨¼ì € ì—…ë¡œë“œí•˜ê³  ê²€ì¦í•´ì£¼ì„¸ìš”":t.some(s=>s.status==="verified")?"ë°œí–‰ ì¤€ë¹„ ì™„ë£Œ":"ì²­êµ¬ì„œ ê²€ì¦ í•„ìš”"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-xs text-gray-600",children:t.length===0?"ì„¸ê¸ˆê³„ì‚°ì„œ ë°œí–‰ ê´€ë¦¬ë¥¼ ìœ„í•´ì„œëŠ” ì²­êµ¬ì„œë¥¼ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”.":t.some(s=>s.taxInvoiceIssued)?"ì„¸ê¸ˆê³„ì‚°ì„œê°€ ë°œí–‰ë˜ì—ˆìŠµë‹ˆë‹¤.":"ì„¸ê¸ˆê³„ì‚°ì„œ ë°œí–‰ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤."}),e.jsx("div",{className:"flex gap-2",children:t.length>0&&t.some(s=>s.status==="verified")?e.jsx(e.Fragment,{children:t.some(s=>s.taxInvoiceIssued)?e.jsxs(c,{size:"sm",variant:"destructive",onClick:()=>{const s=t.find(n=>n.taxInvoiceIssued);s&&f.mutate(s.id)},disabled:f.isPending,children:[e.jsx(de,{className:"h-3 w-3 mr-1"}),e.jsx("span",{className:"text-xs",children:"ë¯¸í™•ì¸"})]}):e.jsxs(c,{size:"sm",variant:"default",onClick:()=>{const s=t.find(n=>n.status==="verified"&&!n.taxInvoiceIssued);s&&S.mutate(s.id)},disabled:S.isPending,children:[e.jsx(E,{className:"h-3 w-3 mr-1"}),e.jsx("span",{className:"text-xs",children:"í™•ì¸"})]})}):e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(c,{size:"sm",variant:"outline",disabled:!0,children:[e.jsx(E,{className:"h-3 w-3 mr-1"}),e.jsx("span",{className:"text-xs",children:"í™•ì¸"})]}),e.jsxs(c,{size:"sm",variant:"outline",disabled:!0,children:[e.jsx(de,{className:"h-3 w-3 mr-1"}),e.jsx("span",{className:"text-xs",children:"ë¯¸í™•ì¸"})]})]})})]})]}),t.length===0?e.jsx("div",{className:"text-center py-4 text-muted-foreground text-xs",children:"ì•„ì§ ì—…ë¡œë“œëœ ì²­êµ¬ì„œê°€ ì—†ìŠµë‹ˆë‹¤."}):e.jsx("div",{className:"space-y-2",children:t.map(s=>e.jsxs("div",{className:"border rounded-lg p-2 space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("h4",{className:"font-medium text-xs",children:s.invoiceNumber}),R(s.invoiceType),M(s.status)]}),s.status==="pending"&&e.jsxs(c,{size:"sm",onClick:()=>A.mutate(s.id),disabled:A.isPending,children:[e.jsx(E,{className:"h-3 w-3 mr-1"}),e.jsx("span",{className:"text-xs",children:"ê²€ì¦"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2 text-xs text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(me,{className:"h-3 w-3 text-muted-foreground"}),e.jsxs("span",{children:["ë°œí–‰ì¼: ",q(new Date(s.issueDate),"yyyy-MM-dd",{locale:$})]})]}),s.dueDate&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(me,{className:"h-3 w-3 text-muted-foreground"}),e.jsxs("span",{children:["ë§ˆê°ì¼: ",q(new Date(s.dueDate),"yyyy-MM-dd",{locale:$})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ue,{className:"h-3 w-3 text-muted-foreground"}),e.jsxs("span",{children:["ì´ì•¡: â‚©",Math.round(s.totalAmount||0).toLocaleString("ko-KR")]})]}),s.vatAmount>0&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ue,{className:"h-3 w-3 text-muted-foreground"}),e.jsxs("span",{children:["ë¶€ê°€ì„¸: â‚©",Math.round(s.vatAmount||0).toLocaleString("ko-KR")]})]})]}),s.notes&&e.jsx("div",{className:"text-xs text-muted-foreground bg-muted p-2 rounded",children:s.notes}),e.jsxs("div",{className:"border-t pt-2 space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(le,{className:"h-3 w-3 text-muted-foreground"}),e.jsx("span",{className:"text-xs font-medium",children:"ì„¸ê¸ˆê³„ì‚°ì„œ"}),s.taxInvoiceIssued?e.jsxs(g,{variant:"default",className:"text-xs",children:[e.jsx(he,{className:"h-2 w-2 mr-1"}),"ë°œí–‰ì™„ë£Œ"]}):e.jsx(g,{variant:"secondary",className:"text-xs",children:"ë¯¸ë°œí–‰"})]}),e.jsxs("div",{className:"flex gap-1",children:[s.status==="verified"&&e.jsx(e.Fragment,{children:s.taxInvoiceIssued?e.jsxs(c,{size:"sm",variant:"destructive",onClick:()=>f.mutate(s.id),disabled:f.isPending,children:[e.jsx(de,{className:"h-3 w-3 mr-1"}),e.jsx("span",{className:"text-xs",children:f.isPending?"ì·¨ì†Œ ì¤‘...":"ë°œí–‰ ì·¨ì†Œ"})]}):e.jsxs(c,{size:"sm",variant:"outline",onClick:()=>S.mutate(s.id),disabled:S.isPending,children:[e.jsx(le,{className:"h-3 w-3 mr-1"}),e.jsx("span",{className:"text-xs",children:S.isPending?"ì²˜ë¦¬ ì¤‘...":"ë°œí–‰ í™•ì¸"})]})}),s.status!=="verified"&&e.jsx("div",{className:"text-xs text-muted-foreground",children:"ì²­êµ¬ì„œ ê²€ì¦ í›„ ë°œí–‰ ê°€ëŠ¥"})]})]}),s.status==="verified"&&s.taxInvoiceIssued&&s.taxInvoiceIssuedDate&&e.jsxs("div",{className:"text-xs text-muted-foreground bg-green-50 dark:bg-green-900/20 p-2 rounded",children:["ë°œí–‰ì¼: ",q(new Date(s.taxInvoiceIssuedDate),"yyyy-MM-dd HH:mm",{locale:$}),s.taxInvoiceIssuedBy&&` | ë°œí–‰ìž: ${s.taxInvoiceIssuedBy}`]})]}),s.verifiedBy&&s.verifiedAt&&e.jsxs("div",{className:"text-xs text-muted-foreground border-t pt-1",children:["ê²€ì¦ìž: ",s.verifiedBy," | ê²€ì¦ì¼: ",q(new Date(s.verifiedAt),"yyyy-MM-dd HH:mm",{locale:$})]})]},s.id))})]}),w.length>0&&e.jsxs("div",{className:"mt-3",children:[e.jsx("h4",{className:"font-medium mb-2 text-xs",children:"ê²€ì¦ ë¡œê·¸"}),e.jsx("div",{className:"space-y-1 max-h-32 overflow-y-auto",children:w.map(s=>e.jsxs("div",{className:"text-xs p-2 bg-muted rounded",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("span",{children:s.details}),e.jsx("span",{className:"text-xs text-muted-foreground",children:q(new Date(s.createdAt),"MM-dd HH:mm",{locale:$})})]}),e.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:s.performedBy})]},s.id))})]})]})]})}function $e({orderItems:r,orderId:l}){const{toast:d}=ce(),h=ge(),[u,y]=T.useState(!1),[x,t]=T.useState(null),[I,w]=T.useState(!1),[v,A]=T.useState(null),[,S]=T.useState(0),f=L({queryKey:["/api/item-receipts",l],queryFn:async()=>{try{const i=await fetch("/api/item-receipts",{headers:{"Cache-Control":"no-cache",Pragma:"no-cache"}});if(!i.ok)throw new Error(`HTTP ${i.status}: ${i.statusText}`);const a=await i.json(),o=r.map(b=>b.id),m=a.filter(b=>o.includes(b.orderItemId));return console.log(`âœ… Query successful: Found ${m.length} receipts for order ${l}`),console.log("âœ… Filtered receipts:",m),m}catch(i){return console.error("âŒ Receipt query failed:",i),[]}},staleTime:0,gcTime:0,refetchOnMount:!0,refetchOnWindowFocus:!0,retry:!1,enabled:r.length>0}),{data:H=[]}=L({queryKey:["/api/invoices",l],queryFn:async()=>await(await N("GET",`/api/invoices?orderId=${l}`)).json()}),M=D({mutationFn:async i=>{console.log("Sending receipt data to API:",i);try{const a=await N("POST","/api/item-receipts",i);return console.log("API response:",a),a}catch(a){throw console.error("API request failed:",a),a}},onSuccess:async i=>{console.log("ðŸ’¥ Receipt creation successful, forcing refetch:",i),h.resetQueries({queryKey:["/api/item-receipts",l]}),h.invalidateQueries({queryKey:["/api/item-receipts"]}),await f.refetch(),S(a=>a+1),h.invalidateQueries({queryKey:["/api/verification-logs",l]}),y(!1),t(null),d({title:"ì„±ê³µ",description:"ìˆ˜ë ¹ í™•ì¸ì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤."})},onError:i=>{console.error("Receipt creation mutation error:",i);const a=i?.message||"ìˆ˜ë ¹ í™•ì¸ ë“±ë¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.";d({title:"ì˜¤ë¥˜",description:a,variant:"destructive"})}}),R=D({mutationFn:async i=>{const{id:a,...o}=i;return await(await N("PATCH",`/api/item-receipts/${a}`,o)).json()},onSuccess:async i=>{console.log("ðŸ’¥ Receipt update successful:",i),h.resetQueries({queryKey:["/api/item-receipts",l]}),h.invalidateQueries({queryKey:["/api/item-receipts"]}),await f.refetch(),S(a=>a+1),h.invalidateQueries({queryKey:["/api/verification-logs",l]}),w(!1),A(null),d({title:"ìˆ˜ë ¹ ì •ë³´ ìˆ˜ì • ì™„ë£Œ",description:"ìˆ˜ë ¹ ì •ë³´ê°€ ì„±ê³µì ìœ¼ë¡œ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤."})},onError:i=>{d({title:"ìˆ˜ì • ì‹¤íŒ¨",description:i.message||"ìˆ˜ë ¹ ì •ë³´ ìˆ˜ì • ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.",variant:"destructive"})}}),s=D({mutationFn:async i=>await N("DELETE",`/api/item-receipts/${i}`),onSuccess:async()=>{console.log("ðŸ’¥ Receipt deletion successful"),h.resetQueries({queryKey:["/api/item-receipts",l]}),h.invalidateQueries({queryKey:["/api/item-receipts"]}),await f.refetch(),S(i=>i+1),h.invalidateQueries({queryKey:["/api/verification-logs",l]}),d({title:"ìˆ˜ë ¹ ì •ë³´ ì‚­ì œ ì™„ë£Œ",description:"ìˆ˜ë ¹ ì •ë³´ê°€ ì„±ê³µì ìœ¼ë¡œ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤."})},onError:i=>{d({title:"ì‚­ì œ ì‹¤íŒ¨",description:i.message||"ìˆ˜ë ¹ ì •ë³´ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.",variant:"destructive"})}}),n=D({mutationFn:async i=>{const a=i.map(o=>N("POST","/api/item-receipts",o));return await Promise.all(a)},onSuccess:()=>{h.invalidateQueries({queryKey:["/api/item-receipts"]}),h.invalidateQueries({queryKey:["/api/verification-logs",l]}),d({title:"ì„±ê³µ",description:"ì¼ê´„ ìˆ˜ë ¹ ë“±ë¡ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤."})},onError:()=>{d({title:"ì˜¤ë¥˜",description:"ì¼ê´„ ìˆ˜ë ¹ ë“±ë¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.",variant:"destructive"})}}),F=i=>{i.preventDefault();const a=new FormData(i.currentTarget),o={orderItemId:x.id,invoiceId:a.get("invoiceId")?parseInt(a.get("invoiceId")):void 0,receivedQuantity:parseFloat(a.get("receivedQuantity")),receivedDate:a.get("receivedDate"),qualityCheck:a.get("qualityCheck")==="on",qualityNotes:a.get("qualityNotes")||"",status:a.get("status")||"approved",notes:a.get("notes")||""};console.log("Submitting receipt data:",o),M.mutate(o)},ne=i=>{if(i.preventDefault(),!v){d({title:"ì˜¤ë¥˜",description:"ì„ íƒëœ ìˆ˜ë ¹ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.",variant:"destructive"});return}const a=new FormData(i.currentTarget),o={id:v.id,receivedQuantity:parseFloat(a.get("receivedQuantity")),receivedDate:a.get("receivedDate"),qualityCheck:a.get("qualityCheck")==="on",qualityNotes:a.get("qualityNotes")||"",status:a.get("status")||"pending",notes:a.get("notes")||""};console.log("Submitting updated receipt data:",o),R.mutate(o)},B=()=>{const i=new Date().toISOString().split("T")[0],a=r.filter(m=>W(m.id)<m.quantity);if(a.length===0){d({title:"ì•Œë¦¼",description:"ëª¨ë“  í•­ëª©ì´ ì´ë¯¸ ìˆ˜ë ¹ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤."});return}const o=a.map(m=>({orderItemId:m.id,receivedQuantity:m.quantity-W(m.id),receivedDate:i,qualityCheck:!0,status:"approved",notes:"ì¼ê´„ ìˆ˜ë ¹ ë“±ë¡"}));n.mutate(o)},G=i=>{if(f.status==="error")return console.log(`âŒ Query in error state for item ${i}, triggering fresh fetch`),f.refetch(),[];const a=f.data||[];console.log(`ðŸ” Looking for receipts for item ${i}`),console.log(`ðŸ” Current query data length: ${a.length}`),console.log(`ðŸ” Query status: ${f.status}, isFetching: ${f.isFetching}`);const o=a.filter(m=>m.orderItemId===i);return console.log(`ðŸ“‹ Found ${o.length} receipts for item ${i}:`,o),o},W=i=>{const o=G(i).reduce((m,b)=>{const p=typeof b.receivedQuantity=="string"?parseFloat(b.receivedQuantity):b.receivedQuantity;return m+(p||0)},0);return console.log(`ðŸ’¯ Total received for item ${i}: ${o}`),o},ye=i=>{const m=(f.data||[]).filter(p=>p.orderItemId===i.id).reduce((p,re)=>{const fe=typeof re.receivedQuantity=="string"?parseFloat(re.receivedQuantity):re.receivedQuantity;return p+(fe||0)},0),b=i.quantity;return m===0?{status:"pending",label:"ë¯¸ìˆ˜ë ¹",icon:Te,color:"secondary"}:m<b?{status:"partial",label:"ë¶€ë¶„ìˆ˜ë ¹",icon:ze,color:"warning"}:{status:"complete",label:"ìˆ˜ë ¹ì™„ë£Œ",icon:E,color:"default"}},ve=i=>{switch(i){case"pending":return e.jsx(g,{variant:"secondary",children:"ëŒ€ê¸°ì¤‘"});case"approved":return e.jsx(g,{variant:"default",children:"ìŠ¹ì¸ë¨"});case"rejected":return e.jsx(g,{variant:"destructive",children:"ë°˜ë ¤ë¨"});default:return e.jsx(g,{variant:"secondary",children:i})}};return e.jsxs(z,{children:[e.jsx(P,{className:"pb-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(_,{className:"flex items-center gap-1 text-sm",children:[e.jsx(pe,{className:"h-4 w-4"}),"ìžìž¬ ìˆ˜ë ¹ í™•ì¸"]}),e.jsxs(c,{onClick:B,disabled:n.isPending,className:"bg-blue-600 hover:bg-blue-700",size:"sm",children:[e.jsx(pe,{className:"h-3 w-3 mr-1"}),e.jsx("span",{className:"text-xs",children:"ì¼ê´„ ìˆ˜ë ¹ ë“±ë¡"})]})]})}),e.jsxs(Q,{className:"p-3",children:[e.jsx("div",{className:"space-y-2",children:r.map(i=>{const a=G(i.id),o=W(i.id),m=ye(i),b=m.icon;return e.jsxs("div",{className:"border rounded-lg p-2 space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-1 mb-1",children:[e.jsx("h4",{className:"font-medium text-xs",children:i.itemName}),e.jsxs(g,{variant:m.color,className:"flex items-center gap-1 text-xs",children:[e.jsx(b,{className:"h-3 w-3"}),m.label]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2 text-xs text-muted-foreground",children:[e.jsxs("div",{children:["ë°œì£¼ìˆ˜ëŸ‰: ",i.quantity.toLocaleString(),i.unit]}),e.jsxs("div",{children:["ìˆ˜ë ¹ìˆ˜ëŸ‰: ",o.toLocaleString(),i.unit]}),e.jsxs("div",{children:["ë¯¸ìˆ˜ë ¹: ",(i.quantity-o).toLocaleString(),i.unit]}),e.jsxs("div",{children:["ë‹¨ê°€: â‚©",Math.round(i.unitPrice||0).toLocaleString("ko-KR")]})]}),i.notes&&e.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:i.notes})]}),e.jsxs(c,{size:"sm",onClick:()=>{t(i),y(!0)},disabled:o>=i.quantity,children:[e.jsx(ke,{className:"h-3 w-3 mr-1"}),e.jsx("span",{className:"text-xs",children:"ìˆ˜ë ¹ë“±ë¡"})]})]}),a.length>0&&e.jsxs("div",{className:"mt-2",children:[e.jsx("h5",{className:"text-xs font-medium mb-1",children:"ìˆ˜ë ¹ ì´ë ¥"}),e.jsx("div",{className:"space-y-1",children:a.map(p=>e.jsx("div",{className:"bg-muted p-2 rounded text-xs",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs("span",{className:"font-medium text-xs",children:[(typeof p.receivedQuantity=="string"?parseFloat(p.receivedQuantity):p.receivedQuantity).toLocaleString(),i.unit," ìˆ˜ë ¹"]}),ve(p.status),p.qualityCheck&&e.jsxs(g,{variant:"outline",className:"text-xs",children:[e.jsx(E,{className:"h-2 w-2 mr-1"}),"í’ˆì§ˆê²€ì‚¬"]})]}),e.jsxs("div",{className:"text-muted-foreground text-xs",children:["ìˆ˜ë ¹ì¼: ",q(new Date(p.receivedDate),"yyyy-MM-dd",{locale:$})]}),p.qualityNotes&&e.jsxs("div",{className:"text-muted-foreground text-xs",children:["í’ˆì§ˆë©”ëª¨: ",p.qualityNotes]}),p.notes&&e.jsxs("div",{className:"text-muted-foreground text-xs",children:["ë©”ëª¨: ",p.notes]})]}),e.jsxs("div",{className:"flex flex-col items-end gap-1",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(c,{size:"sm",variant:"ghost",onClick:()=>{A(p),w(!0)},className:"h-6 w-6 p-0 hover:bg-blue-50",children:e.jsx(Ae,{className:"h-3 w-3 text-blue-600"})}),e.jsx(c,{size:"sm",variant:"ghost",onClick:()=>{confirm("ì´ ìˆ˜ë ¹ ê¸°ë¡ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")&&s.mutate(p.id)},className:"h-6 w-6 p-0 hover:bg-red-50",disabled:s.isPending,children:e.jsx(Fe,{className:"h-3 w-3 text-red-600"})})]}),e.jsxs("div",{className:"text-xs text-muted-foreground text-right",children:[e.jsxs("div",{children:["ë“±ë¡ìž: ",p.verifiedBy]}),e.jsx("div",{children:q(new Date(p.createdAt),"MM-dd HH:mm",{locale:$})})]})]})]})},p.id))})]})]},i.id)})}),e.jsx(ee,{open:u,onOpenChange:y,children:e.jsxs(se,{children:[e.jsx(te,{children:e.jsx(ie,{children:"ìžìž¬ ìˆ˜ë ¹ ë“±ë¡"})}),x&&e.jsxs("form",{onSubmit:F,className:"space-y-4",children:[e.jsxs("div",{className:"bg-muted p-3 rounded",children:[e.jsx("div",{className:"font-medium",children:x.itemName}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["ë°œì£¼ìˆ˜ëŸ‰: ",x.quantity.toLocaleString(),x.unit," | ìˆ˜ë ¹ê°€ëŠ¥: ",(x.quantity-W(x.id)).toLocaleString(),x.unit]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"receivedQuantity",children:"ìˆ˜ë ¹ ìˆ˜ëŸ‰"}),e.jsx(C,{id:"receivedQuantity",name:"receivedQuantity",type:"number",step:"0.01",max:x.quantity-W(x.id),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"receivedDate",children:"ìˆ˜ë ¹ ì¼ìž"}),e.jsx(C,{id:"receivedDate",name:"receivedDate",type:"date",defaultValue:new Date().toISOString().split("T")[0],required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"invoiceId",children:"ì—°ê²°ëœ ì²­êµ¬ì„œ (ì„ íƒ)"}),e.jsxs(X,{name:"invoiceId",children:[e.jsx(Y,{children:e.jsx(J,{placeholder:"ì²­êµ¬ì„œ ì„ íƒ"})}),e.jsx(Z,{children:H.map(i=>e.jsxs(k,{value:i.id.toString(),children:[i.invoiceNumber," - â‚©",i.totalAmount.toLocaleString()]},i.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"status",children:"ìƒíƒœ"}),e.jsxs(X,{name:"status",defaultValue:"pending",children:[e.jsx(Y,{children:e.jsx(J,{})}),e.jsxs(Z,{children:[e.jsx(k,{value:"pending",children:"ëŒ€ê¸°ì¤‘"}),e.jsx(k,{value:"approved",children:"ìŠ¹ì¸ë¨"}),e.jsx(k,{value:"rejected",children:"ë°˜ë ¤ë¨"})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(je,{id:"qualityCheck",name:"qualityCheck"}),e.jsx(j,{htmlFor:"qualityCheck",className:"text-sm",children:"í’ˆì§ˆ ê²€ì‚¬ ì™„ë£Œ"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"qualityNotes",children:"í’ˆì§ˆ ê²€ì‚¬ ë©”ëª¨"}),e.jsx(V,{id:"qualityNotes",name:"qualityNotes",rows:2,placeholder:"í’ˆì§ˆ ê²€ì‚¬ ê²°ê³¼ë‚˜ íŠ¹ì´ì‚¬í•­ì„ ìž…ë ¥í•˜ì„¸ìš”"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"notes",children:"ì¶”ê°€ ë©”ëª¨"}),e.jsx(V,{id:"notes",name:"notes",rows:2,placeholder:"ê¸°íƒ€ ë©”ëª¨ì‚¬í•­ì„ ìž…ë ¥í•˜ì„¸ìš”"})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(c,{type:"button",variant:"outline",onClick:()=>y(!1),children:"ì·¨ì†Œ"}),e.jsx(c,{type:"submit",disabled:M.isPending,children:M.isPending?"ë“±ë¡ ì¤‘...":"ë“±ë¡"})]})]})]})}),e.jsx(ee,{open:I,onOpenChange:w,children:e.jsxs(se,{children:[e.jsx(te,{children:e.jsx(ie,{children:"ìˆ˜ë ¹ ì •ë³´ ìˆ˜ì •"})}),v&&e.jsxs("form",{onSubmit:ne,className:"space-y-4",children:[e.jsx("div",{className:"bg-muted p-3 rounded",children:e.jsxs("div",{className:"text-sm text-muted-foreground",children:["ìˆ˜ë ¹ ê¸°ë¡ ID: ",v.id]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"edit-receivedQuantity",children:"ìˆ˜ë ¹ ìˆ˜ëŸ‰"}),e.jsx(C,{id:"edit-receivedQuantity",name:"receivedQuantity",type:"number",step:"0.01",defaultValue:v.receivedQuantity,required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"edit-receivedDate",children:"ìˆ˜ë ¹ ì¼ìž"}),e.jsx(C,{id:"edit-receivedDate",name:"receivedDate",type:"date",defaultValue:new Date(v.receivedDate).toISOString().split("T")[0],required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"edit-status",children:"ìƒíƒœ"}),e.jsxs(X,{name:"status",defaultValue:v.status,children:[e.jsx(Y,{children:e.jsx(J,{})}),e.jsxs(Z,{children:[e.jsx(k,{value:"pending",children:"ëŒ€ê¸°ì¤‘"}),e.jsx(k,{value:"approved",children:"ìŠ¹ì¸ë¨"}),e.jsx(k,{value:"rejected",children:"ë°˜ë ¤ë¨"})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(je,{id:"edit-qualityCheck",name:"qualityCheck",defaultChecked:v.qualityCheck}),e.jsx(j,{htmlFor:"edit-qualityCheck",className:"text-sm",children:"í’ˆì§ˆ ê²€ì‚¬ ì™„ë£Œ"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"edit-qualityNotes",children:"í’ˆì§ˆ ê²€ì‚¬ ë©”ëª¨"}),e.jsx(V,{id:"edit-qualityNotes",name:"qualityNotes",rows:2,defaultValue:v.qualityNotes,placeholder:"í’ˆì§ˆ ê²€ì‚¬ ê²°ê³¼ë‚˜ íŠ¹ì´ì‚¬í•­ì„ ìž…ë ¥í•˜ì„¸ìš”"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"edit-notes",children:"ì¶”ê°€ ë©”ëª¨"}),e.jsx(V,{id:"edit-notes",name:"notes",rows:2,defaultValue:v.notes,placeholder:"ê¸°íƒ€ ë©”ëª¨ì‚¬í•­ì„ ìž…ë ¥í•˜ì„¸ìš”"})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(c,{type:"button",variant:"outline",onClick:()=>w(!1),children:"ì·¨ì†Œ"}),e.jsx(c,{type:"submit",disabled:R.isPending,children:R.isPending?"ìˆ˜ì • ì¤‘...":"ìˆ˜ì • ì™„ë£Œ"})]})]})]})})]})]})}function Oe({order:r}){const l=u=>`â‚©${Math.round(u).toLocaleString("ko-KR")}`,d=u=>q(new Date(u),"yyyyë…„ MMì›” ddì¼"),h=()=>!r.items||r.items.length===0?0:r.items.reduce((u,y)=>{const x=parseFloat(y.quantity)||0,t=parseFloat(y.unitPrice)||0,I=y.totalAmount||x*t,w=parseFloat(I)||0;return u+w},0);return e.jsxs("div",{style:{fontFamily:'"Noto Sans KR", "Malgun Gothic", sans-serif',fontSize:"11px",lineHeight:"1.3",color:"#000",backgroundColor:"#fff",width:"210mm",minHeight:"297mm",padding:"10mm",margin:"0 auto",boxShadow:"0 0 10px rgba(0,0,0,0.1)"},children:[e.jsx("table",{style:{width:"100%",marginBottom:"15px",borderCollapse:"collapse"},children:e.jsx("tbody",{children:e.jsxs("tr",{children:[e.jsx("td",{style:{textAlign:"left",borderBottom:"2px solid #333",paddingBottom:"8px"},children:e.jsx("h1",{style:{margin:"0",fontSize:"18px",fontWeight:"bold",color:"#333"},children:"ë°œì£¼ì„œ Purchase Order"})}),e.jsxs("td",{style:{textAlign:"right",borderBottom:"2px solid #333",paddingBottom:"8px",fontSize:"10px",color:"#666"},children:["ë°œì£¼ë²ˆí˜¸: ",r.orderNumber||"PO-2025-0612-001"]})]})})}),e.jsx("table",{style:{width:"100%",marginBottom:"15px",borderCollapse:"collapse"},children:e.jsx("tbody",{children:e.jsxs("tr",{children:[e.jsx("td",{style:{width:"50%",verticalAlign:"top",paddingRight:"10px"},children:e.jsxs("table",{style:{width:"100%",border:"1px solid #666",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsx("tr",{children:e.jsx("th",{style:{backgroundColor:"#f0f0f0",border:"1px solid #666",padding:"5px",fontSize:"11px",fontWeight:"bold",textAlign:"center"},children:"ë°œì£¼ìž ì •ë³´"})})}),e.jsx("tbody",{children:e.jsx("tr",{children:e.jsxs("td",{style:{border:"1px solid #666",padding:"8px",fontSize:"10px"},children:[e.jsxs("div",{style:{marginBottom:"2px"},children:[e.jsx("strong",{children:"íšŒì‚¬ëª…:"})," ë°œì£¼ ì‹œìŠ¤í…œ"]}),e.jsxs("div",{style:{marginBottom:"2px"},children:[e.jsx("strong",{children:"ë‹´ë‹¹ìž:"})," David Yang"]}),e.jsxs("div",{style:{marginBottom:"2px"},children:[e.jsx("strong",{children:"ì´ë©”ì¼:"})," davidswyang@gmail.com"]}),e.jsxs("div",{style:{marginBottom:"2px"},children:[e.jsx("strong",{children:"ì—°ë½ì²˜:"})," 031-000-0000"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"ì£¼ì†Œ:"})," ê²½ê¸°ë„ ì„±ë‚¨ì‹œ ë¶„ë‹¹êµ¬"]})]})})})]})}),e.jsx("td",{style:{width:"50%",verticalAlign:"top",paddingLeft:"10px"},children:e.jsxs("table",{style:{width:"100%",border:"1px solid #666",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsx("tr",{children:e.jsx("th",{style:{backgroundColor:"#f0f0f0",border:"1px solid #666",padding:"5px",fontSize:"11px",fontWeight:"bold",textAlign:"center"},children:"ê±°ëž˜ì²˜ ì •ë³´"})})}),e.jsx("tbody",{children:e.jsx("tr",{children:e.jsxs("td",{style:{border:"1px solid #666",padding:"8px",fontSize:"10px"},children:[e.jsxs("div",{style:{marginBottom:"2px"},children:[e.jsx("strong",{children:"íšŒì‚¬ëª…:"})," ",r.vendor?.name||"ìµì§„íŒŒíŠ¸ë„ˆìŠ¤"]}),e.jsxs("div",{style:{marginBottom:"2px"},children:[e.jsx("strong",{children:"ì‚¬ì—…ìž:"})," ",r.vendor?.businessNumber||"123-45-67890"]}),e.jsxs("div",{style:{marginBottom:"2px"},children:[e.jsx("strong",{children:"ë‹´ë‹¹ìž:"})," í™ê¸¸ë™"]}),e.jsxs("div",{style:{marginBottom:"2px"},children:[e.jsx("strong",{children:"ì—°ë½ì²˜:"})," 031-000-0000"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"ì£¼ì†Œ:"})," ê²½ê¸°ë„ ì„±ë‚¨ì‹œ ë¶„ë‹¹êµ¬"]})]})})})]})})]})})}),e.jsxs("table",{style:{width:"100%",marginBottom:"15px",border:"1px solid #666",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsx("tr",{children:e.jsx("th",{style:{backgroundColor:"#f0f0f0",border:"1px solid #666",padding:"5px",fontSize:"11px",fontWeight:"bold",textAlign:"center"},children:"ë°œì£¼ ì •ë³´"})})}),e.jsx("tbody",{children:e.jsx("tr",{children:e.jsx("td",{style:{border:"1px solid #666",padding:"8px"},children:e.jsx("table",{style:{width:"100%",borderCollapse:"collapse"},children:e.jsx("tbody",{children:e.jsxs("tr",{children:[e.jsxs("td",{style:{width:"33%",fontSize:"10px",padding:"2px"},children:[e.jsx("strong",{children:"ë°œì£¼ë²ˆí˜¸:"})," ",r.orderNumber||"PO-2025-0612-001"]}),e.jsxs("td",{style:{width:"33%",fontSize:"10px",padding:"2px"},children:[e.jsx("strong",{children:"ë°œì£¼ì¼ìž:"})," ",r.orderDate?d(r.orderDate):"2025ë…„ 06ì›” 12ì¼"]}),e.jsxs("td",{style:{width:"33%",fontSize:"10px",padding:"2px"},children:[e.jsx("strong",{children:"ë‚©ê¸°ì¼ìž:"})," ",r.deliveryDate?d(r.deliveryDate):"2025ë…„ 06ì›” 30ì¼"]})]})})})})})})]}),e.jsxs("table",{style:{width:"100%",marginBottom:"15px",border:"1px solid #666",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsx("tr",{children:e.jsx("th",{style:{backgroundColor:"#f0f0f0",border:"1px solid #666",padding:"5px",fontSize:"11px",fontWeight:"bold",textAlign:"center"},children:"ë°œì£¼ í•­ëª©"})})}),e.jsx("tbody",{children:e.jsx("tr",{children:e.jsx("td",{style:{border:"1px solid #666",padding:"0"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{backgroundColor:"#f8f8f8"},children:[e.jsx("th",{style:{border:"1px solid #666",padding:"4px",fontSize:"10px",textAlign:"center",width:"8%"},children:"ìˆœë²ˆ"}),e.jsx("th",{style:{border:"1px solid #666",padding:"4px",fontSize:"10px",textAlign:"center",width:"25%"},children:"í’ˆëª©ëª…"}),e.jsx("th",{style:{border:"1px solid #666",padding:"4px",fontSize:"10px",textAlign:"center",width:"15%"},children:"ê·œê²©"}),e.jsx("th",{style:{border:"1px solid #666",padding:"4px",fontSize:"10px",textAlign:"center",width:"8%"},children:"ìˆ˜ëŸ‰"}),e.jsx("th",{style:{border:"1px solid #666",padding:"4px",fontSize:"10px",textAlign:"center",width:"12%"},children:"ë‹¨ê°€"}),e.jsx("th",{style:{border:"1px solid #666",padding:"4px",fontSize:"10px",textAlign:"center",width:"12%"},children:"ê¸ˆì•¡"}),e.jsx("th",{style:{border:"1px solid #666",padding:"4px",fontSize:"10px",textAlign:"center",width:"20%"},children:"ë¹„ê³ "})]})}),e.jsxs("tbody",{children:[r.items&&r.items.length>0?r.items.map((u,y)=>e.jsxs("tr",{children:[e.jsx("td",{style:{border:"1px solid #666",padding:"4px",fontSize:"10px",textAlign:"center"},children:y+1}),e.jsx("td",{style:{border:"1px solid #666",padding:"4px",fontSize:"10px"},children:u.itemName}),e.jsx("td",{style:{border:"1px solid #666",padding:"4px",fontSize:"10px",textAlign:"center"},children:u.specification||"-"}),e.jsx("td",{style:{border:"1px solid #666",padding:"4px",fontSize:"10px",textAlign:"center"},children:parseFloat(u.quantity).toLocaleString()}),e.jsx("td",{style:{border:"1px solid #666",padding:"4px",fontSize:"10px",textAlign:"right"},children:l(u.unitPrice)}),e.jsx("td",{style:{border:"1px solid #666",padding:"4px",fontSize:"10px",textAlign:"right",fontWeight:"bold"},children:l(u.totalAmount)}),e.jsx("td",{style:{border:"1px solid #666",padding:"4px",fontSize:"10px",textAlign:"center"},children:u.notes||"-"})]},u.id||y)):e.jsx("tr",{children:e.jsx("td",{colSpan:7,style:{border:"1px solid #666",padding:"20px",fontSize:"10px",textAlign:"center",color:"#666"},children:"ë°œì£¼ í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤."})}),e.jsxs("tr",{style:{backgroundColor:"#f0f0f0"},children:[e.jsx("td",{colSpan:6,style:{border:"1px solid #666",padding:"6px",fontSize:"11px",textAlign:"right",fontWeight:"bold"},children:"ì´ ê¸ˆì•¡:"}),e.jsxs("td",{style:{border:"1px solid #666",padding:"6px",fontSize:"11px",textAlign:"right",fontWeight:"bold"},children:[l(h())," (VAT í¬í•¨)"]})]})]})]})})})})]}),e.jsxs("table",{style:{width:"100%",marginBottom:"15px",border:"1px solid #666",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsx("tr",{children:e.jsx("th",{style:{backgroundColor:"#f0f0f0",border:"1px solid #666",padding:"5px",fontSize:"11px",fontWeight:"bold",textAlign:"center"},children:"íŠ¹ì´ì‚¬í•­"})})}),e.jsx("tbody",{children:e.jsx("tr",{children:e.jsx("td",{style:{border:"1px solid #666",padding:"10px",fontSize:"10px",minHeight:"40px"},children:r.notes||"ë³¸ ë°œì£¼ì„œëŠ” ì •ê¸° ë°œì£¼ì— ë”°ë¥¸ ë°œìƒ ê±´ìœ¼ë¡œ, í’ˆì§ˆ ë° ë‚©ê¸°ì¼ì •ì„ ì¤€ìˆ˜í•˜ì—¬ ì£¼ì‹œê¸° ë°”ëžë‹ˆë‹¤."})})})]}),e.jsx("table",{style:{width:"100%",marginBottom:"20px",borderCollapse:"collapse"},children:e.jsx("tbody",{children:e.jsxs("tr",{children:[e.jsx("td",{style:{width:"50%",verticalAlign:"top",paddingRight:"10px"},children:e.jsxs("table",{style:{width:"100%",border:"1px solid #666",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsx("tr",{children:e.jsx("th",{style:{backgroundColor:"#f0f0f0",border:"1px solid #666",padding:"5px",fontSize:"11px",fontWeight:"bold",textAlign:"center"},children:"ë°œì£¼ìž"})})}),e.jsx("tbody",{children:e.jsx("tr",{children:e.jsxs("td",{style:{border:"1px solid #666",padding:"15px",fontSize:"10px",textAlign:"center"},children:[e.jsxs("div",{style:{marginBottom:"10px"},children:["ë‚ ì§œ: ",r.orderDate?d(r.orderDate):"2025ë…„ 06ì›” 12ì¼"]}),e.jsx("div",{children:"ì„œëª…: _______________"})]})})})]})}),e.jsx("td",{style:{width:"50%",verticalAlign:"top",paddingLeft:"10px"},children:e.jsxs("table",{style:{width:"100%",border:"1px solid #666",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsx("tr",{children:e.jsx("th",{style:{backgroundColor:"#f0f0f0",border:"1px solid #666",padding:"5px",fontSize:"11px",fontWeight:"bold",textAlign:"center"},children:"ìŠ¹ì¸ìž"})})}),e.jsx("tbody",{children:e.jsx("tr",{children:e.jsxs("td",{style:{border:"1px solid #666",padding:"15px",fontSize:"10px",textAlign:"center"},children:[e.jsx("div",{style:{marginBottom:"10px"},children:"ë‚ ì§œ: _______________"}),e.jsx("div",{children:"ì„œëª…: _______________"})]})})})]})})]})})}),e.jsx("div",{style:{marginTop:"20px",paddingTop:"10px",borderTop:"1px solid #999",fontSize:"9px",color:"#666"},children:e.jsx("table",{style:{width:"100%"},children:e.jsx("tbody",{children:e.jsxs("tr",{children:[e.jsxs("td",{style:{textAlign:"left"},children:["ë³¸ ë°œì£¼ì„œëŠ” ìžìž¬ ë°œì£¼ ê´€ë¦¬ ì‹œìŠ¤í…œì—ì„œ ìžë™ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤. ìƒì„±ì¼ì‹œ: ",q(new Date,"yyyyë…„ MMì›” ddì¼ HH:mm")]}),e.jsx("td",{style:{textAlign:"right"},children:"íŽ˜ì´ì§€ 1"})]})})})})]})}function Je({params:r}){const{user:l}=be(),{toast:d}=ce(),[,h]=Ne(),[u,y]=T.useState(!1),x=parseInt(r.id),{data:t,isLoading:I}=L({queryKey:[`/api/orders/${x}`],queryFn:()=>N("GET",`/api/orders/${x}`)});console.log("Order detail - full order data:",t),console.log("Order detail - items:",t?.items);const{data:w}=L({queryKey:["/api/order-statuses"]}),v=D({mutationFn:async()=>{await N("POST",`/api/orders/${x}/approve`)},onSuccess:()=>{d({title:"ë°œì£¼ì„œ ìŠ¹ì¸",description:"ë°œì£¼ì„œê°€ ì„±ê³µì ìœ¼ë¡œ ìŠ¹ì¸ë˜ì—ˆìŠµë‹ˆë‹¤."}),xe.invalidateQueries({queryKey:["/api/orders"]})},onError:n=>{d({title:"ìŠ¹ì¸ ì‹¤íŒ¨",description:n.message,variant:"destructive"})}}),A=D({mutationFn:async()=>{await N("POST",`/api/orders/${x}/send`)},onSuccess:()=>{d({title:"ë°œì£¼ì„œ ë°œì†¡",description:"ë°œì£¼ì„œê°€ ì„±ê³µì ìœ¼ë¡œ ë°œì†¡ë˜ì—ˆìŠµë‹ˆë‹¤."}),xe.invalidateQueries({queryKey:["/api/orders"]})},onError:n=>{d({title:"ë°œì†¡ ì‹¤íŒ¨",description:n.message,variant:"destructive"})}}),S=n=>{const F=w?.find(G=>G.code===n),ne=F?F.name:n;let B="secondary";if(F)switch(F.color){case"yellow":B="secondary";break;case"blue":case"green":B="default";break;case"red":B="destructive";break;default:B="outline";break}return e.jsx(g,{variant:B,children:ne})},f=()=>{confirm("ì´ ë°œì£¼ì„œë¥¼ ìŠ¹ì¸í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")&&v.mutate()},H=()=>{confirm("ì´ ë°œì£¼ì„œë¥¼ ê±°ëž˜ì²˜ì— ë°œì†¡í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")&&A.mutate()};if(I)return e.jsx("div",{className:"container mx-auto p-6",children:e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/4"}),e.jsx("div",{className:"h-32 bg-gray-200 rounded"}),e.jsx("div",{className:"h-64 bg-gray-200 rounded"})]})});if(!t)return e.jsx("div",{className:"container mx-auto p-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-2xl font-bold mb-4",children:"ë°œì£¼ì„œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤"}),e.jsx(c,{onClick:()=>h("/orders"),children:"ë°œì£¼ì„œ ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸°"})]})});const M=l?.role==="admin"&&t.status==="pending_approval",R=t.status==="approved",s=t.status!=="sent"&&t.status!=="received";return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx("div",{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(c,{variant:"ghost",size:"sm",onClick:()=>h("/orders"),className:"no-print",children:[e.jsx(Pe,{className:"h-4 w-4 mr-2"}),"ëª©ë¡"]}),e.jsx(ae,{className:"h-6 w-6 text-blue-600"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:t.orderNumber}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"ë°œì£¼ì„œ ìƒì„¸ ì •ë³´"})]}),S(t.status)]}),e.jsxs("div",{className:"flex space-x-2 no-print",children:[s&&e.jsxs(c,{variant:"outline",size:"sm",onClick:()=>h(`/orders/${x}/edit`),children:[e.jsx(_e,{className:"h-3 w-3 mr-1"}),"ìˆ˜ì •"]}),M&&e.jsxs(c,{size:"sm",onClick:f,disabled:v.isPending,children:[e.jsx(E,{className:"h-3 w-3 mr-1"}),"ìŠ¹ì¸"]}),R&&e.jsxs(c,{size:"sm",onClick:H,disabled:A.isPending,children:[e.jsx(Qe,{className:"h-3 w-3 mr-1"}),"ë°œì†¡"]}),e.jsxs(c,{variant:"outline",size:"sm",onClick:()=>y(!0),children:[e.jsx(Ie,{className:"h-3 w-3 mr-1"}),"ë¯¸ë¦¬ë³´ê¸°"]})]})]})}),e.jsxs(z,{children:[e.jsx(P,{className:"pb-2",children:e.jsx(_,{className:"text-sm",children:"ë°œì£¼ì„œ ì •ë³´"})}),e.jsxs(Q,{className:"p-3",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-gray-500",children:"ë°œì£¼ë²ˆí˜¸"}),e.jsx("p",{className:"text-xs font-semibold",children:t.orderNumber})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-gray-500",children:"ê±°ëž˜ì²˜"}),e.jsx("p",{className:"text-xs text-blue-600 hover:text-blue-800 cursor-pointer",onClick:()=>t.vendor?.id&&h(`/vendors/${t.vendor.id}`),children:t.vendor?.name||"ì•Œ ìˆ˜ ì—†ìŒ"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-gray-500",children:"ë°œì£¼ì¼"}),e.jsx("p",{className:"text-xs",children:t.orderDate?q(new Date(t.orderDate),"yyyy-MM-dd"):"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-gray-500",children:"ë‚©ê¸°ì¼"}),e.jsx("p",{className:"text-xs",children:t.deliveryDate?q(new Date(t.deliveryDate),"yyyy-MM-dd"):"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-gray-500",children:"ì´ê¸ˆì•¡"}),e.jsx("p",{className:"text-xs font-bold text-blue-600",children:U(t.totalAmount)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-gray-500",children:"ë°œì£¼ë‹´ë‹¹ìž"}),e.jsx("p",{className:"text-xs",children:t.user?.firstName&&t.user?.lastName?`${t.user.lastName}${t.user.firstName}`:t.user?.email||"ì•Œ ìˆ˜ ì—†ìŒ"})]}),t.project&&e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-gray-500",children:"í˜„ìž¥"}),e.jsx("p",{className:"text-xs font-medium text-green-600 hover:text-green-800 cursor-pointer",onClick:()=>h(`/projects/${t.project.id}`),children:t.project.projectName}),e.jsxs("p",{className:"text-xs text-gray-500",children:["(",t.project.projectCode,")"]})]})]}),t.notes&&e.jsxs("div",{className:"mt-3",children:[e.jsx("label",{className:"text-xs font-medium text-gray-500",children:"ë¹„ê³ "}),e.jsx("p",{className:"text-xs mt-1 p-2 bg-gray-50 rounded border",children:t.notes})]})]})]}),e.jsxs(z,{children:[e.jsx(P,{className:"pb-2",children:e.jsx(_,{className:"text-sm",children:"ë°œì£¼ í’ˆëª©"})}),e.jsxs(Q,{className:"p-3",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(Se,{children:[e.jsx(qe,{children:e.jsxs(oe,{children:[e.jsx(O,{className:"text-xs py-1",children:"í’ˆëª©ëª…"}),e.jsx(O,{className:"text-xs py-1",children:"ê·œê²©"}),e.jsx(O,{className:"text-xs text-right py-1",children:"ìˆ˜ëŸ‰"}),e.jsx(O,{className:"text-xs text-right py-1",children:"ë‹¨ê°€"}),e.jsx(O,{className:"text-xs text-right py-1",children:"ê¸ˆì•¡"}),e.jsx(O,{className:"text-xs py-1",children:"ë¹„ê³ "})]})}),e.jsx(Ce,{children:t.items?.map((n,F)=>e.jsxs(oe,{children:[e.jsx(K,{className:"font-medium text-xs py-1 px-2",children:n.itemName}),e.jsx(K,{className:"text-xs py-1 px-2",children:n.specification||"-"}),e.jsx(K,{className:"text-right text-xs py-1 px-2",children:typeof n.quantity=="number"?n.quantity.toLocaleString():n.quantity||"-"}),e.jsx(K,{className:"text-right text-xs py-1 px-2 font-semibold text-blue-600",children:U(n.unitPrice)}),e.jsx(K,{className:"text-right font-semibold text-xs py-1 px-2 text-blue-600",children:U(n.totalAmount)}),e.jsx(K,{className:"text-xs py-1 px-2",children:n.notes||"-"})]},F))})]})}),e.jsx("div",{className:"flex justify-end mt-1 pt-1 border-t",children:e.jsx("div",{className:"text-right",children:e.jsxs("p",{className:"text-xs font-bold",children:["ì´ í•©ê³„: ",U(t.totalAmount)]})})})]})]}),t.vendor&&e.jsxs(z,{children:[e.jsx(P,{className:"pb-2",children:e.jsx(_,{className:"text-sm",children:"ê±°ëž˜ì²˜ ì •ë³´"})}),e.jsx(Q,{className:"p-3",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-gray-500",children:"ì—…ì²´ëª…"}),e.jsx("p",{className:"text-xs",children:t.vendor.name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-gray-500",children:"ë‹´ë‹¹ìž"}),e.jsx("p",{className:"text-xs",children:t.vendor.contact||"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-gray-500",children:"ì „í™”ë²ˆí˜¸"}),e.jsx("p",{className:"text-xs",children:t.vendor.phone||"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-gray-500",children:"ì´ë©”ì¼"}),e.jsx("p",{className:"text-xs",children:t.vendor.email||"-"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"text-xs font-medium text-gray-500",children:"ì£¼ì†Œ"}),e.jsx("p",{className:"text-xs",children:t.vendor.address||"-"})]})]})})]}),t.project&&e.jsxs(z,{children:[e.jsx(P,{className:"pb-2",children:e.jsx(_,{className:"text-sm",children:"í˜„ìž¥ ì •ë³´"})}),e.jsx(Q,{className:"p-3",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-gray-500",children:"í˜„ìž¥ëª…"}),e.jsx("p",{className:"text-sm font-semibold text-blue-600 hover:text-blue-800 cursor-pointer",onClick:()=>h(`/projects/${t.project.id}`),children:t.project.projectName})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-gray-500",children:"í˜„ìž¥ ì½”ë“œ"}),e.jsx("p",{className:"text-sm",children:t.project.projectCode})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-gray-500",children:"ë°œì£¼ë‹´ë‹¹ìž"}),e.jsx("p",{className:"text-sm",children:t.project.projectManager||"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-gray-500",children:"ìœ„ì¹˜"}),e.jsx("p",{className:"text-sm",children:t.project.location||"-"})]}),t.project.description&&e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"text-xs font-medium text-gray-500",children:"í˜„ìž¥ ì„¤ëª…"}),e.jsx("p",{className:"text-xs mt-1 p-2 bg-gray-50 rounded border",children:t.project.description})]})]})})]}),e.jsx(Be,{orderId:x}),t.items&&t.items.length>0&&e.jsx($e,{orderItems:t.items,orderId:x}),t.attachments&&t.attachments.length>0&&e.jsxs(z,{children:[e.jsx(P,{className:"pb-2",children:e.jsx(_,{className:"text-sm",children:"ì²¨ë¶€íŒŒì¼"})}),e.jsx(Q,{className:"p-3",children:e.jsx("div",{className:"space-y-1",children:t.attachments.map(n=>e.jsxs("div",{className:"flex items-center justify-between p-2 border rounded",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ae,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"text-xs",children:n.filename})]}),e.jsxs(c,{variant:"outline",size:"sm",children:[e.jsx(Me,{className:"h-3 w-3 mr-1"}),e.jsx("span",{className:"text-xs",children:"ë‹¤ìš´ë¡œë“œ"})]})]},n.id))})})]}),e.jsx(ee,{open:u,onOpenChange:y,children:e.jsxs(se,{className:"max-w-6xl max-h-[90vh] overflow-y-auto",children:[e.jsx(te,{children:e.jsxs(ie,{className:"flex items-center justify-between",children:[e.jsx("span",{children:"ë°œì£¼ì„œ ë¯¸ë¦¬ë³´ê¸°"}),e.jsx("div",{className:"flex space-x-2",children:e.jsxs(c,{variant:"outline",size:"sm",onClick:()=>{const n=window.open("","_blank");n&&(n.document.write(`
                        <html>
                          <head>
                            <title>ë°œì£¼ì„œ - ${t?.orderNumber}</title>
                            <style>
                              body { margin: 0; font-family: Arial, sans-serif; }
                              @media print {
                                body { margin: 0; }
                                .no-print { display: none !important; }
                              }
                            </style>
                          </head>
                          <body>
                            ${document.querySelector(".order-preview-content")?.innerHTML||""}
                          </body>
                        </html>
                      `),n.document.close(),n.print())},children:[e.jsx(Re,{className:"h-4 w-4 mr-2"}),"PDF ì¶œë ¥"]})})]})}),e.jsx("div",{className:"order-preview-content",children:t&&e.jsx(Oe,{order:t})})]})})]})}export{Je as default};
