import{v as Se,r as u,j as e,ah as U,a as Q,B as N,G as ke,h as re,w as R,m as ee,L as p,I as $,P as H,p as G,A as ve,D as ye,s as X,E as me,F as J,X as W,ak as Ee,a8 as q,c as Fe}from"./index-CT0ftmgw.js";import{A as ie,a as ce}from"./alert-DQYpj1R4.js";import{P as Pe}from"./progress-DJ07V07x.js";import{U as oe}from"./upload-DF-_7XK_.js";import{S as B,a as _,b as V,c as K,d as C}from"./select-i-FUF4r3.js";import{T as Y}from"./textarea-_3whHVQG.js";import{C as xe}from"./calendar-QXd5-012.js";import{P as he,a as ue,b as pe}from"./popover-iHl4x2GH.js";import{C as ge}from"./calendar-CMHFh0dj.js";import{T as be}from"./trash-2-CyJH5Th9.js";import{f as je}from"./format-BqlaHE6C.js";import{k as fe}from"./ko-DHTEdlBI.js";import{T as De,a as Ae,b as se,c as te}from"./tabs-DL-1zGCy.js";import{C as Z}from"./checkbox-BJHnt2OS.js";import{M as ae}from"./mail-B3ncz6jy.js";import{R as we}from"./refresh-cw-BxIJKMcL.js";import{D as de}from"./download-wNw4Myop.js";import{P as le}from"./paperclip-_nUpOGGF.js";import{D as Te,a as Oe,b as Ie,c as Le,e as $e}from"./dialog-Dx9IY5aH.js";import{S as ze}from"./save-DxhsuVpg.js";import{S as Me}from"./send-7lvlk8Kv.js";import{A as Re}from"./arrow-right-CXwidiB7.js";import{I as ne}from"./info-DLj60Ec7.js";import{T as Ue}from"./trending-up-DtPZumTZ.js";import{T as qe}from"./triangle-alert-9mAzq6ST.js";import"./index-BdQq_4o_.js";import"./index-Ba92UTF-.js";import"./chevron-down-CE-M5reU.js";import"./chevron-up-DjOtQo3T.js";import"./chevron-left-BmEy95aX.js";import"./index-B0T6xzVV.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ne=Se("Lightbulb",[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]]),Be=({onDataExtracted:a,onProcessedFileReady:v})=>{const[d,i]=u.useState(!1),[F,D]=u.useState(!1),[g,w]=u.useState(null),[A,b]=u.useState("idle"),[P,S]=u.useState(""),[y,m]=u.useState([]),[j,k]=u.useState(0),E=u.useCallback(h=>{h.preventDefault(),i(!0)},[]),T=u.useCallback(h=>{h.preventDefault(),i(!1)},[]),z=u.useCallback(h=>{h.preventDefault(),i(!1);const s=Array.from(h.dataTransfer.files).find(t=>t.type==="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"||t.name.endsWith(".xlsx"));s?I(s):(S("ì—‘ì…€ íŒŒì¼(.xlsx)ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤."),b("error"))},[]),O=h=>{const l=h.target.files?.[0];l&&I(l)},I=async h=>{w(h),D(!0),b("processing"),S("");const l=new FormData;l.append("file",h);try{const s=await fetch("/api/po-template/upload",{method:"POST",body:l});if(!s.ok)throw new Error("íŒŒì¼ ì—…ë¡œë“œ ì‹¤íŒ¨");const t=await s.json();if(t.success&&t.data.orders.length>0){m(t.data.orders),b("success");try{const r=await fetch("/api/po-template/extract-sheets",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({filePath:t.data.filePath,sheetNames:["ê°‘ì§€","ì„ì§€"]})});if(r.ok){const n=await r.json();if(n.success&&n.data.extractedPath){const o=`/uploads/${n.data.extractedPath.split("/").pop()}`,x=`${h.name.replace(".xlsx","")}_Inputì œê±°.xlsx`;console.log("ğŸ”· ì²˜ë¦¬ëœ Excel íŒŒì¼ ì •ë³´:",{processedFileUrl:o,processedFileName:x}),v?.({url:o,name:x})}}else{console.warn("âš ï¸ Extract sheets API ì‹¤íŒ¨, ê¸°ë³¸ê°’ ì‚¬ìš©");const c=`/uploads/extracted-${Date.now()}.xlsx`,o=`${h.name.replace(".xlsx","")}_Inputì œê±°.xlsx`;v?.({url:c,name:o})}}catch(r){console.error("Extract sheets í˜¸ì¶œ ì‹¤íŒ¨:",r);const c=`/uploads/extracted-${Date.now()}.xlsx`,o=`${h.name.replace(".xlsx","")}_Inputì œê±°.xlsx`;v?.({url:c,name:o})}if(t.data.orders.length===1){const r=t.data.orders[0],n={...r,projectName:r.siteName||r.projectName,orderDate:r.orderDate,deliveryDate:r.dueDate||r.deliveryDate,items:(r.items||[]).map(c=>({...c,name:c.itemName||c.name,unit:c.unit||"EA"}))};a(n)}}else throw new Error(t.error||"ë°ì´í„° ì¶”ì¶œ ì‹¤íŒ¨")}catch(s){S(s.message||"íŒŒì¼ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."),b("error")}finally{D(!1)}},L=async()=>{if(y[j]&&g){const h=y[j],l={...h,projectName:h.siteName||h.projectName,orderDate:h.orderDate,deliveryDate:h.dueDate||h.deliveryDate,items:(h.items||[]).map(s=>({...s,name:s.itemName||s.name,unit:s.unit||"EA"}))};a(l)}};return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{onDragOver:E,onDragLeave:T,onDrop:z,className:`
          border-2 border-dashed rounded-lg ${A==="success"?"p-4":"p-8"} text-center transition-all
          ${d?"border-blue-500 bg-blue-50":"border-gray-300 hover:border-gray-400"}
          ${F?"opacity-50 pointer-events-none":""}
        `,children:F?e.jsxs("div",{className:"space-y-2",children:[e.jsx(U,{className:"w-8 h-8 mx-auto text-blue-600 animate-spin"}),e.jsx("p",{className:"text-sm text-gray-600",children:"íŒŒì¼ì„ ì²˜ë¦¬í•˜ê³  ìˆìŠµë‹ˆë‹¤..."})]}):A==="success"?e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Q,{className:"w-8 h-8 text-green-600"}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"text-sm font-medium text-green-700",children:g?.name}),e.jsxs("p",{className:"text-xs text-gray-600",children:[y.length,"ê°œì˜ ë°œì£¼ì„œ ê°ì§€ë¨"]})]})]}),e.jsx(N,{variant:"outline",size:"sm",onClick:()=>{b("idle"),m([]),w(null)},children:"ë‹¤ì‹œ ì—…ë¡œë“œ"})]}):e.jsxs(e.Fragment,{children:[e.jsx(ke,{className:"w-12 h-12 mx-auto text-gray-400 mb-4"}),e.jsx("p",{className:"text-lg font-medium text-gray-700 mb-2",children:"ì—‘ì…€ íŒŒì¼ì„ ë“œë˜ê·¸í•˜ì—¬ ë†“ìœ¼ì„¸ìš”"}),e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"ë˜ëŠ”"}),e.jsx("input",{type:"file",accept:".xlsx",onChange:O,className:"hidden",id:"excel-upload"}),e.jsx("label",{htmlFor:"excel-upload",children:e.jsx(N,{variant:"outline",asChild:!0,children:e.jsxs("span",{className:"cursor-pointer",children:[e.jsx(oe,{className:"w-4 h-4 mr-2"}),"íŒŒì¼ ì„ íƒ"]})})})]})}),A==="error"&&P&&e.jsxs(ie,{variant:"destructive",children:[e.jsx(re,{className:"h-4 w-4"}),e.jsx(ce,{children:P})]}),y.length>1&&A==="success"&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700",children:"ë°œì£¼ì„œë¥¼ ì„ íƒí•˜ì„¸ìš”:"}),e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto border rounded-lg p-2 bg-gray-50",children:y.map((h,l)=>e.jsx("div",{onClick:()=>k(l),className:`
                  p-3 border rounded-lg cursor-pointer transition-colors
                  ${j===l?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300 bg-white"}
                `,children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:h.orderNumber}),e.jsxs("p",{className:"text-xs text-gray-600",children:[h.vendorName," | ",h.projectName]})]}),e.jsxs(R,{variant:"secondary",children:[h.items?.length||0,"ê°œ í’ˆëª©"]})]}),h.items&&h.items.length>0&&e.jsxs("div",{className:"pt-2 border-t border-gray-200",children:[e.jsxs("table",{className:"w-full text-xs",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-gray-500",children:[e.jsx("th",{className:"text-left font-normal",children:"í’ˆëª©"}),e.jsx("th",{className:"text-right font-normal",children:"ìˆ˜ëŸ‰"}),e.jsx("th",{className:"text-right font-normal",children:"ë‹¨ê°€"}),e.jsx("th",{className:"text-right font-normal",children:"ê¸ˆì•¡"})]})}),e.jsx("tbody",{children:h.items.slice(0,2).map((s,t)=>e.jsxs("tr",{children:[e.jsx("td",{className:"text-gray-600 truncate max-w-[150px] pr-2",children:s.itemName}),e.jsx("td",{className:"text-right text-gray-700",children:Math.floor(s.quantity||0).toLocaleString()}),e.jsx("td",{className:"text-right text-gray-700",children:Math.floor(s.unitPrice||0).toLocaleString()}),e.jsx("td",{className:"text-right font-medium",children:Math.floor(s.totalAmount||0).toLocaleString()})]},t))})]}),e.jsxs("div",{className:"flex items-center justify-between mt-1",children:[h.items.length>2&&e.jsxs("p",{className:"text-xs text-gray-500 italic",children:["ì™¸ ",h.items.length-2,"ê°œ"]}),e.jsxs("div",{className:"text-right",children:[e.jsx("span",{className:"text-xs text-gray-600 mr-2",children:"ì´ì•¡"}),e.jsxs("span",{className:"text-sm font-semibold text-blue-600",children:[Math.floor(h.totalAmount||h.items.reduce((s,t)=>s+(t.totalAmount||0),0)).toLocaleString(),"ì›"]})]})]})]})]})},l))}),e.jsx(N,{onClick:L,className:"w-full",size:"sm",children:"ì„ íƒí•œ ë°œì£¼ì„œ ì‚¬ìš©"})]})]})},_e=({initialData:a={},onChange:v})=>{const[d,i]=u.useState({orderNumber:a.orderNumber||`PO-${new Date().getTime()}`,orderDate:a.orderDate||new Date,deliveryDate:a.deliveryDate||new Date(Date.now()+6048e5),projectId:a.projectId||"",projectName:a.projectName||"",vendorId:a.vendorId||"",vendorName:a.vendorName||"",vendorEmail:a.vendorEmail||"",items:a.items||[{itemName:"",specification:"",unit:"EA",quantity:1,unitPrice:0,totalAmount:0,majorCategory:"",middleCategory:"",minorCategory:"",notes:""}],notes:a.notes||"",totalAmount:a.totalAmount||0}),{data:F,isLoading:D,error:g}=ee({queryKey:["projects"],queryFn:async()=>{console.log("ğŸ” í”„ë¡œì íŠ¸ ëª©ë¡ ì¡°íšŒ ì‹œì‘");const l=await fetch("/api/projects");if(!l.ok)throw new Error("í”„ë¡œì íŠ¸ ëª©ë¡ ì¡°íšŒ ì‹¤íŒ¨");const s=await l.json();return console.log("âœ… í”„ë¡œì íŠ¸ ëª©ë¡ ì¡°íšŒ ì„±ê³µ:",s.length,"ê°œ"),s}}),{data:w,isLoading:A,error:b}=ee({queryKey:["vendors"],queryFn:async()=>{console.log("ğŸ” ê±°ë˜ì²˜ ëª©ë¡ ì¡°íšŒ ì‹œì‘");const l=await fetch("/api/vendors");if(!l.ok)throw new Error("ê±°ë˜ì²˜ ëª©ë¡ ì¡°íšŒ ì‹¤íŒ¨");const s=await l.json();return console.log("âœ… ê±°ë˜ì²˜ ëª©ë¡ ì¡°íšŒ ì„±ê³µ:",s.length,"ê°œ"),s}}),{data:P,isLoading:S,error:y}=ee({queryKey:["categories"],queryFn:async()=>{console.log("ğŸ” ì¹´í…Œê³ ë¦¬ ëª©ë¡ ì¡°íšŒ ì‹œì‘");const l=await fetch("/api/item-categories");if(!l.ok)throw new Error("ì¹´í…Œê³ ë¦¬ ëª©ë¡ ì¡°íšŒ ì‹¤íŒ¨");const s=await l.json();return console.log("âœ… ì¹´í…Œê³ ë¦¬ ëª©ë¡ ì¡°íšŒ ì„±ê³µ:",s?.length,"ê°œ"),{categories:s}}});u.useEffect(()=>{a&&Object.keys(a).length>0&&(console.log("ğŸ“ DirectInputForm: initialData ë³€ê²½ ê°ì§€",a),i({orderNumber:a.orderNumber||`PO-${new Date().getTime()}`,orderDate:a.orderDate?new Date(a.orderDate):new Date,deliveryDate:a.deliveryDate?new Date(a.deliveryDate):new Date(Date.now()+7*24*60*60*1e3),projectId:a.projectId||"",projectName:a.projectName||"",vendorId:a.vendorId||"",vendorName:a.vendorName||"",vendorEmail:a.vendorEmail||"",items:a.items||[{itemName:"",specification:"",unit:"EA",quantity:1,unitPrice:0,totalAmount:0,majorCategory:"",middleCategory:"",minorCategory:"",notes:""}],notes:a.notes||"",totalAmount:a.totalAmount||0}))},[a]),u.useEffect(()=>{v(d)},[d]),u.useEffect(()=>{const l=d.items.reduce((s,t)=>s+(t.totalAmount||0),0);i(s=>({...s,totalAmount:l}))},[d.items]);const m=(l,s)=>{i(t=>({...t,[l]:s}))},j=l=>{const s=F?.find(t=>t.id.toString()===l);s&&i(t=>({...t,projectId:l,projectName:s.projectName}))},k=l=>{const s=w?.find(t=>t.id.toString()===l);s&&i(t=>({...t,vendorId:l,vendorName:s.name,vendorEmail:s.email||""}))},E=(l,s,t)=>{const r=[...d.items];r[l]={...r[l],[s]:t},(s==="quantity"||s==="unitPrice")&&(r[l].totalAmount=r[l].quantity*r[l].unitPrice),i(n=>({...n,items:r}))},T=()=>{i(l=>({...l,items:[...l.items,{itemName:"",specification:"",unit:"EA",quantity:1,unitPrice:0,totalAmount:0,majorCategory:"",middleCategory:"",minorCategory:"",notes:""}]}))},z=l=>{if(d.items.length>1){const s=d.items.filter((t,r)=>r!==l);i(t=>({...t,items:s}))}},O=()=>P?.categories?.filter(l=>l.categoryType==="major")||[],I=l=>{const s=P?.categories?.find(t=>t.categoryType==="major"&&t.categoryName===l);return s?P?.categories?.filter(t=>t.categoryType==="middle"&&t.parentId===s.id)||[]:[]},L=l=>{const s=P?.categories?.find(t=>t.categoryType==="middle"&&t.categoryName===l);return s?P?.categories?.filter(t=>t.categoryType==="minor"&&t.parentId===s.id)||[]:[]},h=(l,s,t)=>{const r=[...d.items],n=r[l];if(s==="major"){const c=O().find(o=>o.id.toString()===t);n.majorCategory=c?.categoryName||"",n.middleCategory="",n.minorCategory=""}else if(s==="middle"){const c=I(n.majorCategory).find(o=>o.id.toString()===t);n.middleCategory=c?.categoryName||"",n.minorCategory=""}else if(s==="minor"){const c=L(n.middleCategory).find(o=>o.id.toString()===t);n.minorCategory=c?.categoryName||""}i(c=>({...c,items:r}))};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"ê¸°ë³¸ ì •ë³´"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"orderNumber",children:"ë°œì£¼ë²ˆí˜¸"}),e.jsx($,{id:"orderNumber",value:d.orderNumber,onChange:l=>m("orderNumber",l.target.value),placeholder:"PO-20240101-001"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"ë°œì£¼ì¼"}),e.jsxs(he,{children:[e.jsx(ue,{asChild:!0,children:e.jsxs(N,{variant:"outline",className:"w-full justify-start text-left font-normal",children:[e.jsx(ge,{className:"mr-2 h-4 w-4"}),je(d.orderDate,"PPP",{locale:fe})]})}),e.jsx(pe,{className:"w-auto p-0",children:e.jsx(xe,{mode:"single",selected:d.orderDate,onSelect:l=>l&&m("orderDate",l),initialFocus:!0})})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"í˜„ì¥"}),e.jsxs(B,{value:d.projectId,onValueChange:j,children:[e.jsx(_,{children:e.jsx(V,{placeholder:D?"ë¡œë”© ì¤‘...":g?"ë¡œë”© ì‹¤íŒ¨":"í˜„ì¥ ì„ íƒ"})}),e.jsxs(K,{children:[D&&e.jsx(C,{value:"loading",disabled:!0,children:"ë¡œë”© ì¤‘..."}),g&&e.jsx(C,{value:"error",disabled:!0,children:"ë°ì´í„° ë¡œë”© ì‹¤íŒ¨"}),F?.map(l=>e.jsx(C,{value:l.id.toString(),children:l.projectName},l.id))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"ë‚©ê¸°ì¼"}),e.jsxs(he,{children:[e.jsx(ue,{asChild:!0,children:e.jsxs(N,{variant:"outline",className:"w-full justify-start text-left font-normal",children:[e.jsx(ge,{className:"mr-2 h-4 w-4"}),je(d.deliveryDate,"PPP",{locale:fe})]})}),e.jsx(pe,{className:"w-auto p-0",children:e.jsx(xe,{mode:"single",selected:d.deliveryDate,onSelect:l=>l&&m("deliveryDate",l),initialFocus:!0})})]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"ê±°ë˜ì²˜ ì •ë³´"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"ê±°ë˜ì²˜"}),e.jsxs(B,{value:d.vendorId,onValueChange:k,children:[e.jsx(_,{children:e.jsx(V,{placeholder:A?"ë¡œë”© ì¤‘...":b?"ë¡œë”© ì‹¤íŒ¨":"ê±°ë˜ì²˜ ì„ íƒ"})}),e.jsxs(K,{children:[A&&e.jsx(C,{value:"loading",disabled:!0,children:"ë¡œë”© ì¤‘..."}),b&&e.jsx(C,{value:"error",disabled:!0,children:"ë°ì´í„° ë¡œë”© ì‹¤íŒ¨"}),w?.map(l=>e.jsx(C,{value:l.id.toString(),children:l.name},l.id))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"vendorEmail",children:"ì´ë©”ì¼"}),e.jsx($,{id:"vendorEmail",type:"email",value:d.vendorEmail,onChange:l=>m("vendorEmail",l.target.value),placeholder:"vendor@example.com"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"í’ˆëª© ì •ë³´"}),e.jsxs(N,{onClick:T,size:"sm",variant:"outline",children:[e.jsx(H,{className:"w-4 h-4 mr-1"}),"í’ˆëª© ì¶”ê°€"]})]}),e.jsx("div",{className:"space-y-4",children:d.items.map((l,s)=>e.jsxs("div",{className:"p-4 border rounded-lg space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"í’ˆëª©ëª…"}),e.jsx($,{value:l.itemName,onChange:t=>E(s,"itemName",t.target.value),placeholder:"í’ˆëª©ëª…ì„ ì…ë ¥í•˜ì„¸ìš”"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"ê·œê²©"}),e.jsx($,{value:l.specification,onChange:t=>E(s,"specification",t.target.value),placeholder:"ê·œê²©ì„ ì…ë ¥í•˜ì„¸ìš”"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"ë‹¨ìœ„"}),e.jsxs(B,{value:l.unit,onValueChange:t=>E(s,"unit",t),children:[e.jsx(_,{children:e.jsx(V,{placeholder:"ë‹¨ìœ„ ì„ íƒ"})}),e.jsxs(K,{children:[e.jsx(C,{value:"EA",children:"EA"}),e.jsx(C,{value:"M",children:"M"}),e.jsx(C,{value:"M2",children:"MÂ²"}),e.jsx(C,{value:"M3",children:"MÂ³"}),e.jsx(C,{value:"KG",children:"KG"}),e.jsx(C,{value:"TON",children:"TON"}),e.jsx(C,{value:"SET",children:"SET"}),e.jsx(C,{value:"BOX",children:"BOX"}),e.jsx(C,{value:"ROLL",children:"ROLL"}),e.jsx(C,{value:"L",children:"L"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"ëŒ€ë¶„ë¥˜"}),e.jsxs(B,{value:l.majorCategory?O().find(t=>t.categoryName===l.majorCategory)?.id.toString():"",onValueChange:t=>h(s,"major",t),children:[e.jsx(_,{children:e.jsx(V,{placeholder:S?"ë¡œë”© ì¤‘...":y?"ë¡œë”© ì‹¤íŒ¨":"ëŒ€ë¶„ë¥˜ ì„ íƒ"})}),e.jsxs(K,{children:[S&&e.jsx(C,{value:"loading",disabled:!0,children:"ë¡œë”© ì¤‘..."}),y&&e.jsx(C,{value:"error",disabled:!0,children:"ë°ì´í„° ë¡œë”© ì‹¤íŒ¨"}),O().map(t=>e.jsx(C,{value:t.id.toString(),children:t.categoryName},t.id))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"ì¤‘ë¶„ë¥˜"}),e.jsxs(B,{value:l.middleCategory?I(l.majorCategory).find(t=>t.categoryName===l.middleCategory)?.id.toString():"",onValueChange:t=>h(s,"middle",t),disabled:!l.majorCategory,children:[e.jsx(_,{children:e.jsx(V,{placeholder:l.majorCategory?"ì¤‘ë¶„ë¥˜ ì„ íƒ":"ëŒ€ë¶„ë¥˜ë¥¼ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”"})}),e.jsx(K,{children:I(l.majorCategory).map(t=>e.jsx(C,{value:t.id.toString(),children:t.categoryName},t.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"ì†Œë¶„ë¥˜"}),e.jsxs(B,{value:l.minorCategory?L(l.middleCategory).find(t=>t.categoryName===l.minorCategory)?.id.toString():"",onValueChange:t=>h(s,"minor",t),disabled:!l.middleCategory,children:[e.jsx(_,{children:e.jsx(V,{placeholder:l.middleCategory?"ì†Œë¶„ë¥˜ ì„ íƒ":"ì¤‘ë¶„ë¥˜ë¥¼ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”"})}),e.jsx(K,{children:L(l.middleCategory).map(t=>e.jsx(C,{value:t.id.toString(),children:t.categoryName},t.id))})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"ìˆ˜ëŸ‰"}),e.jsx($,{type:"number",value:l.quantity,onChange:t=>E(s,"quantity",Number(t.target.value)),min:"1",step:"0.01"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"ë‹¨ê°€"}),e.jsx($,{type:"number",value:l.unitPrice,onChange:t=>E(s,"unitPrice",Number(t.target.value)),min:"0",step:"0.01"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"ê¸ˆì•¡"}),e.jsxs("div",{className:"px-3 py-2 bg-muted border rounded-md text-sm font-medium text-foreground",children:[l.totalAmount.toLocaleString(),"ì›"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"ì‘ì—…"}),e.jsxs(N,{onClick:()=>z(s),size:"sm",variant:"outline",className:"w-full text-red-600 border-red-200 hover:bg-red-50",disabled:d.items.length===1,children:[e.jsx(be,{className:"w-4 h-4 mr-1"}),"ì‚­ì œ"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"í’ˆëª© ë¹„ê³ "}),e.jsx(Y,{value:l.notes,onChange:t=>E(s,"notes",t.target.value),placeholder:"ì´ í’ˆëª©ì— ëŒ€í•œ íŠ¹ë³„ ìš”ì²­ì‚¬í•­ì´ë‚˜ ì°¸ê³ ì‚¬í•­ì„ ì…ë ¥í•˜ì„¸ìš”",rows:2})]})]},s))}),e.jsx("div",{className:"flex justify-end p-3 bg-muted rounded-lg",children:e.jsxs("div",{className:"text-lg font-semibold text-foreground",children:["ì´ì•¡: ",d.totalAmount.toLocaleString(),"ì›"]})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"notes",children:"ë¹„ê³ "}),e.jsx(Y,{id:"notes",value:d.notes,onChange:l=>m("notes",l.target.value),placeholder:"ì¶”ê°€ ìš”ì²­ì‚¬í•­ì´ë‚˜ íŠ¹ì´ì‚¬í•­ì„ ì…ë ¥í•˜ì„¸ìš”",rows:3})]})]})},Ve=({orderData:a,pdfUrl:v,processingStatus:d})=>{const[i,F]=u.useState([a.vendorEmail||""]),[D,g]=u.useState([]),[w,A]=u.useState(`ë°œì£¼ì„œ - ${a.orderNumber||""}`),[b,P]=u.useState("info");u.useState(!1);const[S,y]=u.useState([]),[m,j]=u.useState([]),[k,E]=u.useState(()=>`ì•ˆë…•í•˜ì„¸ìš”,

${a.vendorName||"ê±°ë˜ì²˜"} ë‹´ë‹¹ìë‹˜

ë°œì£¼ì„œë¥¼ ì²¨ë¶€í•˜ì—¬ ë³´ë‚´ë“œë¦½ë‹ˆë‹¤.

ë°œì£¼ë²ˆí˜¸: ${a.orderNumber||"-"}
í”„ë¡œì íŠ¸: ${a.projectName||"-"}
ë‚©ê¸°ì¼: ${a.deliveryDate?new Date(a.deliveryDate).toLocaleDateString("ko-KR"):"-"}

í™•ì¸ í›„ íšŒì‹  ë¶€íƒë“œë¦½ë‹ˆë‹¤.

ê°ì‚¬í•©ë‹ˆë‹¤.`);u.useEffect(()=>{E(`ì•ˆë…•í•˜ì„¸ìš”,

${a.vendorName||"ê±°ë˜ì²˜"} ë‹´ë‹¹ìë‹˜

ë°œì£¼ì„œë¥¼ ì²¨ë¶€í•˜ì—¬ ë³´ë‚´ë“œë¦½ë‹ˆë‹¤.

ë°œì£¼ë²ˆí˜¸: ${a.orderNumber||"-"}
í”„ë¡œì íŠ¸: ${a.projectName||"-"}
ë‚©ê¸°ì¼: ${a.deliveryDate?new Date(a.deliveryDate).toLocaleDateString("ko-KR"):"-"}

í™•ì¸ í›„ íšŒì‹  ë¶€íƒë“œë¦½ë‹ˆë‹¤.

ê°ì‚¬í•©ë‹ˆë‹¤.`)},[a.vendorName,a.orderNumber,a.projectName,a.deliveryDate]),u.useEffect(()=>{const r=[];a.processedExcelUrl&&r.push({id:"processed-excel",name:a.originalFileName||"ì²˜ë¦¬ëœ_Excel_íŒŒì¼.xlsx",size:0,type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",url:a.processedExcelUrl,isDefault:!0,isSelected:!0}),v&&d.pdf==="completed"&&r.push({id:"generated-pdf",name:`ë°œì£¼ì„œ_${a.orderNumber||"generated"}.pdf`,size:0,type:"application/pdf",url:v,isDefault:!0,isSelected:!0}),y(n=>{const c=n.filter(o=>!o.isDefault);return[...r,...c]})},[a.processedExcelUrl,v,d.pdf,a.orderNumber]);const T=r=>{r==="to"?F([...i,""]):g([...D,""])},z=(r,n)=>{r==="to"&&i.length>1?F(i.filter((c,o)=>o!==n)):r==="cc"&&g(D.filter((c,o)=>o!==n))},O=(r,n,c)=>{if(r==="to"){const o=[...i];o[n]=c,F(o)}else{const o=[...D];o[n]=c,g(o)}},I=async r=>{const n=Array.from(r);for(const c of n){const o=`custom-${Date.now()}-${Math.random()}`;j(x=>[...x,o]);try{const x={id:o,name:c.name,size:c.size,type:c.type,file:c,isDefault:!1,isSelected:!0};y(f=>[...f,x])}catch(x){console.error("íŒŒì¼ ì—…ë¡œë“œ ì‹¤íŒ¨:",x)}finally{j(x=>x.filter(f=>f!==o))}}},L=r=>{y(n=>n.map(c=>c.id===r?{...c,isSelected:!c.isSelected}:c))},h=r=>{y(n=>n.filter(c=>c.id!==r))},l=r=>{if(r===0)return"0 Bytes";const n=1024,c=["Bytes","KB","MB","GB"],o=Math.floor(Math.log(r)/Math.log(n));return parseFloat((r/Math.pow(n,o)).toFixed(2))+" "+c[o]},s=r=>r.includes("pdf")?e.jsx(J,{className:"w-4 h-4 text-red-600"}):r.includes("spreadsheet")||r.includes("excel")?e.jsx(J,{className:"w-4 h-4 text-green-600"}):e.jsx(le,{className:"w-4 h-4 text-gray-600"}),t=r=>{switch(r){case"completed":return e.jsx(Q,{className:"w-4 h-4 text-green-600"});case"processing":return e.jsx(U,{className:"w-4 h-4 text-blue-600 animate-spin"});case"error":return e.jsx(re,{className:"w-4 h-4 text-red-600"});default:return null}};return e.jsxs(G,{className:"h-full",children:[e.jsx(ve,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(ye,{children:"ì‹¤ì‹œê°„ ë¯¸ë¦¬ë³´ê¸°"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(R,{variant:d.pdf==="completed"?"success":"secondary",children:[t(d.pdf),e.jsx("span",{className:"ml-1",children:"PDF"})]}),e.jsxs(R,{variant:d.vendor==="completed"?"success":"secondary",children:[t(d.vendor),e.jsx("span",{className:"ml-1",children:"ê±°ë˜ì²˜"})]}),e.jsxs(R,{variant:d.email==="completed"?"success":"secondary",children:[t(d.email),e.jsx("span",{className:"ml-1",children:"ì´ë©”ì¼"})]})]})]})}),e.jsx(X,{className:"h-[calc(100%-5rem)]",children:e.jsxs(De,{value:b,onValueChange:P,className:"h-full",children:[e.jsxs(Ae,{className:"grid w-full grid-cols-3",children:[e.jsxs(se,{value:"info",children:[e.jsx(me,{className:"w-4 h-4 mr-2"}),"ë°œì£¼ì„œ ì •ë³´"]}),e.jsxs(se,{value:"pdf",children:[e.jsx(J,{className:"w-4 h-4 mr-2"}),"PDF ë¯¸ë¦¬ë³´ê¸°"]}),e.jsxs(se,{value:"email",children:[e.jsx(ae,{className:"w-4 h-4 mr-2"}),"ì´ë©”ì¼ ì„¤ì •"]})]}),e.jsx(te,{value:"pdf",className:"h-[calc(100%-3rem)]",children:d.pdf==="processing"?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsxs("div",{className:"text-center space-y-3",children:[e.jsx(U,{className:"w-12 h-12 mx-auto text-blue-600 animate-spin"}),e.jsx("p",{className:"text-sm text-gray-600",children:"PDFë¥¼ ìƒì„±í•˜ê³  ìˆìŠµë‹ˆë‹¤..."})]})}):d.pdf==="error"?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsxs("div",{className:"text-center space-y-3",children:[e.jsx(re,{className:"w-12 h-12 mx-auto text-red-600"}),e.jsx("p",{className:"text-sm text-red-600",children:"PDF ìƒì„± ì‹¤íŒ¨"}),e.jsxs(N,{variant:"outline",size:"sm",children:[e.jsx(we,{className:"w-4 h-4 mr-2"}),"ë‹¤ì‹œ ì‹œë„"]})]})}):v&&d.pdf==="completed"?e.jsx("div",{className:"w-full h-full flex flex-col",children:e.jsx("div",{className:"flex-1 bg-gray-50 rounded-lg p-8 flex items-center justify-center",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx(Q,{className:"w-16 h-16 mx-auto text-green-600"}),e.jsx("h3",{className:"text-lg font-medium",children:"PDFê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤"}),e.jsx("p",{className:"text-sm text-gray-600",children:"ì•„ë˜ ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ PDFë¥¼ í™•ì¸í•˜ì„¸ìš”"}),e.jsxs("div",{className:"flex items-center justify-center gap-3 mt-6",children:[e.jsxs(N,{variant:"default",onClick:()=>window.open(v,"_blank"),children:[e.jsx(me,{className:"w-4 h-4 mr-2"}),"PDF ë¯¸ë¦¬ë³´ê¸°"]}),e.jsxs(N,{variant:"outline",onClick:()=>window.open(`${v}?download=true`,"_blank"),children:[e.jsx(de,{className:"w-4 h-4 mr-2"}),"PDF ë‹¤ìš´ë¡œë“œ"]})]})]})})}):e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsxs("div",{className:"text-center space-y-3",children:[e.jsx(J,{className:"w-12 h-12 mx-auto text-gray-400"}),e.jsx("p",{className:"text-sm text-gray-600",children:"ë°œì£¼ì„œ ì •ë³´ê°€ ì™„ì„±ë˜ë©´ PDFê°€ ìë™ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤"}),e.jsx("p",{className:"text-xs text-gray-500",children:"ë¨¼ì € 'ë°œì£¼ì„œ ì •ë³´' íƒ­ì—ì„œ ë‚´ìš©ì„ í™•ì¸í•´ì£¼ì„¸ìš”"})]})})}),e.jsxs(te,{value:"info",className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(p,{className:"text-xs text-gray-600",children:"ë°œì£¼ë²ˆí˜¸"}),e.jsx("p",{className:"font-medium",children:a.orderNumber||"-"})]}),e.jsxs("div",{children:[e.jsx(p,{className:"text-xs text-gray-600",children:"ë°œì£¼ì¼"}),e.jsx("p",{className:"font-medium",children:a.orderDate?new Date(a.orderDate).toLocaleDateString("ko-KR"):"-"})]}),e.jsxs("div",{children:[e.jsx(p,{className:"text-xs text-gray-600",children:"í”„ë¡œì íŠ¸"}),e.jsx("p",{className:"font-medium",children:a.projectName||"-"})]}),e.jsxs("div",{children:[e.jsx(p,{className:"text-xs text-gray-600",children:"ê±°ë˜ì²˜"}),e.jsx("p",{className:"font-medium",children:a.vendorName||"-"})]}),e.jsxs("div",{children:[e.jsx(p,{className:"text-xs text-gray-600",children:"ë‚©ê¸°ì¼"}),e.jsx("p",{className:"font-medium",children:a.deliveryDate?new Date(a.deliveryDate).toLocaleDateString("ko-KR"):"-"})]}),e.jsxs("div",{children:[e.jsx(p,{className:"text-xs text-gray-600",children:"ì´ì•¡"}),e.jsx("p",{className:"font-medium text-lg text-blue-600",children:a.totalAmount?`${Math.floor(a.totalAmount).toLocaleString()}ì›`:"-"})]})]}),a.items&&a.items.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{className:"text-xs text-gray-600",children:"í’ˆëª© ëª©ë¡"}),e.jsx("div",{className:"border rounded-lg overflow-hidden",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left p-2",children:"í’ˆëª©ëª…"}),e.jsx("th",{className:"text-right p-2",children:"ìˆ˜ëŸ‰"}),e.jsx("th",{className:"text-right p-2",children:"ë‹¨ê°€"}),e.jsx("th",{className:"text-right p-2",children:"ê¸ˆì•¡"})]})}),e.jsx("tbody",{children:a.items.map((r,n)=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"p-2",children:r.itemName||r.name}),e.jsx("td",{className:"text-right p-2",children:Math.floor(r.quantity||0).toLocaleString()}),e.jsxs("td",{className:"text-right p-2",children:[Math.floor(r.unitPrice||0).toLocaleString(),"ì›"]}),e.jsxs("td",{className:"text-right p-2",children:[Math.floor(r.totalAmount||r.quantity*r.unitPrice||0).toLocaleString(),"ì›"]})]},n))})]})})]})]}),e.jsx(te,{value:"email",className:"space-y-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(p,{children:"ë°›ëŠ” ì‚¬ëŒ"}),e.jsx(N,{variant:"ghost",size:"sm",onClick:()=>T("to"),children:e.jsx(H,{className:"w-4 h-4"})})]}),i.map((r,n)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($,{type:"email",value:r,onChange:c=>O("to",n,c.target.value),placeholder:"email@example.com"}),i.length>1&&e.jsx(N,{variant:"ghost",size:"sm",onClick:()=>z("to",n),children:e.jsx(W,{className:"w-4 h-4"})})]},n))]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(p,{children:"ì°¸ì¡° (CC)"}),e.jsx(N,{variant:"ghost",size:"sm",onClick:()=>T("cc"),children:e.jsx(H,{className:"w-4 h-4"})})]}),D.map((r,n)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($,{type:"email",value:r,onChange:c=>O("cc",n,c.target.value),placeholder:"cc@example.com"}),e.jsx(N,{variant:"ghost",size:"sm",onClick:()=>z("cc",n),children:e.jsx(W,{className:"w-4 h-4"})})]},n))]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"ì œëª©"}),e.jsx($,{value:w,onChange:r=>A(r.target.value),placeholder:"ì´ë©”ì¼ ì œëª©"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"ë©”ì¼ ë³¸ë¬¸"}),e.jsx(Y,{value:k,onChange:r=>E(r.target.value),placeholder:"ì´ë©”ì¼ ë³¸ë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”",className:"min-h-[200px] font-mono text-sm",rows:10})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(p,{children:"ì²¨ë¶€íŒŒì¼"}),e.jsxs(N,{variant:"outline",size:"sm",onClick:()=>{const r=document.createElement("input");r.type="file",r.multiple=!0,r.accept=".pdf,.xlsx,.xls,.doc,.docx,.txt",r.onchange=n=>{const c=n.target;c.files&&c.files.length>0&&I(c.files)},r.click()},children:[e.jsx(oe,{className:"w-4 h-4 mr-2"}),"íŒŒì¼ ì¶”ê°€"]})]}),e.jsx("div",{className:"space-y-3",children:S.length===0?e.jsx("p",{className:"text-sm text-gray-500 text-center py-4",children:"ì²¨ë¶€í•  íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤"}):S.map(r=>e.jsxs("div",{className:"flex items-center gap-3 p-3 border rounded-lg bg-gray-50",children:[e.jsx(Z,{checked:r.isSelected,onCheckedChange:()=>L(r.id)}),e.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[s(r.type),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium truncate",children:r.name}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500",children:[e.jsx("span",{children:l(r.size)}),r.isDefault&&e.jsx(R,{variant:"secondary",className:"text-xs",children:"ê¸°ë³¸íŒŒì¼"})]})]})]}),m.includes(r.id)&&e.jsx(U,{className:"w-4 h-4 animate-spin text-blue-600"}),!r.isDefault&&!m.includes(r.id)&&e.jsx(N,{variant:"ghost",size:"sm",onClick:()=>h(r.id),children:e.jsx(be,{className:"w-4 h-4 text-red-600"})})]},r.id))}),S.length>0&&e.jsx("div",{className:"p-3 bg-blue-50 rounded-lg",children:e.jsxs("p",{className:"text-sm text-blue-800",children:["ì„ íƒëœ íŒŒì¼: ",S.filter(r=>r.isSelected).length,"/",S.length,"ê°œ"]})})]})]})})]})})]})},Ke=({orderData:a,pdfUrl:v,processingStatus:d,onSave:i,onSend:F,onDownload:D,onCreateOrder:g,onCreateOrderWithEmail:w})=>{const{isCollapsed:A}=Ee(),[b,P]=u.useState(!0),[S,y]=u.useState(!1),[m,j]=u.useState({to:[a.vendorEmail||""].filter(Boolean),cc:[],subject:`ë°œì£¼ì„œ - ${a.orderNumber||""} (${new Date().toLocaleDateString("ko-KR")})`,message:`ì•ˆë…•í•˜ì„¸ìš”,

ì²¨ë¶€ëœ ë°œì£¼ì„œë¥¼ í™•ì¸í•´ ì£¼ì‹œê¸° ë°”ëë‹ˆë‹¤.

ê°ì‚¬í•©ë‹ˆë‹¤.`,attachments:{includeExcel:!0,includePdf:!0,additionalFiles:[]}}),[k,E]=u.useState(""),[T,z]=u.useState(""),O=()=>{k.trim()&&!m.to.includes(k.trim())&&(j(x=>({...x,to:[...x.to,k.trim()]})),E(""))},I=x=>{j(f=>({...f,to:f.to.filter(M=>M!==x)}))},L=()=>{T.trim()&&!m.cc.includes(T.trim())&&(j(x=>({...x,cc:[...x.cc,T.trim()]})),z(""))},h=x=>{j(f=>({...f,cc:f.cc.filter(M=>M!==x)}))},l=x=>{const f=Array.from(x.target.files||[]);j(M=>({...M,attachments:{...M.attachments,additionalFiles:[...M.attachments.additionalFiles,...f]}}))},s=x=>{j(f=>({...f,attachments:{...f.attachments,additionalFiles:f.attachments.additionalFiles.filter((M,Ce)=>Ce!==x)}}))},t=d.pdf==="completed"&&d.vendor==="completed"&&m.to.length>0,r=a.orderNumber&&a.vendorName&&a.projectName&&a.items?.length>0,n=Object.values(d).some(x=>x==="processing"),c=()=>{b&&w?y(!0):g()},o=()=>{y(!1),w&&w(m)};return e.jsxs("div",{className:"fixed bottom-0 left-0 right-0 bg-background border-t border-border shadow-lg z-30",children:[e.jsxs("div",{className:q("container mx-auto px-6 py-4 transition-all duration-300",A?"xl:ml-16":"xl:ml-64"),children:[e.jsxs("div",{className:"flex flex-col gap-3 items-center",children:[e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 bg-muted rounded-lg text-sm",children:[e.jsx(Z,{id:"send-email",checked:b,onCheckedChange:x=>P(!!x),className:"h-4 w-4"}),e.jsx("label",{htmlFor:"send-email",className:"font-medium cursor-pointer text-foreground whitespace-nowrap text-xs",children:"ë°œì£¼ì„œ ìƒì„± í›„ ì´ë©”ì¼ ìë™ ë°œì†¡"}),n&&e.jsxs("div",{className:"flex items-center gap-1 ml-2 text-xs text-muted-foreground",children:[e.jsx(U,{className:"w-3 h-3 animate-spin"}),"ì²˜ë¦¬ ì¤‘"]})]}),e.jsxs("div",{className:"flex items-center justify-center gap-2 flex-wrap",children:[e.jsxs(N,{variant:"outline",onClick:i,disabled:n,size:"sm",className:"text-xs px-3 py-2 h-8",children:[e.jsx(ze,{className:"w-3 h-3 mr-1"}),"ì„ì‹œì €ì¥"]}),e.jsxs(N,{variant:"outline",onClick:D,disabled:!v||d.pdf!=="completed",size:"sm",className:"text-xs px-3 py-2 h-8",children:[e.jsx(de,{className:"w-3 h-3 mr-1"}),"ë‹¤ìš´ë¡œë“œ"]}),!b&&e.jsx(N,{onClick:F,disabled:!t||d.email==="processing",size:"sm",className:q("text-xs px-3 py-2 h-8",t?"bg-blue-600 hover:bg-blue-700 dark:bg-blue-600 dark:hover:bg-blue-700":""),children:d.email==="processing"?e.jsxs(e.Fragment,{children:[e.jsx(U,{className:"w-3 h-3 mr-1 animate-spin"}),"ë°œì†¡ì¤‘"]}):e.jsxs(e.Fragment,{children:[e.jsx(Me,{className:"w-3 h-3 mr-1"}),"ì´ë©”ì¼ ë°œì†¡"]})}),e.jsx(N,{variant:"default",onClick:c,disabled:!r||d.order==="processing",size:"sm",className:q("text-xs px-4 py-2 h-8 font-medium",r?b?"bg-blue-600 hover:bg-blue-700 dark:bg-blue-600 dark:hover:bg-blue-700":"bg-green-600 hover:bg-green-700 dark:bg-green-600 dark:hover:bg-green-700":""),children:d.order==="processing"?e.jsxs(e.Fragment,{children:[e.jsx(U,{className:"w-3 h-3 mr-1 animate-spin"}),b?"ìƒì„± ë° ë°œì†¡ ì¤‘":"ìƒì„± ì¤‘"]}):e.jsx(e.Fragment,{children:b?e.jsxs(e.Fragment,{children:[e.jsx(ae,{className:"w-3 h-3 mr-1"}),"ë°œì£¼ì„œ ìƒì„± ë° ë°œì†¡"]}):e.jsxs(e.Fragment,{children:[e.jsx(J,{className:"w-3 h-3 mr-1"}),"ë°œì£¼ì„œ ìƒì„±"]})})})]})]}),e.jsxs("div",{className:"mt-3 flex items-center justify-center gap-6 text-xs text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:q("w-2 h-2 rounded-full",d.pdf==="completed"?"bg-green-500":d.pdf==="processing"?"bg-blue-500 animate-pulse":d.pdf==="error"?"bg-red-500":"bg-muted-foreground")}),"PDF ìƒì„±"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:q("w-2 h-2 rounded-full",d.vendor==="completed"?"bg-green-500":d.vendor==="processing"?"bg-blue-500 animate-pulse":d.vendor==="error"?"bg-red-500":"bg-muted-foreground")}),"ê±°ë˜ì²˜ í™•ì¸"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:q("w-2 h-2 rounded-full",d.order==="completed"?"bg-green-500":d.order==="processing"?"bg-blue-500 animate-pulse":d.order==="error"?"bg-red-500":"bg-muted-foreground")}),"ë°œì£¼ì„œ ìƒì„±"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:q("w-2 h-2 rounded-full",d.email==="completed"?"bg-green-500":d.email==="processing"?"bg-blue-500 animate-pulse":d.email==="error"?"bg-red-500":"bg-muted-foreground")}),"ì´ë©”ì¼ ì¤€ë¹„"]})]})]}),e.jsx(Te,{open:S,onOpenChange:y,children:e.jsxs(Oe,{className:"sm:max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx(Ie,{children:e.jsx(Le,{children:"ì´ë©”ì¼ ë°œì†¡ ì„¤ì •"})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(p,{className:"text-sm font-medium",children:"ë°›ëŠ” ì‚¬ëŒ *"}),e.jsxs("div",{className:"mt-2 space-y-2",children:[m.to.map((x,f)=>e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-muted rounded-md",children:[e.jsx("span",{className:"flex-1 text-sm text-foreground",children:x}),e.jsx(N,{type:"button",variant:"ghost",size:"sm",onClick:()=>I(x),className:"h-6 w-6 p-0 hover:bg-red-100 dark:hover:bg-red-900",children:e.jsx(W,{className:"h-3 w-3"})})]},f)),e.jsxs("div",{className:"flex gap-2",children:[e.jsx($,{value:k,onChange:x=>E(x.target.value),placeholder:"example@company.com",onKeyPress:x=>x.key==="Enter"&&O(),className:"flex-1"}),e.jsx(N,{type:"button",variant:"outline",size:"sm",onClick:O,disabled:!k.trim(),children:e.jsx(H,{className:"h-4 w-4"})})]})]})]}),e.jsxs("div",{children:[e.jsx(p,{className:"text-sm font-medium",children:"ì°¸ì¡° (CC)"}),e.jsxs("div",{className:"mt-2 space-y-2",children:[m.cc.map((x,f)=>e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-muted rounded-md",children:[e.jsx("span",{className:"flex-1 text-sm text-foreground",children:x}),e.jsx(N,{type:"button",variant:"ghost",size:"sm",onClick:()=>h(x),className:"h-6 w-6 p-0 hover:bg-red-100 dark:hover:bg-red-900",children:e.jsx(W,{className:"h-3 w-3"})})]},f)),e.jsxs("div",{className:"flex gap-2",children:[e.jsx($,{value:T,onChange:x=>z(x.target.value),placeholder:"manager@company.com (ì„ íƒì‚¬í•­)",onKeyPress:x=>x.key==="Enter"&&L(),className:"flex-1"}),e.jsx(N,{type:"button",variant:"outline",size:"sm",onClick:L,disabled:!T.trim(),children:e.jsx(H,{className:"h-4 w-4"})})]})]})]}),e.jsxs("div",{children:[e.jsx(p,{htmlFor:"email-subject",className:"text-sm font-medium",children:"ì œëª© *"}),e.jsx($,{id:"email-subject",value:m.subject,onChange:x=>j(f=>({...f,subject:x.target.value})),className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(p,{htmlFor:"email-message",className:"text-sm font-medium",children:"ë©”ì‹œì§€"}),e.jsx(Y,{id:"email-message",value:m.message,onChange:x=>j(f=>({...f,message:x.target.value})),rows:4,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(p,{className:"text-sm font-medium",children:"ì²¨ë¶€íŒŒì¼"}),e.jsxs("div",{className:"mt-2 space-y-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Z,{id:"include-excel",checked:m.attachments.includeExcel,onCheckedChange:x=>j(f=>({...f,attachments:{...f.attachments,includeExcel:!!x}}))}),e.jsx(p,{htmlFor:"include-excel",className:"text-sm",children:"Excel íŒŒì¼ ì²¨ë¶€"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Z,{id:"include-pdf",checked:m.attachments.includePdf,onCheckedChange:x=>j(f=>({...f,attachments:{...f.attachments,includePdf:!!x}}))}),e.jsx(p,{htmlFor:"include-pdf",className:"text-sm",children:"PDF íŒŒì¼ ì²¨ë¶€"})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(p,{className:"text-sm",children:"ì¶”ê°€ íŒŒì¼"}),e.jsxs(N,{type:"button",variant:"outline",size:"sm",onClick:()=>document.getElementById("additional-files")?.click(),className:"h-8",children:[e.jsx(le,{className:"h-3 w-3 mr-1"}),"íŒŒì¼ ì„ íƒ"]})]}),e.jsx("input",{id:"additional-files",type:"file",multiple:!0,onChange:l,className:"hidden"}),m.attachments.additionalFiles.length>0&&e.jsx("div",{className:"space-y-1",children:m.attachments.additionalFiles.map((x,f)=>e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-muted rounded-md",children:[e.jsx(le,{className:"h-3 w-3 text-muted-foreground"}),e.jsx("span",{className:"flex-1 text-sm text-foreground",children:x.name}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[(x.size/1024).toFixed(1)," KB"]}),e.jsx(N,{type:"button",variant:"ghost",size:"sm",onClick:()=>s(f),className:"h-6 w-6 p-0 hover:bg-red-100 dark:hover:bg-red-900",children:e.jsx(W,{className:"h-3 w-3"})})]},f))})]})]})]}),e.jsx("div",{className:"text-xs text-muted-foreground bg-blue-50 dark:bg-blue-950 p-2 rounded",children:"ğŸ“ ì„ íƒí•œ ì²¨ë¶€íŒŒì¼ì´ ì´ë©”ì¼ê³¼ í•¨ê»˜ ë°œì†¡ë©ë‹ˆë‹¤."})]}),e.jsxs($e,{className:"mt-6",children:[e.jsx(N,{variant:"outline",onClick:()=>y(!1),children:"ì·¨ì†Œ"}),e.jsxs(N,{onClick:o,disabled:m.to.length===0||!m.subject,className:"bg-blue-600 hover:bg-blue-700",children:[e.jsx(ae,{className:"w-4 h-4 mr-2"}),"ë°œì£¼ì„œ ìƒì„±"]})]})]})})]})},Je=({orderData:a,onSuggestionApply:v})=>{const[d,i]=u.useState([]),[F,D]=u.useState(new Set),[g,w]=u.useState(!1);u.useEffect(()=>{A()},[a]);const A=()=>{w(!0);const m=[];if(a.vendorName&&!a.vendorEmail&&m.push({id:"vendor-email",type:"autofill",title:"ê±°ë˜ì²˜ ì´ë©”ì¼ ìë™ ì™„ì„±",description:"ë“±ë¡ëœ ê±°ë˜ì²˜ ì •ë³´ì—ì„œ ì´ë©”ì¼ì„ ê°€ì ¸ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.",action:{label:"ì´ë©”ì¼ ìë™ ì…ë ¥",data:{vendorEmail:"vendor@example.com"}},priority:"high"}),a.deliveryDate){const j=new Date(a.deliveryDate),k=new Date,E=Math.ceil((j.getTime()-k.getTime())/(1e3*60*60*24));E<3&&m.push({id:"delivery-urgent",type:"warning",title:"ê¸´ê¸‰ ë‚©ê¸°",description:`ë‚©ê¸°ì¼ì´ ${E}ì¼ ë‚¨ì•˜ìŠµë‹ˆë‹¤. ê¸´ê¸‰ ì²˜ë¦¬ê°€ í•„ìš”í•©ë‹ˆë‹¤.`,priority:"high"})}a.projectName&&!a.notes&&m.push({id:"project-defaults",type:"recommendation",title:"í”„ë¡œì íŠ¸ ê¸°ë³¸ ì„¤ì •",description:"ì´ì „ ë°œì£¼ì„œë¥¼ ì°¸ê³ í•˜ì—¬ ìì£¼ ì‚¬ìš©í•˜ëŠ” ì„¤ì •ì„ ì ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.",action:{label:"ê¸°ë³¸ê°’ ì ìš©",data:{notes:"ìƒì°¨ í›„ ì—°ë½ ìš”ë§",deliveryLocation:"í˜„ì¥ ì§ë‚©"}},priority:"medium"}),a.totalAmount>1e7&&m.push({id:"amount-check",type:"info",title:"ê³ ì•¡ ë°œì£¼ì„œ",description:"1ì²œë§Œì› ì´ìƒì˜ ë°œì£¼ì„œì…ë‹ˆë‹¤. ê²°ì¬ ìŠ¹ì¸ì´ í•„ìš”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.",priority:"medium"}),a.vendorName&&a.vendorName.length>2&&["(ì£¼)ABCê±´ì„¤","(ì£¼)ABCì¢…í•©ê±´ì„¤"].length>0&&m.push({id:"similar-vendors",type:"recommendation",title:"ìœ ì‚¬ ê±°ë˜ì²˜ ë°œê²¬",description:`'${a.vendorName}'ì™€ ìœ ì‚¬í•œ ê±°ë˜ì²˜ê°€ ìˆìŠµë‹ˆë‹¤. í™•ì¸í•´ë³´ì„¸ìš”.`,priority:"low"}),i(m.filter(j=>!F.has(j.id))),w(!1)},b=m=>{m.action&&(v(m.action.data),P(m.id))},P=m=>{D(j=>new Set(j).add(m)),i(j=>j.filter(k=>k.id!==m))},S=m=>{switch(m){case"warning":return e.jsx(qe,{className:"w-5 h-5 text-yellow-600"});case"info":return e.jsx(ne,{className:"w-5 h-5 text-blue-600"});case"recommendation":return e.jsx(Ue,{className:"w-5 h-5 text-green-600"});case"autofill":return e.jsx(Ne,{className:"w-5 h-5 text-purple-600"});default:return e.jsx(ne,{className:"w-5 h-5 text-gray-600"})}},y=m=>{switch(m){case"warning":return"bg-yellow-50 border-yellow-200";case"info":return"bg-blue-50 border-blue-200";case"recommendation":return"bg-green-50 border-green-200";case"autofill":return"bg-purple-50 border-purple-200";default:return"bg-gray-50 border-gray-200"}};return d.length===0&&!g?null:e.jsxs(G,{children:[e.jsx(ve,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(ye,{className:"text-lg flex items-center gap-2",children:[e.jsx(Ne,{className:"w-5 h-5 text-yellow-500"}),"ìŠ¤ë§ˆíŠ¸ ì–´ì‹œìŠ¤íŠ¸"]}),g&&e.jsx(we,{className:"w-4 h-4 text-gray-500 animate-spin"})]})}),e.jsxs(X,{className:"space-y-3",children:[d.sort((m,j)=>{const k={high:0,medium:1,low:2};return k[m.priority]-k[j.priority]}).map(m=>e.jsx(ie,{className:`${y(m.type)} border`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[S(m.type),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("p",{className:"font-medium text-sm",children:m.title}),m.priority==="high"&&e.jsx(R,{variant:"destructive",className:"text-xs",children:"ì¤‘ìš”"})]}),e.jsx(ce,{className:"text-xs",children:m.description}),m.action&&e.jsxs(N,{size:"sm",variant:"outline",className:"mt-2",onClick:()=>b(m),children:[m.action.label,e.jsx(Re,{className:"w-3 h-3 ml-1"})]})]}),e.jsx(N,{size:"sm",variant:"ghost",className:"text-gray-400 hover:text-gray-600 h-6 w-6 p-0",onClick:()=>P(m.id),children:"Ã—"})]})},m.id)),d.length===0&&!g&&e.jsxs("div",{className:"text-center py-4 text-sm text-gray-500",children:[e.jsx(Q,{className:"w-8 h-8 text-green-500 mx-auto mb-2"}),"ëª¨ë“  í•­ëª©ì´ ì˜¬ë°”ë¥´ê²Œ ì…ë ¥ë˜ì—ˆìŠµë‹ˆë‹¤"]})]})]})},Cs=()=>{const{toast:a}=Fe(),[v,d]=u.useState(null),[i,F]=u.useState({}),[D,g]=u.useState({pdf:"idle",vendor:"idle",email:"idle",order:"idle"}),[w,A]=u.useState(null),[b,P]=u.useState(!1),[S,y]=u.useState(!1),m=u.useCallback(()=>{console.log("ğŸ”„ ë°œì£¼ì„œ ì‘ì„± í˜ì´ì§€ ì´ˆê¸°í™”"),d(null),F({}),g({pdf:"idle",vendor:"idle",email:"idle",order:"idle"}),A(null),P(!1),y(!1),localStorage.removeItem("draftOrder")},[]);u.useEffect(()=>{const s=()=>{console.log("ğŸ¯ í˜ì´ì§€ í¬ì»¤ìŠ¤ ê°ì§€ - ìƒíƒœ í™•ì¸"),v!==null&&m()};return window.addEventListener("focus",s),()=>{window.removeEventListener("focus",s)}},[v,m]),u.useEffect(()=>{if(S&&i.orderNumber){const s=setTimeout(()=>{j()},2e3);return()=>clearTimeout(s)}},[i,S]),u.useEffect(()=>{if(i.orderNumber&&i.vendorName&&i.projectName&&i.items?.length>0){const s=setTimeout(()=>{k()},500);return()=>clearTimeout(s)}},[i.orderNumber,i.vendorName,i.projectName,i.items]);const j=async()=>{P(!0);try{localStorage.setItem("draftOrder",JSON.stringify(i)),y(!1)}catch(s){console.error("Auto-save failed:",s)}finally{P(!1)}},k=async()=>{if(i.orderNumber){console.log("ğŸ”µ PDF ìƒì„± ì‹œì‘:",i),g(s=>({...s,pdf:"processing"}));try{const s=i.totalAmount||(i.items||[]).reduce((n,c)=>n+(c.quantity||0)*(c.unitPrice||0),0),t={...i,totalAmount:s};console.log("ğŸ”µ PDF ìƒì„± ìš”ì²­ ë°ì´í„°:",t);const r=await fetch("/api/orders/generate-pdf",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({orderData:t})});if(r.ok){const n=await r.json();console.log("ğŸ”µ PDF ìƒì„± ì‘ë‹µ:",n);const c=n.pdfUrl.startsWith("http")?n.pdfUrl:`${window.location.origin}${n.pdfUrl}`;console.log("ğŸ”µ PDF URL:",c),A(c),g(o=>({...o,pdf:"completed"})),fetch(c,{method:"HEAD"}).then(o=>{console.log("ğŸ”µ PDF ì ‘ê·¼ì„± í…ŒìŠ¤íŠ¸:",o.status,o.headers.get("content-type"))}).catch(o=>{console.error("ğŸ”´ PDF ì ‘ê·¼ ì‹¤íŒ¨:",o)})}else{const n=await r.text();throw console.error("ğŸ”´ PDF ìƒì„± ì‹¤íŒ¨ ì‘ë‹µ:",r.status,n),new Error(`PDF ìƒì„± ì‹¤íŒ¨: ${r.status}`)}}catch(s){g(t=>({...t,pdf:"error"})),console.error("ğŸ”´ PDF generation error:",s)}}},E=s=>{d(s);const t=localStorage.getItem("draftOrder");if(t)try{const r=JSON.parse(t);console.log("ğŸ“‹ ì„ì‹œì €ì¥ ë°ì´í„° ë°œê²¬:",r),window.confirm("ì €ì¥ëœ ì„ì‹œ ì‘ì—…ì´ ìˆìŠµë‹ˆë‹¤. ë¶ˆëŸ¬ì˜¤ì‹œê² ìŠµë‹ˆê¹Œ?")?(console.log("âœ… ì‚¬ìš©ì í™•ì¸: ì„ì‹œì €ì¥ ë°ì´í„° ë¡œë“œ ì‹œì‘"),F(n=>(console.log("ğŸ”„ ì´ì „ orderData:",n),console.log("ğŸ”„ ìƒˆë¡œìš´ orderData:",r),{...r})),y(!1),a({title:"ì„ì‹œì €ì¥ ë¶ˆëŸ¬ì˜¤ê¸° ì™„ë£Œ",description:`ë°œì£¼ë²ˆí˜¸ ${r.orderNumber||"ë¯¸ì •"}ì˜ ì„ì‹œ ì‘ì—…ì„ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤.`})):(console.log("âŒ ì‚¬ìš©ì ì·¨ì†Œ: ì„ì‹œì €ì¥ ë°ì´í„° ë¡œë“œ ì·¨ì†Œ"),localStorage.removeItem("draftOrder"))}catch(r){console.error("âŒ ì„ì‹œì €ì¥ ë°ì´í„° íŒŒì‹± ì˜¤ë¥˜:",r),localStorage.removeItem("draftOrder"),a({title:"ì„ì‹œì €ì¥ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨",description:"ì €ì¥ëœ ë°ì´í„°ê°€ ì†ìƒë˜ì–´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.",variant:"destructive"})}else console.log("ğŸ“‹ ì„ì‹œì €ì¥ ë°ì´í„° ì—†ìŒ")},T=s=>{F(t=>({...t,...s})),y(!0),s.vendorName&&s.vendorName!==i.vendorName&&O(s.vendorName)},z=s=>{F(t=>({...t,processedExcelUrl:s.url,originalFileName:s.name}))},O=async s=>{g(t=>({...t,vendor:"processing"}));try{const t=await fetch("/api/vendors/validate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({vendorName:s})});if(t.ok){const r=await t.json();r.isValid?(g(n=>({...n,vendor:"completed"})),r.vendorEmail&&F(n=>({...n,vendorEmail:r.vendorEmail}))):g(n=>({...n,vendor:"error"}))}}catch{g(r=>({...r,vendor:"error"}))}},I=async()=>{if(!i.orderNumber||!i.vendorName||!i.projectName||!i.items?.length){a({title:"ìƒì„± ë¶ˆê°€",description:"í•„ìˆ˜ ì •ë³´ë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.",variant:"destructive"});return}g(s=>({...s,order:"processing"}));try{const s=await fetch("/api/auth/user");if(console.log("ğŸ” ì¸ì¦ ìƒíƒœ í™•ì¸:",s.status),!s.ok){console.error("ğŸ”´ ì¸ì¦ ì‹¤íŒ¨ - ë¡œê·¸ì¸ í•„ìš”"),a({title:"ì¸ì¦ í•„ìš”",description:"ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤. ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤.",variant:"destructive"}),setTimeout(()=>{window.location.href="/login"},2e3);return}const t=await s.json();console.log("ğŸ” í˜„ì¬ ì‚¬ìš©ì:",t)}catch(s){console.error("ğŸ”´ ì¸ì¦ í™•ì¸ ì‹¤íŒ¨:",s)}try{console.log("ğŸŸ¢ ë°œì£¼ì„œ ìƒì„± ì‹œì‘:",i);const s=new FormData;s.append("projectId","1"),s.append("vendorId","1"),s.append("deliveryDate",i.deliveryDate||new Date().toISOString()),s.append("notes",i.notes||`ë°œì£¼ì„œ ì‘ì„±ìœ¼ë¡œ ìƒì„±ëœ ë°œì£¼ì„œ - ${i.orderNumber}`);const t=(i.items||[]).map(n=>({itemName:n.name||n.itemName||"",specification:n.specification||"",unit:n.unit||"EA",quantity:parseFloat(n.quantity||"0"),unitPrice:parseFloat(n.unitPrice||"0"),totalAmount:parseFloat(n.quantity||"0")*parseFloat(n.unitPrice||"0"),majorCategory:n.majorCategory||"",middleCategory:n.middleCategory||"",minorCategory:n.minorCategory||"",notes:n.notes||""}));s.append("items",JSON.stringify(t)),console.log("ğŸŸ¢ ë°œì£¼ì„œ ìƒì„± ìš”ì²­ ë°ì´í„°:",{projectId:"1",vendorId:"1",deliveryDate:i.deliveryDate||new Date().toISOString(),notes:i.notes||`ë°œì£¼ì„œ ì‘ì„±ìœ¼ë¡œ ìƒì„±ëœ ë°œì£¼ì„œ - ${i.orderNumber}`,items:t});const r=await fetch("/api/orders",{method:"POST",body:s});if(console.log("ğŸŸ¢ ë°œì£¼ì„œ ìƒì„± ì‘ë‹µ ìƒíƒœ:",r.status),r.ok){const n=await r.json();console.log("ğŸŸ¢ ìƒì„±ëœ ë°œì£¼ì„œ:",n),g(c=>({...c,order:"completed"})),a({title:"ìƒì„± ì™„ë£Œ",description:`ë°œì£¼ì„œê°€ ì„±ê³µì ìœ¼ë¡œ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤. (${n.orderNumber||i.orderNumber})`}),localStorage.removeItem("draftOrder"),setTimeout(()=>{window.location.href="/orders"},3e3)}else{const n=await r.text();console.error("ğŸ”´ ë°œì£¼ì„œ ìƒì„± ì‹¤íŒ¨ ì‘ë‹µ:",r.status,n);let c="ë°œì£¼ì„œ ìƒì„± ì‹¤íŒ¨";try{c=JSON.parse(n).message||c}catch{c=`HTTP ${r.status}: ${n}`}throw new Error(c)}}catch(s){g(t=>({...t,order:"error"})),a({title:"ìƒì„± ì‹¤íŒ¨",description:s instanceof Error?s.message:"ë°œì£¼ì„œ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.",variant:"destructive"})}},L=async s=>{if(console.log("ğŸ“§ ë°œì£¼ì„œ ìƒì„± ë° ì´ë©”ì¼ ë°œì†¡ ì‹œì‘:",{orderData:i,emailSettings:s}),!i.orderNumber||!i.vendorName||!i.projectName||!i.items?.length){a({title:"ìƒì„± ë¶ˆê°€",description:"í•„ìˆ˜ ì •ë³´ë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.",variant:"destructive"});return}g(t=>({...t,order:"processing",email:"processing"}));try{console.log("ğŸŸ¢ Step 1: ë°œì£¼ì„œ ìƒì„±");const t=new FormData;t.append("projectId","1"),t.append("vendorId","1"),t.append("deliveryDate",i.deliveryDate||new Date().toISOString()),t.append("notes",i.notes||`ë°œì£¼ì„œ ì‘ì„±ìœ¼ë¡œ ìƒì„±ëœ ë°œì£¼ì„œ - ${i.orderNumber}`);const r=(i.items||[]).map(o=>({itemName:o.name||o.itemName||"",specification:o.specification||"",unit:o.unit||"EA",quantity:parseFloat(o.quantity||"0"),unitPrice:parseFloat(o.unitPrice||"0"),totalAmount:parseFloat(o.quantity||"0")*parseFloat(o.unitPrice||"0"),majorCategory:o.majorCategory||"",middleCategory:o.middleCategory||"",minorCategory:o.minorCategory||"",notes:o.notes||""}));t.append("items",JSON.stringify(r));const n=await fetch("/api/orders",{method:"POST",body:t});if(!n.ok)throw new Error("ë°œì£¼ì„œ ìƒì„± ì‹¤íŒ¨");const c=await n.json();if(console.log("ğŸŸ¢ ë°œì£¼ì„œ ìƒì„± ì™„ë£Œ:",c),g(o=>({...o,order:"completed"})),console.log("ğŸ“§ Step 2: ì´ë©”ì¼ ë°œì†¡"),i.processedExcelUrl)try{if((await fetch("/api/orders/send-email-with-excel",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({emailSettings:{to:s.to,cc:s.cc||"",subject:s.subject,message:s.message,orderNumber:i.orderNumber,vendorName:i.vendorName,totalAmount:i.totalAmount},excelFilePath:i.processedExcelUrl,orderData:i})})).ok)console.log("ğŸ“§ ì´ë©”ì¼ ë°œì†¡ ì„±ê³µ"),g(x=>({...x,email:"completed"})),a({title:"ìƒì„± ë° ë°œì†¡ ì™„ë£Œ",description:`ë°œì£¼ì„œê°€ ìƒì„±ë˜ê³  ì´ë©”ì¼ì´ ë°œì†¡ë˜ì—ˆìŠµë‹ˆë‹¤. (${c.orderNumber||i.orderNumber})`});else throw new Error("ì´ë©”ì¼ ë°œì†¡ ì‹¤íŒ¨")}catch(o){console.error("ğŸ“§ ì´ë©”ì¼ ë°œì†¡ ì‹¤íŒ¨:",o),g(x=>({...x,email:"error"})),a({title:"ë¶€ë¶„ ì™„ë£Œ",description:"ë°œì£¼ì„œëŠ” ìƒì„±ë˜ì—ˆìœ¼ë‚˜ ì´ë©”ì¼ ë°œì†¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.",variant:"destructive"})}else try{if((await fetch("/api/orders/send-email",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({orderData:{...i,vendorEmail:s.to},pdfUrl:w,recipients:[s.to],emailSettings:{subject:s.subject,message:s.message,cc:s.cc}})})).ok)console.log("ğŸ“§ PDF ì´ë©”ì¼ ë°œì†¡ ì„±ê³µ"),g(x=>({...x,email:"completed"})),a({title:"ìƒì„± ë° ë°œì†¡ ì™„ë£Œ",description:"ë°œì£¼ì„œê°€ ìƒì„±ë˜ê³  PDF ì´ë©”ì¼ì´ ë°œì†¡ë˜ì—ˆìŠµë‹ˆë‹¤."});else throw new Error("PDF ì´ë©”ì¼ ë°œì†¡ ì‹¤íŒ¨")}catch(o){console.error("ğŸ“§ PDF ì´ë©”ì¼ ë°œì†¡ ì‹¤íŒ¨:",o),g(x=>({...x,email:"error"})),a({title:"ë¶€ë¶„ ì™„ë£Œ",description:"ë°œì£¼ì„œëŠ” ìƒì„±ë˜ì—ˆìœ¼ë‚˜ ì´ë©”ì¼ ë°œì†¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.",variant:"destructive"})}localStorage.removeItem("draftOrder"),setTimeout(()=>{window.location.href="/orders"},3e3)}catch(t){console.error("ğŸ”´ ë°œì£¼ì„œ ìƒì„± ë° ì´ë©”ì¼ ë°œì†¡ ì‹¤íŒ¨:",t),g(r=>({...r,order:"error",email:"error"})),a({title:"ì‹¤íŒ¨",description:t instanceof Error?t.message:"ë°œì£¼ì„œ ìƒì„± ë° ì´ë©”ì¼ ë°œì†¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.",variant:"destructive"})}},h=async()=>{if(!i.vendorEmail){a({title:"ë°œì†¡ ë¶ˆê°€",description:"ìˆ˜ì‹ ì ì´ë©”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.",variant:"destructive"});return}g(s=>({...s,email:"processing"}));try{if((await fetch("/api/orders/send-email",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({orderData:i,pdfUrl:w||null,recipients:[i.vendorEmail]})})).ok)g(t=>({...t,email:"completed"})),a({title:"ë°œì†¡ ì™„ë£Œ",description:"ë°œì£¼ì„œê°€ ì„±ê³µì ìœ¼ë¡œ ë°œì†¡ë˜ì—ˆìŠµë‹ˆë‹¤."}),localStorage.removeItem("draftOrder"),setTimeout(()=>{window.location.href="/orders"},3e3);else throw new Error("ì´ë©”ì¼ ë°œì†¡ ì‹¤íŒ¨")}catch{g(t=>({...t,email:"error"})),a({title:"ë°œì†¡ ì‹¤íŒ¨",description:"ì´ë©”ì¼ ë°œì†¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.",variant:"destructive"})}},l=()=>{const s=Object.values(D);return s.filter(r=>r==="completed").length/s.length*100};return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx("div",{className:"bg-background border-b border-border sticky top-0 z-40",children:e.jsx("div",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-foreground",children:"ë°œì£¼ì„œ ì‘ì„±"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"í•œ í™”ë©´ì—ì„œ ëª¨ë“  ì‘ì—…ì„ ì™„ë£Œí•˜ì„¸ìš”"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[v&&e.jsxs(N,{variant:"outline",size:"sm",onClick:()=>{window.confirm("í˜„ì¬ ì‘ì—… ì¤‘ì¸ ë‚´ìš©ì´ ëª¨ë‘ ì‚­ì œë©ë‹ˆë‹¤. ìƒˆë¡œ ì‘ì„±í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")&&(m(),a({title:"ìƒˆë¡œ ì‘ì„±",description:"ë°œì£¼ì„œ ì‘ì„± í™”ë©´ì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤."}))},className:"text-blue-600 dark:text-blue-400 border-blue-200 dark:border-blue-800 hover:bg-blue-50 dark:hover:bg-blue-950",children:[e.jsx(H,{className:"w-4 h-4 mr-1"}),"ìƒˆë¡œ ì‘ì„±"]}),b&&e.jsxs(R,{variant:"secondary",className:"animate-pulse",children:[e.jsx(U,{className:"w-3 h-3 mr-1 animate-spin"}),"ìë™ ì €ì¥ ì¤‘..."]}),!b&&!S&&i.orderNumber&&e.jsxs(R,{variant:"secondary",className:"bg-green-50 text-green-700",children:[e.jsx(Q,{className:"w-3 h-3 mr-1"}),"ì €ì¥ë¨"]}),e.jsx(Pe,{value:l(),className:"w-32 h-2"})]})]})})}),e.jsxs("div",{className:"container mx-auto px-6 py-6",style:{paddingBottom:"120px"},children:[!v&&e.jsx("div",{className:"mb-8",children:e.jsxs(ie,{className:"mb-6 max-w-4xl mx-auto",children:[e.jsx(ne,{className:"h-4 w-4"}),e.jsx(ce,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"font-medium",children:"ğŸ“‹ ì‚¬ìš©íŒ"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-blue-600 dark:text-blue-400",children:"ì—‘ì…€ íŒŒì¼ ì—…ë¡œë“œ:"})," ëŒ€ëŸ‰ ë°œì£¼ì„œ, ë°˜ë³µ ì—…ë¬´, ìë™í™” ì²˜ë¦¬ì— ì í•© (50ê±´+ ê¶Œì¥)"]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-green-600 dark:text-green-400",children:"ì§ì ‘ ì…ë ¥:"})," ì†ŒëŸ‰ ë°œì£¼ì„œ, ì„¸ë°€í•œ ì¡°ì •, ì¦‰ì‹œ ì²˜ë¦¬ì— ì í•© (10ê±´ ì´í•˜ ê¶Œì¥)"]})]}),e.jsx("div",{className:"pt-2 border-t",children:e.jsxs(N,{variant:"outline",size:"sm",className:"text-blue-600 dark:text-blue-400 border-blue-200 dark:border-blue-800 hover:bg-blue-50 dark:hover:bg-blue-950",onClick:async()=>{try{const s=await fetch("/PO_Excel_Template.xlsx");if(s.ok){const t=await s.blob(),r=URL.createObjectURL(t),n=document.createElement("a");n.href=r,n.download="PO_Excel_Template.xlsx",document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(r)}else throw new Error("íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤")}catch(s){console.error("ì—‘ì…€ í…œí”Œë¦¿ ë‹¤ìš´ë¡œë“œ ì‹¤íŒ¨:",s),a({title:"ë‹¤ìš´ë¡œë“œ ì‹¤íŒ¨",description:"ì—‘ì…€ í…œí”Œë¦¿ ë‹¤ìš´ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.",variant:"destructive"})}},children:[e.jsx(de,{className:"h-4 w-4 mr-2"}),"ì—‘ì…€ í…œí”Œë¦¿ ë‹¤ìš´ë¡œë“œ"]})})]})})]})}),!v&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-8 max-w-4xl mx-auto",children:[e.jsx(G,{className:"cursor-pointer hover:shadow-lg transition-shadow border-2 hover:border-blue-500 dark:hover:border-blue-400",onClick:()=>E("excel"),children:e.jsxs(X,{className:"p-8 text-center",children:[e.jsx(oe,{className:"w-16 h-16 mx-auto mb-4 text-blue-600 dark:text-blue-400"}),e.jsx("h3",{className:"text-xl font-semibold mb-2 text-foreground",children:"ì—‘ì…€ íŒŒì¼ ì—…ë¡œë“œ"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"ê¸°ì¡´ ì—‘ì…€ íŒŒì¼ì„ ì—…ë¡œë“œí•˜ì—¬ ë¹ ë¥´ê²Œ ì‘ì„±"}),e.jsxs("div",{className:"text-xs text-muted-foreground space-y-1",children:[e.jsx("div",{children:"âœ… ëŒ€ëŸ‰ ì²˜ë¦¬ (50ê±´+)"}),e.jsx("div",{children:"âœ… ìë™í™” ì›Œí¬í”Œë¡œìš°"}),e.jsx("div",{children:"âœ… ê±°ë˜ì²˜ ìë™ ë§¤ì¹­"}),e.jsx("div",{children:"âœ… ì´ë©”ì¼ ìë™ ë°œì†¡"})]})]})}),e.jsx(G,{className:"cursor-pointer hover:shadow-lg transition-shadow border-2 hover:border-green-500 dark:hover:border-green-400 bg-card",onClick:()=>E("direct"),children:e.jsxs(X,{className:"p-8 text-center",children:[e.jsx(J,{className:"w-16 h-16 mx-auto mb-4 text-green-600 dark:text-green-400"}),e.jsx("h3",{className:"text-xl font-semibold mb-2 text-foreground",children:"ì§ì ‘ ì…ë ¥"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"í¼ì„ í†µí•´ ì§ì ‘ ì •ë³´ ì…ë ¥"}),e.jsxs("div",{className:"text-xs text-muted-foreground space-y-1",children:[e.jsx("div",{children:"âœ… ì†ŒëŸ‰ ì²˜ë¦¬ (10ê±´ ì´í•˜)"}),e.jsx("div",{children:"âœ… ì¦‰ì‹œ ì²˜ë¦¬"}),e.jsx("div",{children:"âœ… ì‹¤ì‹œê°„ ê²€ì¦"}),e.jsx("div",{children:"âœ… ì„¸ë°€í•œ ì¡°ì •"})]})]})})]}),v&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsx(G,{children:e.jsxs(X,{className:"p-6",children:[v==="excel"&&e.jsx(Be,{onDataExtracted:T,onProcessedFileReady:z}),v==="direct"&&e.jsx(_e,{initialData:i,onChange:T})]})}),e.jsx(Je,{orderData:i,onSuggestionApply:T})]}),e.jsx("div",{className:"space-y-6",children:e.jsx(Ve,{orderData:i,pdfUrl:w,processingStatus:D})})]}),v&&i.orderNumber&&e.jsx(Ke,{orderData:i,pdfUrl:w,processingStatus:D,onSave:j,onSend:h,onCreateOrder:I,onCreateOrderWithEmail:L,onDownload:()=>{w&&window.open(`${w}?download=true`,"_blank")}})]})]})};export{Cs as default};
