import{h as Me,r as n,j as e,F as Ve,B as $,b as Fe,c as ie,ab as dt,ac as Ee,ad as _e,aX as l,e as mt,q,aQ as gt,aY as ut,s as qe,w as J,L as R,N as Y,x as X,O as W,S as Z,z as ee,A as te,D as se,G as k,y as C,P as pt,f as xe,aO as yt,T as ke,K as ne,k as Oe}from"./index-CPgkrsSy-1757309990072.js";import{T as xt}from"./textarea-vA7UlkQ2-1757309990072.js";import{T as ht,a as jt,b as he,c as b,d as bt,e as g}from"./table-BGE0jLXK-1757309990072.js";import{i as Le}from"./authUtils-CcDzk6i0-1757309990072.js";import{P as ft}from"./progress-CnxeQnOD-1757309990072.js";import{U as Nt}from"./upload-BAYQ7HEV-1757309990072.js";const vt={validation:"ì…ë ¥ ë°ì´í„° ê²€ì¦",preparation:"ë°ì´í„° ì¤€ë¹„",saving:"ë°ì´í„°ë² ì´ìŠ¤ ì €ì¥",attachments:"ì²¨ë¶€íŒŒì¼ ì²˜ë¦¬",pdf:"PDF ìƒì„±",status:"ìƒíƒœ ì—…ë°ì´íŠ¸",complete:"ì™„ë£Œ",error:"ì˜¤ë¥˜ ë°œìƒ"};function wt({sessionId:p,onComplete:O,onError:re,onCancel:je,showCancelButton:c=!1}){const{theme:le}=Me(),a=le==="dark",[y,be]=n.useState(null),[ce,de]=n.useState([]),[L,ae]=n.useState(null),[A,K]=n.useState(!1),[P,U]=n.useState(!1),[F,N]=n.useState(!1),B=n.useCallback(()=>{if(F)return;console.log(`ğŸ“¡ SSE ì—°ê²° ì‹œì‘ - ì„¸ì…˜: ${p}`);const v=new EventSource(`/api/orders/progress/${p}`);v.onopen=()=>{console.log("ğŸ“¡ SSE ì—°ê²°ë¨"),K(!0),U(!1)},v.onmessage=w=>{try{const d=JSON.parse(w.data);console.log("ğŸ“Š ì§„í–‰ìƒí™© ì—…ë°ì´íŠ¸:",d),be(d),de(E=>{const x=[...E],u=x.findIndex(S=>S.step===d.step);return u>=0?x[u]=d:x.push(d),x}),d.error?(U(!0),re(d.error)):d.completed&&d.step==="complete"&&O({success:!0,orderId:void 0,orderNumber:void 0,pdfGenerated:!0})}catch(d){console.error("ì§„í–‰ìƒí™© ë°ì´í„° íŒŒì‹± ì˜¤ë¥˜:",d)}},v.onerror=w=>{console.error("ğŸ“¡ SSE ì—°ê²° ì˜¤ë¥˜:",w),K(!1),U(!0),setTimeout(()=>{!F&&!P&&(console.log("ğŸ“¡ SSE ì¬ì—°ê²° ì‹œë„..."),B())},3e3)},ae(v)},[p,O,re,F,P]);n.useEffect(()=>(B(),()=>{L&&(console.log("ğŸ“¡ SSE ì—°ê²° ì¢…ë£Œ"),L.close())}),[B]);const fe=()=>{N(!0),L&&L.close(),je?.()};return e.jsxs("div",{className:`space-y-4 p-6 rounded-lg border transition-colors ${a?"bg-gray-800 border-gray-700":"bg-white border-gray-200"}`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ve,{className:`h-5 w-5 transition-colors ${a?"text-blue-400":"text-blue-600"}`}),e.jsx("h3",{className:`text-lg font-semibold transition-colors ${a?"text-white":"text-gray-900"}`,children:"ë°œì£¼ì„œ ìƒì„± ì¤‘..."})]}),c&&!P&&!F&&e.jsx($,{variant:"outline",size:"sm",onClick:fe,className:"text-gray-500 hover:text-gray-700",children:"ì·¨ì†Œ"})]}),e.jsxs("div",{className:`flex items-center gap-2 text-sm transition-colors ${A?a?"text-green-400":"text-green-600":a?"text-red-400":"text-red-600"}`,children:[A?e.jsx(Fe,{className:"h-4 w-4"}):e.jsx(ie,{className:"h-4 w-4"}),A?"ì‹¤ì‹œê°„ ì—°ê²°ë¨":"ì—°ê²° ì¤‘..."]}),y&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:`text-sm font-medium transition-colors ${a?"text-gray-300":"text-gray-700"}`,children:y.message}),e.jsxs("span",{className:`text-sm transition-colors ${a?"text-gray-400":"text-gray-500"}`,children:[y.progress,"%"]})]}),e.jsx(ft,{value:y.progress,className:"h-2"})]}),e.jsx("div",{className:"space-y-2",children:Object.entries(vt).map(([v,w])=>{const d=ce.find(S=>S.step===v),E=y?.step===v,x=d?.completed||!1,u=d?.error;return e.jsxs("div",{className:`flex items-center gap-3 p-2 rounded transition-colors ${E?a?"bg-blue-900/20":"bg-blue-50":"transparent"}`,children:[u?e.jsx(ie,{className:"h-4 w-4 text-red-500"}):x?e.jsx(Fe,{className:"h-4 w-4 text-green-500"}):E?e.jsx(dt,{className:"h-4 w-4 animate-spin text-blue-500"}):e.jsx("div",{className:`h-4 w-4 rounded-full border-2 transition-colors ${a?"border-gray-600":"border-gray-300"}`}),e.jsx("span",{className:`text-sm transition-colors ${E?a?"text-blue-300 font-medium":"text-blue-600 font-medium":x?a?"text-green-300":"text-green-600":u?a?"text-red-300":"text-red-600":a?"text-gray-400":"text-gray-500"}`,children:w}),u&&e.jsx("span",{className:"text-xs text-red-500 ml-auto",children:u})]},v)})}),P&&y?.error&&e.jsxs(Ee,{variant:"destructive",children:[e.jsx(ie,{className:"h-4 w-4"}),e.jsx(_e,{children:y.error})]}),F&&e.jsxs(Ee,{children:[e.jsx(ie,{className:"h-4 w-4"}),e.jsx(_e,{children:"ë°œì£¼ì„œ ìƒì„±ì´ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤."})]})]})}const Ct=l.object({itemId:l.number().optional(),itemName:l.string().min(1,"í’ˆëª©ëª…ì„ ì…ë ¥í•˜ì„¸ìš”"),specification:l.string().optional(),majorCategory:l.string().optional(),middleCategory:l.string().optional(),minorCategory:l.string().optional(),quantity:l.number().positive("ìˆ˜ëŸ‰ì€ 0ë³´ë‹¤ ì»¤ì•¼ í•©ë‹ˆë‹¤"),unitPrice:l.number().positive("ë‹¨ê°€ëŠ” 0ë³´ë‹¤ ì»¤ì•¼ í•©ë‹ˆë‹¤"),notes:l.string().optional()}),$t=l.object({templateId:l.number().optional(),projectId:l.number().min(1,"í˜„ì¥ì„ ì„ íƒí•˜ì„¸ìš”"),vendorId:l.number().min(1,"ê±°ë˜ì²˜ë¥¼ ì„ íƒí•˜ì„¸ìš”"),orderDate:l.string().min(1,"ë°œì£¼ì¼ìë¥¼ ì„ íƒí•˜ì„¸ìš”"),deliveryDate:l.string().optional(),notes:l.string().optional(),items:l.array(Ct).min(1,"ìµœì†Œ í•˜ë‚˜ì˜ í’ˆëª©ì„ ì¶”ê°€í•˜ì„¸ìš”"),customFields:l.record(l.any()).optional()});function Et({orderId:p,onSuccess:O,onCancel:re,preselectedTemplateId:je}){const{toast:c}=mt(),{theme:le}=Me(),a=le==="dark",[y,be]=n.useState(null),[ce,de]=n.useState([]),[L,ae]=n.useState(!0),[A,K]=n.useState(null),[P,U]=n.useState(!1);n.useEffect(()=>{(async()=>{try{ae(!0),console.log("Loading templates...");const s=await fetch("/api/admin/templates",{method:"GET",headers:{Accept:"application/json"},credentials:"include"});if(console.log("Template response status:",s.status),!s.ok)throw new Error(`HTTP error! status: ${s.status}`);const r=await s.json();console.log("Templates loaded:",r),de(r),K(null)}catch(s){console.error("Error loading templates:",s),K(s)}finally{ae(!1)}})()},[]);const{data:F}=q({queryKey:["/api/admin/templates",y],enabled:!!y,retry:1}),N=F,{data:B,isLoading:fe,error:v}=q({queryKey:["/api/items"],select:t=>t.items||[],retry:1}),{data:w,isLoading:d,error:E}=q({queryKey:["/api/categories"],queryFn:async()=>{console.log("ğŸ” Fetching categories from /api/categories");const t=await fetch("/api/categories",{credentials:"include"});if(console.log("ğŸ” Categories response status:",t.status),!t.ok)throw new Error("Failed to fetch categories");const s=await t.json();return console.log("ğŸ” Categories response data:",s),s},retry:1});w?.categories;const x=w?.flatCategories||[],u=x.filter(t=>t.categoryType==="major"),S=x.filter(t=>t.categoryType==="middle"),Ne=x.filter(t=>t.categoryType==="minor"),{data:ve,isLoading:ze}=q({queryKey:["/api/projects"],retry:1});console.log("Items data:",B),console.log("Templates data:",ce),console.log("Templates loading:",L),console.log("Templates error:",A),console.log("API endpoint test for templates"),console.log("ğŸ” Categories debug:",{isLoadingCategories:d,categoriesError:E,categoriesResponse:w,majorCategoriesCount:u?.length,middleCategoriesCount:S?.length,minorCategoriesCount:Ne?.length});const[m,H]=n.useState([{itemId:0,itemName:"",specification:"",majorCategory:"",middleCategory:"",minorCategory:"",quantity:0,unitPrice:0,notes:""}]),[f,Q]=n.useState([""]),[G,we]=n.useState([]),[M,me]=n.useState(!1),[h,Ae]=n.useState(null),[j,Ke]=n.useState(null),[Ue,V]=n.useState(!1),[Ce,z]=n.useState(null),$e=t=>t===0||isNaN(t)?"":xe(t),Se=t=>{const s=t.replace(/[â‚©,\s]/g,""),r=parseFloat(s);return isNaN(r)?0:r},{register:ge,handleSubmit:Be,watch:He,setValue:_,reset:Qe,formState:{errors:I}}=gt({resolver:ut($t),defaultValues:{templateId:void 0,projectId:0,vendorId:0,orderDate:new Date().toISOString().split("T")[0],deliveryDate:"",notes:"",items:m,customFields:{}}}),{data:Ie}=q({queryKey:["/api/vendors"]});q({queryKey:["/api/projects"]});const{data:oe,isLoading:ue}=q({queryKey:["/api/orders",p],enabled:!!p}),pe=qe({mutationFn:async t=>{const s=`order_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;z(s),V(!0);const r=new FormData;r.append("method","manual"),r.append("projectId",t.projectId.toString()),r.append("vendorId",t.vendorId.toString()),r.append("orderDate",t.orderDate),t.deliveryDate&&r.append("deliveryDate",t.deliveryDate),t.notes&&r.append("notes",t.notes),t.customFields&&r.append("customFields",JSON.stringify(t.customFields)),r.append("items",JSON.stringify(m.map(i=>({...i,itemId:Number(i.itemId),quantity:Number(i.quantity),unitPrice:Number(i.unitPrice),totalAmount:(i.quantity||0)*(i.unitPrice||0)})))),G.forEach(i=>{r.append("attachments",i)});const o=await fetch("/api/orders/create-unified",{method:"POST",body:r,credentials:"include"});if(!o.ok){const i=await o.text();throw new Error(i||"Order creation failed")}return o.json()},onSuccess:t=>{V(!1),z(null),ne.invalidateQueries({queryKey:["/api/orders"]}),c({title:"ì„±ê³µ",description:`ë°œì£¼ì„œê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤. (${t.orderNumber||t.orderId})`}),O?.()},onError:t=>{if(V(!1),z(null),Le(t)){c({title:"Unauthorized",description:"You are logged out. Logging in again...",variant:"destructive"}),setTimeout(()=>{window.location.href="/api/login"},500);return}c({title:"ì˜¤ë¥˜",description:"ë°œì£¼ì„œ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.",variant:"destructive"})}}),ye=qe({mutationFn:async t=>{const{items:s,...r}=t;if(await Oe("PUT",`/api/orders/${p}`,{...r,items:s.map(o=>({...o,totalAmount:(o.quantity||0)*(o.unitPrice||0)}))}),G.length>0){const o=new FormData;G.forEach(i=>{o.append("files",i)}),await Oe("POST",`/api/orders/${p}/attachments`,o)}},onSuccess:()=>{ne.invalidateQueries({queryKey:["/api/orders"]}),ne.invalidateQueries({queryKey:["/api/orders",p]}),c({title:"ì„±ê³µ",description:"ë°œì£¼ì„œê°€ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤."}),O?.()},onError:t=>{if(Le(t)){c({title:"Unauthorized",description:"You are logged out. Logging in again...",variant:"destructive"}),setTimeout(()=>{window.location.href="/api/login"},500);return}c({title:"ì˜¤ë¥˜",description:"ë°œì£¼ì„œ ìˆ˜ì •ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.",variant:"destructive"})}});n.useEffect(()=>{if(oe&&!ue&&typeof oe=="object"&&!P){const t=oe,s=(t.items||[]).map(r=>({itemId:r.itemId||0,itemName:r.itemName,specification:r.specification||"",majorCategory:r.majorCategory||"",middleCategory:r.middleCategory||"",minorCategory:r.minorCategory||"",quantity:r.quantity,unitPrice:r.unitPrice,notes:r.notes||""}));Qe({vendorId:t.vendorId,orderDate:new Date(t.orderDate).toISOString().split("T")[0],deliveryDate:t.deliveryDate?new Date(t.deliveryDate).toISOString().split("T")[0]:"",notes:t.notes||"",items:s}),H(s),U(!0)}},[oe,ue,P]);const Ge=()=>{const t=m.length>0?m[m.length-1]:null,s=f.length>0?f[f.length-1]:"",r=t?{itemId:t.itemId,itemName:t.itemName,specification:t.specification,majorCategory:t.majorCategory,middleCategory:t.middleCategory,minorCategory:t.minorCategory,quantity:t.quantity,unitPrice:t.unitPrice,notes:t.notes}:{itemId:0,itemName:"",specification:"",majorCategory:"",middleCategory:"",minorCategory:"",quantity:0,unitPrice:0,notes:""},o=[...m,r];H(o),_("items",o),Q([...f,s])},Je=t=>{const s=m[t],r=f[t]||"",o={itemId:s.itemId,itemName:s.itemName,specification:s.specification,majorCategory:s.majorCategory,middleCategory:s.middleCategory,minorCategory:s.minorCategory,quantity:s.quantity,unitPrice:s.unitPrice,notes:s.notes},i=[...m,o];H(i),_("items",i),Q([...f,r])},Re=t=>{if(m.length===1)return;const s=m.filter((o,i)=>i!==t),r=f.filter((o,i)=>i!==t);H(s),_("items",s),Q(r)},D=(t,s,r)=>{const o=[...m];o[t]={...o[t],[s]:r},s==="majorCategory"?(o[t].middleCategory="",o[t].minorCategory=""):s==="middleCategory"&&(o[t].minorCategory=""),H(o),_("items",o)},Ye=t=>{if(console.log("ğŸ” getMiddleCategoriesForMajor called with:",t),console.log("ğŸ” Major categories available:",u?.length),console.log("ğŸ” Middle categories available:",S?.length),!t)return console.log("âŒ No major category name provided"),[];const s=u.find(o=>o.categoryName===t);if(console.log("ğŸ” Found major category:",s),!s)return console.log("âŒ Major category not found"),console.log("Available major categories:",u?.map(o=>o.categoryName)),[];const r=S.filter(o=>o.parentId===s.id);return console.log("ğŸ” Filtered middle categories:",r),r},Xe=t=>{if(!t)return[];const s=S.find(r=>r.categoryName===t);return s?Ne.filter(r=>r.parentId===s.id):[]},De=t=>(t.quantity||0)*(t.unitPrice||0),We=()=>m.reduce((t,s)=>t+De(s),0),Te=t=>{const s=t.filter(r=>r.size>52428800?(c({title:"íŒŒì¼ í¬ê¸° ì˜¤ë¥˜",description:`${r.name}ì€(ëŠ”) íŒŒì¼ í¬ê¸°ê°€ 50MBë¥¼ ì´ˆê³¼í•©ë‹ˆë‹¤.`,variant:"destructive"}),!1):!0);s.length>0&&(we(r=>[...r,...s]),c({title:"íŒŒì¼ ì—…ë¡œë“œ",description:`${s.length}ê°œì˜ íŒŒì¼ì´ ì²¨ë¶€ë˜ì—ˆìŠµë‹ˆë‹¤.`}))},Ze=t=>{const s=Array.from(t.target.files||[]);Te(s),t.target&&(t.target.value="")},et=t=>{t.preventDefault(),t.stopPropagation(),me(!0)},tt=t=>{t.preventDefault(),t.stopPropagation(),t.currentTarget.contains(t.relatedTarget)||me(!1)},st=t=>{t.preventDefault(),t.stopPropagation()},rt=t=>{t.preventDefault(),t.stopPropagation(),me(!1);const s=Array.from(t.dataTransfer.files);s.length>0&&Te(s)},at=t=>{V(!1),z(null),ne.invalidateQueries({queryKey:["/api/orders"]}),c({title:"ì„±ê³µ",description:`ë°œì£¼ì„œê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤. (${t.orderNumber||t.orderId})`}),O?.()},ot=t=>{V(!1),z(null),c({title:"ì˜¤ë¥˜",description:t||"ë°œì£¼ì„œ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.",variant:"destructive"})},it=()=>{V(!1),z(null),c({title:"ì·¨ì†Œ",description:"ë°œì£¼ì„œ ìƒì„±ì´ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤."})},nt=t=>{we(s=>s.filter((r,o)=>o!==t))},lt=()=>{if(!N?.fieldsConfig)return null;try{const t=typeof N.fieldsConfig=="string"?JSON.parse(N.fieldsConfig):N.fieldsConfig,s=[];if(N.templateType==="material_extrusion")t.basic_fields&&s.push({key:"basic_fields",name:"ê¸°ë³¸ ì •ë³´",fields:t.basic_fields}),t.extrusion_list&&s.push({key:"extrusion_list",name:"ì••ì¶œ ëª©ë¡",fields:t.extrusion_list}),t.schedule_fields&&s.push({key:"schedule_fields",name:"ì¼ì • ì •ë³´",fields:t.schedule_fields}),t.specification_fields&&s.push({key:"specification_fields",name:"ì‚¬ì–‘ ì •ë³´",fields:t.specification_fields});else if(N.templateType==="panel_manufacturing")t.basic_fields&&s.push({key:"basic_fields",name:"ê¸°ë³¸ ì •ë³´",fields:t.basic_fields}),t.color_breakdown&&s.push({key:"color_breakdown",name:"ìƒ‰ìƒ ë¶„ë¥˜",fields:t.color_breakdown}),t.material_fields&&s.push({key:"material_fields",name:"ì¬ë£Œ ì •ë³´",fields:t.material_fields}),t.panel_breakdown&&s.push({key:"panel_breakdown",name:"íŒë„¬ ë¶„ë¥˜",fields:t.panel_breakdown}),t.delivery_schedule&&s.push({key:"delivery_schedule",name:"ë°°ì†¡ ì¼ì •",fields:t.delivery_schedule}),t.insulation_details&&s.push({key:"insulation_details",name:"ë‹¨ì—´ì¬ ìƒì„¸",fields:t.insulation_details});else if(t.fields&&Array.isArray(t.fields)){const r=t.fields.reduce((o,i)=>{const T=i.sectionName||"ê¸°ë³¸ ì •ë³´";return o[T]||(o[T]=[]),o[T].push(i),o},{});Object.entries(r).forEach(([o,i])=>{s.push({key:o,name:o,fields:i})})}return s.length===0?null:s.map(r=>e.jsxs(J,{className:`mb-4 transition-colors ${a?"bg-gray-800 border-gray-700":"bg-white border-gray-200"}`,children:[e.jsx(R,{className:"pb-2",children:e.jsx(Y,{className:`text-lg transition-colors ${a?"text-white":"text-gray-900"}`,children:r.name})}),e.jsx(X,{className:"pt-2",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:Array.isArray(r.fields)?r.fields.map(o=>Pe(o)):Object.entries(r.fields).map(([o,i])=>Pe({fieldName:o,label:i,fieldType:o.includes("date")?"date":o.includes("amount")||o.includes("price")||o.includes("quantity")||o.includes("count")||o.includes("weight")||o.includes("kg")||o.includes("area")||o==="quantity"?"number":"text"}))})})]},r.key))}catch(t){return console.error("Error rendering dynamic template fields:",t),null}},Pe=t=>{const s=t.fieldName||t.id,r=t.label,o=t.fieldType||"text";return e.jsxs("div",{children:[e.jsx(W,{htmlFor:s,className:`transition-colors ${a?"text-gray-300":"text-gray-700"}`,children:r}),e.jsx(C,{id:s,type:o,placeholder:`${r}ì„ ì…ë ¥í•˜ì„¸ìš”`,className:`transition-colors ${a?"bg-gray-700 border-gray-600 text-gray-100":"bg-white border-gray-300"}`,onChange:i=>{const T=He("customFields")||{};_("customFields",{...T,[s]:i.target.value})}})]},s)},ct=t=>{const s=Number(t.vendorId);if(!s||s===0){c({title:"ì˜¤ë¥˜",description:"ê±°ë˜ì²˜ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.",variant:"destructive"});return}const r=Number(t.projectId);if(!r||r===0){c({title:"ì˜¤ë¥˜",description:"í˜„ì¥ì„ ì„ íƒí•´ì£¼ì„¸ìš”.",variant:"destructive"});return}if(m.length===0){c({title:"ì˜¤ë¥˜",description:"ìµœì†Œ í•˜ë‚˜ì˜ í’ˆëª©ì„ ì¶”ê°€í•´ì•¼ í•©ë‹ˆë‹¤.",variant:"destructive"});return}const o={...t,vendorId:s,projectId:r,orderDate:t.orderDate,deliveryDate:t.deliveryDate||void 0,items:m};p?ye.mutate(o):pe.mutate(o)};return ue&&p?e.jsx("div",{className:"p-6",children:"Loading..."}):e.jsxs("div",{className:`max-w-[1366px] mx-auto compact-form space-y-3 pb-20 transition-colors ${a?"bg-gray-900":"bg-gray-50"}`,children:[Ue&&Ce&&e.jsx(wt,{sessionId:Ce,onComplete:at,onError:ot,onCancel:it,showCancelButton:!0}),e.jsxs("form",{onSubmit:Be(ct),className:"space-y-3",children:[e.jsxs(J,{className:`transition-colors ${a?"bg-gray-800 border-gray-700":"bg-white border-gray-200"}`,children:[e.jsx(R,{className:"pb-2",children:e.jsx(Y,{className:`text-lg transition-colors ${a?"text-white":"text-gray-900"}`,children:"ê¸°ë³¸ ì •ë³´"})}),e.jsxs(X,{className:"space-y-3 pt-2",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(W,{htmlFor:"projectId",className:`transition-colors ${a?"text-gray-300":"text-gray-700"}`,children:"í˜„ì¥ *"}),e.jsxs(Z,{onValueChange:t=>{const s=parseInt(t);_("projectId",s);const r=ve?.find(o=>o.id===s);r&&Ae(r)},children:[e.jsx(ee,{className:`transition-colors ${a?"bg-gray-700 border-gray-600 text-gray-100":"bg-white border-gray-300"}`,children:e.jsx(te,{placeholder:"í˜„ì¥ì„ ì„ íƒí•˜ì„¸ìš”"})}),e.jsx(se,{className:`transition-colors ${a?"bg-gray-800 border-gray-600":"bg-white border-gray-200"}`,children:ze?e.jsx(k,{value:"loading",disabled:!0,children:"ë¡œë”© ì¤‘..."}):ve?.map(t=>e.jsxs(k,{value:t.id.toString(),children:[t.projectName," (",t.projectCode,")"]},t.id))||e.jsx(k,{value:"no-projects",disabled:!0,children:"í˜„ì¥ì´ ì—†ìŠµë‹ˆë‹¤"})})]}),I.projectId&&e.jsx("p",{className:`text-sm mt-1 transition-colors ${a?"text-red-400":"text-red-500"}`,children:I.projectId.message})]}),e.jsxs("div",{children:[e.jsx(W,{htmlFor:"vendorId",className:`transition-colors ${a?"text-gray-300":"text-gray-700"}`,children:"ê±°ë˜ì²˜ *"}),e.jsxs(Z,{onValueChange:t=>{const s=parseInt(t);_("vendorId",s);const r=Ie?.find(o=>o.id===s);r&&Ke(r)},children:[e.jsx(ee,{className:`transition-colors ${a?"bg-gray-700 border-gray-600 text-gray-100":"bg-white border-gray-300"}`,children:e.jsx(te,{placeholder:"ê±°ë˜ì²˜ë¥¼ ì„ íƒí•˜ì„¸ìš”"})}),e.jsx(se,{className:`z-[100] dropdown-high-priority transition-colors ${a?"bg-gray-800 border-gray-600":"bg-white border-gray-200"}`,style:{position:"fixed",zIndex:9999},children:Ie?.map(t=>e.jsx(k,{value:t.id.toString(),children:t.name},t.id))})]}),I.vendorId&&e.jsx("p",{className:`text-sm mt-1 transition-colors ${a?"text-red-400":"text-red-500"}`,children:I.vendorId.message})]}),e.jsxs("div",{children:[e.jsx(W,{htmlFor:"orderDate",className:`transition-colors ${a?"text-gray-300":"text-gray-700"}`,children:"ë°œì£¼ì„œ ì‘ì„±ì¼ *"}),e.jsx(C,{id:"orderDate",type:"date",className:`transition-colors ${a?"bg-gray-700 border-gray-600 text-gray-100":"bg-white border-gray-300"}`,...ge("orderDate")}),I.orderDate&&e.jsx("p",{className:`text-sm mt-1 transition-colors ${a?"text-red-400":"text-red-500"}`,children:I.orderDate.message})]}),e.jsxs("div",{children:[e.jsx(W,{htmlFor:"deliveryDate",className:`transition-colors ${a?"text-gray-300":"text-gray-700"}`,children:"ë‚©í’ˆ í¬ë§ì¼"}),e.jsx(C,{id:"deliveryDate",type:"date",className:`transition-colors ${a?"bg-gray-700 border-gray-600 text-gray-100":"bg-white border-gray-300"}`,...ge("deliveryDate")})]})]}),(h||j)&&e.jsx("div",{className:`mt-4 pt-4 border-t transition-colors ${a?"border-gray-700":"border-gray-200"}`,children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[h&&e.jsxs("div",{className:`p-3 rounded-lg transition-colors ${a?"bg-blue-900/20 border border-blue-800":"bg-blue-50"}`,children:[e.jsx("h4",{className:`font-medium mb-2 transition-colors ${a?"text-blue-300":"text-blue-900"}`,children:"í˜„ì¥ ì •ë³´"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:`font-medium transition-colors ${a?"text-gray-400":"text-gray-600"}`,children:"í˜„ì¥ëª…:"}),e.jsx("span",{className:`ml-2 transition-colors ${a?"text-gray-200":"text-gray-900"}`,children:h.projectName})]}),h.location&&e.jsxs("div",{children:[e.jsx("span",{className:`font-medium transition-colors ${a?"text-gray-400":"text-gray-600"}`,children:"ì£¼ì†Œ:"}),e.jsx("span",{className:`ml-2 transition-colors ${a?"text-gray-200":"text-gray-900"}`,children:h.location})]}),h.projectManager&&e.jsxs("div",{children:[e.jsx("span",{className:`font-medium transition-colors ${a?"text-gray-400":"text-gray-600"}`,children:"í˜„ì¥ ê´€ë¦¬ì:"}),e.jsx("span",{className:`ml-2 transition-colors ${a?"text-gray-200":"text-gray-900"}`,children:h.projectManager})]}),h.managerPhone&&e.jsxs("div",{children:[e.jsx("span",{className:`font-medium transition-colors ${a?"text-gray-400":"text-gray-600"}`,children:"ì „í™”ë²ˆí˜¸:"}),e.jsx("span",{className:`ml-2 transition-colors ${a?"text-gray-200":"text-gray-900"}`,children:h.managerPhone})]}),h.managerEmail&&e.jsxs("div",{children:[e.jsx("span",{className:`font-medium transition-colors ${a?"text-gray-400":"text-gray-600"}`,children:"ì´ë©”ì¼:"}),e.jsx("span",{className:`ml-2 transition-colors ${a?"text-gray-200":"text-gray-900"}`,children:h.managerEmail})]})]})]}),j&&e.jsxs("div",{className:`p-3 rounded-lg transition-colors ${a?"bg-green-900/20 border border-green-800":"bg-green-50"}`,children:[e.jsx("h4",{className:`font-medium mb-2 transition-colors ${a?"text-green-300":"text-green-900"}`,children:"ê±°ë˜ì²˜ ì •ë³´"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:`font-medium transition-colors ${a?"text-gray-400":"text-gray-600"}`,children:"ê±°ë˜ì²˜ëª…:"}),e.jsx("span",{className:`ml-2 transition-colors ${a?"text-gray-200":"text-gray-900"}`,children:j.name})]}),j.contactPerson&&e.jsxs("div",{children:[e.jsx("span",{className:`font-medium transition-colors ${a?"text-gray-400":"text-gray-600"}`,children:"ë‹´ë‹¹ì:"}),e.jsx("span",{className:`ml-2 transition-colors ${a?"text-gray-200":"text-gray-900"}`,children:j.contactPerson})]}),j.phone&&e.jsxs("div",{children:[e.jsx("span",{className:`font-medium transition-colors ${a?"text-gray-400":"text-gray-600"}`,children:"ì—°ë½ì²˜:"}),e.jsx("span",{className:`ml-2 transition-colors ${a?"text-gray-200":"text-gray-900"}`,children:j.phone})]}),j.email&&e.jsxs("div",{children:[e.jsx("span",{className:`font-medium transition-colors ${a?"text-gray-400":"text-gray-600"}`,children:"ì´ë©”ì¼:"}),e.jsx("span",{className:`ml-2 transition-colors ${a?"text-gray-200":"text-gray-900"}`,children:j.email})]}),j.address&&e.jsxs("div",{children:[e.jsx("span",{className:`font-medium transition-colors ${a?"text-gray-400":"text-gray-600"}`,children:"ì£¼ì†Œ:"}),e.jsx("span",{className:`ml-2 transition-colors ${a?"text-gray-200":"text-gray-900"}`,children:j.address})]})]})]})]})})]})]}),N&&lt(),e.jsxs(J,{className:`transition-colors ${a?"bg-gray-800 border-gray-700":"bg-white border-gray-200"}`,children:[e.jsx(R,{className:"pb-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(Y,{className:`text-lg transition-colors ${a?"text-white":"text-gray-900"}`,children:"ë°œì£¼ í’ˆëª©"}),e.jsxs($,{type:"button",variant:"outline",size:"sm",onClick:Ge,children:[e.jsx(pt,{className:"h-4 w-4 mr-1"}),"í’ˆëª© ì¶”ê°€"]})]})}),e.jsxs(X,{className:"pt-2",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(ht,{children:[e.jsx(jt,{children:e.jsxs(he,{children:[e.jsx(b,{className:"py-2",children:"í’ˆëª©ëª…"}),e.jsx(b,{className:"py-2",children:"ê·œê²©"}),e.jsx(b,{className:"py-2",children:"ëŒ€ë¶„ë¥˜"}),e.jsx(b,{className:"py-2",children:"ì¤‘ë¶„ë¥˜"}),e.jsx(b,{className:"py-2",children:"ì†Œë¶„ë¥˜"}),e.jsx(b,{className:"py-2",children:"ìˆ˜ëŸ‰"}),e.jsx(b,{className:"py-2",children:"ë‹¨ê°€"}),e.jsx(b,{className:"py-2",children:"ê¸ˆì•¡"}),e.jsx(b,{className:"py-2",children:"ë¹„ê³ "}),e.jsx(b,{className:"py-2 text-center",children:"ë³µì‚¬"}),e.jsx(b,{className:"py-2 text-center",children:"ì‚­ì œ"})]})}),e.jsx(bt,{children:m.map((t,s)=>e.jsxs(he,{children:[e.jsx(g,{className:"py-1",children:e.jsx("div",{className:"min-w-[180px]",children:e.jsx(C,{className:`h-8 transition-colors ${a?"bg-gray-700 border-gray-600 text-gray-100":"bg-white border-gray-300"}`,placeholder:"í’ˆëª©ëª…ì„ ì…ë ¥í•˜ì„¸ìš”",value:t.itemName,onChange:r=>D(s,"itemName",r.target.value)})})}),e.jsx(g,{className:"py-1",children:e.jsx(C,{className:`h-8 transition-colors ${a?"bg-gray-700 border-gray-600 text-gray-100":"bg-white border-gray-300"}`,placeholder:"ê·œê²©",value:t.specification,onChange:r=>D(s,"specification",r.target.value)})}),e.jsx(g,{className:"py-1",children:e.jsx("div",{className:"min-w-[120px]",children:e.jsxs(Z,{value:t.majorCategory,onValueChange:r=>D(s,"majorCategory",r),children:[e.jsx(ee,{className:`h-8 transition-colors ${a?"bg-gray-700 border-gray-600 text-gray-100":"bg-white border-gray-300"}`,children:e.jsx(te,{placeholder:"ëŒ€ë¶„ë¥˜ ì„ íƒ"})}),e.jsx(se,{className:`transition-colors ${a?"bg-gray-800 border-gray-600":"bg-white border-gray-200"}`,children:u?.map(r=>e.jsx(k,{value:r.categoryName,children:r.categoryName},r.id))})]})})}),e.jsx(g,{className:"py-1",children:e.jsx("div",{className:"min-w-[120px]",children:e.jsxs(Z,{value:t.middleCategory,onValueChange:r=>D(s,"middleCategory",r),disabled:!t.majorCategory,children:[e.jsx(ee,{className:`h-8 transition-colors ${a?"bg-gray-700 border-gray-600 text-gray-100":"bg-white border-gray-300"}`,children:e.jsx(te,{placeholder:"ì¤‘ë¶„ë¥˜ ì„ íƒ"})}),e.jsx(se,{className:`transition-colors ${a?"bg-gray-800 border-gray-600":"bg-white border-gray-200"}`,children:Ye(t.majorCategory)?.map(r=>e.jsx(k,{value:r.categoryName,children:r.categoryName},r.id))})]})})}),e.jsx(g,{className:"py-1",children:e.jsx("div",{className:"min-w-[120px]",children:e.jsxs(Z,{value:t.minorCategory,onValueChange:r=>D(s,"minorCategory",r),disabled:!t.middleCategory,children:[e.jsx(ee,{className:`h-8 transition-colors ${a?"bg-gray-700 border-gray-600 text-gray-100":"bg-white border-gray-300"}`,children:e.jsx(te,{placeholder:"ì†Œë¶„ë¥˜ ì„ íƒ"})}),e.jsx(se,{className:`transition-colors ${a?"bg-gray-800 border-gray-600":"bg-white border-gray-200"}`,children:Xe(t.middleCategory)?.map(r=>e.jsx(k,{value:r.categoryName,children:r.categoryName},r.id))})]})})}),e.jsx(g,{className:"py-1",children:e.jsx(C,{className:`h-8 transition-colors ${a?"bg-gray-700 border-gray-600 text-gray-100":"bg-white border-gray-300"}`,type:"number",placeholder:"ìˆ˜ëŸ‰",value:t.quantity||"",onChange:r=>D(s,"quantity",parseFloat(r.target.value)||0)})}),e.jsx(g,{className:"py-1",children:e.jsx(C,{className:`h-8 transition-colors ${a?"bg-gray-700 border-gray-600 text-gray-100":"bg-white border-gray-300"}`,type:"text",placeholder:"â‚©0",value:f[s]||$e(t.unitPrice),onChange:r=>{const o=[...f];o[s]=r.target.value,Q(o);const i=Se(r.target.value);D(s,"unitPrice",i)},onBlur:r=>{const o=Se(r.target.value),i=$e(o),T=[...f];T[s]=i,Q(T)}})}),e.jsx(g,{className:"py-1",children:e.jsx(C,{className:`h-8 transition-colors ${a?"bg-gray-700":"bg-gray-50"}`,readOnly:!0,value:xe(De(t))})}),e.jsx(g,{className:"py-1",children:e.jsx(C,{className:`h-8 transition-colors ${a?"bg-gray-700 border-gray-600 text-gray-100":"bg-white border-gray-300"}`,placeholder:"ë¹„ê³ ",value:t.notes,onChange:r=>D(s,"notes",r.target.value)})}),e.jsx(g,{className:"py-1 text-center",children:e.jsx($,{type:"button",variant:"ghost",size:"sm",onClick:()=>Je(s),className:"h-6 w-6 p-0",children:e.jsx(yt,{className:"h-3 w-3 text-blue-500"})})}),e.jsx(g,{className:"py-1 text-center",children:e.jsx($,{type:"button",variant:"ghost",size:"sm",onClick:()=>Re(s),disabled:m.length===1,className:"h-6 w-6 p-0",children:e.jsx(ke,{className:"h-3 w-3 text-red-500"})})})]},s))}),e.jsx("tfoot",{className:`transition-colors ${a?"bg-gray-700":"bg-gray-50"}`,children:e.jsxs(he,{children:[e.jsx(g,{colSpan:7,className:`py-2 text-right font-medium transition-colors ${a?"text-gray-300":"text-gray-700"}`,children:"ì´ ê¸ˆì•¡:"}),e.jsx(g,{className:`py-2 font-bold text-lg transition-colors ${a?"text-white":"text-gray-900"}`,children:xe(We())}),e.jsx(g,{colSpan:3,className:"py-2"})]})})]})}),I.items&&e.jsx("p",{className:`text-sm mt-2 transition-colors ${a?"text-red-400":"text-red-500"}`,children:I.items.message})]})]}),e.jsxs(J,{className:`transition-colors ${a?"bg-gray-800 border-gray-700":"bg-white border-gray-200"}`,children:[e.jsx(R,{className:"pb-2",children:e.jsx(Y,{className:`text-lg transition-colors ${a?"text-white":"text-gray-900"}`,children:"íŒŒì¼ ì²¨ë¶€"})}),e.jsxs(X,{className:"pt-2",children:[e.jsxs("div",{className:`border-2 border-dashed rounded-lg p-6 text-center transition-all duration-200 cursor-pointer ${M?a?"border-blue-400 bg-blue-900/20 scale-[1.02]":"border-blue-500 bg-blue-50 scale-[1.02]":a?"border-gray-600 hover:border-blue-400/50 hover:bg-gray-700/50":"border-gray-300 hover:border-blue-400/50 hover:bg-gray-50"}`,onDragEnter:et,onDragLeave:tt,onDragOver:st,onDrop:rt,onClick:()=>document.getElementById("fileUpload")?.click(),children:[e.jsx(Nt,{className:`mx-auto h-8 w-8 mb-3 transition-all duration-200 ${M?a?"text-blue-400 scale-110":"text-blue-500 scale-110":a?"text-gray-500":"text-gray-400"}`}),e.jsx("p",{className:`text-base mb-2 font-medium transition-colors ${M?a?"text-blue-400":"text-blue-600":a?"text-gray-300":"text-gray-700"}`,children:M?"íŒŒì¼ì„ ë†“ì•„ì£¼ì„¸ìš”":"íŒŒì¼ì„ ë“œë˜ê·¸í•˜ê±°ë‚˜ í´ë¦­í•˜ì—¬ ì—…ë¡œë“œ"}),e.jsx("p",{className:`text-sm mb-4 transition-colors ${a?"text-gray-400":"text-gray-500"}`,children:"ëª¨ë“  íŒŒì¼ í˜•ì‹ ì§€ì› (ìµœëŒ€ 10MB)"}),e.jsx("input",{type:"file",multiple:!0,accept:"*",onChange:Ze,className:"hidden",id:"fileUpload"}),e.jsx($,{type:"button",variant:M?"default":"outline",size:"sm",className:`transition-all duration-200 ${M?"scale-105":""}`,onClick:t=>{t.stopPropagation(),document.getElementById("fileUpload")?.click()},children:"íŒŒì¼ ì„ íƒ"})]}),G.length>0&&e.jsxs("div",{className:"mt-2 space-y-1",children:[e.jsx("h4",{className:`text-sm font-medium transition-colors ${a?"text-white":"text-gray-900"}`,children:"ì²¨ë¶€ëœ íŒŒì¼"}),G.map((t,s)=>e.jsxs("div",{className:`flex items-center justify-between p-1 rounded text-xs transition-colors ${a?"bg-gray-700":"bg-gray-50"}`,children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(Ve,{className:`h-3 w-3 transition-colors ${a?"text-gray-500":"text-gray-400"}`}),e.jsx("span",{className:`transition-colors ${a?"text-gray-300":"text-gray-700"}`,children:t.name}),e.jsxs("span",{className:`transition-colors ${a?"text-gray-400":"text-gray-500"}`,children:["(",(t.size/1024/1024).toFixed(2)," MB)"]})]}),e.jsx($,{type:"button",variant:"ghost",size:"sm",className:"h-4 w-4 p-0",onClick:()=>nt(s),children:e.jsx(ke,{className:"h-3 w-3 text-red-500"})})]},s))]})]})]}),e.jsxs(J,{className:`transition-colors ${a?"bg-gray-800 border-gray-700":"bg-white border-gray-200"}`,children:[e.jsx(R,{className:"pb-2",children:e.jsx(Y,{className:`text-lg transition-colors ${a?"text-white":"text-gray-900"}`,children:"íŠ¹ì´ì‚¬í•­"})}),e.jsx(X,{className:"pt-2",children:e.jsx(xt,{...ge("notes"),placeholder:"ë°œì£¼ ê´€ë ¨ íŠ¹ì´ì‚¬í•­ì´ë‚˜ ìš”ì²­ì‚¬í•­ì„ ì…ë ¥í•˜ì„¸ìš”",rows:3,className:`text-sm transition-colors ${a?"bg-gray-700 border-gray-600 text-gray-100":"bg-white border-gray-300"}`})})]}),e.jsx("div",{className:"sticky bottom-0 z-10 mt-6",children:e.jsx("div",{className:`p-4 border-t shadow-lg transition-colors ${a?"bg-gray-800 border-gray-700":"bg-white border-gray-200"}`,children:e.jsxs("div",{className:"max-w-[1366px] mx-auto flex flex-col sm:flex-row justify-end gap-3",children:[e.jsx($,{type:"button",variant:"outline",className:"w-full sm:w-auto px-6 py-3 text-base font-medium",onClick:re,children:"ì·¨ì†Œ"}),e.jsx($,{type:"button",variant:"secondary",className:"w-full sm:w-auto px-6 py-3 text-base font-medium",onClick:()=>{c({title:"ì„ì‹œ ì €ì¥",description:"ì„ì‹œ ì €ì¥ ê¸°ëŠ¥ì€ ì¶”í›„ êµ¬í˜„ ì˜ˆì •ì…ë‹ˆë‹¤."})},children:"ì„ì‹œ ì €ì¥"}),e.jsx($,{type:"submit",className:"w-full sm:w-auto px-6 py-3 text-base font-medium",disabled:pe.isPending||ye.isPending,children:pe.isPending||ye.isPending?"ì €ì¥ ì¤‘...":p?"ìˆ˜ì •":"ë°œì£¼ì„œ ìƒì„±"})]})})})]})]},`general-${y}`)}export{Et as OrderForm};
