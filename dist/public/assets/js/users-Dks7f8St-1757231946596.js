import{d as B,e as P,g as F,u as G,h as I,r as o,q as H,s as K,j as e,o as f,B as g,P as Y,y as J,S as O,z as W,A as X,D as Z,G as h,T as z,w as k,U as ee,x as se,t as re,v as ae,k as te}from"./index-DDWBjC3L-1757231946596.js";import{T as le,a as ie,b as C,c as u,d as ne,e as t}from"./table-k1cYDIzv-1757231946596.js";import{i as oe}from"./authUtils-CcDzk6i0-1757231946596.js";import{f as D}from"./formatters-gd6aBVnV-1757231946596.js";import{U as ce}from"./users-ua05AMI5-1757231946596.js";import{S as de}from"./search-yLgIMhQp-1757231946596.js";import{L as xe}from"./list-pyvJljoM-1757231946596.js";import{G as me}from"./grid-3x3-Dm6fNmaK-1757231946596.js";import{S as q}from"./square-pen-B-RF_cyh-1757231946596.js";function fe(){const{user:c,isAuthenticated:T,isLoading:j}=B(),{toast:d}=P(),E=F(),[,n]=G(),{theme:M}=I(),s=M==="dark",[x,R]=o.useState(""),[b,Q]=o.useState("all"),[m,V]=o.useState(null),[w,L]=o.useState("asc"),[S,A]=o.useState("table");o.useEffect(()=>{if(!j&&!T){d({title:"Unauthorized",description:"You are logged out. Logging in again...",variant:"destructive"}),setTimeout(()=>{n("/login")},500);return}},[T,j,d,n]),o.useEffect(()=>{if(!j&&c&&c.role!=="admin"){d({title:"접근 권한 없음",description:"관리자만 접근할 수 있습니다.",variant:"destructive"}),setTimeout(()=>{window.location.href="/"},1e3);return}},[c,j,d]);const{data:$=[],isLoading:_}=H({queryKey:["/api/users"],enabled:!!c&&c.role==="admin",retry:!1}),y=o.useMemo(()=>{if(!$||!Array.isArray($))return[];let r=$;if(b!=="all"&&(r=r.filter(a=>a.role===b)),x.trim()){const a=x.toLowerCase();r=r.filter(N=>N.name?.toLowerCase().includes(a)||N.email?.toLowerCase().includes(a)||N.phoneNumber?.toLowerCase().includes(a))}return m&&(r=[...r].sort((a,N)=>{let l=a[m],i=N[m];return l==null&&(l=""),i==null&&(i=""),m==="createdAt"?(l=l?new Date(l).getTime():0,i=i?new Date(i).getTime():0):(l=String(l).toLowerCase(),i=String(i).toLowerCase()),w==="asc"?l<i?-1:l>i?1:0:i<l?-1:i>l?1:0})),r},[$,b,x,m,w]);K({mutationFn:async({userId:r,role:a})=>{await te("PUT",`/api/users/${r}`,{role:a})},onSuccess:()=>{d({title:"사용자 역할 변경",description:"사용자 역할이 성공적으로 변경되었습니다."}),E.invalidateQueries({queryKey:["/api/users"]})},onError:r=>{if(oe(r)){d({title:"Unauthorized",description:"You are logged out. Logging in again...",variant:"destructive"}),setTimeout(()=>{n("/login")},500);return}d({title:"오류",description:"사용자 역할 변경 중 오류가 발생했습니다.",variant:"destructive"})}});const p=r=>{m===r?L(w==="asc"?"desc":"asc"):(V(r),L("asc"))},v=r=>m!==r?null:w==="asc"?e.jsx(re,{className:"h-4 w-4"}):e.jsx(ae,{className:"h-4 w-4"}),U=r=>{switch(r){case"admin":return"관리자";case"order_manager":return"발주담당자";case"field_worker":return"현장직원";case"project_manager":return"프로젝트매니저";case"hq_management":return"본사관리";case"executive":return"임원";default:return"사용자"}};return j||!c||c.role!=="admin"?e.jsx("div",{children:"Loading..."}):e.jsx("div",{className:`min-h-screen transition-colors ${s?"bg-gray-900":"bg-gray-50"}`,children:e.jsxs("div",{className:"max-w-[1366px] mx-auto p-6 space-y-6",children:[e.jsx("div",{className:`shadow-sm rounded-lg border transition-colors ${s?"bg-gray-800 border-gray-700":"bg-white border-gray-200"}`,children:e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`p-2 rounded-lg transition-colors ${s?"bg-blue-900/20":"bg-blue-50"}`,children:e.jsx(ce,{className:`h-6 w-6 transition-colors ${s?"text-blue-400":"text-blue-600"}`})}),e.jsxs("div",{children:[e.jsx("h1",{className:`text-2xl font-bold transition-colors ${s?"text-white":"text-gray-900"}`,children:"사용자 관리"}),e.jsx("p",{className:`text-sm mt-1 transition-colors ${s?"text-gray-400":"text-gray-600"}`,children:"시스템 사용자를 조회하고 관리하세요"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(f,{variant:"outline",className:`text-sm transition-colors ${s?"border-gray-600 text-gray-300":"border-gray-300 text-gray-700"}`,children:["총 ",y.length,"개"]}),e.jsxs(g,{onClick:()=>n("/users/add"),className:`shadow-md hover:shadow-lg transition-all duration-200 ${s?"bg-blue-600 hover:bg-blue-500 text-white":"bg-blue-600 hover:bg-blue-700 text-white"}`,children:[e.jsx(Y,{className:"h-4 w-4 mr-2"}),"사용자 추가"]})]})]})})}),e.jsx("div",{className:`shadow-sm rounded-lg border transition-colors ${s?"bg-gray-800 border-gray-700":"bg-white border-gray-200"}`,children:e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"flex flex-col xl:flex-row xl:items-end gap-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:`text-sm font-medium block mb-2 transition-colors ${s?"text-gray-300":"text-gray-700"}`,children:"검색"}),e.jsxs("div",{className:"relative",children:[e.jsx(de,{className:`absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 transition-colors ${s?"text-gray-500":"text-gray-400"}`}),e.jsx(J,{placeholder:"사용자명, 이메일, 연락처로 검색...",value:x,onChange:r=>R(r.target.value),className:`pl-10 h-11 text-sm rounded-lg transition-colors ${s?"bg-gray-700 border-gray-600 text-gray-100":"bg-white border-gray-300"} ${x?`${s?"border-blue-400 bg-blue-900/20":"border-blue-500 bg-blue-50"}`:""}`})]})]}),e.jsxs("div",{className:"w-full xl:w-48",children:[e.jsx("label",{className:`text-sm font-medium block mb-2 transition-colors ${s?"text-gray-300":"text-gray-700"}`,children:"역할"}),e.jsxs(O,{value:b,onValueChange:Q,children:[e.jsx(W,{className:`h-11 transition-colors ${s?"bg-gray-700 border-gray-600 text-gray-100":"bg-white border-gray-300"}`,children:e.jsx(X,{placeholder:"역할 선택"})}),e.jsxs(Z,{className:`transition-colors ${s?"bg-gray-700 border-gray-600":"bg-white border-gray-200"}`,children:[e.jsx(h,{value:"all",children:"모든 역할"}),e.jsx(h,{value:"admin",children:"관리자"}),e.jsx(h,{value:"order_manager",children:"발주담당자"}),e.jsx(h,{value:"field_worker",children:"현장직원"}),e.jsx(h,{value:"project_manager",children:"프로젝트매니저"}),e.jsx(h,{value:"hq_management",children:"본사관리"}),e.jsx(h,{value:"executive",children:"임원"})]})]})]}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("div",{className:`flex items-center rounded-lg p-1 transition-colors ${s?"bg-gray-700":"bg-gray-100"}`,children:[e.jsx(g,{variant:S==="table"?"default":"ghost",size:"sm",onClick:()=>A("table"),className:"h-8 w-8 p-0",title:"목록 보기",children:e.jsx(xe,{className:"h-4 w-4"})}),e.jsx(g,{variant:S==="cards"?"default":"ghost",size:"sm",onClick:()=>A("cards"),className:"h-8 w-8 p-0",title:"카드 보기",children:e.jsx(me,{className:"h-4 w-4"})})]})})]})})}),S==="table"?e.jsx("div",{className:`shadow-sm rounded-lg border transition-colors ${s?"bg-gray-800 border-gray-700":"bg-white border-gray-200"}`,children:e.jsx("div",{className:"p-0",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(le,{children:[e.jsx(ie,{children:e.jsxs(C,{className:`border-b transition-colors ${s?"border-gray-600":"border-gray-200"}`,children:[e.jsx(u,{className:`h-11 px-4 text-sm font-semibold cursor-pointer select-none transition-colors ${s?"text-gray-400 hover:bg-gray-700":"text-gray-700 hover:bg-gray-50"}`,onClick:()=>p("name"),children:e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{children:"사용자명"}),v("name")]})}),e.jsx(u,{className:`h-11 px-4 text-sm font-semibold cursor-pointer select-none transition-colors ${s?"text-gray-400 hover:bg-gray-700":"text-gray-700 hover:bg-gray-50"}`,onClick:()=>p("email"),children:e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{children:"이메일"}),v("email")]})}),e.jsx(u,{className:`h-11 px-4 text-sm font-semibold cursor-pointer select-none transition-colors ${s?"text-gray-400 hover:bg-gray-700":"text-gray-700 hover:bg-gray-50"}`,onClick:()=>p("role"),children:e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{children:"역할"}),v("role")]})}),e.jsx(u,{className:`h-11 px-4 text-sm font-semibold cursor-pointer select-none transition-colors ${s?"text-gray-400 hover:bg-gray-700":"text-gray-700 hover:bg-gray-50"}`,onClick:()=>p("phoneNumber"),children:e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{children:"연락처"}),v("phoneNumber")]})}),e.jsx(u,{className:`h-11 px-4 text-sm font-semibold cursor-pointer select-none transition-colors ${s?"text-gray-400 hover:bg-gray-700":"text-gray-700 hover:bg-gray-50"}`,onClick:()=>p("createdAt"),children:e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{children:"가입일"}),v("createdAt")]})}),e.jsx(u,{className:`h-11 px-4 text-sm font-semibold text-right transition-colors ${s?"text-gray-400":"text-gray-700"}`,children:"관리"})]})}),e.jsx(ne,{children:_?[...Array(5)].map((r,a)=>e.jsxs(C,{children:[e.jsx(t,{children:e.jsx("div",{className:`h-4 rounded animate-pulse ${s?"bg-gray-600":"bg-gray-200"}`})}),e.jsx(t,{children:e.jsx("div",{className:`h-4 rounded animate-pulse ${s?"bg-gray-600":"bg-gray-200"}`})}),e.jsx(t,{children:e.jsx("div",{className:`h-4 rounded animate-pulse ${s?"bg-gray-600":"bg-gray-200"}`})}),e.jsx(t,{children:e.jsx("div",{className:`h-4 rounded animate-pulse ${s?"bg-gray-600":"bg-gray-200"}`})}),e.jsx(t,{children:e.jsx("div",{className:`h-4 rounded animate-pulse ${s?"bg-gray-600":"bg-gray-200"}`})}),e.jsx(t,{children:e.jsx("div",{className:`h-4 rounded animate-pulse ${s?"bg-gray-600":"bg-gray-200"}`})})]},a)):y.length===0?e.jsx(C,{children:e.jsx(t,{colSpan:6,className:`text-center py-8 transition-colors ${s?"text-gray-400":"text-gray-500"}`,children:x||b!=="all"?"검색 결과가 없습니다":"등록된 사용자가 없습니다"})}):y.map(r=>e.jsxs(C,{className:`h-12 border-b transition-colors ${s?"hover:bg-gray-700 border-gray-600":"hover:bg-gray-50 border-gray-100"}`,children:[e.jsx(t,{className:"py-2 px-4",children:e.jsx("div",{className:`text-sm font-medium cursor-pointer hover:underline overflow-hidden text-ellipsis whitespace-nowrap transition-colors ${s?"text-blue-400 hover:text-blue-300":"text-blue-600 hover:text-blue-800"}`,onClick:()=>n(`/user-detail/${r.id}`),title:r.name||r.email,children:r.name||r.email})}),e.jsx(t,{className:"py-2 px-4",children:e.jsx("div",{className:`text-sm transition-colors ${s?"text-gray-300":"text-gray-600"}`,children:r.email})}),e.jsx(t,{className:"py-2 px-4",children:e.jsx(f,{variant:r.role==="admin"?"destructive":r.role==="order_manager"?"default":"secondary",className:"text-xs",children:U(r.role)})}),e.jsx(t,{className:"py-2 px-4",children:e.jsx("div",{className:`text-sm transition-colors ${s?"text-gray-300":"text-gray-600"}`,children:r.phoneNumber||"-"})}),e.jsx(t,{className:"py-2 px-4",children:e.jsx("div",{className:`text-sm transition-colors ${s?"text-gray-300":"text-gray-600"}`,children:r.createdAt?D(r.createdAt):"-"})}),e.jsx(t,{className:"py-2 px-4",children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[e.jsx(g,{variant:"ghost",size:"sm",onClick:()=>n(`/user-detail/${r.id}`),className:"h-7 w-7 p-0",title:"수정",children:e.jsx(q,{className:"h-3 w-3"})}),e.jsx(g,{variant:"ghost",size:"sm",onClick:()=>{confirm("정말로 이 사용자를 삭제하시겠습니까?")&&console.log("Delete user:",r.id)},className:`h-7 w-7 p-0 transition-colors ${s?"text-red-400 hover:text-red-300":"text-red-600 hover:text-red-700"}`,title:"삭제",children:e.jsx(z,{className:"h-3 w-3"})})]})})]},r.id))})]})})})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6",children:_?[...Array(6)].map((r,a)=>e.jsx(k,{className:`p-6 shadow-sm transition-colors ${s?"bg-gray-800 border-gray-700":"bg-white border-gray-200"}`,children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:`h-4 rounded mb-3 ${s?"bg-gray-600":"bg-gray-200"}`}),e.jsx("div",{className:`h-3 rounded w-3/4 mb-2 ${s?"bg-gray-600":"bg-gray-200"}`}),e.jsx("div",{className:`h-3 rounded w-1/2 ${s?"bg-gray-600":"bg-gray-200"}`})]})},a)):y.length===0?e.jsx("div",{className:`col-span-full text-center py-8 transition-colors ${s?"text-gray-400":"text-gray-500"}`,children:x||b!=="all"?"검색 결과가 없습니다":"등록된 사용자가 없습니다"}):y.map(r=>e.jsxs(k,{className:`p-4 hover:shadow-md transition-shadow shadow-sm ${s?"bg-gray-800 border-gray-700":"bg-white border-gray-200"}`,children:[e.jsx("div",{className:"flex items-start justify-between mb-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center transition-colors ${s?"bg-blue-900/30":"bg-blue-100"}`,children:e.jsx(ee,{className:`h-4 w-4 transition-colors ${s?"text-blue-400":"text-blue-600"}`})}),e.jsxs("div",{children:[e.jsx("h3",{className:`text-sm font-semibold cursor-pointer transition-colors ${s?"text-gray-100 hover:text-blue-400":"text-gray-900 hover:text-blue-600"}`,onClick:()=>n(`/user-detail/${r.id}`),children:r.name||r.email}),e.jsx(f,{variant:r.role==="admin"?"destructive":r.role==="order_manager"?"default":"secondary",className:"text-xs mt-1",children:U(r.role)})]})]})}),e.jsxs("div",{className:"space-y-2 mb-3",children:[e.jsxs("div",{className:`flex items-center text-sm gap-2 transition-colors ${s?"text-gray-400":"text-gray-600"}`,children:[e.jsx("span",{className:"font-medium",children:"이메일:"}),e.jsx("span",{className:"ml-1 text-xs",children:r.email})]}),r.phoneNumber&&e.jsxs("div",{className:`flex items-center text-sm gap-2 transition-colors ${s?"text-gray-400":"text-gray-600"}`,children:[e.jsx("span",{className:"font-medium",children:"연락처:"}),e.jsx("span",{className:"ml-1 text-xs",children:r.phoneNumber})]})]}),e.jsx("div",{className:`flex items-center justify-between text-xs mb-3 transition-colors ${s?"text-gray-400":"text-gray-500"}`,children:e.jsxs("span",{children:["가입일: ",r.createdAt?D(r.createdAt):"-"]})}),e.jsxs("div",{className:`flex items-center justify-end gap-2 pt-2 border-t transition-colors ${s?"border-gray-600":"border-gray-200"}`,children:[e.jsx(g,{variant:"ghost",size:"sm",onClick:()=>n(`/user-detail/${r.id}`),className:`h-8 w-8 p-0 transition-colors ${s?"text-blue-400 hover:text-blue-300 hover:bg-blue-900/20":"text-blue-600 hover:text-blue-700 hover:bg-blue-50"}`,title:"수정",children:e.jsx(q,{className:"h-3 w-3"})}),e.jsx(g,{variant:"ghost",size:"sm",onClick:()=>{confirm("정말로 이 사용자를 삭제하시겠습니까?")&&console.log("Delete user:",r.id)},className:`h-8 w-8 p-0 transition-colors ${s?"text-red-400 hover:text-red-300 hover:bg-red-900/20":"text-red-600 hover:text-red-700 hover:bg-red-50"}`,title:"삭제",children:e.jsx(z,{className:"h-3 w-3"})})]})]},r.id))}),e.jsx(k,{className:`shadow-sm transition-colors ${s?"bg-gray-800 border-gray-700":"bg-white border-gray-200"}`,children:e.jsxs(se,{className:"p-4",children:[e.jsx("h3",{className:`text-sm font-semibold mb-3 transition-colors ${s?"text-white":"text-gray-900"}`,children:"사용자 역할 안내"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{className:`p-3 rounded-lg border transition-colors ${s?"bg-red-900/20 border-red-800":"bg-red-50 border-red-200"}`,children:[e.jsx("div",{className:"flex items-center space-x-2 mb-2",children:e.jsx(f,{variant:"destructive",className:"text-xs",children:"관리자"})}),e.jsxs("ul",{className:`text-xs space-y-1 transition-colors ${s?"text-gray-300":"text-gray-700"}`,children:[e.jsx("li",{children:"• 모든 발주서 조회 및 승인"}),e.jsx("li",{children:"• 거래처 관리 (추가, 수정, 삭제)"}),e.jsx("li",{children:"• 사용자 권한 관리"}),e.jsx("li",{children:"• 시스템 통계 및 분석"})]})]}),e.jsxs("div",{className:`p-3 rounded-lg border transition-colors ${s?"bg-blue-900/20 border-blue-800":"bg-blue-50 border-blue-200"}`,children:[e.jsx("div",{className:"flex items-center space-x-2 mb-2",children:e.jsx(f,{variant:"default",className:"text-xs",children:"발주담당자"})}),e.jsxs("ul",{className:`text-xs space-y-1 transition-colors ${s?"text-gray-300":"text-gray-700"}`,children:[e.jsx("li",{children:"• 발주서 작성 및 관리"}),e.jsx("li",{children:"• 자신의 발주서만 조회"}),e.jsx("li",{children:"• 거래처 정보 조회"}),e.jsx("li",{children:"• 개인 대시보드 접근"})]})]})]})]})})]})})}export{fe as default};
