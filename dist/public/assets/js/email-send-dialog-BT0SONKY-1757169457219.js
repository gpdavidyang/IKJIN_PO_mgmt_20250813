import{c as V,e as G,r as n,k as J,j as s,J as d,I as v,B as f,n as L,X as k,L as U,F as $}from"./index-DnIyYAML-1757169457219.js";import{D as Z,a as Q,b as Y,c as _,d as O,e as ee}from"./dialog-DAM0aVO2-1757169457219.js";import{T as se}from"./textarea-CVvVLHHn-1757169457219.js";import{A as te,a as ae}from"./alert-CCA9TdIO-1757169457219.js";import{C as le}from"./checkbox-B3pI_cBx-1757169457219.js";import{M as ie}from"./mail-By2n9WIh-1757169457219.js";import{T as ce}from"./triangle-alert--th7wQSC-1757169457219.js";import{S as re}from"./send-Dg7bdAFA-1757169457219.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const I=V("File",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}]]);function ge({open:g,onOpenChange:p,orderData:i,onSendEmail:z}){const{toast:P}=G(),[a,o]=n.useState({to:i.vendorEmail?[i.vendorEmail]:[""],cc:[],subject:`ë°œì£¼ì„œ ì „ì†¡ - ${i.orderNumber}`,message:"",attachPDF:!0,attachExcel:!0,selectedAttachments:[]}),[j,b]=n.useState(!1),[y,x]=n.useState([]),[m,w]=n.useState(""),[h,E]=n.useState(""),[N,C]=n.useState([]),[X,S]=n.useState(!1);n.useEffect(()=>{g&&i.orderId&&M()},[g,i.orderId]);const M=async()=>{if(i.orderId){S(!0);try{console.log("ğŸ“ Fetching attachments for order:",i.orderId);const e=await J("GET",`/api/orders/${i.orderId}`);if(e.attachments&&Array.isArray(e.attachments)){const t=e.attachments.map(l=>({id:l.id,originalName:l.originalName,filePath:l.filePath,fileSize:l.fileSize,mimeType:l.mimeType,isSelected:!1}));C(t);const r=t.filter(l=>l.mimeType?.includes("pdf")||l.originalName?.toLowerCase().endsWith(".pdf")).map(l=>l.id),c=t.filter(l=>l.mimeType?.includes("excel")||l.mimeType?.includes("spreadsheet")||l.originalName?.toLowerCase().endsWith(".xlsx")||l.originalName?.toLowerCase().endsWith(".xls")).map(l=>l.id);o(l=>({...l,attachPDF:r.length>0,attachExcel:c.length>0,selectedAttachments:[...r,...c]})),console.log("ğŸ“ Loaded attachments:",{total:t.length,pdfs:r.length,excels:c.length})}else C([]),console.log("ğŸ“ No attachments found for order:",i.orderId)}catch(e){console.error("âŒ Failed to fetch attachments:",e),P({title:"ì²¨ë¶€íŒŒì¼ ì¡°íšŒ ì‹¤íŒ¨",description:"ì²¨ë¶€íŒŒì¼ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.",variant:"destructive"})}finally{S(!1)}}},u=e=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e),F=()=>{m&&u(m)?a.to.includes(m)||(o(e=>({...e,to:[...e.to.filter(t=>t!==""),m]})),w(""),x(e=>e.filter(t=>!t.includes("ìˆ˜ì‹ ì")))):x(e=>[...e,"ì˜¬ë°”ë¥¸ ì´ë©”ì¼ ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš”."])},A=()=>{h&&u(h)&&(a.cc?.includes(h)||(o(e=>({...e,cc:[...e.cc||[],h]})),E("")))},T=(e,t)=>{o(r=>({...r,[t]:r[t]?.filter(c=>c!==e)||[]}))},W=e=>{o(t=>{const r=t.selectedAttachments||[],l=r.includes(e)?r.filter(H=>H!==e):[...r,e];return{...t,selectedAttachments:l}})},B=e=>{if(!e)return"";const t=e/(1024*1024);return t>1?`${t.toFixed(1)}MB`:`${Math.round(e/1024)}KB`},R=(e,t)=>e?.includes("pdf")||t?.toLowerCase().endsWith(".pdf")?s.jsx($,{className:"h-4 w-4 text-red-500"}):e?.includes("excel")||e?.includes("spreadsheet")||t?.toLowerCase().endsWith(".xlsx")||t?.toLowerCase().endsWith(".xls")?s.jsx(I,{className:"h-4 w-4 text-green-600"}):s.jsx(I,{className:"h-4 w-4 text-gray-500"}),q=()=>{const e=[];return(!a.to.length||a.to.every(c=>!c.trim()))&&e.push("ìµœì†Œ í•˜ë‚˜ì˜ ìˆ˜ì‹ ì ì´ë©”ì¼ì„ ì…ë ¥í•˜ì„¸ìš”."),a.to.filter(c=>c&&!u(c)).length>0&&e.push("ìˆ˜ì‹ ì ì´ë©”ì¼ ì£¼ì†Œê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤."),(a.cc?.filter(c=>c&&!u(c))||[]).length>0&&e.push("ì°¸ì¡° ì´ë©”ì¼ ì£¼ì†Œê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤."),a.subject.trim()||e.push("ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”."),x(e),e.length===0},K=async()=>{if(q()){b(!0);try{console.log("ğŸ“§ Sending email with data:",{to:a.to,cc:a.cc,subject:a.subject,message:a.message,selectedAttachments:a.selectedAttachments,attachPDF:a.attachPDF,attachExcel:a.attachExcel}),await z(a),p(!1)}catch{x(["ì´ë©”ì¼ ë°œì†¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."])}finally{b(!1)}}},D=`ì•ˆë…•í•˜ì„¸ìš”.

${i.vendorName} ë‹´ë‹¹ìë‹˜ê»˜ ë°œì£¼ì„œë¥¼ ì „ì†¡ë“œë¦½ë‹ˆë‹¤.

â–  ë°œì£¼ ì •ë³´
- ë°œì£¼ë²ˆí˜¸: ${i.orderNumber}
- ë°œì£¼ì¼ì: ${i.orderDate}
- í˜„ì¥ëª…: ${i.siteName||"N/A"}
- ë°œì£¼ê¸ˆì•¡: ${i.totalAmount.toLocaleString()}ì›

ì²¨ë¶€ëœ ë°œì£¼ì„œë¥¼ í™•ì¸í•˜ì‹œê³ , ë‚©ê¸°ì¼ì •ì— ë§ì¶° ì§„í–‰ ë¶€íƒë“œë¦½ë‹ˆë‹¤.

ê°ì‚¬í•©ë‹ˆë‹¤.`;return s.jsx(Z,{open:g,onOpenChange:p,children:s.jsxs(Q,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[s.jsxs(Y,{children:[s.jsxs(_,{className:"flex items-center gap-2",children:[s.jsx(ie,{className:"h-5 w-5"}),"ë°œì£¼ì„œ ì´ë©”ì¼ ë°œì†¡"]}),s.jsxs(O,{children:[i.vendorName,"ì—ê²Œ ë°œì£¼ì„œ ",i.orderNumber,"ë¥¼ ì´ë©”ì¼ë¡œ ì „ì†¡í•©ë‹ˆë‹¤."]})]}),s.jsxs("div",{className:"space-y-4",children:[y.length>0&&s.jsxs(te,{variant:"destructive",children:[s.jsx(ce,{className:"h-4 w-4"}),s.jsx(ae,{children:s.jsx("ul",{className:"list-disc list-inside",children:y.map((e,t)=>s.jsx("li",{children:e},t))})})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(d,{htmlFor:"to-email",children:"ìˆ˜ì‹ ì *"}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx(v,{id:"to-email",type:"email",placeholder:"example@company.com",value:m,onChange:e=>w(e.target.value),onKeyPress:e=>e.key==="Enter"&&F()}),s.jsx(f,{type:"button",onClick:F,variant:"outline",size:"sm",children:"ì¶”ê°€"})]}),s.jsx("div",{className:"flex flex-wrap gap-2",children:a.to.filter(e=>e.trim()).map((e,t)=>s.jsxs(L,{variant:"secondary",className:"flex items-center gap-1",children:[e,s.jsx(k,{className:"h-3 w-3 cursor-pointer hover:text-red-500",onClick:()=>T(e,"to")})]},t))})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(d,{htmlFor:"cc-email",children:"ì°¸ì¡° (ì„ íƒ)"}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx(v,{id:"cc-email",type:"email",placeholder:"cc@company.com",value:h,onChange:e=>E(e.target.value),onKeyPress:e=>e.key==="Enter"&&A()}),s.jsx(f,{type:"button",onClick:A,variant:"outline",size:"sm",children:"ì¶”ê°€"})]}),s.jsx("div",{className:"flex flex-wrap gap-2",children:a.cc?.map((e,t)=>s.jsxs(L,{variant:"outline",className:"flex items-center gap-1",children:[e,s.jsx(k,{className:"h-3 w-3 cursor-pointer hover:text-red-500",onClick:()=>T(e,"cc")})]},t))})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(d,{htmlFor:"subject",children:"ì œëª© *"}),s.jsx(v,{id:"subject",value:a.subject,onChange:e=>o(t=>({...t,subject:e.target.value})),placeholder:"ë°œì£¼ì„œ ì „ì†¡ - PO-XXXX-XXX"})]}),s.jsxs("div",{className:"space-y-3",children:[s.jsx(d,{className:"text-base font-medium",children:"ì²¨ë¶€íŒŒì¼"}),X?s.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[s.jsx(U,{className:"h-4 w-4 animate-spin"}),"ì²¨ë¶€íŒŒì¼ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘..."]}):N.length===0?s.jsxs("div",{className:"text-sm text-muted-foreground p-4 border border-dashed rounded-lg text-center",children:[s.jsx($,{className:"h-8 w-8 mx-auto mb-2 text-gray-400"}),"ì´ ë°œì£¼ì„œì— ì²¨ë¶€ëœ íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤."]}):s.jsxs("div",{className:"space-y-2 max-h-64 overflow-y-auto border rounded-lg p-3",children:[s.jsxs("div",{className:"text-xs font-medium text-muted-foreground mb-2",children:["ì´ ",N.length,"ê°œì˜ íŒŒì¼ì´ ì²¨ë¶€ë˜ì–´ ìˆìŠµë‹ˆë‹¤"]}),N.map(e=>{const t=a.selectedAttachments?.includes(e.id)||!1;return s.jsxs("div",{className:`flex items-center space-x-3 p-2 rounded-md hover:bg-gray-50 transition-colors ${t?"bg-blue-50 border border-blue-200":"border border-gray-200"}`,children:[s.jsx(le,{id:`attach-${e.id}`,checked:t,onCheckedChange:()=>W(e.id)}),s.jsxs("div",{className:"flex items-center space-x-2 flex-1 min-w-0",children:[R(e.mimeType,e.originalName),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx(d,{htmlFor:`attach-${e.id}`,className:"text-sm font-medium cursor-pointer block truncate",title:e.originalName,children:e.originalName}),e.fileSize&&s.jsxs("div",{className:"text-xs text-muted-foreground",children:[B(e.fileSize),e.mimeType&&s.jsxs("span",{className:"ml-2",children:["â€¢ ",e.mimeType.split("/")[1]?.toUpperCase()]})]})]})]})]},e.id)}),(a.selectedAttachments?.length||0)>0&&s.jsx("div",{className:"pt-2 border-t border-gray-200",children:s.jsxs("div",{className:"text-xs text-blue-600 font-medium",children:["âœ“ ",a.selectedAttachments?.length,"ê°œ íŒŒì¼ì´ ì„ íƒë˜ì—ˆìŠµë‹ˆë‹¤"]})})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(d,{htmlFor:"message",children:"ë©”ì‹œì§€ (ì„ íƒ)"}),s.jsx("div",{className:"text-xs text-muted-foreground mb-1",children:"ì´ ë©”ì‹œì§€ëŠ” ì´ë©”ì¼ ë³¸ë¬¸ì— í¬í•¨ë˜ì–´ ìˆ˜ì‹ ìì—ê²Œ ì „ë‹¬ë©ë‹ˆë‹¤."}),s.jsx(se,{id:"message",value:a.message||D,onChange:e=>o(t=>({...t,message:e.target.value})),placeholder:"ì¶”ê°€ ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”...",rows:8,className:"resize-none"})]})]}),s.jsxs(ee,{children:[s.jsx(f,{variant:"outline",onClick:()=>p(!1),disabled:j,children:"ì·¨ì†Œ"}),s.jsx(f,{onClick:K,disabled:j,children:j?s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"ë°œì†¡ ì¤‘..."]}):s.jsxs(s.Fragment,{children:[s.jsx(re,{className:"h-4 w-4 mr-2"}),"ì´ë©”ì¼ ë°œì†¡"]})})]})]})})}export{ge as E};
