import{k as c}from"./index-GjFQBII2-1757333712922.js";const i=class i{static async showPdfGenerationFailureDialog(){return new Promise(e=>{const t=window.confirm(`PDF íŒŒì¼ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.

PDF ì—†ì´ ì´ë©”ì¼ì„ ë°œì†¡í•˜ì‹œê² ìŠµë‹ˆê¹Œ?
(Excel íŒŒì¼ê³¼ ê¸°íƒ€ ì²¨ë¶€íŒŒì¼ì€ í¬í•¨ë©ë‹ˆë‹¤)`);e(t)})}static async sendPurchaseOrderEmailOriginalFormat(e,s){try{return{success:!0,messageId:(await c("POST",`${this.BASE_URL}/send-email-original-format`,{filePath:e,...s})).data?.messageId}}catch(t){return console.error("ì›ë³¸ í˜•ì‹ ìœ ì§€ ì´ë©”ì¼ ë°œì†¡ ì˜¤ë¥˜:",t),{success:!1,error:t instanceof Error?t.message:"ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜"}}}static async sendPurchaseOrderEmail(e,s){if(e.filePath){const t={to:s.to,cc:s.cc,subject:s.subject,additionalMessage:s.message,poData:{orderNumber:e.orderNumber,orderDate:e.orderDate,siteName:e.siteName,vendorName:e.vendorName,totalAmount:e.totalAmount}};t.attachments=[],e.attachmentUrls&&e.attachmentUrls.length>0&&(t.attachments=e.attachmentUrls.map((r,o)=>({path:r,filename:`ì²¨ë¶€íŒŒì¼_${e.orderNumber}_${o+1}`})));try{return await c("POST",`${this.BASE_URL}/send-email`,t)}catch(r){throw console.error("Email send error:",r),new Error("ì´ë©”ì¼ ë°œì†¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.")}}try{if(s.customFiles&&s.customFiles.length>0){console.log("ğŸ“ ì‚¬ìš©ì ì—…ë¡œë“œ íŒŒì¼ í¬í•¨:",s.customFiles.length);const t=new FormData;t.append("orderData",JSON.stringify({orderId:e.orderId,orderNumber:e.orderNumber,vendorName:e.vendorName,orderDate:e.orderDate,totalAmount:e.totalAmount,siteName:e.siteName})),t.append("to",JSON.stringify(s.to)),s.cc&&s.cc.length>0&&t.append("cc",JSON.stringify(s.cc)),t.append("subject",s.subject),s.message&&t.append("message",s.message),t.append("selectedAttachmentIds",JSON.stringify(s.selectedAttachmentIds)),e.attachmentUrls&&e.attachmentUrls.length>0&&(t.append("attachmentUrls",JSON.stringify(e.attachmentUrls)),console.log("ğŸ“ ì²¨ë¶€íŒŒì¼ URL ì¶”ê°€:",e.attachmentUrls)),s.customFiles.forEach((n,u)=>{t.append("customFiles",n),console.log(`ğŸ“ ì‚¬ìš©ì íŒŒì¼ ì¶”ê°€: ${n.name} (${n.size} bytes)`)});const r=await fetch("/api/orders/send-email-with-files",{method:"POST",body:t,credentials:"include"});if(!r.ok){const n=await r.json().catch(()=>({}));throw new Error(n.error||`HTTP ${r.status}: ${r.statusText}`)}return{success:!0,messageId:(await r.json()).messageId}}else{const t={orderData:{orderId:e.orderId,orderNumber:e.orderNumber,vendorName:e.vendorName,orderDate:e.orderDate,totalAmount:e.totalAmount,siteName:e.siteName},to:s.to,cc:s.cc,subject:s.subject,message:s.message,selectedAttachmentIds:s.selectedAttachmentIds,attachmentUrls:e.attachmentUrls,emailSettings:{subject:s.subject,message:s.message,cc:s.cc}};return e.attachmentUrls&&e.attachmentUrls.length>0&&console.log("ğŸ“ ì²¨ë¶€íŒŒì¼ URL ì¶”ê°€:",e.attachmentUrls),console.log("ğŸ“§ ì´ë©”ì¼ API ìš”ì²­ ë°ì´í„° (JSON):",t),{success:!0,messageId:(await c("POST","/api/orders/send-email",t)).messageId}}}catch(t){if(console.error("Email send error:",t),t.message?.includes("ì²¨ë¶€í•  íŒŒì¼ì´ ìƒì„±ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤")||t.message?.includes("PDF ìƒì„±"))if(await this.showPdfGenerationFailureDialog()){console.log("ğŸ“§ PDF ì—†ì´ ì´ë©”ì¼ ë°œì†¡ ì¬ì‹œë„");const o={orderData:{orderId:e.orderId,orderNumber:e.orderNumber,vendorName:e.vendorName,orderDate:e.orderDate,totalAmount:e.totalAmount,siteName:e.siteName},to:s.to,cc:s.cc,subject:s.subject,message:s.message,selectedAttachmentIds:s.selectedAttachmentIds,attachmentUrls:e.attachmentUrls,skipPdfGeneration:!0,emailSettings:{subject:s.subject,message:s.message,cc:s.cc}};try{return{success:!0,messageId:(await c("POST","/api/orders/send-email",o)).messageId,warning:"PDF íŒŒì¼ ì—†ì´ ì´ë©”ì¼ì´ ë°œì†¡ë˜ì—ˆìŠµë‹ˆë‹¤."}}catch(n){throw console.error("Email send retry error:",n),new Error("PDF ì—†ì´ ì´ë©”ì¼ ë°œì†¡ì„ ì‹œë„í–ˆìœ¼ë‚˜ ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")}}else throw new Error("PDF ìƒì„± ì‹¤íŒ¨ë¡œ ì´ë©”ì¼ ë°œì†¡ì´ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.");throw new Error("ì´ë©”ì¼ ë°œì†¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.")}}static async testEmailConnection(){try{return await c("GET",`${this.BASE_URL}/test-email`)}catch(e){return console.error("Email connection test error:",e),{success:!1,message:"ì´ë©”ì¼ ì„œë²„ ì—°ê²° í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨"}}}static async extractSheets(e,s=["ê°‘ì§€","ì„ì§€"]){try{return await c("POST",`${this.BASE_URL}/extract-sheets`,{filePath:e,sheets:s})}catch(t){throw console.error("Sheet extraction error:",t),new Error("ì‹œíŠ¸ ì¶”ì¶œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.")}}static async convertToPDF(e,s){try{return await c("POST",`${this.BASE_URL}/convert-to-pdf`,{excelPath:e,sheets:s})}catch(t){throw console.error("PDF conversion error:",t),new Error("PDF ë³€í™˜ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.")}}static async processComplete(e,s){const t=new FormData;t.append("file",e),Object.entries(s).forEach(([r,o])=>{o!==void 0&&(Array.isArray(o)?t.append(r,o.join(",")):t.append(r,o.toString()))});try{return await c("POST",`${this.BASE_URL}/process-complete`,t)}catch(r){throw console.error("Complete process error:",r),new Error("í†µí•© ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.")}}};i.BASE_URL="/api/po-template";let m=i;export{m as E};
