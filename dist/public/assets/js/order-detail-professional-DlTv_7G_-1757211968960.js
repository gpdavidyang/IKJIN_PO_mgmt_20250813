import{d as ee,e as se,u as te,y as ae,r as Q,p as k,q as v,j as e,s as p,t as h,z as re,B as c,F as K,A as ie,b as $,f as u,U as P,D as E,k as y,w as r}from"./index-DSMc0hwj-1757211968960.js";import{d as de,s as le,I as ne,R as ce,A as oe}from"./attached-files-info-xoOQVEl6-1757211968960.js";import{E as me}from"./email-send-dialog-Dz4cIM1e-1757211968960.js";import{A as xe}from"./arrow-left-DjY8tuWE-1757211968960.js";import{S as pe}from"./square-pen-_ro71rQT-1757211968960.js";import{E as he}from"./external-link-BV9BWMzz-1757211968960.js";import{M as F}from"./mail-DYn5OMuD-1757211968960.js";import{D as ge}from"./dollar-sign-CITxebIq-1757211968960.js";import{P as O}from"./package-Cx2B0qFs-1757211968960.js";import{C as ue}from"./calendar-D1sWkh5a-1757211968960.js";import{P as ye}from"./phone-Dp4BhGky-1757211968960.js";import{M as I}from"./map-pin-DPxTJ5mQ-1757211968960.js";import{f as o}from"./format-vTMqd3lv-1757211968960.js";import"./select-BiVFjcIA-1757211968960.js";import"./index-Bm4OQpG7-1757211968960.js";import"./chevron-down-D8pi_gEz-1757211968960.js";import"./chevron-up-BVlf5esw-1757211968960.js";import"./textarea-D5vfdmoU-1757211968960.js";import"./dialog-BZBxfzOI-1757211968960.js";import"./index-DrU2OEM5-1757211968960.js";import"./upload-DmjcF9qn-1757211968960.js";import"./checkbox-BsItWC0H-1757211968960.js";import"./trash-2-DhcRrQkx-1757211968960.js";import"./triangle-alert-CXFNZvv8-1757211968960.js";import"./alert-dialog-DRJXE2A7-1757211968960.js";import"./download-z5H3MLR0-1757211968960.js";import"./info-DLhhc0oO-1757211968960.js";import"./alert-DYKcvEXP-1757211968960.js";import"./send-BPxPsjAz-1757211968960.js";function Je(){const{user:l}=ee(),{toast:d}=se(),[,g]=te(),T=ae(),[L,b]=Q.useState(!1),[je,f]=Q.useState(null),i=parseInt(T.id),{data:s,isLoading:R}=k({queryKey:[`/api/orders/${i}`],queryFn:async()=>{console.log("ðŸ“˜ OrderDetailProfessional - Fetching order:",i);const t=await y("GET",`/api/orders/${i}`);return console.log("ðŸ“˜ OrderDetailProfessional - Order data received:",t),console.log("ðŸ“˜ OrderDetailProfessional - Attachments:",t?.attachments),t}});k({queryKey:["/api/order-statuses"]});const C=v({mutationFn:async()=>{await y("POST",`/api/orders/${i}/approve`)},onSuccess:()=>{d({title:"ë°œì£¼ì„œ ìŠ¹ì¸",description:"ë°œì£¼ì„œê°€ ì„±ê³µì ìœ¼ë¡œ ìŠ¹ì¸ë˜ì—ˆìŠµë‹ˆë‹¤."}),r.invalidateQueries({queryKey:["/api/orders"]}),r.invalidateQueries({queryKey:[`/api/orders/${i}`]}),r.invalidateQueries({queryKey:["orders-optimized"]}),r.invalidateQueries({queryKey:["orders-metadata"]}),r.invalidateQueries({queryKey:["/api/dashboard"]}),r.refetchQueries({queryKey:["orders-optimized"],type:"active",exact:!1})},onError:t=>{d({title:"ìŠ¹ì¸ ì‹¤íŒ¨",description:t.message,variant:"destructive"})}});v({mutationFn:async()=>{await y("POST",`/api/orders/${i}/send`)},onSuccess:()=>{d({title:"ë°œì£¼ì„œ ë°œì†¡",description:"ë°œì£¼ì„œê°€ ì„±ê³µì ìœ¼ë¡œ ë°œì†¡ë˜ì—ˆìŠµë‹ˆë‹¤."}),r.invalidateQueries({queryKey:["/api/orders"]}),r.invalidateQueries({queryKey:[`/api/orders/${i}`]}),r.invalidateQueries({queryKey:["orders-optimized"]}),r.invalidateQueries({queryKey:["orders-metadata"]}),r.invalidateQueries({queryKey:["/api/dashboard"]}),r.refetchQueries({queryKey:["orders-optimized"],type:"active",exact:!1})},onError:t=>{d({title:"ë°œì†¡ ì‹¤íŒ¨",description:t.message,variant:"destructive"})}});const w=v({mutationFn:async()=>await y("POST",`/api/orders/${i}/create-order`),onSuccess:t=>{d({title:"ë°œì£¼ì„œ ìƒì„± ì™„ë£Œ",description:"ë°œì£¼ì„œê°€ ì„±ê³µì ìœ¼ë¡œ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤. PDFê°€ ì²¨ë¶€ë˜ì—ˆìŠµë‹ˆë‹¤."}),r.invalidateQueries({queryKey:["/api/orders"]}),r.invalidateQueries({queryKey:[`/api/orders/${i}`]})},onError:t=>{d({title:"ë°œì£¼ì„œ ìƒì„± ì‹¤íŒ¨",description:t.message||"ë°œì£¼ì„œ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.",variant:"destructive"})}}),D=v({mutationFn:async()=>await y("POST",`/api/orders/${i}/complete-delivery`),onMutate:async()=>{await r.cancelQueries({queryKey:[`/api/orders/${i}`]});const t=r.getQueryData([`/api/orders/${i}`]);return r.setQueryData([`/api/orders/${i}`],a=>({...a,status:"completed",orderStatus:"delivered"})),{previousOrder:t}},onSuccess:t=>{d({title:"ë‚©í’ˆê²€ìˆ˜ì™„ë£Œ",description:"ë°œì£¼ì„œê°€ ë‚©í’ˆì™„ë£Œ ìƒíƒœë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤."}),r.invalidateQueries({queryKey:["/api/orders"]}),r.invalidateQueries({queryKey:[`/api/orders/${i}`]}),r.invalidateQueries({queryKey:["/api/dashboard/unified"]}),r.invalidateQueries({queryKey:["orders-optimized"]}),r.invalidateQueries({queryKey:["orders-metadata"]}),r.invalidateQueries({queryKey:["/api/dashboard"]}),r.refetchQueries({queryKey:["orders-optimized"],type:"active",exact:!1})},onError:(t,a,x)=>{r.setQueryData([`/api/orders/${i}`],x?.previousOrder),d({title:"ë‚©í’ˆê²€ìˆ˜ì™„ë£Œ ì‹¤íŒ¨",description:t.message||"ë‚©í’ˆê²€ìˆ˜ì™„ë£Œ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.",variant:"destructive"})},onSettled:()=>{r.invalidateQueries({queryKey:[`/api/orders/${i}`]})}}),z=t=>{switch(t){case"draft":return"bg-gray-100 text-gray-800 border-gray-200";case"created":return"bg-blue-100 text-blue-800 border-blue-200";case"pending_approval":case"pending":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"approved":return"bg-green-100 text-green-800 border-green-200";case"sent":return"bg-indigo-100 text-indigo-800 border-indigo-200";case"delivered":case"completed":return"bg-purple-100 text-purple-800 border-purple-200";case"rejected":return"bg-red-100 text-red-800 border-red-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},B=t=>({draft:"ìž„ì‹œì €ìž¥",created:"ë°œì£¼ì„œ ìƒì„±ì™„ë£Œ",sent:"ë°œì†¡ì™„ë£Œ",delivered:"ë‚©í’ˆì™„ë£Œ",pending_approval:"ìŠ¹ì¸ëŒ€ê¸°",pending:"ìŠ¹ì¸ëŒ€ê¸°",approved:"ìŠ¹ì¸ì™„ë£Œ",rejected:"ë°˜ë ¤",completed:"ì™„ë£Œ"})[t]||t,W=()=>{confirm("ì´ ë°œì£¼ì„œë¥¼ ìŠ¹ì¸í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")&&C.mutate()},H=()=>{confirm(`ë‚©í’ˆê²€ìˆ˜ë¥¼ ì™„ë£Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?

â€¢ ë°œì£¼ì„œ ìƒíƒœê°€ 'ë‚©í’ˆì™„ë£Œ'ë¡œ ë³€ê²½ë©ë‹ˆë‹¤
â€¢ ì´ ìž‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤
â€¢ ë‚©í’ˆì´ ì™„ì „ížˆ ê²€ìˆ˜ë˜ì—ˆì„ ë•Œë§Œ ì§„í–‰í•˜ì„¸ìš”`)&&D.mutate()},_=async t=>{if(s)try{const a={orderNumber:s.orderNumber,vendorName:s.vendor?.name||s.vendorName||"",orderDate:s.orderDate,totalAmount:s.totalAmount,siteName:s.project?.projectName||s.projectName||"",filePath:s.filePath||""};let x="",N="";if(s.attachments&&s.attachments.length>0){const S=s.attachments.find(n=>n.mimeType?.includes("pdf")||n.originalName?.toLowerCase().endsWith(".pdf"));S&&(x=`/api/attachments/${S.id}/download`,console.log("ðŸ”— Found PDF attachment for email:",x));const M=s.attachments.find(n=>n.mimeType?.includes("excel")||n.mimeType?.includes("spreadsheet")||n.originalName?.toLowerCase().endsWith(".xlsx")||n.originalName?.toLowerCase().endsWith(".xls"));M&&(N=`/api/attachments/${M.id}/download`,console.log("ðŸ”— Found Excel attachment for email:",N))}if(console.log("ðŸ“§ Email attachment info:",{attachPdf:t.attachPDF,attachExcel:t.attachExcel,selectedAttachments:t.selectedAttachments,pdfUrl:x,excelUrl:N,hasAttachments:s.attachments?.length||0}),(await fetch("/api/orders/send-email",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({orderData:a,...t,orderId:s.id,pdfUrl:x,excelUrl:N,selectedAttachments:t.selectedAttachments})})).ok)d({title:"ì´ë©”ì¼ ë°œì†¡ ì™„ë£Œ",description:`${s.vendor?.name||s.vendorName}ì—ê²Œ ë°œì£¼ì„œ ${s.orderNumber}ë¥¼ ì „ì†¡í–ˆìŠµë‹ˆë‹¤.`}),b(!1),f(null);else throw new Error("ì´ë©”ì¼ ë°œì†¡ ì‹¤íŒ¨")}catch(a){d({title:"ì´ë©”ì¼ ë°œì†¡ ì‹¤íŒ¨",description:a instanceof Error?a.message:"ì´ë©”ì¼ ë°œì†¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.",variant:"destructive"})}};if(R)return e.jsx("div",{className:"min-h-screen bg-gray-50",children:e.jsx("div",{className:"max-w-[1366px] mx-auto p-6",children:e.jsxs("div",{className:"animate-pulse space-y-6",children:[e.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/3"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/2"}),e.jsx("div",{className:"grid grid-cols-4 gap-4",children:[...Array(4)].map((t,a)=>e.jsx("div",{className:"h-24 bg-gray-200 rounded-xl"},a))}),e.jsx("div",{className:"h-64 bg-gray-200 rounded-xl"})]})})});if(!s)return e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsx(p,{className:"max-w-md shadow-sm",children:e.jsxs(h,{className:"p-8 text-center",children:[e.jsx(re,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h1",{className:"text-lg font-semibold text-gray-900 mb-2",children:"ë°œì£¼ì„œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤"}),e.jsx("p",{className:"text-sm text-gray-600 mb-6",children:"ìš”ì²­í•˜ì‹  ë°œì£¼ì„œê°€ ì¡´ìž¬í•˜ì§€ ì•Šê±°ë‚˜ ì ‘ê·¼ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤."}),e.jsx(c,{onClick:()=>g("/orders"),className:"bg-blue-600 hover:bg-blue-700",children:"ë°œì£¼ì„œ ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸°"})]})})});const m=s.orderStatus||s.status,A=m==="draft",j=m==="created",q=m==="sent",U=m==="delivered",G=A&&(l?.role==="admin"||s.userId===l?.id),J=j||q||U,V=j&&(l?.role==="admin"||s.userId===l?.id),X=A||j&&(l?.role==="admin"||s.userId===l?.id),Y=l?.role==="admin"&&s.approvalStatus==="pending",Z=(j||q)&&(l?.role==="admin"||s.userId===l?.id);return e.jsx("div",{className:"min-h-screen bg-gray-50",children:e.jsxs("div",{className:"max-w-[1366px] mx-auto p-6",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("button",{onClick:()=>g("/orders"),className:"inline-flex items-center text-sm text-gray-600 hover:text-gray-900 mb-4",children:[e.jsx(xe,{className:"h-4 w-4 mr-1"}),"ë°œì£¼ì„œ ëª©ë¡ìœ¼ë¡œ"]}),e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:s.orderNumber}),e.jsxs("div",{className:"flex items-center gap-4 mt-2",children:[e.jsx("span",{className:`inline-flex items-center px-3 py-1 rounded-full text-xs font-medium border ${z(m)}`,children:B(m)}),A&&e.jsx("span",{className:"text-xs text-amber-600 bg-amber-50 px-2 py-1 rounded",children:"âš ï¸ ìž„ì‹œì €ìž¥ ìƒíƒœ - ë°œì£¼ì„œ ìƒì„± í•„ìš”"}),e.jsxs("p",{className:"text-sm text-gray-500",children:[s.vendor?.name," â€¢ ",s.orderDate?o(new Date(s.orderDate),"yyyyë…„ MMì›” ddì¼"):"ë‚ ì§œ ë¯¸ì •"]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[X&&e.jsxs(c,{variant:"outline",onClick:()=>g(`/orders/${i}/edit`),className:"flex items-center gap-2",children:[e.jsx(pe,{className:"h-4 w-4"}),"ìˆ˜ì •"]}),G&&e.jsxs(c,{onClick:()=>{confirm(`ë°œì£¼ì„œë¥¼ ìƒì„±í•˜ì‹œê² ìŠµë‹ˆê¹Œ?

â€¢ PDF íŒŒì¼ì´ ìžë™ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤
â€¢ ìƒíƒœê°€ 'ìƒì„±ë¨'ìœ¼ë¡œ ë³€ê²½ë©ë‹ˆë‹¤
â€¢ ìƒì„± í›„ PDF ë³´ê¸° ë° ì´ë©”ì¼ ë°œì†¡ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤`)&&w.mutate()},disabled:w.isPending,className:"bg-blue-600 hover:bg-blue-700 text-white flex items-center gap-2",children:[e.jsx(K,{className:"h-4 w-4"}),w.isPending?"ìƒì„± ì¤‘...":"ë°œì£¼ì„œ ìƒì„±"]}),Y&&e.jsxs(c,{onClick:W,disabled:C.isPending,className:"bg-green-600 hover:bg-green-700 text-white flex items-center gap-2",children:[e.jsx(ie,{className:"h-4 w-4"}),"ìŠ¹ì¸"]}),J&&e.jsxs(c,{variant:"outline",onClick:async()=>{const t=s.attachments?.find(a=>a.mimeType?.includes("pdf")||a.originalName?.toLowerCase().endsWith(".pdf"));if(t)try{const a=t.originalName||`ë°œì£¼ì„œ_${s.orderNumber}.pdf`;await de(t.id,a),le(a,d)}catch(a){console.error("PDF download error:",a),d({title:"PDF ë‹¤ìš´ë¡œë“œ ì‹¤íŒ¨",description:a instanceof Error?a.message:"ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.",variant:"destructive"})}else d({title:"PDF íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤",description:"ë°œì£¼ì„œ ìƒì„± ë²„íŠ¼ì„ í´ë¦­í•˜ë©´ PDFê°€ ìžë™ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤."})},className:"flex items-center gap-2",title:"ìƒˆ íƒ­ì—ì„œ PDF ì—´ê¸°",children:[e.jsx(he,{className:"h-4 w-4"}),"PDF ë‹¤ìš´ë¡œë“œ"]}),V&&e.jsxs(c,{variant:"outline",onClick:()=>{f(s),b(!0)},className:"flex items-center gap-2",children:[e.jsx(F,{className:"h-4 w-4"}),"ì´ë©”ì¼ ë°œì†¡"]}),Z&&e.jsxs(c,{onClick:H,disabled:D.isPending,className:"bg-purple-600 hover:bg-purple-700 text-white flex items-center gap-2",children:[e.jsx($,{className:"h-4 w-4"}),D.isPending?"ì²˜ë¦¬ ì¤‘...":"ë‚©í’ˆê²€ìˆ˜ì™„ë£Œ"]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-8",children:[e.jsx("div",{className:"bg-blue-50/30 rounded-xl shadow-sm p-6 border border-blue-200",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"ì´ ë°œì£¼ê¸ˆì•¡"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600 mt-2",children:u(s.totalAmount)})]}),e.jsx("div",{className:"bg-blue-100 p-3 rounded-lg",children:e.jsx(ge,{className:"h-6 w-6 text-blue-600"})})]})}),e.jsx("div",{className:"bg-blue-50/30 rounded-xl shadow-sm p-6 border border-blue-200",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"ë°œì£¼ í’ˆëª©"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900 mt-2",children:[s.items?.length||0,"ê°œ"]})]}),e.jsx("div",{className:"bg-purple-100 p-3 rounded-lg",children:e.jsx(O,{className:"h-6 w-6 text-purple-600"})})]})}),e.jsx("div",{className:"bg-blue-50/30 rounded-xl shadow-sm p-6 border border-blue-200",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"ë‚©ê¸°ì¼"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900 mt-2",children:s.deliveryDate?o(new Date(s.deliveryDate),"MMì›” ddì¼"):"ë¯¸ì •"}),(()=>{const t=s.notes?.split(`
`).find(a=>a.startsWith("ë‚©í’ˆì²˜: "))?.replace("ë‚©í’ˆì²˜: ","").trim();return t?e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["ðŸ“ ",t]}):null})()]}),e.jsx("div",{className:"bg-orange-100 p-3 rounded-lg",children:e.jsx(ue,{className:"h-6 w-6 text-orange-600"})})]})}),e.jsx("div",{className:"bg-blue-50/30 rounded-xl shadow-sm p-6 border border-blue-200",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"ìž‘ì„±ìž"}),e.jsx("p",{className:"text-sm font-medium text-gray-900 mt-2",children:s.user?.firstName&&s.user?.lastName?`${s.user.lastName}${s.user.firstName}`:s.user?.email||"ì•Œ ìˆ˜ ì—†ìŒ"})]}),e.jsx("div",{className:"bg-green-100 p-3 rounded-lg",children:e.jsx(P,{className:"h-6 w-6 text-green-600"})})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8",children:[e.jsx(p,{className:"shadow-sm bg-white border-blue-200",children:e.jsxs(h,{className:"p-6 bg-blue-50/20",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(K,{className:"h-5 w-5 text-gray-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"ë°œì£¼ì„œ ì •ë³´"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"ë°œì£¼ë²ˆí˜¸"}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:s.orderNumber})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"ë°œì£¼ì¼"}),e.jsx("p",{className:"text-sm text-gray-900",children:s.orderDate?o(new Date(s.orderDate),"yyyyë…„ MMì›” ddì¼"):"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"ë‚©ê¸°ì¼"}),e.jsx("p",{className:"text-sm text-gray-900",children:s.deliveryDate?o(new Date(s.deliveryDate),"yyyyë…„ MMì›” ddì¼"):"-"})]}),(()=>{const t=s.notes?.split(`
`).find(a=>a.startsWith("ë‚©í’ˆì²˜: "))?.replace("ë‚©í’ˆì²˜: ","").trim();return t?e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"ë‚©í’ˆìž¥ì†Œ"}),e.jsx("p",{className:"text-sm text-gray-900",children:t})]}):null})(),s.templateId&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"ì‚¬ìš© í…œí”Œë¦¿"}),e.jsxs("p",{className:"text-sm text-gray-900",children:["Template ID: ",s.templateId]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"ìž‘ì„±ì¼ì‹œ"}),e.jsx("p",{className:"text-sm text-gray-900",children:s.createdAt?o(new Date(s.createdAt),"yyyyë…„ MMì›” ddì¼ HH:mm"):"-"})]}),s.updatedAt&&s.updatedAt!==s.createdAt&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"ìµœì¢… ìˆ˜ì •ì¼ì‹œ"}),e.jsx("p",{className:"text-sm text-gray-900",children:o(new Date(s.updatedAt),"yyyyë…„ MMì›” ddì¼ HH:mm")})]})]}),s.notes&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-100",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"ë¹„ê³ "}),e.jsx("div",{className:"p-3 bg-gray-50 rounded-lg text-sm text-gray-700",children:s.notes})]})]})}),s.vendor&&e.jsx(p,{className:"shadow-sm bg-white border-blue-200",children:e.jsxs(h,{className:"p-6 bg-blue-50/20",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(E,{className:"h-5 w-5 text-gray-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"ê±°ëž˜ì²˜ ì •ë³´"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"ì—…ì²´ëª…"}),e.jsx("button",{className:"text-sm font-medium text-blue-600 hover:text-blue-700",onClick:()=>s.vendor?.id&&g(`/vendors/${s.vendor.id}`),children:s.vendor.name})]}),s.vendor.contact&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"ë‹´ë‹¹ìž"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(P,{className:"h-4 w-4 text-gray-400"}),e.jsx("p",{className:"text-sm text-gray-900",children:s.vendor.contact})]})]}),s.vendor.phone&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"ì „í™”ë²ˆí˜¸"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ye,{className:"h-4 w-4 text-gray-400"}),e.jsx("p",{className:"text-sm text-gray-900",children:s.vendor.phone})]})]}),s.vendor.email&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"ì´ë©”ì¼"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(F,{className:"h-4 w-4 text-gray-400"}),e.jsx("p",{className:"text-sm text-gray-900",children:s.vendor.email})]})]}),s.vendor.address&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"ì£¼ì†Œ"}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(I,{className:"h-4 w-4 text-gray-400 mt-0.5"}),e.jsx("p",{className:"text-sm text-gray-900",children:s.vendor.address})]})]})]})]})}),s.project&&e.jsx(p,{className:"shadow-sm bg-white border-blue-200",children:e.jsxs(h,{className:"p-6 bg-blue-50/20",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(E,{className:"h-5 w-5 text-gray-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"í˜„ìž¥ ì •ë³´"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"í˜„ìž¥ëª…"}),e.jsx("button",{className:"text-sm font-medium text-blue-600 hover:text-blue-700",onClick:()=>g(`/projects/${s.project.id}`),children:s.project.projectName}),e.jsxs("p",{className:"text-xs text-gray-500",children:["(",s.project.projectCode,")"]})]}),s.project.projectManager&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"ë‹´ë‹¹ìž"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(P,{className:"h-4 w-4 text-gray-400"}),e.jsx("p",{className:"text-sm text-gray-900",children:s.project.projectManager})]})]}),s.project.location&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"ìœ„ì¹˜"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(I,{className:"h-4 w-4 text-gray-400"}),e.jsx("p",{className:"text-sm text-gray-900",children:s.project.location})]})]}),s.project.description&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"ì„¤ëª…"}),e.jsx("div",{className:"p-3 bg-gray-50 rounded-lg text-sm text-gray-700",children:s.project.description})]})]})]})})]}),(s.approvedBy||s.approvedAt||s.currentApproverRole)&&e.jsx(p,{className:"shadow-sm mb-8 bg-white border-blue-200",children:e.jsxs(h,{className:"p-6 bg-blue-50/20",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx($,{className:"h-5 w-5 text-gray-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"ìŠ¹ì¸ ì •ë³´"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[s.approvedBy&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"ìŠ¹ì¸ìž"}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:s.approvedBy})]}),s.approvedAt&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"ìŠ¹ì¸ì¼ì‹œ"}),e.jsx("p",{className:"text-sm text-gray-900",children:o(new Date(s.approvedAt),"yyyyë…„ MMì›” ddì¼ HH:mm")})]}),s.currentApproverRole&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"í˜„ìž¬ ìŠ¹ì¸ ë‹¨ê³„"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-900",children:s.currentApproverRole==="admin"?"ê´€ë¦¬ìž":s.currentApproverRole==="executive"?"ìž„ì›":s.currentApproverRole==="hq_management"?"ë³¸ë¶€ìž¥":s.currentApproverRole==="project_manager"?"í”„ë¡œì íŠ¸ë§¤ë‹ˆì €":s.currentApproverRole}),s.approvalLevel&&e.jsxs("span",{className:"text-xs text-gray-500",children:["(Level ",s.approvalLevel,")"]})]})]})]})]})}),e.jsx(p,{className:"shadow-sm mb-8 bg-white border-blue-200",children:e.jsxs(h,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(O,{className:"h-5 w-5 text-gray-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"ë°œì£¼ í’ˆëª©"}),e.jsxs("span",{className:"text-sm text-gray-500",children:["ì´ ",s.items?.length||0,"ê°œ í’ˆëª©"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"ì´ ë°œì£¼ê¸ˆì•¡"}),e.jsx("p",{className:"text-lg font-bold text-blue-600",children:u(s.totalAmount)})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-blue-50 border-b border-blue-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"í’ˆëª©ëª…"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"ëŒ€ë¶„ë¥˜"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"ì¤‘ë¶„ë¥˜"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"ì†Œë¶„ë¥˜"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"ê·œê²©"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"ìˆ˜ëŸ‰"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"ë‹¨ìœ„"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"ë‹¨ê°€"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"ê¸ˆì•¡"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"ë¹„ê³ "})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:s.items?.map((t,a)=>e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-4 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm font-medium text-gray-900",children:t.itemName})}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-700",children:t.majorCategory||"-"})}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-700",children:t.middleCategory||"-"})}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-700",children:t.minorCategory||"-"})}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap text-sm text-gray-700",children:t.specification||"-"}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap text-center",children:e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800",children:typeof t.quantity=="number"?t.quantity.toLocaleString():t.quantity||"-"})}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap text-sm text-gray-700",children:t.unit||"EA"}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap text-right text-sm font-medium text-gray-900",children:u(t.unitPrice)}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap text-right",children:e.jsx("span",{className:"text-sm font-semibold text-blue-600",children:u(t.totalAmount)})}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap text-sm text-gray-700",children:t.notes||"-"})]},a))}),e.jsx("tfoot",{className:"bg-blue-50",children:e.jsxs("tr",{children:[e.jsx("td",{colSpan:8,className:"px-4 py-4 text-right text-sm font-medium text-gray-900",children:"ì´ ë°œì£¼ê¸ˆì•¡"}),e.jsx("td",{className:"px-4 py-4 text-right",children:e.jsx("span",{className:"text-lg font-bold text-blue-600",children:u(s.totalAmount)})}),e.jsx("td",{})]})})]})})]})}),e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-6 mb-8",children:[e.jsx("div",{children:e.jsx(ne,{orderId:i})}),s.items&&s.items.length>0&&e.jsx("div",{children:e.jsx(ce,{orderItems:s.items,orderId:i})})]}),s.attachments&&s.attachments.length>0&&e.jsx(oe,{attachments:s.attachments,orderId:i}),s&&e.jsx(me,{open:L,onOpenChange:t=>{b(t),t||f(null)},orderData:{orderNumber:s.orderNumber,vendorName:s.vendor?.name||s.vendorName||"",vendorEmail:s.vendor?.email,orderDate:s.orderDate?new Date(s.orderDate).toLocaleDateString():"",totalAmount:s.totalAmount,siteName:s.project?.projectName||s.projectName||"",orderId:s.id},onSendEmail:_})]})})}export{Je as default};
