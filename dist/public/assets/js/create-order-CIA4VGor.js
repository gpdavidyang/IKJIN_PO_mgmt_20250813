import{r as d,j as e,N as se,V as ue,W as ge,Z as te,O as ie,_ as ae,B as $,b as re,i as X,Y as K,U as pe,s as q,$ as J,I as W,P as je,F as z,a0 as h,H as ne,K as ce,o as G,k as I,c as ve,u as oe,g as fe}from"./index-BJXK4EC8.js";import{OrderForm as Ne}from"./order-form-eoHXuzV8.js";import{A as L,a as V}from"./alert-D59CLjBj.js";import{r as de,u as me}from"./xlsx-ocdEQCFM.js";import{P as ye}from"./progress-B_rhr30D.js";import{C as ee}from"./checkbox-DcefLmYm.js";import{T as be}from"./textarea-C-_oGICr.js";import{D as we,a as Se,b as Ee,c as Ce,e as De}from"./dialog-C7aPrfzR.js";import{M as H}from"./mail-ntkB8NrZ.js";import{U as Pe}from"./users-DpRxEW3r.js";import{P as $e}from"./paperclip-D2ACM-eM.js";import{S as ke}from"./send-Br2XjPrC.js";import{S as xe}from"./save-cdY9c6lT.js";import{C as le}from"./calendar-GFWo7Gdm.js";import{P as he}from"./package-BrPiLKTW.js";import{H as Oe}from"./hash-Cbwdu44F.js";import{T as Fe,a as Te,b as Y,c as Z}from"./tabs-Bt1Rd8pV.js";import{I as Ae}from"./info-DJ-XaMQ7.js";import{D as _e}from"./download-BrX6C9S0.js";import"./select-Eg8tzUEN.js";import"./index-CXakYd-p.js";import"./chevron-down-CPEgYEnV.js";import"./chevron-up-BmR94US2.js";import"./table-9JY3OIqz.js";import"./authUtils-CcDzk6i0.js";import"./trash-2-C_vS9eM1.js";import"./index-C6Z6pKfJ.js";function Re({onDataParsed:v}){const[N,u]=d.useState(!1),[g,i]=d.useState("idle"),[D,f]=d.useState(""),w=d.useRef(null),y=x=>{if(!x)return;u(!0),i("idle");const m=new FileReader;m.onload=r=>{try{const b=new Uint8Array(r.target?.result),T=de(b,{type:"array"}),k=T.SheetNames[0],A=T.Sheets[k],C=me.sheet_to_json(A,{header:1});if(C.length<2)throw new Error("Excel íŒŒì¼ì— ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.");const O=C.slice(1).filter(P=>P&&P.some(_=>_));if(O.length===0)throw new Error("ìœ íš¨í•œ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.");i("success"),f(`${O.length}ê°œì˜ í–‰ì„ ì„±ê³µì ìœ¼ë¡œ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤.`),v(O)}catch(b){i("error"),f(b instanceof Error?b.message:"íŒŒì¼ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.")}finally{u(!1)}},m.onerror=()=>{u(!1),i("error"),f("íŒŒì¼ì„ ì½ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.")},m.readAsArrayBuffer(x)},j=x=>{const m=x.target.files?.[0];m&&y(m)},E=()=>{w.current?.click()};return e.jsxs(se,{className:"w-full",children:[e.jsx(ue,{children:e.jsxs(ge,{className:"flex items-center gap-2",children:[e.jsx(te,{className:"h-5 w-5"}),"Excel íŒŒì¼ ì—…ë¡œë“œ (ì‹¤í—˜ ê¸°ëŠ¥)"]})}),e.jsx(ie,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"border-2 border-dashed rounded-lg p-6 text-center border-gray-300 hover:border-gray-400",children:[e.jsx("input",{ref:w,type:"file",accept:".xlsx,.xlsm,.xls,.csv",onChange:j,className:"hidden"}),e.jsx(ae,{className:"h-8 w-8 text-gray-400 mx-auto mb-3"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"font-medium text-gray-700",children:"Excel íŒŒì¼ì„ ì—…ë¡œë“œí•˜ì—¬ í’ˆëª© ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°"}),e.jsx("p",{className:"text-sm text-gray-500",children:".xlsx, .xlsm, .xls, .csv íŒŒì¼ì„ ì§€ì›í•©ë‹ˆë‹¤"})]}),e.jsx($,{onClick:E,disabled:N,className:"mt-3",variant:"outline",children:N?"ì²˜ë¦¬ ì¤‘...":"íŒŒì¼ ì„ íƒ"})]}),g==="success"&&e.jsxs(L,{children:[e.jsx(re,{className:"h-4 w-4"}),e.jsx(V,{children:D})]}),g==="error"&&e.jsxs(L,{variant:"destructive",children:[e.jsx(X,{className:"h-4 w-4"}),e.jsx(V,{children:D})]}),e.jsxs(L,{children:[e.jsx(X,{className:"h-4 w-4"}),e.jsxs(V,{children:[e.jsx("strong",{children:"ì°¸ê³ :"})," ì²« ë²ˆì§¸ í–‰ì€ í—¤ë”ë¡œ ì²˜ë¦¬ë˜ë©°, ë‘ ë²ˆì§¸ í–‰ë¶€í„° ë°ì´í„°ë¡œ ì¸ì‹ë©ë‹ˆë‹¤. í’ˆëª©ëª…, ìˆ˜ëŸ‰, ë‹¨ê°€ ë“±ì˜ ì •ë³´ê°€ í¬í•¨ëœ Excel íŒŒì¼ì„ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”."]})]})]})})]})}function Be({isOpen:v,onClose:N,onSend:u,orderData:g,initialTo:i=[],initialCc:D=[]}){const[f,w]=d.useState(i),[y,j]=d.useState(D),[E,x]=d.useState(`ë°œì£¼ì„œ: ${g?.projectName||""} - ${g?.vendorName||""}`),[m,r]=d.useState(`ì•ˆë…•í•˜ì„¸ìš”.

${g?.projectName||"[í”„ë¡œì íŠ¸ëª…]"} ê´€ë ¨ ë°œì£¼ì„œë¥¼ ì†¡ë¶€ë“œë¦½ë‹ˆë‹¤.

ë°œì£¼ ë‚´ì—­:
- ê±°ëž˜ì²˜: ${g?.vendorName||"[ê±°ëž˜ì²˜ëª…]"}
- ë‚©ê¸°ì¼: ${g?.deliveryDate||"[ë‚©ê¸°ì¼]"}
- í’ˆëª©: ${g?.items?.[0]?.itemName||"[í’ˆëª©ëª…]"}
- ìˆ˜ëŸ‰: ${g?.items?.[0]?.quantity||"[ìˆ˜ëŸ‰]"}
- ê¸ˆì•¡: ${((g?.items?.[0]?.quantity||0)*(g?.items?.[0]?.unitPrice||0)).toLocaleString()}ì›

ì²¨ë¶€ëœ ë°œì£¼ì„œë¥¼ í™•ì¸í•˜ì‹œê³  ë¬¸ì˜ì‚¬í•­ì´ ìžˆìœ¼ì‹œë©´ ì—°ë½ ë¶€íƒë“œë¦½ë‹ˆë‹¤.

ê°ì‚¬í•©ë‹ˆë‹¤.`),[b,T]=d.useState(!0),[k,A]=d.useState(!1),[C,B]=d.useState(""),[O,P]=d.useState(""),[_,U]=d.useState("to"),p=()=>{if(!C){h({title:"ì´ë©”ì¼ ì£¼ì†Œë¥¼ ìž…ë ¥í•˜ì„¸ìš”",variant:"destructive"});return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(C)){h({title:"ì˜¬ë°”ë¥¸ ì´ë©”ì¼ í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤",variant:"destructive"});return}const t={email:C,name:O||void 0};if(_==="to"){if(f.some(l=>l.email===C)){h({title:"ì´ë¯¸ ì¶”ê°€ëœ ìˆ˜ì‹ ìžìž…ë‹ˆë‹¤",variant:"destructive"});return}w([...f,t])}else{if(y.some(l=>l.email===C)){h({title:"ì´ë¯¸ ì¶”ê°€ëœ ì°¸ì¡°ìžìž…ë‹ˆë‹¤",variant:"destructive"});return}j([...y,t])}B(""),P("")},a=(s,t)=>{t==="to"?w(f.filter(l=>l.email!==s)):j(y.filter(l=>l.email!==s))},o=()=>{if(f.length===0){h({title:"ìˆ˜ì‹ ìžë¥¼ ì¶”ê°€í•´ì£¼ì„¸ìš”",variant:"destructive"});return}if(!E.trim()){h({title:"ì œëª©ì„ ìž…ë ¥í•´ì£¼ì„¸ìš”",variant:"destructive"});return}if(!m.trim()){h({title:"ë‚´ìš©ì„ ìž…ë ¥í•´ì£¼ì„¸ìš”",variant:"destructive"});return}u({to:f,cc:y,subject:E,body:m,attachPdf:b,attachExcel:k})};return e.jsx(we,{open:v,onOpenChange:N,children:e.jsxs(Se,{className:"max-w-3xl max-h-[90vh] overflow-y-auto",children:[e.jsx(Ee,{children:e.jsxs(Ce,{className:"flex items-center gap-2",children:[e.jsx(H,{className:"h-5 w-5"}),"ì´ë©”ì¼ ìž‘ì„±"]})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{children:[e.jsxs(K,{className:"flex items-center gap-2 mb-2",children:[e.jsx(pe,{className:"h-4 w-4"}),"ìˆ˜ì‹ ìž (To)"]}),e.jsxs("div",{className:"flex flex-wrap gap-2 mb-2",children:[f.map(s=>e.jsxs(q,{variant:"secondary",className:"px-2 py-1",children:[s.name&&`${s.name} `,"<",s.email,">",e.jsx("button",{onClick:()=>a(s.email,"to"),className:"ml-2 hover:text-red-600",children:e.jsx(J,{className:"h-3 w-3"})})]},s.email)),f.length===0&&e.jsx("span",{className:"text-sm text-gray-500",children:"ìˆ˜ì‹ ìžë¥¼ ì¶”ê°€í•´ì£¼ì„¸ìš”"})]})]}),e.jsxs("div",{children:[e.jsxs(K,{className:"flex items-center gap-2 mb-2",children:[e.jsx(Pe,{className:"h-4 w-4"}),"ì°¸ì¡° (CC)"]}),e.jsxs("div",{className:"flex flex-wrap gap-2 mb-2",children:[y.map(s=>e.jsxs(q,{variant:"outline",className:"px-2 py-1",children:[s.name&&`${s.name} `,"<",s.email,">",e.jsx("button",{onClick:()=>a(s.email,"cc"),className:"ml-2 hover:text-red-600",children:e.jsx(J,{className:"h-3 w-3"})})]},s.email)),y.length===0&&e.jsx("span",{className:"text-sm text-gray-500",children:"ì°¸ì¡°ìž ì—†ìŒ (ì„ íƒì‚¬í•­)"})]})]}),e.jsx("div",{className:"border rounded-lg p-3 bg-gray-50",children:e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsx("div",{className:"flex-1",children:e.jsx(W,{placeholder:"ì´ë¦„ (ì„ íƒì‚¬í•­)",value:O,onChange:s=>P(s.target.value)})}),e.jsx("div",{className:"flex-1",children:e.jsx(W,{placeholder:"ì´ë©”ì¼ ì£¼ì†Œ",type:"email",value:C,onChange:s=>B(s.target.value),onKeyPress:s=>s.key==="Enter"&&p()})}),e.jsxs("select",{className:"px-3 py-2 border rounded-md",value:_,onChange:s=>U(s.target.value),children:[e.jsx("option",{value:"to",children:"ìˆ˜ì‹ ìž"}),e.jsx("option",{value:"cc",children:"ì°¸ì¡°"})]}),e.jsxs($,{type:"button",onClick:p,size:"sm",children:[e.jsx(je,{className:"h-4 w-4 mr-1"}),"ì¶”ê°€"]})]})}),e.jsxs("div",{children:[e.jsx(K,{htmlFor:"subject",children:"ì œëª©"}),e.jsx(W,{id:"subject",value:E,onChange:s=>x(s.target.value),placeholder:"ì´ë©”ì¼ ì œëª©ì„ ìž…ë ¥í•˜ì„¸ìš”",className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(K,{htmlFor:"body",children:"ë‚´ìš©"}),e.jsx(be,{id:"body",value:m,onChange:s=>r(s.target.value),placeholder:"ì´ë©”ì¼ ë‚´ìš©ì„ ìž…ë ¥í•˜ì„¸ìš”",className:"mt-1 min-h-[200px]"})]}),e.jsxs("div",{children:[e.jsxs(K,{className:"flex items-center gap-2 mb-2",children:[e.jsx($e,{className:"h-4 w-4"}),"ì²¨ë¶€íŒŒì¼"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ee,{id:"attach-pdf",checked:b,onCheckedChange:s=>T(s)}),e.jsxs("label",{htmlFor:"attach-pdf",className:"flex items-center gap-2 text-sm cursor-pointer",children:[e.jsx(z,{className:"h-4 w-4 text-red-600"}),"ë°œì£¼ì„œ PDF ì²¨ë¶€"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ee,{id:"attach-excel",checked:k,onCheckedChange:s=>A(s)}),e.jsxs("label",{htmlFor:"attach-excel",className:"flex items-center gap-2 text-sm cursor-pointer",children:[e.jsx(z,{className:"h-4 w-4 text-green-600"}),"ì›ë³¸ ì—‘ì…€ íŒŒì¼ ì²¨ë¶€"]})]})]})]})]}),e.jsxs(De,{children:[e.jsx($,{variant:"outline",onClick:N,children:"ì·¨ì†Œ"}),e.jsxs($,{onClick:o,className:"bg-blue-600 hover:bg-blue-700",children:[e.jsx(ke,{className:"h-4 w-4 mr-2"}),"ì´ë©”ì¼ ë°œì†¡"]})]})]})})}function Le({orders:v,onOrderUpdate:N,onOrderRemove:u,onSingleOrderSave:g,file:i}){const[D,f]=d.useState(null),[w,y]=d.useState(""),[j,E]=d.useState(v.reduce((s,t,l)=>({...s,[l]:!0}),{})),[x,m]=d.useState(null),[r,b]=d.useState(null),[T,k]=d.useState(!1),A=ne({mutationFn:async({order:s,sendEmail:t,index:l,isDraft:F=!1})=>{const c=new FormData;i&&c.append("excelFile",i),c.append("orders",JSON.stringify([s])),c.append("sendEmail",t.toString()),c.append("isDraft",F.toString());const S=await fetch("/api/orders/bulk-create-simple",{method:"POST",credentials:"include",body:c});if(!S.ok){const n=await S.text();throw new Error(n||"Failed to save order")}return S.json()},onSuccess:async(s,t)=>{await ce.invalidateQueries({predicate:l=>l.queryKey.some(c=>typeof c=="string"&&(c.includes("orders")||c.includes("/api/orders")))}),t.isDraft?(h({title:"ìž„ì‹œì €ìž¥ ì™„ë£Œ",description:"ë°œì£¼ì„œê°€ ìž„ì‹œì €ìž¥ë˜ì—ˆìŠµë‹ˆë‹¤. ë°œì£¼ì„œ ê´€ë¦¬ í™”ë©´ì—ì„œ í™•ì¸ ë° ìˆ˜ì •í•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤."}),u(t.index)):t.sendEmail?(b({...s,originalOrder:t.order,originalIndex:t.index}),k(!0),h({title:"ë°œì£¼ì„œ ìƒì„± ì™„ë£Œ",description:"ë°œì£¼ì„œê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤. ì´ë©”ì¼ì„ ìž‘ì„±í•´ì£¼ì„¸ìš”."})):(h({title:"ë°œì£¼ì„œ ìƒì„± ì™„ë£Œ",description:"ë°œì£¼ì„œê°€ ì„±ê³µì ìœ¼ë¡œ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤. ìƒì„±ëœ ë°œì£¼ì„œëŠ” ë°œì£¼ì„œ ê´€ë¦¬ í™”ë©´ì—ì„œ í™•ì¸í•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤."}),u(t.index))},onError:s=>{h({title:"ë°œì£¼ì„œ ìƒì„± ì‹¤íŒ¨",description:s.message||"ë°œì£¼ì„œ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.",variant:"destructive"})},onSettled:()=>{m(null)}}),C=(s,t)=>{f(s),y(t||"")},B=s=>{g?g(s,j[s]):(m(s),A.mutate({order:v[s],sendEmail:j[s],index:s}))},O=s=>{m(s),A.mutate({order:v[s],sendEmail:!1,index:s,isDraft:!0})},P=(s,t)=>{E(l=>({...l,[s]:t}))},_=(s,t,l)=>{const c={...v[s]};if(t.startsWith("item.")){const[,S]=t.split("."),n=c.items[0]||{};["quantity","unitPrice"].includes(S)?(n[S]=parseFloat(l)||0,n.quantity&&n.unitPrice&&(n.totalAmount=n.quantity*n.unitPrice)):n[S]=l,c.items=[n]}else c[t]=l;c.errors=[],c.vendorName||c.errors.push("ê±°ëž˜ì²˜ëª… í•„ìˆ˜"),c.vendorEmail||c.errors.push("ì´ë©”ì¼ í•„ìˆ˜"),c.projectName||c.errors.push("í”„ë¡œì íŠ¸ í•„ìˆ˜"),c.isValid=c.errors.length===0,N(s,c),f(null)},U=(s,t,l)=>{s.key==="Enter"?(s.preventDefault(),_(t,l,w)):s.key==="Escape"&&f(null)},p=({cellId:s,value:t,orderIndex:l,field:F,type:c="text",icon:S,label:n,className:M=""})=>D===s?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-xs text-gray-500 w-20",children:[n,":"]}),e.jsx(W,{type:c,value:w,onChange:R=>y(R.target.value),onKeyDown:R=>U(R,l,F),onBlur:()=>_(l,F,w),className:G("h-7 px-2 py-0 text-xs flex-1",M),autoFocus:!0})]}):e.jsxs("div",{className:"flex items-center gap-2 p-1 rounded cursor-pointer hover:bg-gray-50 group",onClick:()=>C(s,t),children:[S&&e.jsx("div",{className:"text-gray-400 w-4",children:S}),e.jsxs("span",{className:"text-xs text-gray-500 min-w-[80px]",children:[n,":"]}),e.jsx("span",{className:G("text-xs flex-1",!t&&"text-gray-400 italic"),children:t||"ìž…ë ¥"})]}),a=async s=>{try{const t=await fetch("/api/orders/send-email-simple",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({to:s.to,cc:s.cc,subject:s.subject,body:s.body,orderData:{orderId:r?.orderId||r?.orderIds?.[0],orderNumber:r?.orderNumber,projectName:r?.projectName,vendorName:r?.vendorName,location:r?.location,orderDate:r?.orderDate,deliveryDate:r?.deliveryDate,totalAmount:r?.totalAmount,excelFilePath:r?.excelFilePath},attachPdf:s.attachPdf,attachExcel:s.attachExcel})}),l=await t.json();t.ok?l.message&&l.message.includes("ê°œë°œ ëª¨ë“œ")?h({title:"ì´ë©”ì¼ í…ŒìŠ¤íŠ¸ ëª¨ë“œ",description:"SMTP ì„¤ì •ì´ ì—†ì–´ ì‹¤ì œ ì´ë©”ì¼ì€ ë°œì†¡ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ë°œì£¼ì„œëŠ” ì •ìƒì ìœ¼ë¡œ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.",variant:"default"}):h({title:"ì´ë©”ì¼ ë°œì†¡ ì™„ë£Œ",description:"ë°œì£¼ì„œì™€ ì´ë©”ì¼ì´ ì„±ê³µì ìœ¼ë¡œ ë°œì†¡ë˜ì—ˆìŠµë‹ˆë‹¤."}):h({title:"ì´ë©”ì¼ ë°œì†¡ ì‹¤íŒ¨",description:l.error||"ì´ë©”ì¼ì€ ë°œì†¡ë˜ì§€ ì•Šì•˜ì§€ë§Œ ë°œì£¼ì„œëŠ” ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.",variant:"destructive"}),r?.originalIndex!==void 0&&u(r.originalIndex)}catch(t){console.error("ì´ë©”ì¼ ë°œì†¡ ì˜¤ë¥˜:",t),h({title:"ì´ë©”ì¼ ë°œì†¡ ì‹¤íŒ¨",description:"ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë°œì£¼ì„œëŠ” ì •ìƒì ìœ¼ë¡œ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.",variant:"destructive"}),r?.originalIndex!==void 0&&u(r.originalIndex)}finally{k(!1),b(null)}},o=()=>{k(!1),r?.originalIndex!==void 0&&u(r.originalIndex),b(null)};return e.jsxs("div",{className:"space-y-4",children:[v.map((s,t)=>{const l=v[t].items[0]||{},F=(l.quantity||0)*(l.unitPrice||0);return e.jsxs(se,{className:G("p-4 relative",s.isValid===!1&&"border-red-300 bg-red-50/30"),children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(q,{variant:"outline",className:"text-xs",children:["#",t+1]}),e.jsx(q,{variant:s.isValid?"default":"destructive",className:"text-xs h-5",children:s.isValid?e.jsxs(e.Fragment,{children:[e.jsx(re,{className:"h-3 w-3 mr-1"}),"ìœ íš¨"]}):e.jsxs(e.Fragment,{children:[e.jsx(X,{className:"h-3 w-3 mr-1"}),"ê²€ì¦ í•„ìš”"]})}),s.errors&&s.errors.length>0&&e.jsxs("span",{className:"text-xs text-red-600",children:["(",s.errors.join(", "),")"]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ee,{id:`email-${t}`,checked:j[t],onCheckedChange:c=>P(t,c),disabled:x===t}),e.jsxs("label",{htmlFor:`email-${t}`,className:"text-xs text-gray-600 cursor-pointer",children:[e.jsx(H,{className:"h-3 w-3 inline mr-1"}),"ì´ë©”ì¼ ë°œì†¡"]})]}),e.jsxs($,{onClick:()=>B(t),disabled:!s.isValid||x===t,size:"sm",className:"bg-blue-600 hover:bg-blue-700 text-xs",children:[e.jsx(z,{className:"h-3 w-3 mr-1"}),x===t?"ìƒì„± ì¤‘...":"ë°œì£¼ì„œ ìƒì„±"]}),e.jsxs($,{onClick:()=>O(t),disabled:!s.isValid||x===t,size:"sm",variant:"outline",className:"text-xs",children:[e.jsx(xe,{className:"h-3 w-3 mr-1"}),x===t?"ì €ìž¥ ì¤‘...":"ìž„ì‹œì €ìž¥"]}),e.jsx($,{variant:"ghost",size:"icon",className:"h-6 w-6 text-gray-400 hover:text-red-600",onClick:()=>u(t),children:e.jsx(J,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 mb-3",children:[e.jsx(p,{cellId:`${t}-orderDate`,value:s.orderDate,orderIndex:t,field:"orderDate",label:"ë°œì£¼ì¼ìž",icon:e.jsx(le,{className:"h-3 w-3"})}),e.jsx(p,{cellId:`${t}-deliveryDate`,value:s.deliveryDate,orderIndex:t,field:"deliveryDate",label:"ë‚©ê¸°ì¼ìž",icon:e.jsx(le,{className:"h-3 w-3"})}),e.jsx(p,{cellId:`${t}-vendor`,value:s.vendorName,orderIndex:t,field:"vendorName",label:"ê±°ëž˜ì²˜ëª…",icon:e.jsx(I,{className:"h-3 w-3"})}),e.jsx(p,{cellId:`${t}-vendorEmail`,value:s.vendorEmail,orderIndex:t,field:"vendorEmail",label:"ê±°ëž˜ì²˜ ì´ë©”ì¼",type:"email",icon:e.jsx(H,{className:"h-3 w-3"})})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 mb-3",children:[e.jsx(p,{cellId:`${t}-deliveryPlace`,value:s.deliveryPlace,orderIndex:t,field:"deliveryPlace",label:"ë‚©í’ˆì²˜ëª…",icon:e.jsx(I,{className:"h-3 w-3"})}),e.jsx(p,{cellId:`${t}-deliveryEmail`,value:s.deliveryEmail,orderIndex:t,field:"deliveryEmail",label:"ë‚©í’ˆì²˜ ì´ë©”ì¼",type:"email",icon:e.jsx(H,{className:"h-3 w-3"})}),e.jsx(p,{cellId:`${t}-project`,value:s.projectName,orderIndex:t,field:"projectName",label:"í”„ë¡œì íŠ¸ëª…",icon:e.jsx(I,{className:"h-3 w-3"})})]}),e.jsx("div",{className:"border-t pt-3",children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-6 gap-3",children:[e.jsx(p,{cellId:`${t}-itemName`,value:l.itemName,orderIndex:t,field:"item.itemName",label:"í’ˆëª©ëª…",icon:e.jsx(he,{className:"h-3 w-3"})}),e.jsx(p,{cellId:`${t}-spec`,value:l.specification,orderIndex:t,field:"item.specification",label:"ê·œê²©"}),e.jsx(p,{cellId:`${t}-qty`,value:l.quantity,orderIndex:t,field:"item.quantity",label:"ìˆ˜ëŸ‰",type:"number",icon:e.jsx(Oe,{className:"h-3 w-3"})}),e.jsx(p,{cellId:`${t}-price`,value:l.unitPrice,orderIndex:t,field:"item.unitPrice",label:"ë‹¨ê°€",type:"number"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-gray-500",children:"ì´ê¸ˆì•¡:"}),e.jsxs("span",{className:"text-sm font-medium",children:[F.toLocaleString(),"ì›"]})]}),e.jsx(p,{cellId:`${t}-remarks`,value:l.remarks,orderIndex:t,field:"item.remarks",label:"ë¹„ê³ "})]})}),e.jsx("div",{className:"mt-3 pt-3 border-t",children:e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsx(p,{cellId:`${t}-majorCategory`,label:"ëŒ€ë¶„ë¥˜",value:s.majorCategory||"",orderIndex:t,field:"majorCategory",className:"h-7"}),e.jsx(p,{cellId:`${t}-middleCategory`,label:"ì¤‘ë¶„ë¥˜",value:s.middleCategory||"",orderIndex:t,field:"middleCategory",className:"h-7"}),e.jsx(p,{cellId:`${t}-minorCategory`,label:"ì†Œë¶„ë¥˜",value:s.minorCategory||"",orderIndex:t,field:"minorCategory",className:"h-7"})]})})]},t)}),v.length===0&&e.jsx("div",{className:"text-center py-12 text-gray-500",children:"ì—…ë¡œë“œëœ ë°œì£¼ì„œê°€ ì—†ìŠµë‹ˆë‹¤."}),T&&r&&e.jsx(Be,{isOpen:T,onClose:o,onSend:a,orderData:r?.originalOrder||r,initialTo:[{email:r?.originalOrder?.vendorEmail||"",name:r?.originalOrder?.vendorName||""}],initialCc:r?.originalOrder?.deliveryEmail?[{email:r?.originalOrder?.deliveryEmail,name:r?.originalOrder?.deliveryPlace||""}]:[]})]})}function Ve(){ve();const[,v]=oe(),N=d.useRef(null),[u,g]=d.useState(null),[i,D]=d.useState(!1),[f,w]=d.useState([]),[y,j]=d.useState(!1),[E,x]=d.useState(0),[m,r]=d.useState([]),b=a=>{a.preventDefault(),a.stopPropagation(),a.type==="dragenter"||a.type==="dragover"?D(!0):a.type==="dragleave"&&D(!1)},T=a=>{if(a.preventDefault(),a.stopPropagation(),D(!1),a.dataTransfer.files&&a.dataTransfer.files[0]){const o=a.dataTransfer.files[0];A(o)}},k=a=>{a.target.files&&a.target.files[0]&&A(a.target.files[0])},A=a=>{const o=a.name.toLowerCase();if(!o.endsWith(".xlsx")&&!o.endsWith(".xls")&&!o.endsWith(".xlsm")){h({title:"íŒŒì¼ í˜•ì‹ ì˜¤ë¥˜",description:"ì—‘ì…€ íŒŒì¼(.xlsx, .xls, .xlsm)ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.",variant:"destructive"});return}g(a),C(a)},C=async a=>{j(!0),x(20);try{const o=await a.arrayBuffer();x(40);const s=de(o,{type:"array"});x(60);const t=s.SheetNames[0],l=s.Sheets[t],F=me.sheet_to_json(l,{header:1});x(80);const S=F.slice(1).filter(n=>n&&n.some(M=>M)).map((n,M)=>{const Q=R=>R?typeof R=="number"?new Date((R-25569)*86400*1e3).toISOString().split("T")[0]:R.toString().trim():"";return{rowIndex:M+2,orderDate:Q(n[0]),deliveryDate:Q(n[1]),vendorName:n[2]?.toString().trim(),vendorEmail:n[3]?.toString().trim(),deliveryPlace:n[4]?.toString().trim(),deliveryEmail:n[5]?.toString().trim(),projectName:n[6]?.toString().trim(),majorCategory:n[7]?.toString().trim(),middleCategory:n[8]?.toString().trim(),minorCategory:n[9]?.toString().trim(),items:[{itemName:n[10]?.toString().trim(),specification:n[11]?.toString().trim(),quantity:parseFloat(n[12])||0,unitPrice:parseFloat(n[13])||0,totalAmount:parseFloat(n[14])||0,remarks:n[15]?.toString().trim()}],isValid:!0,errors:[]}});w(S),r(S),x(100),h({title:"ì—‘ì…€ íŒŒì¼ ë¡œë”© ì™„ë£Œ",description:`ë°œì£¼ì„œ ìƒì„±ì„ ìœ„í•´ ${S.length}ê°œì˜ ë°ì´í„°ê°€ ì„±ê³µì ìœ¼ë¡œ ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤. ê° í•­ëª©ì„ í™•ì¸í•˜ê³  ìˆ˜ì •í•œ í›„ 'ëª¨ë‘ ì €ìž¥' ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.`})}catch(o){console.error("Excel parsing error:",o),h({title:"íŒŒì¼ íŒŒì‹± ì‹¤íŒ¨",description:"ì—‘ì…€ íŒŒì¼ì„ ì½ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.",variant:"destructive"})}finally{j(!1),setTimeout(()=>x(0),1e3)}},B=(a,o)=>{const s=[...m];s[a]=o,r(s)},O=a=>{const o=m.filter((s,t)=>t!==a);r(o),h({title:"ë°œì£¼ì„œ ìƒì„± ì™„ë£Œ",description:"ì„±ê³µì ìœ¼ë¡œ ë°œì£¼ì„œê°€ ìƒì„±ë˜ì–´ ìž‘ì„± ëª©ë¡ì—ì„œ ì œê±°ë˜ì—ˆìŠµë‹ˆë‹¤. ìƒì„±ëœ ë°œì£¼ì„œëŠ” ë°œì£¼ì„œ ê´€ë¦¬ í™”ë©´ì—ì„œ í™•ì¸í•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤."})},P=ne({mutationFn:async a=>{const o=new FormData;u&&o.append("excelFile",u),o.append("orders",JSON.stringify(a));const s=await fetch("/api/orders/bulk-create-simple",{method:"POST",credentials:"include",body:o});if(!s.ok){const t=await s.text();throw new Error(t||"Failed to save orders")}return s.json()},onSuccess:async a=>{await ce.invalidateQueries({predicate:o=>o.queryKey.some(t=>typeof t=="string"&&(t.includes("orders")||t.includes("/api/orders")))}),h({title:"ì €ìž¥ ì™„ë£Œ",description:`${a.savedCount}ê°œì˜ ë°œì£¼ì„œê°€ ì„±ê³µì ìœ¼ë¡œ ì €ìž¥ë˜ì—ˆìŠµë‹ˆë‹¤.`}),setTimeout(()=>v("/orders"),1500)},onError:a=>{h({title:"ì €ìž¥ ì‹¤íŒ¨",description:a.message||"ë°œì£¼ì„œ ì €ìž¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.",variant:"destructive"})}}),_=()=>{const a=m.filter(o=>o.isValid!==!1);if(a.length===0){h({title:"ì €ìž¥í•  ìˆ˜ ì—†ìŒ",description:"ìœ íš¨í•œ ë°œì£¼ì„œê°€ ì—†ìŠµë‹ˆë‹¤.",variant:"destructive"});return}P.mutate(a)},U=()=>{g(null),w([]),r([]),x(0)},p=()=>{N.current?.click()};return e.jsxs("div",{className:"space-y-6",children:[m.length===0&&e.jsx(se,{children:e.jsxs(ie,{className:"p-8",children:[e.jsx("input",{ref:N,type:"file",accept:".xlsx,.xls,.xlsm",onChange:k,className:"hidden"}),e.jsxs("div",{className:`border-2 border-dashed rounded-lg p-12 text-center transition-colors ${i?"border-blue-500 bg-blue-50":"border-gray-300 hover:border-gray-400"}`,onDragEnter:b,onDragLeave:b,onDragOver:b,onDrop:T,children:[e.jsx(ae,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-lg font-medium text-gray-700",children:"ì—‘ì…€ íŒŒì¼ì„ ë“œëž˜ê·¸í•˜ê±°ë‚˜ í´ë¦­í•˜ì—¬ ì—…ë¡œë“œ"}),e.jsx("p",{className:"text-sm text-gray-500",children:"DB ê²€ì¦ ì—†ì´ ë°”ë¡œ íŽ¸ì§‘ ê°€ëŠ¥í•œ ë°œì£¼ì„œë¡œ ë³€í™˜ë©ë‹ˆë‹¤"}),e.jsx("p",{className:"text-xs text-gray-400",children:".xlsx, .xls, .xlsm íŒŒì¼ ì§€ì›"})]}),e.jsx($,{onClick:p,disabled:y,className:"mt-6",size:"lg",children:y?"ì²˜ë¦¬ ì¤‘...":"íŒŒì¼ ì„ íƒ"})]}),E>0&&e.jsxs("div",{className:"mt-6 space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm text-gray-600",children:[e.jsx("span",{children:"íŒŒì¼ ì²˜ë¦¬ ì¤‘..."}),e.jsxs("span",{children:[E,"%"]})]}),e.jsx(ye,{value:E,className:"h-2"})]}),u&&e.jsxs(L,{className:"mt-6",children:[e.jsx(te,{className:"h-4 w-4"}),e.jsxs(V,{children:[e.jsx("strong",{children:u.name})," (",(u.size/1024).toFixed(1)," KB)"]})]}),e.jsxs(L,{className:"mt-6",children:[e.jsx(X,{className:"h-4 w-4"}),e.jsxs(V,{children:[e.jsx("strong",{children:"ì—‘ì…€ ì‹¬í”Œ ì—…ë¡œë“œ íŠ¹ì§•:"}),e.jsxs("ul",{className:"list-disc list-inside mt-2 text-sm space-y-1",children:[e.jsx("li",{children:"DB ê°’ê³¼ ë¹„êµ/ë³´ì • ê³¼ì • ì—†ìŒ"}),e.jsx("li",{children:"ì—‘ì…€ ë°ì´í„°ë¥¼ ê·¸ëŒ€ë¡œ í‘œì‹œ"}),e.jsx("li",{children:"ëª¨ë“  í•„ë“œë¥¼ ì§ì ‘ ìˆ˜ì • ê°€ëŠ¥"}),e.jsx("li",{children:"ì—¬ëŸ¬ ë°œì£¼ì„œë¥¼ í•œë²ˆì— íŽ¸ì§‘ ë° ì €ìž¥"})]})]})]})]})}),m.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"sticky top-0 z-10 bg-white border rounded-lg shadow-sm p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs($,{onClick:_,disabled:P.isPending,size:"lg",className:"bg-blue-600 hover:bg-blue-700",children:[e.jsx(xe,{className:"h-4 w-4 mr-2"}),P.isPending?"ì €ìž¥ ì¤‘...":"ëª¨ë‘ ì €ìž¥"]}),e.jsxs($,{onClick:U,variant:"outline",size:"lg",children:[e.jsx(J,{className:"h-4 w-4 mr-2"}),"ì´ˆê¸°í™”"]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(q,{variant:"secondary",className:"px-3 py-1",children:[e.jsx(he,{className:"h-3 w-3 mr-1"}),m.length,"ê°œ ë°œì£¼ì„œ"]}),e.jsxs(q,{variant:"outline",className:"px-3 py-1",children:[m.reduce((a,o)=>a+o.items.length,0),"ê°œ í’ˆëª©"]})]})]})}),e.jsx(Le,{orders:m,onOrderUpdate:B,onOrderRemove:O,file:u})]})]})}const qe={EXCEL_UPLOAD:!0,HANDSONTABLE:!1,APPROVAL_WORKFLOW:!1,ADVANCED_PERMISSIONS:!1};function Ue(v){return qe[v]}function ps(){const[,v]=oe(),[N,u]=d.useState([]),{theme:g}=fe(),i=g==="dark",D=Ue("EXCEL_UPLOAD");console.log("ðŸ” Create Order Debug Info:",{isExcelUploadEnabled:D,VITE_ENVIRONMENT:"production",VITE_ENABLE_EXCEL_UPLOAD:"true",NODE_ENV:void 0,timestamp:new Date().toISOString()});const f=()=>{v("/orders")},w=()=>{v("/orders")},y=j=>{u(j)};return e.jsx("div",{className:`min-h-screen transition-colors ${i?"bg-gray-900":"bg-gray-50"}`,children:e.jsxs("div",{className:"max-w-[1366px] mx-auto p-6 space-y-6 pb-20",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(z,{className:"h-5 w-5 text-blue-600"}),e.jsxs("div",{children:[e.jsx("h1",{className:`text-2xl font-bold transition-colors ${i?"text-white":"text-gray-900"}`,children:"ë°œì£¼ì„œ ìž‘ì„±"}),e.jsx("p",{className:`text-sm mt-1 transition-colors ${i?"text-gray-400":"text-gray-600"}`,children:"ìƒˆë¡œìš´ ë°œì£¼ì„œë¥¼ ìž‘ì„±í•˜ê±°ë‚˜ Excel íŒŒì¼ì„ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”"})]})]})}),e.jsxs(L,{className:`mb-6 transition-colors ${i?"bg-gray-800 border-gray-700":"bg-white border-gray-200"}`,children:[e.jsx(Ae,{className:`h-4 w-4 ${i?"text-blue-400":"text-blue-600"}`}),e.jsx(V,{className:i?"text-gray-300":"text-gray-700",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:`font-medium ${i?"text-white":"text-gray-900"}`,children:"ðŸ“‹ ì‚¬ìš©íŒ"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:`font-medium ${i?"text-blue-400":"text-blue-600"}`,children:"Excel ì—…ë¡œë“œ:"})," ëŒ€ëŸ‰ ë°œì£¼ì„œ, ë°˜ë³µ ì—…ë¬´, ìžë™í™” ì²˜ë¦¬ì— ì í•© (50ê±´+ ê¶Œìž¥)"]}),e.jsxs("div",{children:[e.jsx("span",{className:`font-medium ${i?"text-green-400":"text-green-600"}`,children:"ì¼ë°˜ í¼ ìž‘ì„±:"})," ì†ŒëŸ‰ ë°œì£¼ì„œ, ì„¸ë°€í•œ ì¡°ì •, ì¦‰ì‹œ ì²˜ë¦¬ì— ì í•© (10ê±´ ì´í•˜ ê¶Œìž¥)"]})]}),e.jsx("div",{className:`pt-2 border-t transition-colors ${i?"border-gray-700":"border-gray-200"}`,children:e.jsxs($,{variant:"outline",size:"sm",className:`transition-colors ${i?"text-blue-400 border-gray-600 hover:bg-gray-700 hover:border-blue-500":"text-blue-600 border-blue-200 hover:bg-blue-50"}`,onClick:()=>{const j=document.createElement("a");j.href="/PO_Excel_Template.xlsx",j.download="PO_Excel_Template.xlsx",j.click()},children:[e.jsx(_e,{className:"h-4 w-4 mr-2"}),"Excel í…œí”Œë¦¿ ë‹¤ìš´ë¡œë“œ"]})})]})})]}),e.jsxs(Fe,{defaultValue:"excel",className:"w-full",children:[e.jsxs(Te,{className:`grid w-full grid-cols-3 transition-colors ${i?"bg-gray-800 border-gray-700":"bg-gray-100"}`,children:[e.jsxs(Y,{value:"excel",className:`flex items-center gap-2 transition-colors ${i?"data-[state=active]:bg-gray-700 data-[state=active]:text-white hover:bg-gray-750":"data-[state=active]:bg-white data-[state=active]:text-gray-900"}`,children:[e.jsx(te,{className:"h-4 w-4"}),"ì—‘ì…€ íŒŒì¼ ì—…ë¡œë“œ"]}),e.jsxs(Y,{value:"form",className:`flex items-center gap-2 transition-colors ${i?"data-[state=active]:bg-gray-700 data-[state=active]:text-white hover:bg-gray-750":"data-[state=active]:bg-white data-[state=active]:text-gray-900"}`,children:[e.jsx(z,{className:"h-4 w-4"}),"ì§ì ‘ ìž…ë ¥"]}),e.jsxs(Y,{value:"simple",className:`flex items-center gap-2 transition-colors ${i?"data-[state=active]:bg-gray-700 data-[state=active]:text-white hover:bg-gray-750":"data-[state=active]:bg-white data-[state=active]:text-gray-900"}`,children:[e.jsx(ae,{className:"h-4 w-4"}),"ì—‘ì…€ ì‹¬í”Œ ì—…ë¡œë“œ"]})]}),e.jsx(Z,{value:"excel",className:"mt-6",children:e.jsxs("div",{className:"space-y-6",children:[e.jsx(Re,{onDataParsed:y}),N.length>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsx(L,{className:`transition-colors ${i?"bg-gray-800 border-gray-700":"bg-white border-gray-200"}`,children:e.jsx(V,{className:i?"text-gray-300":"text-gray-700",children:'Excel ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤. "ì§ì ‘ ìž…ë ¥" íƒ­ìœ¼ë¡œ ì´ë™í•˜ì—¬ ë°œì£¼ì„œë¥¼ ì™„ì„±í•´ì£¼ì„¸ìš”.'})}),e.jsxs("div",{className:`rounded-lg p-4 transition-colors ${i?"bg-gray-800":"bg-gray-50"}`,children:[e.jsxs("h3",{className:`font-medium mb-3 transition-colors ${i?"text-white":"text-gray-900"}`,children:["ë¯¸ë¦¬ë³´ê¸° (",N.length,"ê°œ í–‰)"]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsx("table",{className:"min-w-full text-sm",children:e.jsxs("tbody",{children:[N.slice(0,5).map((j,E)=>e.jsx("tr",{className:`border-b transition-colors ${i?"border-gray-700":"border-gray-100"}`,children:j.slice(0,6).map((x,m)=>e.jsx("td",{className:`py-2 px-3 transition-colors ${i?"text-gray-300":"text-gray-900"}`,children:x||"-"},m))},E)),N.length>5&&e.jsx("tr",{children:e.jsxs("td",{colSpan:6,className:`py-2 px-3 text-center transition-colors ${i?"text-gray-400":"text-gray-500"}`,children:["... ì™¸ ",N.length-5,"ê°œ í–‰"]})})]})})})]})]})]})}),e.jsx(Z,{value:"form",className:"mt-6",children:e.jsx(Ne,{onSuccess:f,onCancel:w})}),e.jsx(Z,{value:"simple",className:"mt-6",children:e.jsx(Ve,{})})]})]})})}export{ps as default};
