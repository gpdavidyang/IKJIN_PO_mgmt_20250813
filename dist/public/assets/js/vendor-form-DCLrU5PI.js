import{r as b,j as e,o as h,X as q,T as R,t as X,v as Y,w as K,W as O,i as W,I as M,bO as ee,E as se,aN as x,d as ae,aG as te,aO as re,G as B,H as G,B as L,P as ie,as as le}from"./index-BkVWclAn.js";import{D as ne,a as oe,b as ce,c as de}from"./dialog-BzNb1g2C.js";import{T as me}from"./textarea-BxUPh8KU.js";import{I as _}from"./info-Cl7J8Y8S.js";import{C as J}from"./circle-check-C5LqRZVc.js";import{S as ue,a as xe,b as he,c as pe,d as ge}from"./select-DllVN4u6.js";import{i as H}from"./authUtils-CcDzk6i0.js";import"./index-DJjCK80a.js";import"./index-DF5EViyG.js";import"./chevron-down-NA-IvIzI.js";import"./chevron-up-Bzc4HmWa.js";function $({label:A,name:S,value:p="",onChange:a,onBlur:d,type:c="text",placeholder:P,required:l=!1,disabled:f=!1,readOnly:g=!1,error:y,success:E,helperText:N,tooltip:n,autoComplete:i,maxLength:w,rows:T=3,validating:t=!1,autoSave:r=!1,onAutoSave:j,className:m,labelClassName:D,inputClassName:k}){const[V,F]=b.useState(!1),[I,s]=b.useState(null),[u,U]=b.useState(!1),v=`field-${S}`,o=!!y,z=E&&!o;b.useEffect(()=>{if(r&&p&&j){I&&clearTimeout(I);const C=setTimeout(async()=>{U(!0),await j(),U(!1)},1500);s(C)}return()=>{I&&clearTimeout(I)}},[p,r,j]);const Q=()=>{const C={id:v,name:S,value:p,onChange:Z=>a?.(Z.target.value),onBlur:d,placeholder:P,required:l,disabled:f,readOnly:g,autoComplete:i,maxLength:w,className:h("transition-all duration-200",o&&"border-red-500 focus:border-red-500 focus:ring-red-500",z&&"border-green-500 focus:border-green-500 focus:ring-green-500",k),"aria-invalid":o,"aria-describedby":o?`${v}-error`:N?`${v}-helper`:void 0};return c==="textarea"?e.jsx(me,{...C,rows:T,className:h(C.className,"resize-none")}):c==="password"?e.jsxs("div",{className:"relative",children:[e.jsx(M,{...C,type:V?"text":"password",className:h(C.className,"pr-10")}),e.jsx("button",{type:"button",onClick:()=>F(!V),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-700 transition-colors",tabIndex:-1,children:V?e.jsx(ee,{className:"h-4 w-4"}):e.jsx(se,{className:"h-4 w-4"})})]}):e.jsx(M,{...C,type:c})};return e.jsxs("div",{className:h("space-y-2",m),children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs(q,{htmlFor:v,className:h("text-sm font-medium",o&&"text-red-600",z&&"text-green-600",D),children:[A,l&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),n&&e.jsx(R,{children:e.jsxs(X,{children:[e.jsx(Y,{asChild:!0,children:e.jsx(_,{className:"h-3.5 w-3.5 text-gray-400 cursor-help"})}),e.jsx(K,{children:e.jsx("p",{className:"max-w-xs text-sm",children:n})})]})}),r&&u&&e.jsxs("div",{className:"ml-auto flex items-center gap-1 text-xs text-gray-500",children:[e.jsx(O,{className:"h-3 w-3 animate-spin"}),e.jsx("span",{children:"저장 중..."})]})]}),e.jsxs("div",{className:"relative",children:[Q(),(t||o||z)&&c!=="password"&&e.jsxs("div",{className:"absolute right-3 top-1/2 -translate-y-1/2",children:[t&&e.jsx(O,{className:"h-4 w-4 animate-spin text-gray-400"}),o&&!t&&e.jsx(W,{className:"h-4 w-4 text-red-500"}),z&&!t&&e.jsx(J,{className:"h-4 w-4 text-green-500"})]})]}),(N||o)&&e.jsx("div",{id:o?`${v}-error`:`${v}-helper`,className:h("text-sm",o?"text-red-600":"text-gray-500"),role:o?"alert":void 0,children:o?y:N}),c==="textarea"&&w&&e.jsxs("div",{className:"text-xs text-gray-500 text-right",children:[p.length," / ",w]})]})}function je({label:A,name:S,value:p="",onChange:a,onBlur:d,options:c,placeholder:P="선택하세요",required:l=!1,disabled:f=!1,error:g,success:y,helperText:E,tooltip:N,validating:n=!1,className:i,labelClassName:w,selectClassName:T}){const t=`field-${S}`,r=!!g,j=y&&!r;return e.jsxs("div",{className:h("space-y-2",i),children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs(q,{htmlFor:t,className:h("text-sm font-medium",r&&"text-red-600",j&&"text-green-600",w),children:[A,l&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),N&&e.jsx(R,{children:e.jsxs(X,{children:[e.jsx(Y,{asChild:!0,children:e.jsx(_,{className:"h-3.5 w-3.5 text-gray-400 cursor-help"})}),e.jsx(K,{children:e.jsx("p",{className:"max-w-xs text-sm",children:N})})]})})]}),e.jsxs("div",{className:"relative",children:[e.jsxs(ue,{value:p,onValueChange:a,disabled:f,required:l,children:[e.jsx(xe,{id:t,onBlur:d,className:h("transition-all duration-200",r&&"border-red-500 focus:border-red-500 focus:ring-red-500",j&&"border-green-500 focus:border-green-500 focus:ring-green-500",T),"aria-invalid":r,"aria-describedby":r?`${t}-error`:E?`${t}-helper`:void 0,children:e.jsx(he,{placeholder:P})}),e.jsx(pe,{children:c.map(m=>e.jsx(ge,{value:m.value,disabled:m.disabled,children:m.label},m.value))})]}),(n||r||j)&&e.jsxs("div",{className:"absolute right-10 top-1/2 -translate-y-1/2 pointer-events-none",children:[n&&e.jsx(O,{className:"h-4 w-4 animate-spin text-gray-400"}),r&&!n&&e.jsx(W,{className:"h-4 w-4 text-red-500"}),j&&!n&&e.jsx(J,{className:"h-4 w-4 text-green-500"})]})]}),(E||r)&&e.jsx("div",{id:r?`${t}-error`:`${t}-helper`,className:h("text-sm",r?"text-red-600":"text-gray-500"),role:r?"alert":void 0,children:r?g:E})]})}const be=x.object({name:x.string().min(1,"거래처명을 입력하세요"),businessNumber:x.string().optional(),contactPerson:x.string().min(1,"담당자명을 입력하세요"),email:x.string().email("올바른 이메일 주소를 입력하세요"),phone:x.string().optional(),address:x.string().optional(),businessType:x.string().optional(),aliases:x.array(x.string()).optional()});function Ie({isOpen:A,onClose:S,onSuccess:p,vendor:a}){const{toast:d}=ae(),[c,P]=b.useState(!1),[l,f]=b.useState([]),[g,y]=b.useState(""),{register:E,handleSubmit:N,reset:n,setValue:i,watch:w,formState:{errors:T}}=te({resolver:re(be),defaultValues:{name:"",businessNumber:"",contactPerson:"",email:"",phone:"",address:"",businessType:"",aliases:[]}}),t=w(),[r,j]=b.useState({}),m=B({mutationFn:async s=>await G("POST","/api/vendors",s),onSuccess:()=>{d({title:"성공",description:"거래처가 추가되었습니다."}),p(),F()},onError:s=>{if(H(s)){d({title:"Unauthorized",description:"You are logged out. Logging in again...",variant:"destructive"}),setTimeout(()=>{window.location.href="/api/login"},500);return}d({title:"오류",description:"거래처 추가에 실패했습니다.",variant:"destructive"})}}),D=B({mutationFn:async s=>await G("PUT",`/api/vendors/${a.id}`,s),onSuccess:()=>{d({title:"성공",description:"거래처가 수정되었습니다."}),p(),F()},onError:s=>{if(H(s)){d({title:"Unauthorized",description:"You are logged out. Logging in again...",variant:"destructive"}),setTimeout(()=>{window.location.href="/api/login"},500);return}d({title:"오류",description:"거래처 수정에 실패했습니다.",variant:"destructive"})}});b.useEffect(()=>{a?(n({name:a.name||"",businessNumber:a.businessNumber||"",contactPerson:a.contactPerson||"",email:a.email||"",phone:a.phone||"",address:a.address||"",businessType:a.businessType||"",aliases:a.aliases||[]}),f(a.aliases||[])):(n({name:"",businessNumber:"",contactPerson:"",email:"",phone:"",address:"",businessType:"",aliases:[]}),f([]))},[a,n]);const k=()=>{if(g.trim()&&!l.includes(g.trim())){const s=[...l,g.trim()];f(s),i("aliases",s),y("")}},V=s=>{const u=l.filter((U,v)=>v!==s);f(u),i("aliases",u)},F=()=>{n(),S()},I=s=>{P(!0);const u={...s,aliases:l};a?D.mutate(u):m.mutate(u),P(!1)};return e.jsx(ne,{open:A,onOpenChange:F,children:e.jsxs(oe,{className:"sm:max-w-lg max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsx(ce,{className:"flex-shrink-0",children:e.jsx(de,{children:a?"거래처 수정":"거래처 추가"})}),e.jsx("div",{className:"flex-1 overflow-y-auto pr-2 -mr-2",children:e.jsxs("form",{onSubmit:N(I),className:"space-y-6",children:[e.jsx($,{label:"거래처명",name:"name",value:t.name,onChange:s=>i("name",s),required:!0,error:T.name?.message,placeholder:"거래처명을 입력하세요",helperText:"정확한 거래처명을 입력해주세요",validating:r.name}),e.jsx($,{label:"사업자등록번호",name:"businessNumber",value:t.businessNumber,onChange:s=>i("businessNumber",s),placeholder:"123-45-67890",helperText:"'-'를 포함하여 입력해주세요"}),e.jsx($,{label:"담당자명",name:"contactPerson",value:t.contactPerson,onChange:s=>i("contactPerson",s),required:!0,error:T.contactPerson?.message,placeholder:"담당자명을 입력하세요"}),e.jsx($,{label:"이메일",name:"email",type:"email",value:t.email,onChange:s=>i("email",s),required:!0,error:T.email?.message,placeholder:"example@company.com",helperText:"업무용 이메일 주소를 입력해주세요",validating:r.email}),e.jsx($,{label:"연락처",name:"phone",type:"tel",value:t.phone,onChange:s=>i("phone",s),placeholder:"02-1234-5678",helperText:"하이픈(-)을 포함하여 입력해주세요"}),e.jsx($,{label:"주소",name:"address",type:"textarea",value:t.address,onChange:s=>i("address",s),placeholder:"주소를 입력하세요",rows:3,maxLength:200}),e.jsx(je,{label:"업종",name:"businessType",value:t.businessType,onChange:s=>i("businessType",s),placeholder:"업종을 선택하세요",options:[{value:"construction",label:"건설업"},{value:"manufacturing",label:"제조업"},{value:"service",label:"서비스업"},{value:"wholesale",label:"도매업"},{value:"retail",label:"소매업"},{value:"other",label:"기타"}],helperText:"주요 업종을 선택해주세요"}),e.jsxs("div",{children:[e.jsx(q,{htmlFor:"aliases",children:"별칭 (선택사항)"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(M,{id:"newAlias",value:g,onChange:s=>y(s.target.value),placeholder:"별칭 입력 (예: (주)익진, 주식회사 익진)",onKeyPress:s=>{s.key==="Enter"&&(s.preventDefault(),k())}}),e.jsx(L,{type:"button",size:"sm",onClick:k,className:"px-3",children:e.jsx(ie,{className:"h-4 w-4"})})]}),l.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:l.map((s,u)=>e.jsxs("div",{className:"flex items-center gap-1 bg-gray-100 px-2 py-1 rounded-md text-sm",children:[e.jsx("span",{children:s}),e.jsx("button",{type:"button",onClick:()=>V(u),className:"text-gray-500 hover:text-red-500",children:e.jsx(le,{className:"h-3 w-3"})})]},u))}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"거래처명의 다양한 표기법을 추가하여 자동 매칭이 가능합니다."})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4 border-t border-border mt-6 pt-6",children:[e.jsx(L,{type:"button",variant:"outline",onClick:F,disabled:c,children:"취소"}),e.jsx(L,{type:"submit",disabled:c||m.isPending||D.isPending,className:"min-w-[80px]",children:c||m.isPending||D.isPending?e.jsxs(e.Fragment,{children:[e.jsx(O,{className:"h-4 w-4 mr-2 animate-spin"}),"저장 중..."]}):a?"수정":"추가"})]})]})})]})})}export{Ie as VendorForm};
