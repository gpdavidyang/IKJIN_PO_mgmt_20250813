import{q as b,k as w,a5 as C,j as s,a6 as A,a7 as M,a8 as m,a9 as T,w as d,a as h,a3 as B,M as n,c as o,aa as D,ab as H,B as E,o as S,R as k,b as R}from"./index-_veMqcTm-1757338637561.js";import{D as $,a as q,b as z,c as L,d as F}from"./dialog-r5175mh2-1757338637561.js";import{R as j}from"./refresh-cw-DIs7xf9t-1757338637561.js";import{f as p}from"./format-Ch1rWxL0-1757338637561.js";import{P}from"./paperclip-gH2E4Z1W-1757338637561.js";function _(t){return b({queryKey:["/api/email-history/orders",t,"email-history"],queryFn:()=>w("GET",`/api/email-history/orders/${t}/email-history`),enabled:!!t,staleTime:30*1e3})}function X({orderId:t,orderNumber:g,isOpen:l,onClose:y,onResend:i}){const{data:r,isLoading:N,refetch:x}=_(t);C.useEffect(()=>{l&&t&&(console.log("📧 이메일 기록 모달 열림 - 데이터 새로고침"),x())},[l,t,x]);const u=e=>{switch(e){case"sent":return s.jsx(R,{className:"h-4 w-4"});case"pending":return s.jsx(h,{className:"h-4 w-4"});case"failed":return s.jsx(o,{className:"h-4 w-4"});default:return s.jsx(n,{className:"h-4 w-4"})}},f=e=>{const a={sent:{variant:"default",label:"발송완료"},pending:{variant:"secondary",label:"발송대기"},failed:{variant:"destructive",label:"발송실패"}}[e]||{variant:"secondary",label:e||"알 수 없음"};return s.jsxs(S,{variant:a.variant,children:[u(e),s.jsx("span",{className:"ml-1",children:a.label})]})};return s.jsx($,{open:l,onOpenChange:y,children:s.jsxs(q,{className:"max-w-4xl max-h-[90vh]",children:[s.jsxs(z,{children:[s.jsx(L,{children:"이메일 발송 이력"}),s.jsxs(F,{children:["발주서 ",g,"의 이메일 발송 내역입니다."]})]}),N?s.jsx("div",{className:"flex items-center justify-center py-8",children:s.jsx(j,{className:"h-6 w-6 animate-spin text-gray-400"})}):r&&r.length>0?s.jsxs(A,{defaultValue:"0",className:"w-full",children:[s.jsxs(M,{className:"grid w-full",style:{gridTemplateColumns:`repeat(${Math.min(r.length,5)}, 1fr)`},children:[r.slice(0,5).map((e,c)=>s.jsx(m,{value:c.toString(),children:e.sentAt?p(new Date(e.sentAt),"MM/dd HH:mm"):`#${c+1}`},e.id)),r.length>5&&s.jsxs(m,{value:"more",disabled:!0,children:["+",r.length-5," more"]})]}),r.map((e,c)=>s.jsxs(T,{value:c.toString(),className:"space-y-4",children:[s.jsxs(d,{className:"p-4",children:[s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[s.jsx(h,{className:"h-4 w-4 text-gray-500"}),s.jsx("span",{className:"text-gray-600",children:"발송 시간:"}),s.jsx("span",{className:"font-medium",children:e.sentAt?p(new Date(e.sentAt),"yyyy년 MM월 dd일 HH:mm:ss",{locale:k}):"대기 중"})]}),s.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[s.jsx(B,{className:"h-4 w-4 text-gray-500"}),s.jsx("span",{className:"text-gray-600",children:"발송자:"}),s.jsxs("span",{className:"font-medium",children:[e.sentByName||"시스템",e.sentByEmail&&`(${e.sentByEmail})`]})]}),s.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[s.jsx(n,{className:"h-4 w-4 text-gray-500"}),s.jsx("span",{className:"text-gray-600",children:"수신자:"}),s.jsx("span",{className:"font-medium",children:Array.isArray(e.recipients)?e.recipients.join(", "):typeof e.recipients=="string"?e.recipients:"N/A"})]}),e.cc&&e.cc.length>0&&s.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[s.jsx(n,{className:"h-4 w-4 text-gray-500"}),s.jsx("span",{className:"text-gray-600",children:"참조:"}),s.jsx("span",{className:"font-medium",children:Array.isArray(e.cc)?e.cc.join(", "):e.cc})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:"text-sm text-gray-600",children:"상태:"}),f(e.status)]}),e.errorMessage&&s.jsxs("div",{className:"flex items-start gap-2 text-sm",children:[s.jsx(o,{className:"h-4 w-4 text-red-500 mt-0.5"}),s.jsxs("div",{children:[s.jsx("span",{className:"text-gray-600",children:"오류 메시지:"}),s.jsx("p",{className:"text-red-600 text-xs mt-1",children:e.errorMessage})]})]})]})]}),e.attachments&&Array.isArray(e.attachments)&&e.attachments.length>0&&s.jsxs("div",{className:"mt-4 pt-4 border-t",children:[s.jsxs("div",{className:"flex items-center gap-2 text-sm mb-2",children:[s.jsx(P,{className:"h-4 w-4 text-gray-500"}),s.jsx("span",{className:"text-gray-600",children:"첨부 파일:"})]}),s.jsx("div",{className:"space-y-1",children:e.attachments.map((a,v)=>s.jsxs("div",{className:"text-sm text-gray-700",children:[typeof a=="string"?a:a.filename||a.name||"첨부파일",a.size&&` (${(a.size/1024/1024).toFixed(2)} MB)`]},v))})]})]}),s.jsxs(d,{className:"p-4",children:[s.jsx("h4",{className:"font-medium mb-2",children:"제목"}),s.jsx("p",{className:"text-sm text-gray-700 mb-4",children:e.subject}),s.jsx(D,{}),s.jsx("h4",{className:"font-medium mt-4 mb-2",children:"내용"}),s.jsx(H,{className:"h-[300px] w-full rounded-md border p-4",children:s.jsx("div",{className:"prose prose-sm max-w-none",dangerouslySetInnerHTML:{__html:e.body}})})]}),i&&e.status==="failed"&&s.jsx("div",{className:"flex justify-end",children:s.jsxs(E,{variant:"outline",size:"sm",onClick:()=>i(e.id),children:[s.jsx(j,{className:"h-4 w-4 mr-2"}),"재발송"]})})]},e.id))]}):s.jsxs("div",{className:"text-center py-8",children:[s.jsx(n,{className:"h-12 w-12 text-gray-300 mx-auto mb-3"}),s.jsx("p",{className:"text-gray-500",children:"이메일 발송 이력이 없습니다."})]})]})})}export{X as E};
