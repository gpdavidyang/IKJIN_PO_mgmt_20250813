import{e as K,g as R,u as Z,r as C,q as w,d as G,j as e,a0 as H,o as J,F as P,a5 as U,a6 as W,a7 as $,a8 as A,w as D,a4 as Y,x as I,O as y,S as m,z as x,A as h,D as g,G as u,y as N,B as S,P as _,T as X,ab as ee}from"./index-D-PHG7W0-1757335699768.js";import{T as te}from"./textarea-BkWT8NO8-1757335699768.js";import{C as se}from"./checkbox-CTabQCoy-1757335699768.js";import{ExcelAutomationWizard as ae}from"./excel-automation-wizard-Drnp9hjo-1757335699768.js";import{Z as re}from"./zap-D1umzeuR-1757335699768.js";import{C as ie}from"./calendar-DtYzE_hc-1757335699768.js";import{P as le}from"./package-C1gdgyc1-1757335699768.js";import{S as ne}from"./save-CyRgS1ki-1757335699768.js";import"./index-xjHeoEQ7-1757335699768.js";import"./progress--0U0rAvF-1757335699768.js";import"./vendor-validation-modal-BIZ6omaQ-1757335699768.js";import"./dialog-CDTBVwlV-1757335699768.js";import"./index-c5BTlTr6-1757335699768.js";import"./circle-check-suTO6tsz-1757335699768.js";import"./email-send-dialog-CsfmkxEe-1757335699768.js";import"./triangle-alert-CdFXjshg-1757335699768.js";import"./paperclip-DlZrQqNj-1757335699768.js";import"./upload--U71HbsA-1757335699768.js";import"./send-BkBJAkHC-1757335699768.js";import"./download-53nsvyRC-1757335699768.js";function ce(){const o=new Date,p=o.getFullYear(),j=String(o.getMonth()+1).padStart(2,"0"),f=String(o.getDate()).padStart(2,"0"),b=String(o.getHours()).padStart(2,"0")+String(o.getMinutes()).padStart(2,"0");return`PO-${p}${j}${f}-${b}`}function Ie(){const{toast:o}=K();R();const[,p]=Z(),[j,f]=C.useState(!1),[b]=C.useState(ce()),[i,n]=C.useState({site:"",deliveryDate:"",isNegotiable:!1,receiver:"",manager:"",notes:"",items:[{name:"",category:"",majorCategory:"",middleCategory:"",minorCategory:"",quantity:0,unit:"",unitPrice:0,totalPrice:0,specs:"",remarks:""}]}),Q=()=>i.items.reduce((t,a)=>t+(a.totalPrice||0),0),{data:V=[]}=w({queryKey:["/api/projects"],select:t=>t?.filter(a=>a.isActive)||[]}),{user:L}=G(),{data:F=[]}=w({queryKey:["/api/users"],select:t=>t?.filter(a=>a.isActive)||[]}),{data:v=[]}=w({queryKey:["/api/item-categories/major"],queryFn:()=>fetch("/api/item-categories/major").then(t=>t.json())}),[d,T]=C.useState({middleQueries:{},minorQueries:{}}),O=async t=>{if(d.middleQueries[t])return d.middleQueries[t];try{const s=await(await fetch(`/api/item-categories/middle?majorId=${t}`)).json();return T(r=>({...r,middleQueries:{...r.middleQueries,[t]:s}})),s}catch(a){return console.error("Error fetching middle categories:",a),[]}},E=async t=>{if(d.minorQueries[t])return d.minorQueries[t];try{const s=await(await fetch(`/api/item-categories/minor?middleId=${t}`)).json();return T(r=>({...r,minorQueries:{...r.minorQueries,[t]:s}})),s}catch(a){return console.error("Error fetching minor categories:",a),[]}},q=t=>{if(!t.majorCategory)return[];const a=v.find(s=>s.categoryName===t.majorCategory);return a?d.middleQueries[a.id]||[]:[]},M=t=>{if(!t.middleCategory||!t.majorCategory)return[];const a=v.find(l=>l.categoryName===t.majorCategory);if(!a)return[];const r=(d.middleQueries[a.id]||[]).find(l=>l.categoryName===t.middleCategory);return r?d.minorQueries[r.id]||[]:[]};w({queryKey:["/api/vendors"],select:t=>t?.filter(a=>a.isActive)||[]});const z=async t=>{if(t.preventDefault(),!i.site){o({title:"필수 정보 누락",description:"현장을 선택해주세요.",variant:"destructive"});return}if(!i.receiver){o({title:"필수 정보 누락",description:"자재 인수자를 선택해주세요.",variant:"destructive"});return}const a=i.items.filter(s=>s.name.trim());if(a.length===0){o({title:"필수 정보 누락",description:"최소 하나의 품목을 입력해주세요.",variant:"destructive"});return}try{f(!0);const s={orderNumber:b,projectId:parseInt(i.site),userId:L?.id,orderDate:new Date,deliveryDate:i.deliveryDate?new Date(i.deliveryDate):void 0,totalAmount:Q(),notes:i.notes||void 0,status:"pending",items:a.map(c=>({itemName:c.name,quantity:c.quantity||0,unitPrice:c.unitPrice||0,totalAmount:c.totalPrice||0,specification:c.specs||void 0,notes:c.remarks||void 0}))},r=await fetch("/api/orders",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!r.ok)throw new Error("Failed to create order");const l=await r.json();o({title:"발주서 생성 완료",description:"발주서가 성공적으로 생성되었습니다."}),l?.id&&p(`/orders/${l.id}`)}catch(s){console.error("Order creation error:",s),o({title:"저장 실패",description:"발주서 저장 중 오류가 발생했습니다.",variant:"destructive"})}finally{f(!1)}},B=()=>{if(i.items.length>=10){o({title:"품목 추가 제한",description:"최대 10개까지 추가 가능합니다.",variant:"destructive"});return}n(t=>({...t,items:[...t.items,{name:"",category:"",majorCategory:"",middleCategory:"",minorCategory:"",quantity:0,unit:"",unitPrice:0,totalPrice:0,specs:"",remarks:""}]}))};return e.jsx("div",{className:"min-h-screen bg-gray-50",children:e.jsxs("div",{className:"max-w-[1366px] mx-auto p-6",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("button",{onClick:()=>p("/orders"),className:"inline-flex items-center text-sm text-gray-600 hover:text-gray-900 mb-4",children:[e.jsx(H,{className:"h-4 w-4 mr-1"}),"발주서 목록으로"]}),e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"표준 발주서 작성"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"새로운 발주서를 작성하고 관리하세요"})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(J,{variant:"outline",className:"text-sm px-3 py-1",children:[e.jsx(P,{className:"h-4 w-4 mr-1"}),b]})})]})]}),e.jsxs(U,{defaultValue:"manual",className:"space-y-6",children:[e.jsxs(W,{className:"grid w-full grid-cols-2 max-w-[400px]",children:[e.jsxs($,{value:"manual",className:"flex items-center gap-2",children:[e.jsx(P,{className:"h-4 w-4"}),"수동 입력"]}),e.jsxs($,{value:"automation",className:"flex items-center gap-2",children:[e.jsx(re,{className:"h-4 w-4"}),"엑셀 자동화"]})]}),e.jsx(A,{value:"manual",className:"space-y-6",children:e.jsxs("form",{onSubmit:z,className:"space-y-6",children:[e.jsxs(D,{className:"shadow-sm bg-white",children:[e.jsx("div",{className:"p-6 border-b border-blue-200 bg-blue-50/30",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"h-5 w-5 text-gray-600"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"발주 정보"})]})}),e.jsx(I,{className:"p-6 bg-white",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs(y,{htmlFor:"site",className:"text-sm font-medium text-gray-700 mb-2 block",children:["현장 ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(m,{value:i.site,onValueChange:t=>n(a=>({...a,site:t})),children:[e.jsx(x,{id:"site",className:"h-11",children:e.jsx(h,{placeholder:"현장을 선택하세요"})}),e.jsx(g,{children:V.map(t=>e.jsx(u,{value:t.id.toString(),children:t.projectName},t.id))})]})]}),e.jsxs("div",{children:[e.jsx(y,{htmlFor:"deliveryDate",className:"text-sm font-medium text-gray-700 mb-2 block",children:"납기일"}),e.jsxs("div",{className:"relative",children:[e.jsx(ie,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-5 w-5 pointer-events-none"}),e.jsx(N,{id:"deliveryDate",type:"date",value:i.deliveryDate,onChange:t=>n(a=>({...a,deliveryDate:t.target.value})),className:"pl-10 h-11"})]}),e.jsx("div",{className:"mt-2",children:e.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(se,{checked:i.isNegotiable,onCheckedChange:t=>n(a=>({...a,isNegotiable:t}))}),"협의 가능"]})})]}),e.jsxs("div",{children:[e.jsxs(y,{htmlFor:"receiver",className:"text-sm font-medium text-gray-700 mb-2 block",children:["자재 인수자 ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(m,{value:i.receiver,onValueChange:t=>n(a=>({...a,receiver:t})),children:[e.jsx(x,{id:"receiver",className:"h-11",children:e.jsx(h,{placeholder:"인수자를 선택하세요"})}),e.jsx(g,{children:F.map(t=>e.jsx(u,{value:t.id,children:t.firstName&&t.lastName?`${t.lastName}${t.firstName}`:t.email},t.id))})]})]}),e.jsxs("div",{children:[e.jsx(y,{htmlFor:"manager",className:"text-sm font-medium text-gray-700 mb-2 block",children:"현장 책임자"}),e.jsxs(m,{value:i.manager,onValueChange:t=>n(a=>({...a,manager:t})),children:[e.jsx(x,{id:"manager",className:"h-11",children:e.jsx(h,{placeholder:"책임자를 선택하세요"})}),e.jsx(g,{children:F.map(t=>e.jsx(u,{value:t.id,children:t.firstName&&t.lastName?`${t.lastName}${t.firstName}`:t.email},t.id))})]})]})]})})]}),e.jsxs(D,{className:"shadow-sm bg-white",children:[e.jsx("div",{className:"p-6 border-b border-blue-200 bg-blue-50/30",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(le,{className:"h-5 w-5 text-gray-600"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"품목 정보"}),e.jsxs("span",{className:"text-sm text-gray-500",children:[i.items.filter(t=>t.name).length," / 10 품목"]})]}),e.jsxs(S,{type:"button",variant:"outline",size:"sm",onClick:B,disabled:i.items.length>=10,className:"flex items-center gap-2",children:[e.jsx(_,{className:"h-4 w-4"}),"품목 추가"]})]})}),e.jsx(I,{className:"p-0",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-blue-50 border-b border-blue-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"품목명"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"대분류"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"중분류"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"소분류"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"수량"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"단위"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"단가"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"금액"}),e.jsx("th",{className:"px-4 py-3"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:i.items.map((t,a)=>e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsx(N,{value:t.name,onChange:s=>{const r=[...i.items];r[a]={...t,name:s.target.value},n(l=>({...l,items:r}))},placeholder:"품목명",className:"h-9 border-gray-200"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs(m,{value:t.majorCategory,onValueChange:async s=>{const r=v.find(c=>c.categoryName===s),l=[...i.items];l[a]={...t,majorCategory:s,middleCategory:"",minorCategory:""},n(c=>({...c,items:l})),r&&await O(r.id)},children:[e.jsx(x,{className:"h-9 border-gray-200",children:e.jsx(h,{placeholder:"대분류"})}),e.jsx(g,{children:v.map(s=>e.jsx(u,{value:s.categoryName,children:s.categoryName},s.id))})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs(m,{value:t.middleCategory,onValueChange:async s=>{const l=q(t).find(k=>k.categoryName===s),c=[...i.items];c[a]={...t,middleCategory:s,minorCategory:""},n(k=>({...k,items:c})),l&&await E(l.id)},disabled:!t.majorCategory,children:[e.jsx(x,{className:"h-9 border-gray-200",children:e.jsx(h,{placeholder:t.majorCategory?"중분류":"대분류 먼저"})}),e.jsx(g,{children:q(t).map(s=>e.jsx(u,{value:s.categoryName,children:s.categoryName},s.id))})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs(m,{value:t.minorCategory,onValueChange:s=>{const r=[...i.items];r[a]={...t,minorCategory:s},n(l=>({...l,items:r}))},disabled:!t.middleCategory,children:[e.jsx(x,{className:"h-9 border-gray-200",children:e.jsx(h,{placeholder:t.middleCategory?"소분류":"중분류 먼저"})}),e.jsx(g,{children:M(t).map(s=>e.jsx(u,{value:s.categoryName,children:s.categoryName},s.id))})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx(N,{type:"number",value:t.quantity||"",onChange:s=>{const r=[...i.items];r[a]={...t,quantity:parseInt(s.target.value)||0,totalPrice:(parseInt(s.target.value)||0)*(t.unitPrice||0)},n(l=>({...l,items:r}))},placeholder:"0",className:"h-9 text-center w-20 border-gray-200"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx(N,{value:t.unit||"",onChange:s=>{const r=[...i.items];r[a]={...t,unit:s.target.value},n(l=>({...l,items:r}))},placeholder:"개",className:"h-9 text-center w-16 border-gray-200"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx(N,{type:"number",value:t.unitPrice||"",onChange:s=>{const r=[...i.items];r[a]={...t,unitPrice:parseInt(s.target.value)||0,totalPrice:(t.quantity||0)*(parseInt(s.target.value)||0)},n(l=>({...l,items:r}))},placeholder:"0",className:"h-9 text-right border-gray-200"})}),e.jsx("td",{className:"px-4 py-3 text-right",children:e.jsxs("span",{className:"font-semibold text-blue-600",children:[(t.totalPrice||0).toLocaleString(),"원"]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx(S,{type:"button",variant:"ghost",size:"icon",onClick:()=>{const s=i.items.filter((r,l)=>l!==a);n(r=>({...r,items:s}))},className:"h-8 w-8 text-gray-400 hover:text-red-600",children:e.jsx(X,{className:"h-4 w-4"})})})]},a))}),e.jsx("tfoot",{className:"bg-blue-50",children:e.jsxs("tr",{children:[e.jsx("td",{colSpan:7,className:"px-4 py-4 text-right text-sm font-medium text-gray-900",children:"총 발주금액"}),e.jsx("td",{className:"px-4 py-4 text-right",children:e.jsxs("span",{className:"text-lg font-bold text-blue-600",children:[Q().toLocaleString(),"원"]})}),e.jsx("td",{})]})})]})})})]}),e.jsxs(D,{className:"shadow-sm bg-white",children:[e.jsx("div",{className:"p-6 border-b border-blue-200 bg-blue-50/30",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(P,{className:"h-5 w-5 text-gray-600"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"추가 정보"})]})}),e.jsx(I,{className:"p-6 bg-white",children:e.jsxs("div",{children:[e.jsx(y,{htmlFor:"notes",className:"text-sm font-medium text-gray-700 mb-2 block",children:"비고사항"}),e.jsx(te,{id:"notes",value:i.notes,onChange:t=>n(a=>({...a,notes:t.target.value})),placeholder:"추가 요청사항이나 특이사항을 입력하세요...",className:"min-h-[100px] resize-none"})]})})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(S,{type:"button",variant:"outline",onClick:()=>p("/orders"),disabled:j,children:"취소"}),e.jsx(S,{type:"submit",disabled:j,className:"bg-blue-600 hover:bg-blue-700 text-white flex items-center gap-2",children:j?e.jsxs(e.Fragment,{children:[e.jsx(ee,{className:"h-4 w-4 animate-spin"}),"저장 중..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ne,{className:"h-4 w-4"}),"발주서 저장"]})})]})]})}),e.jsx(A,{value:"automation",className:"space-y-6",children:e.jsx(ae,{})})]})]})})}export{Ie as default};
