import{c as Pe,j as e,s as w,t as b,G as T,H as R,ap as Y,n as C,x as U,r as h,B as k,U as es,bt as ke,bu as Me,F as Te,l as ss,E as ie,bh as ts,W as ns,af as rs,$ as W,aZ as ae,b5 as as,_ as le,b3 as is,bp as _e,M as ls,ao as ne,J as N,d as cs,e as ds,p as he,k as te,q as Re,I as os,m as xs,S as ms,z as us,w as hs}from"./index-BfDc6Omt-1757213250784.js";import{T as js,a as fs,b as G,c as J}from"./tabs-BQBrwsH2-1757213250784.js";import{S as je,a as fe,b as ge,c as pe,d as P}from"./select-BLTlOVj9-1757213250784.js";import{A as be,b as gs,a as Se}from"./alert-COSiiwC3-1757213250784.js";import{S as ps}from"./separator-BsI4cP4l-1757213250784.js";import{T as ce,a as de,b as I,c as v,d as oe,e as p}from"./table-DhBDkVL0-1757213250784.js";import{D as Ns,a as vs,b as ys,c as ws,d as bs}from"./dialog-Bo48vr0k-1757213250784.js";import{U as Ie}from"./users-DFvByWQM-1757213250784.js";import{A as Le}from"./activity-DfmxCP5q-1757213250784.js";import{T as re}from"./triangle-alert-CrwRroiq-1757213250784.js";import{f as $}from"./format-pq49SRM7-1757213250784.js";import{R as V}from"./refresh-cw-CVqRgU6S-1757213250784.js";import{D as Ce}from"./download-Bsg6xcv--1757213250784.js";import{P as Ss}from"./package-DoesSaI9-1757213250784.js";import{U as Ae}from"./user-x-B_ItaITK-1757213250784.js";import{L as Ne}from"./lock-C6ehm_lq-1757213250784.js";import{S as O}from"./switch-CoIrwUgO-1757213250784.js";import{u as Cs}from"./index-38EM6Lo0-1757213250784.js";import{I as Es}from"./info-CKu1PqNX-1757213250784.js";import{A as Fe}from"./archive-Bda_YPu_-1757213250784.js";import{T as Oe}from"./trash-2-Vt9HzQc1-1757213250784.js";import{S as Ds}from"./save-D-19p1G_-1757213250784.js";import{C as Ts}from"./chevron-left-C_HJWEvB-1757213250784.js";import"./chevron-down-C_SK49in-1757213250784.js";import"./chevron-up-DBeMyJPH-1757213250784.js";import"./index-Bkwo1L4z-1757213250784.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rs=Pe("Ban",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m4.9 4.9 14.2 14.2",key:"1m5liu"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const As=Pe("KeyRound",[["path",{d:"M2.586 17.414A2 2 0 0 0 2 18.828V21a1 1 0 0 0 1 1h3a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1h1a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1h.172a2 2 0 0 0 1.414-.586l.814-.814a6.5 6.5 0 1 0-4-4z",key:"1s6t7t"}],["circle",{cx:"16.5",cy:"7.5",r:".5",fill:"currentColor",key:"w0ekpg"}]]);function Ps({stats:t,loading:n}){return n?e.jsx(w,{children:e.jsx(b,{className:"flex items-center justify-center py-8",children:e.jsx("p",{className:"text-muted-foreground",children:"대시보드를 불러오는 중..."})})}):t?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs(w,{children:[e.jsxs(T,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(R,{className:"text-sm font-medium",children:"활성 사용자"}),e.jsx(Ie,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(b,{children:[e.jsx("div",{className:"text-2xl font-bold",children:t.activeUserCount||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"지난 24시간"})]})]}),e.jsxs(w,{children:[e.jsxs(T,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(R,{className:"text-sm font-medium",children:"총 이벤트"}),e.jsx(Le,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(b,{children:[e.jsx("div",{className:"text-2xl font-bold",children:t.eventStats?.reduce((r,i)=>r+i.count,0)||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"지난 24시간"})]})]}),e.jsxs(w,{children:[e.jsxs(T,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(R,{className:"text-sm font-medium",children:"보안 이벤트"}),e.jsx(Y,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(b,{children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:t.securityEvents?.length||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"경고 및 실패"})]})]}),e.jsxs(w,{children:[e.jsxs(T,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(R,{className:"text-sm font-medium",children:"에러"}),e.jsx(re,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(b,{children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:t.recentErrors?.length||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"최근 오류"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs(w,{children:[e.jsx(T,{children:e.jsx(R,{className:"text-sm",children:"이벤트 유형별 분포"})}),e.jsx(b,{children:e.jsx("div",{className:"space-y-2",children:t.eventStats?.slice(0,5).map(r=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(C,{variant:"outline",className:"text-xs",children:r.eventType})}),e.jsx("span",{className:"text-sm font-medium",children:r.count})]},r.eventType))})})]}),e.jsxs(w,{children:[e.jsx(T,{children:e.jsx(R,{className:"text-sm",children:"카테고리별 활동"})}),e.jsx(b,{children:e.jsx("div",{className:"space-y-2",children:t.categoryStats?.map(r=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm capitalize",children:r.category}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-24 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full",style:{width:`${r.count/Math.max(...t.categoryStats.map(i=>i.count))*100}%`}})}),e.jsx("span",{className:"text-sm font-medium w-10 text-right",children:r.count})]})]},r.category))})})]})]}),t.securityEvents&&t.securityEvents.length>0&&e.jsxs(w,{children:[e.jsx(T,{children:e.jsx(R,{className:"text-sm",children:"최근 보안 이벤트"})}),e.jsx(b,{children:e.jsx("div",{className:"space-y-2",children:t.securityEvents.slice(0,5).map(r=>e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"h-4 w-4 text-orange-500"}),e.jsx("span",{children:r.action})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-muted-foreground",children:r.userName||"Unknown"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:$(new Date(r.createdAt),"HH:mm",{locale:U})})]})]},r.id))})})]}),t.recentErrors&&t.recentErrors.length>0&&e.jsxs(w,{children:[e.jsx(T,{children:e.jsx(R,{className:"text-sm",children:"최근 에러"})}),e.jsx(b,{children:e.jsx("div",{className:"space-y-2",children:t.recentErrors.slice(0,5).map(r=>e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(re,{className:"h-4 w-4 text-red-500"}),e.jsx("span",{className:"font-medium",children:r.action})]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:$(new Date(r.createdAt),"HH:mm",{locale:U})})]}),r.errorMessage&&e.jsx("p",{className:"text-xs text-muted-foreground pl-6",children:r.errorMessage})]},r.id))})})]})]}):e.jsx(w,{children:e.jsx(b,{className:"flex items-center justify-center py-8",children:e.jsx("p",{className:"text-muted-foreground",children:"데이터가 없습니다."})})})}function ks({filters:t}){const[n,r]=h.useState([]),[i,x]=h.useState(!0);h.useEffect(()=>{j()},[t]);const j=async()=>{try{x(!0);const d=new URLSearchParams({eventCategory:"auth",...t}),o=await fetch(`/api/audit/logs?${d}`,{credentials:"include"});if(o.ok){const g=await o.json();r(g.logs||[])}}catch(d){console.error("Failed to fetch login history:",d)}finally{x(!1)}},m=d=>{switch(d){case"login":return e.jsx(Me,{className:"h-4 w-4 text-green-500"});case"logout":return e.jsx(ke,{className:"h-4 w-4 text-blue-500"});case"login_failed":return e.jsx(re,{className:"h-4 w-4 text-red-500"});case"password_change":return e.jsx(Y,{className:"h-4 w-4 text-orange-500"});default:return e.jsx(es,{className:"h-4 w-4 text-gray-500"})}},f=d=>{switch(d){case"login":return e.jsx(C,{className:"bg-green-100 text-green-800",children:"로그인"});case"logout":return e.jsx(C,{className:"bg-blue-100 text-blue-800",children:"로그아웃"});case"login_failed":return e.jsx(C,{className:"bg-red-100 text-red-800",children:"로그인 실패"});case"password_change":return e.jsx(C,{className:"bg-orange-100 text-orange-800",children:"비밀번호 변경"});default:return e.jsx(C,{variant:"outline",children:d})}};return i?e.jsx(w,{children:e.jsxs(b,{className:"flex items-center justify-center py-8",children:[e.jsx(V,{className:"h-6 w-6 animate-spin text-muted-foreground"}),e.jsx("span",{className:"ml-2 text-muted-foreground",children:"로그인 기록을 불러오는 중..."})]})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-lg font-medium",children:"로그인 기록"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(k,{size:"sm",variant:"outline",onClick:j,children:[e.jsx(V,{className:"h-4 w-4 mr-1"}),"새로고침"]}),e.jsxs(k,{size:"sm",variant:"outline",children:[e.jsx(Ce,{className:"h-4 w-4 mr-1"}),"다운로드"]})]})]}),e.jsx(w,{children:e.jsxs(ce,{children:[e.jsx(de,{children:e.jsxs(I,{children:[e.jsx(v,{children:"시간"}),e.jsx(v,{children:"이벤트"}),e.jsx(v,{children:"사용자"}),e.jsx(v,{children:"역할"}),e.jsx(v,{children:"IP 주소"}),e.jsx(v,{children:"브라우저"}),e.jsx(v,{children:"상태"})]})}),e.jsx(oe,{children:n.length===0?e.jsx(I,{children:e.jsx(p,{colSpan:7,className:"text-center text-muted-foreground",children:"로그인 기록이 없습니다"})}):n.map(d=>e.jsxs(I,{children:[e.jsx(p,{className:"text-sm",children:$(new Date(d.createdAt),"MM/dd HH:mm:ss",{locale:U})}),e.jsx(p,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[m(d.eventType),f(d.eventType)]})}),e.jsx(p,{className:"text-sm",children:d.userName||"Unknown"}),e.jsx(p,{className:"text-sm",children:e.jsx(C,{variant:"outline",children:d.userRole||"N/A"})}),e.jsx(p,{className:"text-sm text-muted-foreground",children:d.ipAddress||"N/A"}),e.jsx(p,{className:"text-sm text-muted-foreground",children:d.userAgent?d.userAgent.substring(0,30)+"...":"N/A"}),e.jsx(p,{children:d.eventType==="login"?e.jsx(C,{className:"bg-green-100 text-green-800",children:"성공"}):d.eventType==="login_failed"?e.jsx(C,{className:"bg-red-100 text-red-800",children:"실패"}):e.jsx(C,{variant:"outline",children:"N/A"})})]},d.id))})]})})]})}function Ms({filters:t}){const[n,r]=h.useState([]),[i,x]=h.useState(!0);h.useEffect(()=>{j()},[t]);const j=async()=>{try{x(!0);const o=new URLSearchParams({eventCategory:"data",...t}),g=await fetch(`/api/audit/logs?${o}`,{credentials:"include"});if(g.ok){const u=await g.json();r(u.logs||[])}}catch(o){console.error("Failed to fetch data changes:",o)}finally{x(!1)}},m=o=>({purchase_orders:e.jsx(Te,{className:"h-4 w-4 text-blue-500"}),vendors:e.jsx(ss,{className:"h-4 w-4 text-green-500"}),items:e.jsx(Ss,{className:"h-4 w-4 text-purple-500"}),users:e.jsx(Ie,{className:"h-4 w-4 text-orange-500"})})[o]||e.jsx(Te,{className:"h-4 w-4 text-gray-500"}),f=o=>o.includes("생성")||o.includes("추가")?e.jsx(C,{className:"bg-green-100 text-green-800",children:"생성"}):o.includes("수정")||o.includes("업데이트")?e.jsx(C,{className:"bg-blue-100 text-blue-800",children:"수정"}):o.includes("삭제")?e.jsx(C,{className:"bg-red-100 text-red-800",children:"삭제"}):o.includes("승인")?e.jsx(C,{className:"bg-purple-100 text-purple-800",children:"승인"}):e.jsx(C,{variant:"outline",children:"변경"}),d=(o,g)=>{if(!o&&!g)return null;try{const u=o?JSON.parse(o):{},s=g?JSON.parse(g):{},a=[];return Object.keys(s).forEach(c=>{u[c]!==s[c]&&a.push(`${c}: ${u[c]||"N/A"} → ${s[c]}`)}),a.length>0?e.jsxs("div",{className:"text-xs text-muted-foreground",children:[a.slice(0,3).map((c,E)=>e.jsx("div",{children:c},E)),a.length>3&&e.jsxs("div",{children:["... +",a.length-3," more"]})]}):null}catch{return null}};return i?e.jsx(w,{children:e.jsxs(b,{className:"flex items-center justify-center py-8",children:[e.jsx(V,{className:"h-6 w-6 animate-spin text-muted-foreground"}),e.jsx("span",{className:"ml-2 text-muted-foreground",children:"데이터 변경 기록을 불러오는 중..."})]})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-lg font-medium",children:"데이터 변경 기록"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(k,{size:"sm",variant:"outline",onClick:j,children:[e.jsx(V,{className:"h-4 w-4 mr-1"}),"새로고침"]}),e.jsxs(k,{size:"sm",variant:"outline",children:[e.jsx(Ce,{className:"h-4 w-4 mr-1"}),"다운로드"]})]})]}),e.jsx(w,{children:e.jsxs(ce,{children:[e.jsx(de,{children:e.jsxs(I,{children:[e.jsx(v,{children:"시간"}),e.jsx(v,{children:"대상"}),e.jsx(v,{children:"작업"}),e.jsx(v,{children:"사용자"}),e.jsx(v,{children:"변경 내용"}),e.jsx(v,{children:"IP 주소"})]})}),e.jsx(oe,{children:n.length===0?e.jsx(I,{children:e.jsx(p,{colSpan:6,className:"text-center text-muted-foreground",children:"데이터 변경 기록이 없습니다"})}):n.map(o=>e.jsxs(I,{children:[e.jsx(p,{className:"text-sm",children:$(new Date(o.createdAt),"MM/dd HH:mm",{locale:U})}),e.jsx(p,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[m(o.tableName||""),e.jsx("span",{className:"text-sm",children:o.entityType||o.tableName})]})}),e.jsx(p,{children:f(o.action)}),e.jsx(p,{className:"text-sm",children:o.userName||"System"}),e.jsx(p,{children:d(o.oldData,o.newData)}),e.jsx(p,{className:"text-sm text-muted-foreground",children:o.ipAddress||"N/A"})]},o.id))})]})})]})}function _s({filters:t}){const[n,r]=h.useState([]),[i,x]=h.useState(!0),[j,m]=h.useState([]);h.useEffect(()=>{f(),d()},[t]);const f=async()=>{try{x(!0);const s=new URLSearchParams({eventCategory:"security",...t}),a=await fetch(`/api/audit/logs?${s}`,{credentials:"include"});if(a.ok){const c=await a.json();r(c.logs||[])}}catch(s){console.error("Failed to fetch security events:",s)}finally{x(!1)}},d=async()=>{try{const s=await fetch("/api/audit/alert-rules",{credentials:"include"});if(s.ok){const a=await s.json();m(a||[])}}catch(s){console.error("Failed to fetch alert rules:",s)}},o=s=>{switch(s){case"critical":return e.jsx(C,{className:"bg-red-600 text-white",children:"긴급"});case"high":return e.jsx(C,{className:"bg-orange-500 text-white",children:"높음"});case"medium":return e.jsx(C,{className:"bg-yellow-500 text-white",children:"중간"});case"low":return e.jsx(C,{className:"bg-green-500 text-white",children:"낮음"});default:return e.jsx(C,{variant:"outline",children:"정보"})}},g=s=>({unauthorized_access:e.jsx(Rs,{className:"h-4 w-4 text-red-500"}),login_failed:e.jsx(Ae,{className:"h-4 w-4 text-orange-500"}),permission_denied:e.jsx(Ne,{className:"h-4 w-4 text-red-500"}),suspicious_activity:e.jsx(ie,{className:"h-4 w-4 text-yellow-500"}),password_reset:e.jsx(As,{className:"h-4 w-4 text-blue-500"})})[s]||e.jsx(Y,{className:"h-4 w-4 text-gray-500"}),u=n.filter(s=>s.action?.includes("실패")||s.action?.includes("차단")||s.action?.includes("거부"));return i?e.jsx(w,{children:e.jsxs(b,{className:"flex items-center justify-center py-8",children:[e.jsx(V,{className:"h-6 w-6 animate-spin text-muted-foreground"}),e.jsx("span",{className:"ml-2 text-muted-foreground",children:"보안 이벤트를 불러오는 중..."})]})}):e.jsxs("div",{className:"space-y-4",children:[u.length>0&&e.jsxs(be,{className:"border-red-200 bg-red-50",children:[e.jsx(re,{className:"h-4 w-4 text-red-600"}),e.jsx(gs,{className:"text-red-800",children:"보안 경고"}),e.jsxs(Se,{className:"text-red-700",children:["최근 24시간 동안 ",u.length,"건의 보안 이벤트가 감지되었습니다."]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs(w,{children:[e.jsxs(T,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(R,{className:"text-sm font-medium",children:"실패한 로그인"}),e.jsx(Ae,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(b,{children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:n.filter(s=>s.eventType==="login_failed").length}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"지난 24시간"})]})]}),e.jsxs(w,{children:[e.jsxs(T,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(R,{className:"text-sm font-medium",children:"권한 거부"}),e.jsx(Ne,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(b,{children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:n.filter(s=>s.action?.includes("권한")).length}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"지난 24시간"})]})]}),e.jsxs(w,{children:[e.jsxs(T,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(R,{className:"text-sm font-medium",children:"의심스러운 활동"}),e.jsx(ie,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(b,{children:[e.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:n.filter(s=>s.action?.includes("의심")).length}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"지난 24시간"})]})]}),e.jsxs(w,{children:[e.jsxs(T,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(R,{className:"text-sm font-medium",children:"활성 경고 규칙"}),e.jsx(Y,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(b,{children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:j.filter(s=>s.isActive).length}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["전체 ",j.length,"개"]})]})]})]}),e.jsxs(w,{children:[e.jsx(T,{children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(R,{children:"보안 이벤트 상세"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(k,{size:"sm",variant:"outline",onClick:f,children:[e.jsx(V,{className:"h-4 w-4 mr-1"}),"새로고침"]}),e.jsxs(k,{size:"sm",variant:"outline",children:[e.jsx(Ce,{className:"h-4 w-4 mr-1"}),"다운로드"]})]})]})}),e.jsx(b,{children:e.jsxs(ce,{children:[e.jsx(de,{children:e.jsxs(I,{children:[e.jsx(v,{children:"시간"}),e.jsx(v,{children:"이벤트"}),e.jsx(v,{children:"심각도"}),e.jsx(v,{children:"사용자"}),e.jsx(v,{children:"상세 내용"}),e.jsx(v,{children:"IP 주소"}),e.jsx(v,{children:"조치"})]})}),e.jsx(oe,{children:n.length===0?e.jsx(I,{children:e.jsx(p,{colSpan:7,className:"text-center text-muted-foreground",children:"보안 이벤트가 없습니다"})}):n.map(s=>e.jsxs(I,{children:[e.jsx(p,{className:"text-sm",children:$(new Date(s.createdAt),"MM/dd HH:mm",{locale:U})}),e.jsx(p,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[g(s.eventType),e.jsx("span",{className:"text-sm",children:s.eventType})]})}),e.jsx(p,{children:o(s.action?.includes("실패")?"high":s.action?.includes("거부")?"medium":"low")}),e.jsx(p,{className:"text-sm",children:s.userName||"Unknown"}),e.jsxs(p,{className:"text-sm",children:[s.action,s.errorMessage&&e.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:s.errorMessage})]}),e.jsx(p,{className:"text-sm text-muted-foreground",children:s.ipAddress||"N/A"}),e.jsx(p,{children:e.jsx(k,{size:"sm",variant:"ghost",children:e.jsx(ie,{className:"h-4 w-4"})})})]},s.id))})]})})]})]})}var Ve=["PageUp","PageDown"],ze=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],Be={"from-left":["Home","PageDown","ArrowDown","ArrowLeft"],"from-right":["Home","PageDown","ArrowDown","ArrowRight"],"from-bottom":["Home","PageDown","ArrowDown","ArrowLeft"],"from-top":["Home","PageDown","ArrowUp","ArrowLeft"]},X="Slider",[ve,Is,Ls]=ts(X),[He,Et]=ns(X,[Ls]),[Fs,xe]=He(X),Ke=h.forwardRef((t,n)=>{const{name:r,min:i=0,max:x=100,step:j=1,orientation:m="horizontal",disabled:f=!1,minStepsBetweenThumbs:d=0,defaultValue:o=[i],value:g,onValueChange:u=()=>{},onValueCommit:s=()=>{},inverted:a=!1,form:c,...E}=t,S=h.useRef(new Set),y=h.useRef(0),A=m==="horizontal"?Os:Vs,[D=[],z]=rs({prop:g,defaultProp:o,onChange:M=>{[...S.current][y.current]?.focus(),u(M)}}),Q=h.useRef(D);function Z(M){const _=Us(D,M);B(M,_)}function me(M){B(M,y.current)}function ue(){const M=Q.current[y.current];D[y.current]!==M&&s(D)}function B(M,_,{commit:l}={commit:!1}){const ee=Js(j),L=Ws(Math.round((M-i)/j)*j+i,ee),se=_e(L,[i,x]);z((q=[])=>{const H=Hs(q,se,_);if(Gs(H,d*j)){y.current=H.indexOf(se);const De=String(H)!==String(q);return De&&l&&s(H),De?H:q}else return q})}return e.jsx(Fs,{scope:t.__scopeSlider,name:r,disabled:f,min:i,max:x,valueIndexToChangeRef:y,thumbs:S.current,values:D,orientation:m,form:c,children:e.jsx(ve.Provider,{scope:t.__scopeSlider,children:e.jsx(ve.Slot,{scope:t.__scopeSlider,children:e.jsx(A,{"aria-disabled":f,"data-disabled":f?"":void 0,...E,ref:n,onPointerDown:W(E.onPointerDown,()=>{f||(Q.current=D)}),min:i,max:x,inverted:a,onSlideStart:f?void 0:Z,onSlideMove:f?void 0:me,onSlideEnd:f?void 0:ue,onHomeKeyDown:()=>!f&&B(i,0,{commit:!0}),onEndKeyDown:()=>!f&&B(x,D.length-1,{commit:!0}),onStepKeyDown:({event:M,direction:_})=>{if(!f){const L=Ve.includes(M.key)||M.shiftKey&&ze.includes(M.key)?10:1,se=y.current,q=D[se],H=j*L*_;B(q+H,se,{commit:!0})}}})})})})});Ke.displayName=X;var[Ue,$e]=He(X,{startEdge:"left",endEdge:"right",size:"width",direction:1}),Os=h.forwardRef((t,n)=>{const{min:r,max:i,dir:x,inverted:j,onSlideStart:m,onSlideMove:f,onSlideEnd:d,onStepKeyDown:o,...g}=t,[u,s]=h.useState(null),a=ae(n,A=>s(A)),c=h.useRef(void 0),E=as(x),S=E==="ltr",y=S&&!j||!S&&j;function F(A){const D=c.current||u.getBoundingClientRect(),z=[0,D.width],Z=Ee(z,y?[r,i]:[i,r]);return c.current=D,Z(A-D.left)}return e.jsx(Ue,{scope:t.__scopeSlider,startEdge:y?"left":"right",endEdge:y?"right":"left",direction:y?1:-1,size:"width",children:e.jsx(qe,{dir:E,"data-orientation":"horizontal",...g,ref:a,style:{...g.style,"--radix-slider-thumb-transform":"translateX(-50%)"},onSlideStart:A=>{const D=F(A.clientX);m?.(D)},onSlideMove:A=>{const D=F(A.clientX);f?.(D)},onSlideEnd:()=>{c.current=void 0,d?.()},onStepKeyDown:A=>{const z=Be[y?"from-left":"from-right"].includes(A.key);o?.({event:A,direction:z?-1:1})}})})}),Vs=h.forwardRef((t,n)=>{const{min:r,max:i,inverted:x,onSlideStart:j,onSlideMove:m,onSlideEnd:f,onStepKeyDown:d,...o}=t,g=h.useRef(null),u=ae(n,g),s=h.useRef(void 0),a=!x;function c(E){const S=s.current||g.current.getBoundingClientRect(),y=[0,S.height],A=Ee(y,a?[i,r]:[r,i]);return s.current=S,A(E-S.top)}return e.jsx(Ue,{scope:t.__scopeSlider,startEdge:a?"bottom":"top",endEdge:a?"top":"bottom",size:"height",direction:a?1:-1,children:e.jsx(qe,{"data-orientation":"vertical",...o,ref:u,style:{...o.style,"--radix-slider-thumb-transform":"translateY(50%)"},onSlideStart:E=>{const S=c(E.clientY);j?.(S)},onSlideMove:E=>{const S=c(E.clientY);m?.(S)},onSlideEnd:()=>{s.current=void 0,f?.()},onStepKeyDown:E=>{const y=Be[a?"from-bottom":"from-top"].includes(E.key);d?.({event:E,direction:y?-1:1})}})})}),qe=h.forwardRef((t,n)=>{const{__scopeSlider:r,onSlideStart:i,onSlideMove:x,onSlideEnd:j,onHomeKeyDown:m,onEndKeyDown:f,onStepKeyDown:d,...o}=t,g=xe(X,r);return e.jsx(le.span,{...o,ref:n,onKeyDown:W(t.onKeyDown,u=>{u.key==="Home"?(m(u),u.preventDefault()):u.key==="End"?(f(u),u.preventDefault()):Ve.concat(ze).includes(u.key)&&(d(u),u.preventDefault())}),onPointerDown:W(t.onPointerDown,u=>{const s=u.target;s.setPointerCapture(u.pointerId),u.preventDefault(),g.thumbs.has(s)?s.focus():i(u)}),onPointerMove:W(t.onPointerMove,u=>{u.target.hasPointerCapture(u.pointerId)&&x(u)}),onPointerUp:W(t.onPointerUp,u=>{const s=u.target;s.hasPointerCapture(u.pointerId)&&(s.releasePointerCapture(u.pointerId),j(u))})})}),Ge="SliderTrack",Je=h.forwardRef((t,n)=>{const{__scopeSlider:r,...i}=t,x=xe(Ge,r);return e.jsx(le.span,{"data-disabled":x.disabled?"":void 0,"data-orientation":x.orientation,...i,ref:n})});Je.displayName=Ge;var ye="SliderRange",We=h.forwardRef((t,n)=>{const{__scopeSlider:r,...i}=t,x=xe(ye,r),j=$e(ye,r),m=h.useRef(null),f=ae(n,m),d=x.values.length,o=x.values.map(s=>Xe(s,x.min,x.max)),g=d>1?Math.min(...o):0,u=100-Math.max(...o);return e.jsx(le.span,{"data-orientation":x.orientation,"data-disabled":x.disabled?"":void 0,...i,ref:f,style:{...t.style,[j.startEdge]:g+"%",[j.endEdge]:u+"%"}})});We.displayName=ye;var we="SliderThumb",Ye=h.forwardRef((t,n)=>{const r=Is(t.__scopeSlider),[i,x]=h.useState(null),j=ae(n,f=>x(f)),m=h.useMemo(()=>i?r().findIndex(f=>f.ref.current===i):-1,[r,i]);return e.jsx(zs,{...t,ref:j,index:m})}),zs=h.forwardRef((t,n)=>{const{__scopeSlider:r,index:i,name:x,...j}=t,m=xe(we,r),f=$e(we,r),[d,o]=h.useState(null),g=ae(n,F=>o(F)),u=d?m.form||!!d.closest("form"):!0,s=is(d),a=m.values[i],c=a===void 0?0:Xe(a,m.min,m.max),E=Ks(i,m.values.length),S=s?.[f.size],y=S?$s(S,c,f.direction):0;return h.useEffect(()=>{if(d)return m.thumbs.add(d),()=>{m.thumbs.delete(d)}},[d,m.thumbs]),e.jsxs("span",{style:{transform:"var(--radix-slider-thumb-transform)",position:"absolute",[f.startEdge]:`calc(${c}% + ${y}px)`},children:[e.jsx(ve.ItemSlot,{scope:t.__scopeSlider,children:e.jsx(le.span,{role:"slider","aria-label":t["aria-label"]||E,"aria-valuemin":m.min,"aria-valuenow":a,"aria-valuemax":m.max,"aria-orientation":m.orientation,"data-orientation":m.orientation,"data-disabled":m.disabled?"":void 0,tabIndex:m.disabled?void 0:0,...j,ref:g,style:a===void 0?{display:"none"}:t.style,onFocus:W(t.onFocus,()=>{m.valueIndexToChangeRef.current=i})})}),u&&e.jsx(Bs,{name:x??(m.name?m.name+(m.values.length>1?"[]":""):void 0),form:m.form,value:a},i)]})});Ye.displayName=we;var Bs=t=>{const{value:n,...r}=t,i=h.useRef(null),x=Cs(n);return h.useEffect(()=>{const j=i.current,m=window.HTMLInputElement.prototype,d=Object.getOwnPropertyDescriptor(m,"value").set;if(x!==n&&d){const o=new Event("input",{bubbles:!0});d.call(j,n),j.dispatchEvent(o)}},[x,n]),e.jsx("input",{style:{display:"none"},...r,ref:i,defaultValue:n})};function Hs(t=[],n,r){const i=[...t];return i[r]=n,i.sort((x,j)=>x-j)}function Xe(t,n,r){const j=100/(r-n)*(t-n);return _e(j,[0,100])}function Ks(t,n){return n>2?`Value ${t+1} of ${n}`:n===2?["Minimum","Maximum"][t]:void 0}function Us(t,n){if(t.length===1)return 0;const r=t.map(x=>Math.abs(x-n)),i=Math.min(...r);return r.indexOf(i)}function $s(t,n,r){const i=t/2,j=Ee([0,50],[0,i]);return(i-j(n)*r)*r}function qs(t){return t.slice(0,-1).map((n,r)=>t[r+1]-n)}function Gs(t,n){if(n>0){const r=qs(t);return Math.min(...r)>=n}return!0}function Ee(t,n){return r=>{if(t[0]===t[1]||n[0]===n[1])return n[0];const i=(n[1]-n[0])/(t[1]-t[0]);return n[0]+i*(r-t[0])}}function Js(t){return(String(t).split(".")[1]||"").length}function Ws(t,n){const r=Math.pow(10,n);return Math.round(t*r)/r}var Qe=Ke,Ys=Je,Xs=We,Qs=Ye;const Ze=h.forwardRef(({className:t,...n},r)=>e.jsxs(Qe,{ref:r,className:ls("relative flex w-full touch-none select-none items-center",t),...n,children:[e.jsx(Ys,{className:"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary",children:e.jsx(Xs,{className:"absolute h-full bg-primary"})}),e.jsx(Qs,{className:"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50"})]}));Ze.displayName=Qe.displayName;const K={success:t=>console.log("✅ SUCCESS:",t),error:t=>console.log("❌ ERROR:",t)};function Zs({onSettingsChange:t}){const[n,r]=h.useState({logLevel:"INFO",enableAuth:!0,enableData:!0,enableSystem:!0,enableSecurity:!0,retentionDays:30,archiveEnabled:!0,maxLogSize:1e6,autoCleanup:!0,alertsEnabled:!0,emailNotifications:!1,realTimeMonitoring:!1}),[i,x]=h.useState(!1),[j,m]=h.useState(!1);h.useEffect(()=>{f()},[]);const f=async()=>{try{x(!0);const s=await fetch("/api/audit/settings",{credentials:"include"});if(s.ok){const a=await s.json();r(c=>({...c,...a}))}}catch(s){console.error("Failed to fetch settings:",s),K.error("설정을 불러올 수 없습니다")}finally{x(!1)}},d=async()=>{try{if(m(!0),(await fetch("/api/audit/settings",{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(n)})).ok)K.success("설정이 저장되었습니다"),t?.();else throw new Error("Failed to save settings")}catch(s){console.error("Failed to save settings:",s),K.error("설정 저장에 실패했습니다")}finally{m(!1)}},o=async()=>{if(confirm("30일 이전의 로그를 아카이브하시겠습니까?"))try{const s=await fetch("/api/audit/archive",{method:"POST",credentials:"include"});if(s.ok){const a=await s.json();K.success(`${a.archived}개의 로그가 아카이브되었습니다`)}else throw new Error("Archive failed")}catch(s){console.error("Archive failed:",s),K.error("아카이브에 실패했습니다")}},g=async()=>{if(confirm("오래된 로그를 정리하시겠습니까? 이 작업은 되돌릴 수 없습니다."))try{const s=await fetch("/api/audit/cleanup",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({days:n.retentionDays})});if(s.ok){const a=await s.json();K.success(`${a.deleted}개의 로그가 정리되었습니다`)}else throw new Error("Cleanup failed")}catch(s){console.error("Cleanup failed:",s),K.error("정리 작업에 실패했습니다")}},u={OFF:"로그를 기록하지 않습니다",ERROR:"오류만 기록합니다",WARNING:"경고 및 오류를 기록합니다",INFO:"일반 정보, 경고, 오류를 기록합니다",DEBUG:"모든 상세 정보를 기록합니다"};return i?e.jsx(w,{children:e.jsxs(b,{className:"flex items-center justify-center py-8",children:[e.jsx(V,{className:"h-6 w-6 animate-spin text-muted-foreground"}),e.jsx("span",{className:"ml-2 text-muted-foreground",children:"설정을 불러오는 중..."})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs(w,{children:[e.jsxs(T,{children:[e.jsx(R,{children:"로그 레벨 설정"}),e.jsx(ne,{children:"시스템 로그 기록 수준을 설정합니다"})]}),e.jsxs(b,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"log-level",children:"전역 로그 레벨"}),e.jsxs(je,{value:n.logLevel,onValueChange:s=>r(a=>({...a,logLevel:s})),children:[e.jsx(fe,{id:"log-level",children:e.jsx(ge,{})}),e.jsxs(pe,{children:[e.jsx(P,{value:"OFF",children:"OFF - 로그 없음"}),e.jsx(P,{value:"ERROR",children:"ERROR - 오류만"}),e.jsx(P,{value:"WARNING",children:"WARNING - 경고 이상"}),e.jsx(P,{value:"INFO",children:"INFO - 일반 정보 이상"}),e.jsx(P,{value:"DEBUG",children:"DEBUG - 모든 정보"})]})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:u[n.logLevel]})]}),e.jsxs(be,{children:[e.jsx(Es,{className:"h-4 w-4"}),e.jsx(Se,{children:"DEBUG 레벨은 시스템 성능에 영향을 줄 수 있으므로 개발 환경에서만 사용을 권장합니다."})]})]})]}),e.jsxs(w,{children:[e.jsxs(T,{children:[e.jsx(R,{children:"카테고리별 설정"}),e.jsx(ne,{children:"각 카테고리의 로그 기록 여부를 설정합니다"})]}),e.jsxs(b,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(N,{htmlFor:"auth-logs",children:"인증 로그"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"로그인, 로그아웃, 권한 관련"})]}),e.jsx(O,{id:"auth-logs",checked:n.enableAuth,onCheckedChange:s=>r(a=>({...a,enableAuth:s}))})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(N,{htmlFor:"data-logs",children:"데이터 변경 로그"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"생성, 수정, 삭제 작업"})]}),e.jsx(O,{id:"data-logs",checked:n.enableData,onCheckedChange:s=>r(a=>({...a,enableData:s}))})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(N,{htmlFor:"system-logs",children:"시스템 로그"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"시스템 이벤트, 오류, 성능"})]}),e.jsx(O,{id:"system-logs",checked:n.enableSystem,onCheckedChange:s=>r(a=>({...a,enableSystem:s}))})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(N,{htmlFor:"security-logs",children:"보안 로그"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"보안 이벤트, 접근 시도"})]}),e.jsx(O,{id:"security-logs",checked:n.enableSecurity,onCheckedChange:s=>r(a=>({...a,enableSecurity:s}))})]})]})]}),e.jsxs(w,{children:[e.jsxs(T,{children:[e.jsx(R,{children:"저장소 설정"}),e.jsx(ne,{children:"로그 보관 및 정리 정책을 설정합니다"})]}),e.jsxs(b,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"retention",children:"로그 보관 기간"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(Ze,{id:"retention",min:7,max:365,step:1,value:[n.retentionDays],onValueChange:([s])=>r(a=>({...a,retentionDays:s})),className:"flex-1"}),e.jsxs("span",{className:"w-20 text-sm font-medium",children:[n.retentionDays,"일"]})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[n.retentionDays,"일 이후의 로그는 자동으로 삭제됩니다"]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(N,{htmlFor:"archive",children:"자동 아카이브"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"오래된 로그를 자동으로 아카이브"})]}),e.jsx(O,{id:"archive",checked:n.archiveEnabled,onCheckedChange:s=>r(a=>({...a,archiveEnabled:s}))})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(N,{htmlFor:"cleanup",children:"자동 정리"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"보관 기간이 지난 로그 자동 삭제"})]}),e.jsx(O,{id:"cleanup",checked:n.autoCleanup,onCheckedChange:s=>r(a=>({...a,autoCleanup:s}))})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(k,{variant:"outline",onClick:o,children:[e.jsx(Fe,{className:"h-4 w-4 mr-2"}),"수동 아카이브"]}),e.jsxs(k,{variant:"outline",onClick:g,children:[e.jsx(Oe,{className:"h-4 w-4 mr-2"}),"수동 정리"]})]})]})]}),e.jsxs(w,{children:[e.jsxs(T,{children:[e.jsx(R,{children:"알림 설정"}),e.jsx(ne,{children:"보안 이벤트 및 시스템 알림을 설정합니다"})]}),e.jsxs(b,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(N,{htmlFor:"alerts",children:"보안 알림"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"중요 보안 이벤트 발생 시 알림"})]}),e.jsx(O,{id:"alerts",checked:n.alertsEnabled,onCheckedChange:s=>r(a=>({...a,alertsEnabled:s}))})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(N,{htmlFor:"email",children:"이메일 알림"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"중요 이벤트를 이메일로 전송"})]}),e.jsx(O,{id:"email",checked:n.emailNotifications,onCheckedChange:s=>r(a=>({...a,emailNotifications:s}))})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(N,{htmlFor:"realtime",children:"실시간 모니터링"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"실시간으로 로그를 모니터링"})]}),e.jsx(O,{id:"realtime",checked:n.realTimeMonitoring,onCheckedChange:s=>r(a=>({...a,realTimeMonitoring:s}))})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsxs(k,{variant:"outline",onClick:f,disabled:j,children:[e.jsx(V,{className:"h-4 w-4 mr-2"}),"초기화"]}),e.jsxs(k,{onClick:d,disabled:j,children:[e.jsx(Ds,{className:"h-4 w-4 mr-2"}),j?"저장 중...":"설정 저장"]})]})]})}function Dt(){const{user:t}=cs(),{toast:n}=ds(),[r,i]=h.useState("dashboard"),[x,j]=h.useState(""),[m,f]=h.useState("all"),[d,o]=h.useState("all"),[g,u]=h.useState({start:"",end:""}),[s,a]=h.useState(1),[c,E]=h.useState(null),S=50,{data:y,isLoading:F,refetch:A}=he({queryKey:["audit-logs",s,m,d,g,x],queryFn:async()=>{const l=new URLSearchParams({limit:String(S),offset:String((s-1)*S),sortOrder:"desc"});return m!=="all"&&l.append("eventType",m),d!=="all"&&l.append("eventCategory",d),g.start&&l.append("startDate",g.start),g.end&&l.append("endDate",g.end),x&&l.append("search",x),te(`/api/audit/logs?${l}`,{method:"GET"})},enabled:t?.role==="admin"}),{data:D,isLoading:z}=he({queryKey:["audit-settings"],queryFn:()=>te("/api/audit/settings",{method:"GET"}),enabled:t?.role==="admin"}),{data:Q,isLoading:Z}=he({queryKey:["audit-dashboard"],queryFn:()=>te("/api/audit/dashboard?hours=24",{method:"GET"}),enabled:t?.role==="admin"&&r==="dashboard",refetchInterval:6e4}),me=Re({mutationFn:l=>te("/api/audit/settings",{method:"PUT",body:JSON.stringify(l)}),onSuccess:()=>{n({title:"설정 업데이트",description:"감사 설정이 성공적으로 업데이트되었습니다."}),hs.invalidateQueries({queryKey:["audit-settings"]})},onError:l=>{n({title:"오류",description:l.message||"설정 업데이트에 실패했습니다.",variant:"destructive"})}}),ue=Re({mutationFn:l=>te("/api/audit/archive",{method:"POST",body:JSON.stringify({beforeDate:l})}),onSuccess:l=>{n({title:"아카이빙 완료",description:`${l.archived}개의 로그가 아카이빙되었습니다.`}),A()},onError:l=>{n({title:"오류",description:l.message||"아카이빙에 실패했습니다.",variant:"destructive"})}}),B=l=>({login:"bg-green-500",logout:"bg-blue-500",login_failed:"bg-red-500",data_create:"bg-purple-500",data_update:"bg-yellow-500",data_delete:"bg-red-600",permission_change:"bg-orange-500",security_alert:"bg-red-700",error:"bg-red-800"})[l]||"bg-gray-500",M=l=>{switch(l){case"login":return e.jsx(Me,{className:"h-4 w-4"});case"logout":return e.jsx(ke,{className:"h-4 w-4"});case"login_failed":return e.jsx(us,{className:"h-4 w-4"});case"permission_change":return e.jsx(Ne,{className:"h-4 w-4"});case"data_delete":return e.jsx(Oe,{className:"h-4 w-4"});case"security_alert":return e.jsx(Y,{className:"h-4 w-4"});default:return e.jsx(Le,{className:"h-4 w-4"})}};if(t?.role!=="admin"&&t?.role!=="executive"&&t?.role!=="hq_management")return e.jsx("div",{className:"container mx-auto p-6",children:e.jsxs(be,{children:[e.jsx(re,{className:"h-4 w-4"}),e.jsx(Se,{children:"이 페이지에 접근할 권한이 없습니다."})]})});const _=y?Math.ceil(y.total/S):1;return e.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"로그 관리"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"시스템 활동 로그 및 보안 이벤트 모니터링"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(k,{variant:"outline",size:"sm",onClick:()=>A(),disabled:F,children:[e.jsx(V,{className:"h-4 w-4 mr-2"}),"새로고침"]}),t?.role==="admin"&&e.jsxs(k,{variant:"outline",size:"sm",onClick:()=>{const l=new Date;l.setDate(l.getDate()-30),confirm("30일 이전 로그를 아카이빙하시겠습니까?")&&ue.mutate(l.toISOString())},children:[e.jsx(Fe,{className:"h-4 w-4 mr-2"}),"아카이빙"]})]})]}),e.jsxs(js,{value:r,onValueChange:i,children:[e.jsxs(fs,{className:"grid grid-cols-6 w-full",children:[e.jsx(G,{value:"dashboard",children:"대시보드"}),e.jsx(G,{value:"logs",children:"활동 로그"}),e.jsx(G,{value:"login",children:"로그인 기록"}),e.jsx(G,{value:"changes",children:"데이터 변경"}),e.jsx(G,{value:"security",children:"보안 이벤트"}),t?.role==="admin"&&e.jsx(G,{value:"settings",children:"설정"})]}),e.jsx(J,{value:"dashboard",children:e.jsx(Ps,{stats:Q,loading:Z})}),e.jsx(J,{value:"logs",className:"space-y-4",children:e.jsxs(w,{children:[e.jsxs(T,{children:[e.jsx(R,{children:"시스템 활동 로그"}),e.jsx(ne,{children:"모든 시스템 활동 및 사용자 작업 기록"})]}),e.jsxs(b,{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-4 flex-wrap",children:[e.jsx("div",{className:"flex-1 min-w-[200px]",children:e.jsx(os,{placeholder:"검색 (사용자, 작업, IP 등)...",value:x,onChange:l=>j(l.target.value),className:"w-full"})}),e.jsxs(je,{value:m,onValueChange:f,children:[e.jsx(fe,{className:"w-[180px]",children:e.jsx(ge,{placeholder:"이벤트 유형"})}),e.jsxs(pe,{children:[e.jsx(P,{value:"all",children:"모든 이벤트"}),e.jsx(P,{value:"login",children:"로그인"}),e.jsx(P,{value:"logout",children:"로그아웃"}),e.jsx(P,{value:"data_create",children:"생성"}),e.jsx(P,{value:"data_update",children:"수정"}),e.jsx(P,{value:"data_delete",children:"삭제"}),e.jsx(P,{value:"security_alert",children:"보안 경고"})]})]}),e.jsxs(je,{value:d,onValueChange:o,children:[e.jsx(fe,{className:"w-[180px]",children:e.jsx(ge,{placeholder:"카테고리"})}),e.jsxs(pe,{children:[e.jsx(P,{value:"all",children:"모든 카테고리"}),e.jsx(P,{value:"auth",children:"인증"}),e.jsx(P,{value:"data",children:"데이터"}),e.jsx(P,{value:"system",children:"시스템"}),e.jsx(P,{value:"security",children:"보안"})]})]})]}),e.jsx("div",{className:"rounded-md border",children:e.jsxs(ce,{children:[e.jsx(de,{children:e.jsxs(I,{children:[e.jsx(v,{children:"시간"}),e.jsx(v,{children:"이벤트"}),e.jsx(v,{children:"사용자"}),e.jsx(v,{children:"작업"}),e.jsx(v,{children:"IP 주소"}),e.jsx(v,{children:"상태"}),e.jsx(v,{className:"w-[100px]",children:"상세"})]})}),e.jsx(oe,{children:F?e.jsx(I,{children:e.jsx(p,{colSpan:7,className:"text-center py-8",children:"로딩 중..."})}):y?.logs?.length===0?e.jsx(I,{children:e.jsx(p,{colSpan:7,className:"text-center py-8 text-muted-foreground",children:"로그가 없습니다."})}):y?.logs?.map(l=>e.jsxs(I,{children:[e.jsx(p,{className:"text-sm",children:$(new Date(l.createdAt),"PPp",{locale:U})}),e.jsx(p,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[M(l.eventType),e.jsx(C,{className:`${B(l.eventType)} text-white`,children:l.eventType})]})}),e.jsx(p,{children:e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"font-medium",children:l.userName||"System"}),l.userRole&&e.jsx("div",{className:"text-muted-foreground text-xs",children:l.userRole})]})}),e.jsx(p,{className:"max-w-[300px] truncate",children:l.action}),e.jsx(p,{className:"text-sm text-muted-foreground",children:l.ipAddress||"-"}),e.jsx(p,{children:l.responseStatus&&e.jsx(C,{variant:l.responseStatus>=400?"destructive":"default",children:l.responseStatus})}),e.jsx(p,{children:e.jsx(k,{variant:"ghost",size:"sm",onClick:()=>E(l),children:e.jsx(ie,{className:"h-4 w-4"})})})]},l.id))})]})}),_>1&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:["총 ",y?.total||0,"개 중 ",(s-1)*S+1,"-",Math.min(s*S,y?.total||0),"개 표시"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(k,{variant:"outline",size:"sm",onClick:()=>a(l=>Math.max(1,l-1)),disabled:s===1,children:[e.jsx(Ts,{className:"h-4 w-4"}),"이전"]}),e.jsx("div",{className:"flex items-center gap-1",children:Array.from({length:Math.min(5,_)},(l,ee)=>{const L=s-2+ee;return L>0&&L<=_?e.jsx(k,{variant:L===s?"default":"outline",size:"sm",onClick:()=>a(L),children:L},L):null})}),e.jsxs(k,{variant:"outline",size:"sm",onClick:()=>a(l=>Math.min(_,l+1)),disabled:s===_,children:["다음",e.jsx(xs,{className:"h-4 w-4"})]})]})]})]})]})}),e.jsx(J,{value:"login",children:e.jsx(ks,{userId:t?.role==="admin"?void 0:t?.id})}),e.jsx(J,{value:"changes",children:e.jsx(Ms,{})}),e.jsx(J,{value:"security",children:e.jsx(_s,{})}),t?.role==="admin"&&e.jsx(J,{value:"settings",children:e.jsx(Zs,{settings:D,onUpdate:l=>me.mutate(l),loading:z})})]}),e.jsx(Ns,{open:!!c,onOpenChange:l=>!l&&E(null),children:e.jsxs(vs,{className:"max-w-3xl max-h-[80vh]",children:[e.jsxs(ys,{children:[e.jsx(ws,{children:"로그 상세 정보"}),e.jsx(bs,{children:c&&$(new Date(c.createdAt),"PPpp",{locale:U})})]}),e.jsx(ms,{className:"h-[500px] pr-4",children:c&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(N,{className:"text-muted-foreground",children:"이벤트 유형"}),e.jsx("p",{className:"font-medium",children:c.eventType})]}),e.jsxs("div",{children:[e.jsx(N,{className:"text-muted-foreground",children:"카테고리"}),e.jsx("p",{className:"font-medium",children:c.eventCategory})]}),e.jsxs("div",{children:[e.jsx(N,{className:"text-muted-foreground",children:"사용자"}),e.jsx("p",{className:"font-medium",children:c.userName||"System"})]}),e.jsxs("div",{children:[e.jsx(N,{className:"text-muted-foreground",children:"역할"}),e.jsx("p",{className:"font-medium",children:c.userRole||"-"})]}),e.jsxs("div",{children:[e.jsx(N,{className:"text-muted-foreground",children:"IP 주소"}),e.jsx("p",{className:"font-medium",children:c.ipAddress||"-"})]}),e.jsxs("div",{children:[e.jsx(N,{className:"text-muted-foreground",children:"세션 ID"}),e.jsx("p",{className:"font-medium text-xs",children:c.sessionId||"-"})]})]}),e.jsx(ps,{}),e.jsxs("div",{children:[e.jsx(N,{className:"text-muted-foreground",children:"작업"}),e.jsx("p",{className:"font-medium",children:c.action})]}),c.requestPath&&e.jsxs("div",{children:[e.jsx(N,{className:"text-muted-foreground",children:"요청 경로"}),e.jsxs("p",{className:"font-medium",children:[c.requestMethod," ",c.requestPath]})]}),c.entityType&&e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(N,{className:"text-muted-foreground",children:"엔티티 유형"}),e.jsx("p",{className:"font-medium",children:c.entityType})]}),e.jsxs("div",{children:[e.jsx(N,{className:"text-muted-foreground",children:"엔티티 ID"}),e.jsx("p",{className:"font-medium",children:c.entityId})]})]}),c.details&&e.jsxs("div",{children:[e.jsx(N,{className:"text-muted-foreground",children:"추가 정보"}),e.jsx("pre",{className:"mt-2 p-3 bg-muted rounded-md text-sm overflow-x-auto",children:JSON.stringify(c.details,null,2)})]}),c.oldValue&&e.jsxs("div",{children:[e.jsx(N,{className:"text-muted-foreground",children:"이전 값"}),e.jsx("pre",{className:"mt-2 p-3 bg-muted rounded-md text-sm overflow-x-auto",children:JSON.stringify(c.oldValue,null,2)})]}),c.newValue&&e.jsxs("div",{children:[e.jsx(N,{className:"text-muted-foreground",children:"새 값"}),e.jsx("pre",{className:"mt-2 p-3 bg-muted rounded-md text-sm overflow-x-auto",children:JSON.stringify(c.newValue,null,2)})]}),c.errorMessage&&e.jsxs("div",{children:[e.jsx(N,{className:"text-muted-foreground text-red-500",children:"에러 메시지"}),e.jsx("p",{className:"mt-2 p-3 bg-red-50 rounded-md text-sm",children:c.errorMessage})]}),c.executionTime&&e.jsxs("div",{children:[e.jsx(N,{className:"text-muted-foreground",children:"실행 시간"}),e.jsxs("p",{className:"font-medium",children:[c.executionTime,"ms"]})]}),c.userAgent&&e.jsxs("div",{children:[e.jsx(N,{className:"text-muted-foreground",children:"User Agent"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:c.userAgent})]})]})})]})})]})}export{Dt as default};
