import{e as V,g as $,r as y,p as z,q as N,j as e,s as d,t as x,B as o,P as R,J as c,I as S,G as m,H as h,ap as G,ao as W,n as F}from"./index-DSMc0hwj-1757211968960.js";import{S as T,a as E,b as k,c as P,d as q}from"./select-BiVFjcIA-1757211968960.js";import{T as L}from"./textarea-D5vfdmoU-1757211968960.js";import{D as O,f as A,a as _,b as K,c as M,d as Q}from"./dialog-BZBxfzOI-1757211968960.js";import{A as X,f as Y,a as Z,b as ee,c as se,d as te,e as ie,g as ae,h as re}from"./alert-dialog-DRJXE2A7-1757211968960.js";import{U as ne}from"./users-CtjjgrfB-1757211968960.js";import{D as le}from"./dollar-sign-CITxebIq-1757211968960.js";import{S as oe}from"./square-pen-_ro71rQT-1757211968960.js";import{T as ce}from"./trash-2-DhcRrQkx-1757211968960.js";import"./index-Bm4OQpG7-1757211968960.js";import"./chevron-down-D8pi_gEz-1757211968960.js";import"./chevron-up-BVlf5esw-1757211968960.js";import"./index-DrU2OEM5-1757211968960.js";const w={admin:"관리자",executive:"임원",hq_management:"본사 관리자",project_manager:"프로젝트 매니저",field_worker:"현장 작업자"},H=[{value:"admin",label:"관리자"},{value:"executive",label:"임원"},{value:"hq_management",label:"본사 관리자"},{value:"project_manager",label:"프로젝트 매니저"},{value:"field_worker",label:"현장 작업자"}];function Ae(){const{toast:l}=V(),u=$(),[I,p]=y.useState(!1),[D,j]=y.useState(null),[a,r]=y.useState({role:"",maxAmount:"",description:""}),{data:n,isLoading:B,error:J}=z({queryKey:["approval-authorities"],queryFn:async()=>{const s=await fetch("/api/approval-authorities",{credentials:"include"});if(!s.ok)throw new Error("Failed to fetch approval authorities");return s.json()}}),v=N({mutationFn:async s=>{const t=await fetch("/api/approval-authorities",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({role:s.role,maxAmount:s.maxAmount,description:s.description,isActive:!0})});if(!t.ok){const i=await t.json();throw new Error(i.message||"Failed to create approval authority")}return t.json()},onSuccess:()=>{u.invalidateQueries({queryKey:["approval-authorities"]}),p(!1),b(),l({title:"성공",description:"승인 권한이 생성되었습니다."})},onError:s=>{l({title:"오류",description:s.message,variant:"destructive"})}}),g=N({mutationFn:async s=>{const t=await fetch(`/api/approval-authorities/${s.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({role:s.role,maxAmount:s.maxAmount,description:s.description,isActive:!0})});if(!t.ok){const i=await t.json();throw new Error(i.message||"Failed to update approval authority")}return t.json()},onSuccess:()=>{u.invalidateQueries({queryKey:["approval-authorities"]}),j(null),b(),l({title:"성공",description:"승인 권한이 수정되었습니다."})},onError:s=>{l({title:"오류",description:s.message,variant:"destructive"})}}),f=N({mutationFn:async s=>{const t=await fetch(`/api/approval-authorities/${s}`,{method:"DELETE",credentials:"include"});if(!t.ok){const i=await t.json();throw new Error(i.message||"Failed to delete approval authority")}return t.json()},onSuccess:()=>{u.invalidateQueries({queryKey:["approval-authorities"]}),l({title:"성공",description:"승인 권한이 삭제되었습니다."})},onError:s=>{l({title:"오류",description:s.message,variant:"destructive"})}}),b=()=>{r({role:"",maxAmount:"",description:""})},U=s=>{j(s),r({role:s.role,maxAmount:s.maxAmount.toString(),description:s.description||""})},C=s=>{if(s.preventDefault(),!a.role||!a.maxAmount){l({title:"오류",description:"역할과 승인 한도를 입력해주세요.",variant:"destructive"});return}D?g.mutate({id:D.id,...a}):v.mutate(a)};return B?e.jsx("div",{className:"container mx-auto py-8",children:e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900"})})}):J?e.jsx("div",{className:"container mx-auto py-8",children:e.jsx(d,{children:e.jsx(x,{className:"pt-6",children:e.jsx("div",{className:"text-center text-red-600",children:"승인 권한 데이터를 불러오는 중 오류가 발생했습니다."})})})}):e.jsxs("div",{className:"container mx-auto py-8",children:[e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"승인 권한 관리"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"사용자 역할별 승인 권한과 한도를 관리합니다"})]}),e.jsxs(O,{open:I,onOpenChange:p,children:[e.jsx(A,{asChild:!0,children:e.jsxs(o,{onClick:()=>{b(),j(null)},children:[e.jsx(R,{className:"w-4 h-4 mr-2"}),"새 권한 추가"]})}),e.jsxs(_,{children:[e.jsxs(K,{children:[e.jsx(M,{children:"승인 권한 추가"}),e.jsx(Q,{children:"새로운 역할의 승인 권한을 설정합니다."})]}),e.jsxs("form",{onSubmit:C,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(c,{htmlFor:"role",children:"역할"}),e.jsxs(T,{value:a.role,onValueChange:s=>r(t=>({...t,role:s})),children:[e.jsx(E,{children:e.jsx(k,{placeholder:"역할을 선택하세요"})}),e.jsx(P,{children:H.map(s=>e.jsx(q,{value:s.value,children:s.label},s.value))})]})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"maxAmount",children:"승인 한도 (원)"}),e.jsx(S,{id:"maxAmount",type:"number",value:a.maxAmount,onChange:s=>r(t=>({...t,maxAmount:s.target.value})),placeholder:"승인 가능한 최대 금액"})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"description",children:"설명 (선택사항)"}),e.jsx(L,{id:"description",value:a.description,onChange:s=>r(t=>({...t,description:s.target.value})),placeholder:"승인 권한에 대한 설명",rows:3})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(o,{type:"button",variant:"outline",onClick:()=>p(!1),children:"취소"}),e.jsx(o,{type:"submit",disabled:v.isPending,children:v.isPending?"생성 중...":"생성"})]})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[e.jsxs(d,{children:[e.jsxs(m,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(h,{className:"text-sm font-medium",children:"총 권한 수"}),e.jsx(G,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(x,{children:e.jsx("div",{className:"text-2xl font-bold",children:n?.length||0})})]}),e.jsxs(d,{children:[e.jsxs(m,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(h,{className:"text-sm font-medium",children:"활성 권한"}),e.jsx(ne,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(x,{children:e.jsx("div",{className:"text-2xl font-bold",children:n?.filter(s=>s.isActive).length||0})})]}),e.jsxs(d,{children:[e.jsxs(m,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(h,{className:"text-sm font-medium",children:"최고 한도"}),e.jsx(le,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(x,{children:e.jsx("div",{className:"text-2xl font-bold",children:n&&n.length>0?`${Math.max(...n.map(s=>s.maxAmount)).toLocaleString()}원`:"0원"})})]})]}),e.jsxs(d,{children:[e.jsxs(m,{children:[e.jsx(h,{children:"승인 권한 목록"}),e.jsx(W,{children:"각 역할별로 설정된 승인 권한과 한도를 확인할 수 있습니다."})]}),e.jsx(x,{children:n&&n.length>0?e.jsx("div",{className:"space-y-4",children:n.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(F,{variant:s.isActive?"default":"secondary",children:w[s.role]||s.role}),e.jsxs("div",{className:"text-lg font-semibold",children:[s.maxAmount.toLocaleString(),"원"]}),!s.isActive&&e.jsx(F,{variant:"outline",children:"비활성"})]}),s.description&&e.jsx("p",{className:"text-gray-600 mt-1 text-sm",children:s.description}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["생성일: ",new Date(s.createdAt).toLocaleDateString("ko-KR")]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs(O,{children:[e.jsx(A,{asChild:!0,children:e.jsx(o,{variant:"outline",size:"sm",onClick:()=>U(s),children:e.jsx(oe,{className:"w-4 h-4"})})}),e.jsxs(_,{children:[e.jsxs(K,{children:[e.jsx(M,{children:"승인 권한 수정"}),e.jsxs(Q,{children:[w[s.role]," 역할의 승인 권한을 수정합니다."]})]}),e.jsxs("form",{onSubmit:C,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(c,{htmlFor:"edit-role",children:"역할"}),e.jsxs(T,{value:a.role,onValueChange:t=>r(i=>({...i,role:t})),children:[e.jsx(E,{children:e.jsx(k,{})}),e.jsx(P,{children:H.map(t=>e.jsx(q,{value:t.value,children:t.label},t.value))})]})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"edit-maxAmount",children:"승인 한도 (원)"}),e.jsx(S,{id:"edit-maxAmount",type:"number",value:a.maxAmount,onChange:t=>r(i=>({...i,maxAmount:t.target.value}))})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"edit-description",children:"설명"}),e.jsx(L,{id:"edit-description",value:a.description,onChange:t=>r(i=>({...i,description:t.target.value})),rows:3})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(A,{asChild:!0,children:e.jsx(o,{type:"button",variant:"outline",children:"취소"})}),e.jsx(o,{type:"submit",disabled:g.isPending,children:g.isPending?"수정 중...":"수정"})]})]})]})]}),e.jsxs(X,{children:[e.jsx(Y,{asChild:!0,children:e.jsx(o,{variant:"outline",size:"sm",className:"text-red-600",children:e.jsx(ce,{className:"w-4 h-4"})})}),e.jsxs(Z,{children:[e.jsxs(ee,{children:[e.jsx(se,{children:"승인 권한 삭제"}),e.jsxs(te,{children:[w[s.role]," 역할의 승인 권한을 삭제하시겠습니까? 이 작업은 되돌릴 수 없습니다."]})]}),e.jsxs(ie,{children:[e.jsx(ae,{children:"취소"}),e.jsx(re,{onClick:()=>f.mutate(s.id),disabled:f.isPending,className:"bg-red-600 hover:bg-red-700",children:f.isPending?"삭제 중...":"삭제"})]})]})]})]})]},s.id))}):e.jsx("div",{className:"text-center py-8 text-gray-500",children:"설정된 승인 권한이 없습니다. 새 권한을 추가해보세요."})})]})]})}export{Ae as default};
