import{d as me,e as he,u as ue,K as ye,h as je,r as C,q as D,s as be,j as e,B as h,N as pe,f as H,F as ve,U as E,a as Ne,Q as W,M as fe,w as P,a3 as _,a4 as A,x as L,a9 as x,S as y,z as j,A as b,D as p,G as l,y as w,P as $e,o as we,T as Ce,E as J,k as v,J as O}from"./index-CrGSvBhN-1757224872882.js";import{T as De}from"./textarea-D0-S9llr-1757224872882.js";import{i as Ie}from"./authUtils-CcDzk6i0-1757224872882.js";import{A as ke}from"./attached-files-info-DXBy5C6W-1757224872882.js";import{D as Pe,a as Se,b as qe,c as Fe}from"./dialog-BrkPOfTv-1757224872882.js";import{O as Me}from"./order-preview-simple-XsRlVXN9-1757224872882.js";import{S as Te}from"./square-pen-CclaRBhv-1757224872882.js";import{D as Ee}from"./dollar-sign-B_g7TCsE-1757224872882.js";import{P as _e}from"./package-DB6yBWqi-1757224872882.js";import{C as Ae}from"./calendar-BCbn0W1Q-1757224872882.js";import{P as Le}from"./phone-D4_aghXZ-1757224872882.js";import{M as Y}from"./map-pin-BJx9DII6-1757224872882.js";import{S as Oe}from"./save-CDMTtV1v-1757224872882.js";import{f as I}from"./format-BDCjiJ8q-1757224872882.js";import"./alert-dialog-8olKaJG2-1757224872882.js";import"./index-9iGmfwU4-1757224872882.js";import"./download-lXIoYkmL-1757224872882.js";function as(){me();const{toast:N}=he(),[Ke,f]=ue(),K=ye(),c=K.id,{theme:X}=je(),s=X==="dark",[V,S]=C.useState(!1),[z,G]=C.useState(!1);console.log("OrderEdit params:",K),console.log("OrderEdit orderId:",c,typeof c);const[U,Z]=C.useState(!1),[n,m]=C.useState({projectId:"",vendorId:"",orderDate:"",deliveryDate:"",notes:"",templateId:"",items:[]}),{data:i,isLoading:R,error:q}=D({queryKey:[`/api/orders/${c}`],queryFn:()=>v("GET",`/api/orders/${c}`),enabled:!!c});console.log("OrderEdit Debug:",{orderId:c,order:i,orderLoading:R,orderError:q,enabled:!!c});const{data:ee}=D({queryKey:["/api/vendors"],queryFn:()=>v("GET","/api/vendors")}),{data:se}=D({queryKey:["/api/projects"],queryFn:()=>v("GET","/api/projects")}),{data:F}=D({queryKey:["/api/categories"],queryFn:()=>v("GET","/api/categories")}),re=F?.categories||[],$=F?.flatCategories||[];console.log("Categories data:",F),console.log("Categories (hierarchical):",re),console.log("Flat categories:",$);const{data:te}=D({queryKey:["/api/items"],queryFn:()=>v("GET","/api/items")}),u=te?.items||[];C.useEffect(()=>{if(i&&!U){if(u.length>0){const r=(i.items||[]).map(t=>{let a=null;return a=u.find(o=>o.name===t.itemName),a||(a=u.find(o=>o.name.includes(t.itemName)||t.itemName.includes(o.name))),!a&&t.itemId&&(a=u.find(o=>o.id===t.itemId)),{itemId:a?.id||null,itemName:t.itemName||"",quantity:parseFloat(t.quantity)||1,unitPrice:parseFloat(t.unitPrice)||0,specification:t.specification||"",notes:t.notes||"",unit:t.unit||"EA",majorCategory:t.majorCategory||"",middleCategory:t.middleCategory||"",minorCategory:t.minorCategory||""}});m({projectId:i.projectId?.toString()||"",vendorId:i.vendorId?.toString()||"",orderDate:i.orderDate?new Date(i.orderDate).toISOString().split("T")[0]:"",deliveryDate:i.deliveryDate?new Date(i.deliveryDate).toISOString().split("T")[0]:"",notes:i.notes||"",templateId:i.templateId?.toString()||"",items:r})}else m({projectId:i.projectId?.toString()||"",vendorId:i.vendorId?.toString()||"",orderDate:i.orderDate?new Date(i.orderDate).toISOString().split("T")[0]:"",deliveryDate:i.deliveryDate?new Date(i.deliveryDate).toISOString().split("T")[0]:"",notes:i.notes||"",templateId:i.templateId?.toString()||"",items:i.items||[]});Z(!0)}},[i,u,U]);const M=be({mutationFn:async r=>await v("PUT",`/api/orders/${c}`,r),onSuccess:()=>{N({title:"성공",description:"발주서가 수정되었습니다."}),O.invalidateQueries({queryKey:[`/api/orders/${c}`]}),O.invalidateQueries({queryKey:["/api/orders"]}),f(`/orders/${c}`)},onError:r=>{if(Ie(r)){N({title:"Unauthorized",description:"You are logged out. Logging in again...",variant:"destructive"}),setTimeout(()=>{f("/login")},500);return}N({title:"오류",description:"발주서 수정에 실패했습니다.",variant:"destructive"})}}),ae=r=>{if(r.preventDefault(),!n.vendorId||!n.orderDate||n.items.length===0){N({title:"오류",description:"모든 필수 필드를 입력해주세요.",variant:"destructive"});return}const t={projectId:n.projectId?parseInt(n.projectId):null,vendorId:parseInt(n.vendorId),orderDate:new Date(n.orderDate),deliveryDate:n.deliveryDate?new Date(n.deliveryDate):null,notes:n.notes,templateId:n.templateId?parseInt(n.templateId):null,items:n.items.map(a=>({itemId:a.itemId,itemName:a.itemName,quantity:Number(a.quantity),unitPrice:Number(a.unitPrice),specification:a.specification||"",notes:a.notes||"",unit:a.unit||"EA",majorCategory:a.majorCategory||"",middleCategory:a.middleCategory||"",minorCategory:a.minorCategory||""}))};M.mutate(t)},ie=async()=>{if(i?.attachments?.find(t=>t.mimeType==="application/pdf"&&t.originalName?.startsWith("PO_"))){S(!0);return}G(!0);try{(await v("POST",`/api/orders/${c}/regenerate-pdf`)).success&&(N({title:"PDF 생성 완료",description:"PDF가 생성되어 첨부파일에 저장되었습니다."}),O.invalidateQueries({queryKey:[`/api/orders/${c}`]}),S(!0))}catch(t){N({title:"PDF 생성 실패",description:t.message||"PDF 생성 중 오류가 발생했습니다.",variant:"destructive"})}finally{G(!1)}},le=()=>{m(r=>({...r,items:[...r.items,{itemId:null,itemName:"",quantity:1,unitPrice:0,specification:"",notes:"",unit:"EA",majorCategory:"",middleCategory:"",minorCategory:""}]}))},oe=r=>{m(t=>({...t,items:t.items.filter((a,o)=>o!==r)}))},g=(r,t,a)=>{m(o=>({...o,items:o.items.map((d,k)=>k===r?{...d,[t]:a}:d)}))},ne=(r,t)=>{const a=u.find(o=>o.id.toString()===t);a&&(g(r,"itemId",a.id),g(r,"itemName",a.name),g(r,"unitPrice",a.unitPrice||0),g(r,"specification",a.specification||""))},ce=()=>{const r=$.filter(t=>t.categoryType==="major");return console.log("getMajorCategories result:",r),r},de=r=>{if(!r||r==="none")return[];const t=$.find(o=>o.categoryType==="major"&&o.categoryName===r);if(!t)return console.log(`Major category not found: ${r}`),[];const a=$.filter(o=>o.categoryType==="middle"&&o.parentId===t.id);return console.log(`Middle categories for ${r}:`,a),a},xe=r=>{if(!r||r==="none")return[];const t=$.find(o=>o.categoryType==="middle"&&o.categoryName===r);if(!t)return console.log(`Middle category not found: ${r}`),[];const a=$.filter(o=>o.categoryType==="minor"&&o.parentId===t.id);return console.log(`Minor categories for ${r}:`,a),a},T=(r,t,a)=>{console.log(`Category change: index=${r}, type=${t}, value=${a}`);const o={},d=a==="__CLEAR__"?"":a;console.log(`Actual value after conversion: ${d}`),t==="major"?(o.majorCategory=d,o.middleCategory="",o.minorCategory=""):t==="middle"?(o.middleCategory=d,o.minorCategory=""):t==="minor"&&(o.minorCategory=d),console.log("Updates to apply:",o),m(k=>{const B=k.items.map((Q,ge)=>ge===r?{...Q,...o}:Q);return console.log(`Updated item ${r}:`,B[r]),{...k,items:B}})};return R?e.jsx("div",{className:"container mx-auto py-6",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/4 mb-6"}),e.jsx("div",{className:"h-96 bg-gray-200 rounded"})]})}):q?e.jsx("div",{className:"container mx-auto py-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-2xl font-bold mb-4",children:"발주서 로드 중 오류가 발생했습니다"}),e.jsx("p",{className:"mb-4 text-red-600",children:q.message}),e.jsx(h,{onClick:()=>f("/orders"),children:"발주서 목록으로 돌아가기"})]})}):i?e.jsxs("div",{className:`min-h-screen transition-colors ${s?"bg-gray-900":"bg-gray-50"}`,children:[e.jsx("div",{className:"max-w-[1366px] mx-auto",children:e.jsx("div",{className:`shadow-sm border-b transition-colors ${s?"bg-gray-800 border-gray-700":"bg-white border-gray-200"}`,children:e.jsx("div",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(h,{variant:"ghost",size:"sm",onClick:()=>f(`/orders/${c}`),className:`no-print h-8 px-2 transition-colors ${s?"text-gray-300 hover:text-gray-100 hover:bg-gray-700":"text-gray-600 hover:text-gray-900 hover:bg-gray-100"}`,"aria-label":"발주서 상세로 돌아가기",children:e.jsx(pe,{className:"h-4 w-4"})}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`p-2 rounded-lg transition-colors ${s?"bg-blue-900/20":"bg-blue-50"}`,children:e.jsx(Te,{className:`h-5 w-5 transition-colors ${s?"text-blue-400":"text-blue-600"}`})}),e.jsxs("div",{children:[e.jsx("h1",{className:`text-lg font-bold transition-colors ${s?"text-white":"text-gray-900"}`,children:"발주서 수정"}),e.jsxs("p",{className:`text-sm transition-colors ${s?"text-gray-400":"text-gray-500"}`,children:[i?.vendor?.name," • ",i?.orderDate?I(new Date(i.orderDate),"MM.dd"):"날짜 미정"]})]})]})]}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:`text-sm transition-colors ${s?"text-gray-400":"text-gray-500"}`,children:"총 발주금액"}),e.jsx("p",{className:`text-lg font-bold transition-colors ${s?"text-white":"text-gray-900"}`,children:H(n.items.reduce((r,t)=>{const a=(Number(t.quantity)||0)*(Number(t.unitPrice)||0);return r+a},0))})]})})]})})})}),e.jsx("div",{className:"px-6 py-4 space-y-4",children:e.jsxs("form",{onSubmit:ae,children:[i&&e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-3 mb-4",children:[e.jsx("div",{className:`shadow-sm rounded-lg border transition-colors ${s?"bg-gray-800 border-gray-700":"bg-white border-gray-200"}`,children:e.jsxs("div",{className:"p-3",children:[e.jsx("span",{className:`text-xs block mb-1 transition-colors ${s?"text-gray-400":"text-gray-600"}`,children:"진행 상태"}),e.jsx("div",{className:`inline-flex items-center px-2 py-1 rounded text-xs font-medium transition-colors ${i.status==="draft"?s?"bg-yellow-900/20 text-yellow-400":"bg-yellow-100 text-yellow-800":i.status==="pending_approval"?s?"bg-orange-900/20 text-orange-400":"bg-orange-100 text-orange-800":i.status==="approved"?s?"bg-blue-900/20 text-blue-400":"bg-blue-100 text-blue-800":i.status==="sent"?s?"bg-green-900/20 text-green-400":"bg-green-100 text-green-800":s?"bg-gray-700 text-gray-300":"bg-gray-100 text-gray-800"}`,children:i.status||"N/A"})]})}),e.jsx("div",{className:`shadow-sm rounded-lg border transition-colors ${s?"bg-gray-800 border-gray-700":"bg-white border-gray-200"}`,children:e.jsx("div",{className:"p-3",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("span",{className:`text-xs block mb-1 transition-colors ${s?"text-gray-400":"text-gray-600"}`,children:"발주 금액"}),e.jsx("span",{className:`text-lg font-bold transition-colors ${s?"text-blue-400":"text-blue-600"}`,children:H(n.items.reduce((r,t)=>{const a=(Number(t.quantity)||0)*(Number(t.unitPrice)||0);return r+a},0))})]}),e.jsx(Ee,{className:`h-4 w-4 mt-0.5 transition-colors ${s?"text-gray-500":"text-gray-400"}`})]})})}),e.jsx("div",{className:`shadow-sm rounded-lg border transition-colors ${s?"bg-gray-800 border-gray-700":"bg-white border-gray-200"}`,children:e.jsx("div",{className:"p-3",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("span",{className:`text-xs block mb-1 transition-colors ${s?"text-gray-400":"text-gray-600"}`,children:"품목 수"}),e.jsxs("span",{className:`text-lg font-bold transition-colors ${s?"text-white":"text-gray-900"}`,children:[n.items.length,"개"]})]}),e.jsx(_e,{className:`h-4 w-4 mt-0.5 transition-colors ${s?"text-gray-500":"text-gray-400"}`})]})})}),e.jsx("div",{className:`shadow-sm rounded-lg border transition-colors ${s?"bg-gray-800 border-gray-700":"bg-white border-gray-200"}`,children:e.jsx("div",{className:"p-3",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("span",{className:`text-xs block mb-1 transition-colors ${s?"text-gray-400":"text-gray-600"}`,children:"납기일"}),e.jsx("span",{className:`text-lg font-bold transition-colors ${s?"text-white":"text-gray-900"}`,children:i.deliveryDate?I(new Date(i.deliveryDate),"MM.dd"):"미정"})]}),e.jsx(Ae,{className:`h-4 w-4 mt-0.5 transition-colors ${s?"text-gray-500":"text-gray-400"}`})]})})})]}),i&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{className:`shadow-sm rounded-lg border transition-colors ${s?"bg-gray-800 border-gray-700":"bg-white border-gray-200"}`,children:[e.jsx("div",{className:`p-4 border-b transition-colors ${s?"border-gray-700":"border-gray-200"}`,children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:`p-2 rounded-lg mr-3 transition-colors ${s?"bg-blue-900/20":"bg-blue-50"}`,children:e.jsx(ve,{className:`h-5 w-5 transition-colors ${s?"text-blue-400":"text-blue-600"}`})}),e.jsx("h3",{className:`text-lg font-semibold transition-colors ${s?"text-white":"text-gray-900"}`,children:"발주서 정보"})]})}),e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:`block transition-colors ${s?"text-gray-400":"text-gray-600"}`,children:"발주번호"}),e.jsx("span",{className:`font-semibold transition-colors ${s?"text-gray-200":"text-gray-900"}`,children:i.orderNumber})]}),e.jsxs("div",{children:[e.jsx("span",{className:`block transition-colors ${s?"text-gray-400":"text-gray-600"}`,children:"발주일"}),e.jsx("span",{className:`transition-colors ${s?"text-gray-200":"text-gray-900"}`,children:i.orderDate?I(new Date(i.orderDate),"yyyy.MM.dd"):"-"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"block text-xs transition-colors text-gray-500",children:"시스템 등록일"}),e.jsx("span",{className:`text-xs transition-colors ${s?"text-gray-400":"text-gray-600"}`,children:i.createdAt?I(new Date(i.createdAt),"yyyy.MM.dd HH:mm"):"-"})]}),e.jsxs("div",{children:[e.jsx("span",{className:`block transition-colors ${s?"text-gray-400":"text-gray-600"}`,children:"담당자"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(E,{className:`h-4 w-4 transition-colors ${s?"text-blue-400":"text-blue-600"}`}),e.jsx("span",{className:`transition-colors ${s?"text-gray-200":"text-gray-900"}`,children:i.user?.firstName&&i.user?.lastName?`${i.user.lastName}${i.user.firstName}`:i.user?.email||"알 수 없음"})]})]}),e.jsxs("div",{children:[e.jsx("span",{className:`block transition-colors ${s?"text-gray-400":"text-gray-600"}`,children:"납기일"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ne,{className:`h-4 w-4 transition-colors ${s?"text-blue-400":"text-blue-600"}`}),e.jsx("span",{className:`transition-colors ${s?"text-gray-200":"text-gray-900"}`,children:i.deliveryDate?I(new Date(i.deliveryDate),"yyyy.MM.dd"):"-"})]})]})]}),i.notes&&e.jsxs("div",{className:`pt-4 border-t transition-colors ${s?"border-gray-700":"border-gray-100"}`,children:[e.jsx("span",{className:`text-sm block mb-2 transition-colors ${s?"text-gray-400":"text-gray-600"}`,children:"비고"}),e.jsx("div",{className:`text-sm p-3 rounded transition-colors ${s?"bg-gray-700 text-gray-200":"bg-gray-50 text-gray-700"}`,children:i.notes})]})]})]}),i.vendor&&e.jsxs("div",{className:`shadow-sm rounded-lg border transition-colors ${s?"bg-gray-800 border-gray-700":"bg-white border-gray-200"}`,children:[e.jsx("div",{className:`p-4 border-b transition-colors ${s?"border-gray-700":"border-gray-200"}`,children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:`p-2 rounded-lg mr-3 transition-colors ${s?"bg-blue-900/20":"bg-blue-50"}`,children:e.jsx(W,{className:`h-5 w-5 transition-colors ${s?"text-blue-400":"text-blue-600"}`})}),e.jsx("h3",{className:`text-lg font-semibold transition-colors ${s?"text-white":"text-gray-900"}`,children:"거래처 정보"})]})}),e.jsx("div",{className:"p-4 space-y-3",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:`text-xs block transition-colors ${s?"text-gray-400":"text-gray-600"}`,children:"업체명"}),e.jsx("span",{className:`text-sm font-medium transition-colors ${s?"text-gray-200":"text-gray-900"}`,children:i.vendor.name})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[e.jsxs("div",{children:[e.jsx("span",{className:`block transition-colors ${s?"text-gray-400":"text-gray-600"}`,children:"담당자"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(E,{className:`h-3 w-3 transition-colors ${s?"text-blue-400":"text-blue-600"}`}),e.jsx("span",{className:`transition-colors ${s?"text-gray-200":"text-gray-900"}`,children:i.vendor.contact||"-"})]})]}),e.jsxs("div",{children:[e.jsx("span",{className:`block transition-colors ${s?"text-gray-400":"text-gray-600"}`,children:"전화번호"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Le,{className:`h-3 w-3 transition-colors ${s?"text-blue-400":"text-blue-600"}`}),e.jsx("span",{className:`transition-colors ${s?"text-gray-200":"text-gray-900"}`,children:i.vendor.phone||"-"})]})]})]}),i.vendor.email&&e.jsxs("div",{children:[e.jsx("span",{className:`text-xs block transition-colors ${s?"text-gray-400":"text-gray-600"}`,children:"이메일"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(fe,{className:`h-3 w-3 transition-colors ${s?"text-blue-400":"text-blue-600"}`}),e.jsx("span",{className:`text-xs transition-colors ${s?"text-gray-200":"text-gray-900"}`,children:i.vendor.email})]})]}),i.vendor.address&&e.jsxs("div",{children:[e.jsx("span",{className:`text-xs block transition-colors ${s?"text-gray-400":"text-gray-600"}`,children:"주소"}),e.jsxs("div",{className:"flex items-start gap-1",children:[e.jsx(Y,{className:`h-3 w-3 mt-0.5 flex-shrink-0 transition-colors ${s?"text-blue-400":"text-blue-600"}`}),e.jsx("span",{className:`text-xs transition-colors ${s?"text-gray-200":"text-gray-900"}`,children:i.vendor.address})]})]})]})})]}),i.project&&e.jsxs("div",{className:`shadow-sm rounded-lg border transition-colors ${s?"bg-gray-800 border-gray-700":"bg-white border-gray-200"}`,children:[e.jsx("div",{className:`p-4 border-b transition-colors ${s?"border-gray-700":"border-gray-200"}`,children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:`p-2 rounded-lg mr-3 transition-colors ${s?"bg-blue-900/20":"bg-blue-50"}`,children:e.jsx(W,{className:`h-5 w-5 transition-colors ${s?"text-blue-400":"text-blue-600"}`})}),e.jsx("h3",{className:`text-lg font-semibold transition-colors ${s?"text-white":"text-gray-900"}`,children:"현장 정보"})]})}),e.jsx("div",{className:"p-4 space-y-3",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:`text-xs block transition-colors ${s?"text-gray-400":"text-gray-600"}`,children:"현장명"}),e.jsx("span",{className:`text-sm font-medium transition-colors ${s?"text-gray-200":"text-gray-900"}`,children:i.project.projectName}),e.jsxs("span",{className:`text-xs block transition-colors ${s?"text-gray-400":"text-gray-500"}`,children:["(",i.project.projectCode,")"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[e.jsxs("div",{children:[e.jsx("span",{className:`block transition-colors ${s?"text-gray-400":"text-gray-600"}`,children:"담당자"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(E,{className:`h-3 w-3 transition-colors ${s?"text-blue-400":"text-blue-600"}`}),e.jsx("span",{className:`transition-colors ${s?"text-gray-200":"text-gray-900"}`,children:i.project.projectManager||"-"})]})]}),e.jsxs("div",{children:[e.jsx("span",{className:`block transition-colors ${s?"text-gray-400":"text-gray-600"}`,children:"위치"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Y,{className:`h-3 w-3 transition-colors ${s?"text-blue-400":"text-blue-600"}`}),e.jsx("span",{className:`transition-colors ${s?"text-gray-200":"text-gray-900"}`,children:i.project.location||"-"})]})]})]}),i.project.description&&e.jsxs("div",{children:[e.jsx("span",{className:`text-xs block mb-1 transition-colors ${s?"text-gray-400":"text-gray-600"}`,children:"설명"}),e.jsx("div",{className:`text-xs p-2 rounded transition-colors ${s?"bg-gray-700 text-gray-200":"bg-gray-50 text-gray-700"}`,children:i.project.description})]})]})})]})]}),e.jsxs(P,{className:`mb-6 transition-colors ${s?"bg-gray-800 border-gray-700":"bg-white border-gray-200"}`,children:[e.jsx(_,{children:e.jsx(A,{className:`transition-colors ${s?"text-white":"text-gray-900"}`,children:"기본 정보"})}),e.jsxs(L,{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"project",children:"프로젝트"}),e.jsxs(y,{value:n.projectId,onValueChange:r=>m(t=>({...t,projectId:r})),children:[e.jsx(j,{children:e.jsx(b,{placeholder:"프로젝트를 선택하세요"})}),e.jsx(p,{children:se?.map(r=>e.jsx(l,{value:r.id.toString(),children:r.projectName},r.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"vendor",children:"거래처 *"}),e.jsxs(y,{value:n.vendorId,onValueChange:r=>m(t=>({...t,vendorId:r})),children:[e.jsx(j,{children:e.jsx(b,{placeholder:"거래처를 선택하세요"})}),e.jsx(p,{children:ee?.map(r=>e.jsx(l,{value:r.id.toString(),children:r.name},r.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"orderDate",children:"발주일자 *"}),e.jsx(w,{id:"orderDate",type:"date",value:n.orderDate,onChange:r=>m(t=>({...t,orderDate:r.target.value})),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"deliveryDate",children:"납품희망일"}),e.jsx(w,{id:"deliveryDate",type:"date",value:n.deliveryDate,onChange:r=>m(t=>({...t,deliveryDate:r.target.value}))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"notes",children:"비고"}),e.jsx(De,{id:"notes",placeholder:"추가 정보나 요청사항을 입력하세요",value:n.notes,onChange:r=>m(t=>({...t,notes:r.target.value})),rows:3})]})]})]}),e.jsxs(P,{className:`mb-6 transition-colors ${s?"bg-gray-800 border-gray-700":"bg-white border-gray-200"}`,children:[e.jsx(_,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(A,{className:`transition-colors ${s?"text-white":"text-gray-900"}`,children:"발주 품목"}),e.jsxs(h,{type:"button",onClick:le,className:`transition-colors ${s?"bg-blue-600 hover:bg-blue-500 text-white":"bg-blue-600 hover:bg-blue-700 text-white"}`,children:[e.jsx($e,{className:"h-4 w-4 mr-2"}),"품목 추가"]})]})}),e.jsxs(L,{children:[n.items.length===0?e.jsx("div",{className:`text-center py-8 transition-colors ${s?"text-gray-400":"text-gray-500"}`,children:"발주할 품목을 추가해주세요"}):e.jsx("div",{className:"space-y-4",children:n.items.map((r,t)=>e.jsxs(P,{className:`p-4 border transition-all ${s?"bg-gradient-to-br from-gray-700 to-gray-800 hover:shadow-lg border-gray-600":"bg-gradient-to-br from-gray-50 to-white hover:shadow-md border-gray-200"}`,children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(we,{variant:"outline",className:`text-sm transition-colors ${s?"bg-blue-900/20 text-blue-300 border-blue-700":"bg-blue-50 text-blue-700 border-blue-200"}`,children:["품목 #",t+1]}),e.jsx("span",{className:`text-xs transition-colors ${s?"text-gray-400":"text-gray-500"}`,children:r.itemName?`• ${r.itemName}`:""})]}),e.jsx(h,{type:"button",variant:"ghost",size:"icon",onClick:()=>oe(t),className:`h-8 w-8 transition-colors ${s?"text-gray-400 hover:text-red-400 hover:bg-red-950":"text-gray-400 hover:text-red-600 hover:bg-red-50"}`,children:e.jsx(Ce,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-5 gap-3 mb-3",children:[e.jsxs("div",{className:"col-span-2 sm:col-span-3 md:col-span-2",children:[e.jsx(x,{className:`text-xs font-medium mb-1 block transition-colors ${s?"text-gray-300":"text-gray-700"}`,children:"품목명 *"}),e.jsxs(y,{value:r.itemId?.toString()||"",onValueChange:a=>ne(t,a),children:[e.jsx(j,{children:e.jsx(b,{placeholder:r.itemName||"품목 선택"})}),e.jsx(p,{children:u.map(a=>e.jsx(l,{value:a.id.toString(),children:a.name},a.id))})]})]}),e.jsxs("div",{children:[e.jsx(x,{className:`text-xs font-medium mb-1 block transition-colors ${s?"text-gray-300":"text-gray-700"}`,children:"수량 *"}),e.jsx(w,{type:"number",value:r.quantity||0,onChange:a=>{const o=a.target.value;if(o===""||o==="0")g(t,"quantity",0);else{const d=parseFloat(o);!isNaN(d)&&d>=0&&g(t,"quantity",d)}},onBlur:a=>{const o=parseFloat(a.target.value);(isNaN(o)||o<=0)&&g(t,"quantity",1)},min:"0.01",step:"0.01",required:!0,className:`transition-colors ${s?"bg-gray-700 border-gray-600 text-gray-200":"bg-white border-gray-300 text-gray-900"}`})]}),e.jsxs("div",{children:[e.jsx(x,{className:`text-xs font-medium mb-1 block transition-colors ${s?"text-gray-300":"text-gray-700"}`,children:"단위"}),e.jsxs(y,{value:r.unit||"EA",onValueChange:a=>{console.log(`Unit selected: ${a}`),g(t,"unit",a)},children:[e.jsx(j,{children:e.jsx(b,{placeholder:"단위 선택"})}),e.jsxs(p,{children:[e.jsx(l,{value:"EA",children:"EA"}),e.jsx(l,{value:"개",children:"개"}),e.jsx(l,{value:"박스",children:"박스"}),e.jsx(l,{value:"세트",children:"세트"}),e.jsx(l,{value:"kg",children:"kg"}),e.jsx(l,{value:"g",children:"g"}),e.jsx(l,{value:"L",children:"L"}),e.jsx(l,{value:"mL",children:"mL"}),e.jsx(l,{value:"m",children:"m"}),e.jsx(l,{value:"cm",children:"cm"}),e.jsx(l,{value:"mm",children:"mm"}),e.jsx(l,{value:"㎡",children:"㎡"}),e.jsx(l,{value:"㎥",children:"㎥"}),e.jsx(l,{value:"매",children:"매"}),e.jsx(l,{value:"장",children:"장"}),e.jsx(l,{value:"권",children:"권"}),e.jsx(l,{value:"부",children:"부"}),e.jsx(l,{value:"대",children:"대"}),e.jsx(l,{value:"식",children:"식"}),e.jsx(l,{value:"조",children:"조"}),e.jsx(l,{value:"타",children:"타"}),e.jsx(l,{value:"켤레",children:"켤레"}),e.jsx(l,{value:"통",children:"통"}),e.jsx(l,{value:"병",children:"병"}),e.jsx(l,{value:"캔",children:"캔"}),e.jsx(l,{value:"포",children:"포"}),e.jsx(l,{value:"봉",children:"봉"}),e.jsx(l,{value:"팩",children:"팩"}),e.jsx(l,{value:"롤",children:"롤"}),e.jsx(l,{value:"쌍",children:"쌍"}),e.jsx(l,{value:"톤",children:"톤"}),e.jsx(l,{value:"되",children:"되"}),e.jsx(l,{value:"말",children:"말"}),e.jsx(l,{value:"자루",children:"자루"}),e.jsx(l,{value:"마리",children:"마리"}),e.jsx(l,{value:"모",children:"모"}),e.jsx(l,{value:"평",children:"평"}),e.jsx(l,{value:"보루",children:"보루"}),e.jsx(l,{value:"묶음",children:"묶음"}),e.jsx(l,{value:"다스",children:"다스"}),e.jsx(l,{value:"갑",children:"갑"}),e.jsx(l,{value:"곽",children:"곽"}),e.jsx(l,{value:"판",children:"판"}),e.jsx(l,{value:"그루",children:"그루"}),e.jsx(l,{value:"주",children:"주"}),e.jsx(l,{value:"본",children:"본"}),e.jsx(l,{value:"줄",children:"줄"})]})]})]}),e.jsxs("div",{children:[e.jsx(x,{className:`text-xs font-medium mb-1 block transition-colors ${s?"text-gray-300":"text-gray-700"}`,children:"단가"}),e.jsx(w,{type:"number",value:r.unitPrice||0,onChange:a=>{const o=a.target.value;if(o===""||o==="0")g(t,"unitPrice",0);else{const d=parseFloat(o);!isNaN(d)&&d>=0&&g(t,"unitPrice",d)}},min:"0",step:"0.01",className:`transition-colors ${s?"bg-gray-700 border-gray-600 text-gray-200":"bg-white border-gray-300 text-gray-900"}`})]}),e.jsxs("div",{children:[e.jsx(x,{className:`text-xs font-medium mb-1 block transition-colors ${s?"text-gray-300":"text-gray-700"}`,children:"총액"}),e.jsxs("div",{className:`h-10 px-3 py-2 border rounded-md flex items-center font-semibold transition-colors ${s?"bg-blue-900/20 border-blue-700 text-blue-300":"bg-blue-50 border-blue-200 text-blue-700"}`,children:["₩",(Number(r.quantity)*Number(r.unitPrice)).toLocaleString("ko-KR")]})]})]}),e.jsxs("div",{className:`grid grid-cols-2 sm:grid-cols-3 md:grid-cols-5 gap-3 border-t pt-3 mt-3 transition-colors ${s?"border-gray-600":"border-gray-200"}`,children:[e.jsxs("div",{children:[e.jsx(x,{className:`text-xs font-medium mb-1 block transition-colors ${s?"text-gray-300":"text-gray-700"}`,children:"대분류"}),e.jsxs(y,{value:r.majorCategory||"",onValueChange:a=>{console.log(`Major category selected: ${a}`),T(t,"major",a)},children:[e.jsx(j,{className:`transition-colors ${s?"bg-gray-700 border-gray-600 text-gray-200":"bg-white border-gray-300 text-gray-900"}`,children:e.jsx(b,{placeholder:"대분류 선택"})}),e.jsxs(p,{children:[e.jsx(l,{value:"__CLEAR__",children:"선택 해제"}),ce().map(a=>e.jsx(l,{value:a.categoryName,children:a.categoryName},`major-${a.id}`))]})]})]}),e.jsxs("div",{children:[e.jsx(x,{className:`text-xs font-medium mb-1 block transition-colors ${s?"text-gray-300":"text-gray-700"}`,children:"중분류"}),e.jsxs(y,{value:r.middleCategory||"",onValueChange:a=>{console.log(`Middle category selected: ${a}`),T(t,"middle",a)},disabled:!r.majorCategory,children:[e.jsx(j,{className:`transition-colors ${s?"bg-gray-700 border-gray-600 text-gray-200":"bg-white border-gray-300 text-gray-900"}`,children:e.jsx(b,{placeholder:r.majorCategory?"중분류 선택":"대분류 먼저 선택"})}),e.jsxs(p,{children:[e.jsx(l,{value:"__CLEAR__",children:"선택 해제"}),de(r.majorCategory||"").map(a=>e.jsx(l,{value:a.categoryName,children:a.categoryName},`middle-${a.id}`))]})]})]}),e.jsxs("div",{children:[e.jsx(x,{className:`text-xs font-medium mb-1 block transition-colors ${s?"text-gray-300":"text-gray-700"}`,children:"소분류"}),e.jsxs(y,{value:r.minorCategory||"",onValueChange:a=>{console.log(`Minor category selected: ${a}`),T(t,"minor",a)},disabled:!r.middleCategory,children:[e.jsx(j,{className:`transition-colors ${s?"bg-gray-700 border-gray-600 text-gray-200":"bg-white border-gray-300 text-gray-900"}`,children:e.jsx(b,{placeholder:r.middleCategory?"소분류 선택":"중분류 먼저 선택"})}),e.jsxs(p,{children:[e.jsx(l,{value:"__CLEAR__",children:"선택 해제"}),xe(r.middleCategory||"").map(a=>e.jsx(l,{value:a.categoryName,children:a.categoryName},`minor-${a.id}`))]})]})]}),e.jsxs("div",{children:[e.jsx(x,{className:`text-xs font-medium mb-1 block transition-colors ${s?"text-gray-300":"text-gray-700"}`,children:"규격"}),e.jsx(w,{value:r.specification,onChange:a=>g(t,"specification",a.target.value),placeholder:"규격 입력",className:`transition-colors ${s?"bg-gray-700 border-gray-600 text-gray-200":"bg-white border-gray-300 text-gray-900"}`})]}),e.jsxs("div",{children:[e.jsx(x,{className:`text-xs font-medium mb-1 block transition-colors ${s?"text-gray-300":"text-gray-700"}`,children:"비고"}),e.jsx(w,{value:r.notes,onChange:a=>g(t,"notes",a.target.value),placeholder:"비고 입력",className:`transition-colors ${s?"bg-gray-700 border-gray-600 text-gray-200":"bg-white border-gray-300 text-gray-900"}`})]})]})]},t))}),n.items.length>0&&e.jsx("div",{className:"mt-6 space-y-4",children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:`p-4 rounded-lg transition-colors ${s?"bg-blue-900/20 border border-blue-700":"bg-blue-50"}`,children:[e.jsx("div",{className:`text-sm mb-1 transition-colors ${s?"text-blue-400":"text-blue-600"}`,children:"총 품목 수"}),e.jsxs("div",{className:`text-xl font-bold transition-colors ${s?"text-blue-300":"text-blue-700"}`,children:[n.items.length,"개"]})]}),e.jsxs("div",{className:`p-4 rounded-lg transition-colors ${s?"bg-green-900/20 border border-green-700":"bg-green-50"}`,children:[e.jsx("div",{className:`text-sm mb-1 transition-colors ${s?"text-green-400":"text-green-600"}`,children:"총 수량"}),e.jsx("div",{className:`text-xl font-bold transition-colors ${s?"text-green-300":"text-green-700"}`,children:n.items.reduce((r,t)=>r+(Number(t.quantity)||0),0)})]}),e.jsxs("div",{className:`p-4 rounded-lg transition-colors ${s?"bg-purple-900/20 border border-purple-700":"bg-purple-50"}`,children:[e.jsx("div",{className:`text-sm mb-1 transition-colors ${s?"text-purple-400":"text-purple-600"}`,children:"대분류 수"}),e.jsxs("div",{className:`text-xl font-bold transition-colors ${s?"text-purple-300":"text-purple-700"}`,children:[new Set(n.items.map(r=>r.majorCategory).filter(r=>r)).size,"개"]})]}),e.jsxs("div",{className:`p-4 rounded-lg transition-colors ${s?"bg-orange-900/20 border border-orange-700":"bg-orange-50"}`,children:[e.jsx("div",{className:`text-sm mb-1 transition-colors ${s?"text-orange-400":"text-orange-600"}`,children:"총 합계 금액"}),e.jsxs("div",{className:`text-xl font-bold transition-colors ${s?"text-orange-300":"text-orange-700"}`,children:["₩",n.items.reduce((r,t)=>{const a=(Number(t.quantity)||0)*(Number(t.unitPrice)||0);return r+a},0).toLocaleString()]})]})]})})]})]}),i?.attachments&&i.attachments.length>0&&e.jsxs(P,{className:`mb-6 transition-colors ${s?"bg-gray-800 border-gray-700":"bg-white border-gray-200"}`,children:[e.jsx(_,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(A,{className:`transition-colors ${s?"text-white":"text-gray-900"}`,children:"첨부파일"}),e.jsx("div",{className:"flex gap-2",children:e.jsx(h,{variant:"outline",size:"sm",onClick:ie,disabled:z,className:`h-8 px-3 text-xs transition-colors ${s?"border-gray-600 text-gray-300 hover:bg-gray-700":"border-gray-300 text-gray-700 hover:bg-gray-50"}`,children:z?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin h-3 w-3 mr-1 border border-gray-300 border-t-transparent rounded-full"}),"생성 중..."]}):i?.attachments?.find(t=>t.mimeType==="application/pdf"&&t.originalName?.startsWith("PO_"))?e.jsxs(e.Fragment,{children:[e.jsx(J,{className:"h-4 w-4 mr-1"}),"PDF 미리보기"]}):e.jsxs(e.Fragment,{children:[e.jsx(J,{className:"h-4 w-4 mr-1"}),"PDF 생성 및 미리보기"]})})})]})}),e.jsx(L,{children:e.jsx(ke,{attachments:i.attachments,orderId:i.id,isDarkMode:s})})]}),e.jsxs("div",{className:"flex justify-end space-x-4",children:[e.jsx(h,{type:"button",variant:"outline",onClick:()=>f(`/orders/${c}`),className:`transition-colors ${s?"border-gray-600 text-gray-300 hover:bg-gray-700":"border-gray-300 text-gray-700 hover:bg-gray-50"}`,children:"취소"}),e.jsxs(h,{type:"submit",disabled:M.isPending,className:`transition-colors ${s?"bg-blue-600 hover:bg-blue-500 text-white":"bg-blue-600 hover:bg-blue-700 text-white"}`,children:[e.jsx(Oe,{className:"h-4 w-4 mr-2"}),M.isPending?"저장 중...":"저장"]})]})]})}),V&&i&&e.jsx(Pe,{open:V,onOpenChange:S,children:e.jsxs(Se,{className:"max-w-4xl max-h-[90vh]",children:[e.jsx(qe,{children:e.jsx(Fe,{children:"발주서 미리보기"})}),e.jsx(Me,{order:i})]})})]}):e.jsx("div",{className:"container mx-auto py-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-2xl font-bold mb-4",children:"발주서를 찾을 수 없습니다"}),e.jsxs("p",{className:"mb-4 text-gray-600",children:["OrderID: ",c]}),e.jsx(h,{onClick:()=>f("/orders"),children:"발주서 목록으로 돌아가기"})]})})}export{as as default};
