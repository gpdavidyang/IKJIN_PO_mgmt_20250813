import{v as ve,r as p,j as e,ah as T,a as _,B as f,G as ye,h as K,w as A,m as Y,L as g,I as k,P as H,p as R,A as ue,D as je,s as q,E as ee,F as M,X as se,a8 as L,c as be}from"./index-DyuWuW3j.js";import{A as W,a as Q}from"./alert-BRm2bKzF.js";import{P as we}from"./progress-aM8EAVnZ.js";import{U as X}from"./upload-BSxzbMQK.js";import{S as te,a as ae,b as re,c as le,d as ne}from"./select-DhBGD1cJ.js";import{T as ge}from"./textarea-C-UOhm8J.js";import{C as ie}from"./calendar-BOYM4E41.js";import{P as ce,a as oe,b as de}from"./popover-DaT0tfxN.js";import{C as me}from"./calendar-CtLmm0_6.js";import{T as Ne}from"./trash-2-CpBWm7um.js";import{f as xe}from"./format-BqlaHE6C.js";import{k as he}from"./ko-DHTEdlBI.js";import{T as Ce,a as Se,b as V,c as J}from"./tabs-RgCA-uix.js";import{C as Pe}from"./checkbox-kCZv8LPg.js";import{M as Fe}from"./mail-07iDKyG_.js";import{R as fe}from"./refresh-cw-BeQ9xfD3.js";import{D as Z}from"./download-BWUsefu8.js";import{P as De}from"./paperclip-BbopF56K.js";import{S as Ee}from"./save-CsiLZzs_.js";import{S as ke}from"./send-hauSSxoA.js";import{A as Ae}from"./arrow-right-BWlfUgX5.js";import{I as G}from"./info-ZGD2p2Hx.js";import{T as Te}from"./trending-up-CT2qy-6L.js";import{T as Oe}from"./triangle-alert-CStjjXXy.js";import"./index-BdQq_4o_.js";import"./index-CNa4HaJl.js";import"./chevron-down-McvCdMH5.js";import"./chevron-up-DkMcZm1w.js";import"./chevron-left-60vzIGCk.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pe=ve("Lightbulb",[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]]),Ie=({onDataExtracted:a,onProcessedFileReady:N})=>{const[i,n]=p.useState(!1),[b,w]=p.useState(!1),[u,C]=p.useState(null),[P,y]=p.useState("idle"),[F,S]=p.useState(""),[l,r]=p.useState([]),[d,v]=p.useState(0),D=p.useCallback(s=>{s.preventDefault(),n(!0)},[]),O=p.useCallback(s=>{s.preventDefault(),n(!1)},[]),I=p.useCallback(s=>{s.preventDefault(),n(!1);const x=Array.from(s.dataTransfer.files).find(c=>c.type==="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"||c.name.endsWith(".xlsx"));x?z(x):(S("ì—‘ì…€ íŒŒì¼(.xlsx)ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤."),y("error"))},[]),$=s=>{const m=s.target.files?.[0];m&&z(m)},z=async s=>{C(s),w(!0),y("processing"),S("");const m=new FormData;m.append("file",s);try{const x=await fetch("/api/po-template/upload",{method:"POST",body:m});if(!x.ok)throw new Error("íŒŒì¼ ì—…ë¡œë“œ ì‹¤íŒ¨");const c=await x.json();if(c.success&&c.data.orders.length>0){r(c.data.orders),y("success");try{const t=await fetch("/api/po-template/extract-sheets",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({filePath:c.data.filePath,sheetNames:["ê°‘ì§€","ì„ì§€"]})});if(t.ok){const o=await t.json();if(o.success&&o.data.extractedPath){const j=`/uploads/${o.data.extractedPath.split("/").pop()}`,E=`${s.name.replace(".xlsx","")}_Inputì œê±°.xlsx`;console.log("ğŸ”· ì²˜ë¦¬ëœ Excel íŒŒì¼ ì •ë³´:",{processedFileUrl:j,processedFileName:E}),N?.({url:j,name:E})}}else{console.warn("âš ï¸ Extract sheets API ì‹¤íŒ¨, ê¸°ë³¸ê°’ ì‚¬ìš©");const h=`/uploads/extracted-${Date.now()}.xlsx`,j=`${s.name.replace(".xlsx","")}_Inputì œê±°.xlsx`;N?.({url:h,name:j})}}catch(t){console.error("Extract sheets í˜¸ì¶œ ì‹¤íŒ¨:",t);const h=`/uploads/extracted-${Date.now()}.xlsx`,j=`${s.name.replace(".xlsx","")}_Inputì œê±°.xlsx`;N?.({url:h,name:j})}if(c.data.orders.length===1){const t=c.data.orders[0],o={...t,projectName:t.siteName||t.projectName,orderDate:t.orderDate,deliveryDate:t.dueDate||t.deliveryDate,items:(t.items||[]).map(h=>({...h,name:h.itemName||h.name,unit:h.unit||"EA"}))};a(o)}}else throw new Error(c.error||"ë°ì´í„° ì¶”ì¶œ ì‹¤íŒ¨")}catch(x){S(x.message||"íŒŒì¼ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."),y("error")}finally{w(!1)}},U=async()=>{if(l[d]&&u){const s=l[d],m={...s,projectName:s.siteName||s.projectName,orderDate:s.orderDate,deliveryDate:s.dueDate||s.deliveryDate,items:(s.items||[]).map(x=>({...x,name:x.itemName||x.name,unit:x.unit||"EA"}))};a(m)}};return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{onDragOver:D,onDragLeave:O,onDrop:I,className:`
          border-2 border-dashed rounded-lg ${P==="success"?"p-4":"p-8"} text-center transition-all
          ${i?"border-blue-500 bg-blue-50":"border-gray-300 hover:border-gray-400"}
          ${b?"opacity-50 pointer-events-none":""}
        `,children:b?e.jsxs("div",{className:"space-y-2",children:[e.jsx(T,{className:"w-8 h-8 mx-auto text-blue-600 animate-spin"}),e.jsx("p",{className:"text-sm text-gray-600",children:"íŒŒì¼ì„ ì²˜ë¦¬í•˜ê³  ìˆìŠµë‹ˆë‹¤..."})]}):P==="success"?e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(_,{className:"w-8 h-8 text-green-600"}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"text-sm font-medium text-green-700",children:u?.name}),e.jsxs("p",{className:"text-xs text-gray-600",children:[l.length,"ê°œì˜ ë°œì£¼ì„œ ê°ì§€ë¨"]})]})]}),e.jsx(f,{variant:"outline",size:"sm",onClick:()=>{y("idle"),r([]),C(null)},children:"ë‹¤ì‹œ ì—…ë¡œë“œ"})]}):e.jsxs(e.Fragment,{children:[e.jsx(ye,{className:"w-12 h-12 mx-auto text-gray-400 mb-4"}),e.jsx("p",{className:"text-lg font-medium text-gray-700 mb-2",children:"ì—‘ì…€ íŒŒì¼ì„ ë“œë˜ê·¸í•˜ì—¬ ë†“ìœ¼ì„¸ìš”"}),e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"ë˜ëŠ”"}),e.jsx("input",{type:"file",accept:".xlsx",onChange:$,className:"hidden",id:"excel-upload"}),e.jsx("label",{htmlFor:"excel-upload",children:e.jsx(f,{variant:"outline",asChild:!0,children:e.jsxs("span",{className:"cursor-pointer",children:[e.jsx(X,{className:"w-4 h-4 mr-2"}),"íŒŒì¼ ì„ íƒ"]})})})]})}),P==="error"&&F&&e.jsxs(W,{variant:"destructive",children:[e.jsx(K,{className:"h-4 w-4"}),e.jsx(Q,{children:F})]}),l.length>1&&P==="success"&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700",children:"ë°œì£¼ì„œë¥¼ ì„ íƒí•˜ì„¸ìš”:"}),e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto border rounded-lg p-2 bg-gray-50",children:l.map((s,m)=>e.jsx("div",{onClick:()=>v(m),className:`
                  p-3 border rounded-lg cursor-pointer transition-colors
                  ${d===m?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300 bg-white"}
                `,children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:s.orderNumber}),e.jsxs("p",{className:"text-xs text-gray-600",children:[s.vendorName," | ",s.projectName]})]}),e.jsxs(A,{variant:"secondary",children:[s.items?.length||0,"ê°œ í’ˆëª©"]})]}),s.items&&s.items.length>0&&e.jsxs("div",{className:"pt-2 border-t border-gray-200",children:[e.jsxs("table",{className:"w-full text-xs",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-gray-500",children:[e.jsx("th",{className:"text-left font-normal",children:"í’ˆëª©"}),e.jsx("th",{className:"text-right font-normal",children:"ìˆ˜ëŸ‰"}),e.jsx("th",{className:"text-right font-normal",children:"ë‹¨ê°€"}),e.jsx("th",{className:"text-right font-normal",children:"ê¸ˆì•¡"})]})}),e.jsx("tbody",{children:s.items.slice(0,2).map((x,c)=>e.jsxs("tr",{children:[e.jsx("td",{className:"text-gray-600 truncate max-w-[150px] pr-2",children:x.itemName}),e.jsx("td",{className:"text-right text-gray-700",children:Math.floor(x.quantity||0).toLocaleString()}),e.jsx("td",{className:"text-right text-gray-700",children:Math.floor(x.unitPrice||0).toLocaleString()}),e.jsx("td",{className:"text-right font-medium",children:Math.floor(x.totalAmount||0).toLocaleString()})]},c))})]}),e.jsxs("div",{className:"flex items-center justify-between mt-1",children:[s.items.length>2&&e.jsxs("p",{className:"text-xs text-gray-500 italic",children:["ì™¸ ",s.items.length-2,"ê°œ"]}),e.jsxs("div",{className:"text-right",children:[e.jsx("span",{className:"text-xs text-gray-600 mr-2",children:"ì´ì•¡"}),e.jsxs("span",{className:"text-sm font-semibold text-blue-600",children:[Math.floor(s.totalAmount||s.items.reduce((x,c)=>x+(c.totalAmount||0),0)).toLocaleString(),"ì›"]})]})]})]})]})},m))}),e.jsx(f,{onClick:U,className:"w-full",size:"sm",children:"ì„ íƒí•œ ë°œì£¼ì„œ ì‚¬ìš©"})]})]})},$e=({initialData:a={},onChange:N})=>{const[i,n]=p.useState({orderNumber:a.orderNumber||`PO-${new Date().getTime()}`,orderDate:a.orderDate||new Date,deliveryDate:a.deliveryDate||new Date(Date.now()+6048e5),projectId:a.projectId||"",projectName:a.projectName||"",vendorId:a.vendorId||"",vendorName:a.vendorName||"",vendorEmail:a.vendorEmail||"",items:a.items||[{itemName:"",specification:"",quantity:1,unitPrice:0,totalAmount:0}],notes:a.notes||"",totalAmount:a.totalAmount||0}),{data:b}=Y({queryKey:["projects"],queryFn:async()=>(await fetch("/api/projects")).json()}),{data:w}=Y({queryKey:["vendors"],queryFn:async()=>(await fetch("/api/vendors")).json()});p.useEffect(()=>{N(i)},[i]),p.useEffect(()=>{const l=i.items.reduce((r,d)=>r+(d.totalAmount||0),0);n(r=>({...r,totalAmount:l}))},[i.items]);const u=(l,r)=>{n(d=>({...d,[l]:r}))},C=l=>{const r=b?.find(d=>d.id===l);r&&n(d=>({...d,projectId:l,projectName:r.name}))},P=l=>{const r=w?.find(d=>d.id===l);r&&n(d=>({...d,vendorId:l,vendorName:r.name,vendorEmail:r.email||""}))},y=(l,r,d)=>{const v=[...i.items];v[l]={...v[l],[r]:d},(r==="quantity"||r==="unitPrice")&&(v[l].totalAmount=v[l].quantity*v[l].unitPrice),n(D=>({...D,items:v}))},F=()=>{n(l=>({...l,items:[...l.items,{itemName:"",specification:"",quantity:1,unitPrice:0,totalAmount:0}]}))},S=l=>{if(i.items.length>1){const r=i.items.filter((d,v)=>v!==l);n(d=>({...d,items:r}))}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"ê¸°ë³¸ ì •ë³´"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"orderNumber",children:"ë°œì£¼ë²ˆí˜¸"}),e.jsx(k,{id:"orderNumber",value:i.orderNumber,onChange:l=>u("orderNumber",l.target.value),placeholder:"PO-20240101-001"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{children:"ë°œì£¼ì¼"}),e.jsxs(ce,{children:[e.jsx(oe,{asChild:!0,children:e.jsxs(f,{variant:"outline",className:"w-full justify-start text-left font-normal",children:[e.jsx(me,{className:"mr-2 h-4 w-4"}),xe(i.orderDate,"PPP",{locale:he})]})}),e.jsx(de,{className:"w-auto p-0",children:e.jsx(ie,{mode:"single",selected:i.orderDate,onSelect:l=>l&&u("orderDate",l),initialFocus:!0})})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{children:"í”„ë¡œì íŠ¸"}),e.jsxs(te,{value:i.projectId,onValueChange:C,children:[e.jsx(ae,{children:e.jsx(re,{placeholder:"í”„ë¡œì íŠ¸ ì„ íƒ"})}),e.jsx(le,{children:b?.map(l=>e.jsx(ne,{value:l.id,children:l.name},l.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{children:"ë‚©ê¸°ì¼"}),e.jsxs(ce,{children:[e.jsx(oe,{asChild:!0,children:e.jsxs(f,{variant:"outline",className:"w-full justify-start text-left font-normal",children:[e.jsx(me,{className:"mr-2 h-4 w-4"}),xe(i.deliveryDate,"PPP",{locale:he})]})}),e.jsx(de,{className:"w-auto p-0",children:e.jsx(ie,{mode:"single",selected:i.deliveryDate,onSelect:l=>l&&u("deliveryDate",l),initialFocus:!0})})]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"ê±°ë˜ì²˜ ì •ë³´"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{children:"ê±°ë˜ì²˜"}),e.jsxs(te,{value:i.vendorId,onValueChange:P,children:[e.jsx(ae,{children:e.jsx(re,{placeholder:"ê±°ë˜ì²˜ ì„ íƒ"})}),e.jsx(le,{children:w?.map(l=>e.jsx(ne,{value:l.id,children:l.name},l.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"vendorEmail",children:"ì´ë©”ì¼"}),e.jsx(k,{id:"vendorEmail",type:"email",value:i.vendorEmail,onChange:l=>u("vendorEmail",l.target.value),placeholder:"vendor@example.com"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"í’ˆëª© ì •ë³´"}),e.jsxs(f,{onClick:F,size:"sm",variant:"outline",children:[e.jsx(H,{className:"w-4 h-4 mr-1"}),"í’ˆëª© ì¶”ê°€"]})]}),e.jsx("div",{className:"space-y-3",children:i.items.map((l,r)=>e.jsxs("div",{className:"grid grid-cols-12 gap-3 items-end p-3 border rounded-lg",children:[e.jsxs("div",{className:"col-span-3 space-y-2",children:[e.jsx(g,{children:"í’ˆëª©ëª…"}),e.jsx(k,{value:l.itemName,onChange:d=>y(r,"itemName",d.target.value),placeholder:"í’ˆëª©ëª…"})]}),e.jsxs("div",{className:"col-span-3 space-y-2",children:[e.jsx(g,{children:"ê·œê²©"}),e.jsx(k,{value:l.specification,onChange:d=>y(r,"specification",d.target.value),placeholder:"ê·œê²©"})]}),e.jsxs("div",{className:"col-span-2 space-y-2",children:[e.jsx(g,{children:"ìˆ˜ëŸ‰"}),e.jsx(k,{type:"number",value:l.quantity,onChange:d=>y(r,"quantity",Number(d.target.value)),min:"1"})]}),e.jsxs("div",{className:"col-span-2 space-y-2",children:[e.jsx(g,{children:"ë‹¨ê°€"}),e.jsx(k,{type:"number",value:l.unitPrice,onChange:d=>y(r,"unitPrice",Number(d.target.value)),min:"0"})]}),e.jsxs("div",{className:"col-span-1 space-y-2",children:[e.jsx(g,{children:"ê¸ˆì•¡"}),e.jsxs("div",{className:"text-sm font-medium py-2",children:[l.totalAmount.toLocaleString(),"ì›"]})]}),e.jsx("div",{className:"col-span-1",children:e.jsx(f,{onClick:()=>S(r),size:"sm",variant:"ghost",className:"text-red-600 hover:text-red-700",disabled:i.items.length===1,children:e.jsx(Ne,{className:"w-4 h-4"})})})]},r))}),e.jsx("div",{className:"flex justify-end p-3 bg-gray-50 rounded-lg",children:e.jsxs("div",{className:"text-lg font-semibold",children:["ì´ì•¡: ",i.totalAmount.toLocaleString(),"ì›"]})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"notes",children:"ë¹„ê³ "}),e.jsx(ge,{id:"notes",value:i.notes,onChange:l=>u("notes",l.target.value),placeholder:"ì¶”ê°€ ìš”ì²­ì‚¬í•­ì´ë‚˜ íŠ¹ì´ì‚¬í•­ì„ ì…ë ¥í•˜ì„¸ìš”",rows:3})]})]})},ze=({orderData:a,pdfUrl:N,processingStatus:i})=>{const[n,b]=p.useState([a.vendorEmail||""]),[w,u]=p.useState([]),[C,P]=p.useState(`ë°œì£¼ì„œ - ${a.orderNumber||""}`),[y,F]=p.useState("info");p.useState(!1);const[S,l]=p.useState([]),[r,d]=p.useState([]),[v,D]=p.useState(()=>`ì•ˆë…•í•˜ì„¸ìš”,

${a.vendorName||"ê±°ë˜ì²˜"} ë‹´ë‹¹ìë‹˜

ë°œì£¼ì„œë¥¼ ì²¨ë¶€í•˜ì—¬ ë³´ë‚´ë“œë¦½ë‹ˆë‹¤.

ë°œì£¼ë²ˆí˜¸: ${a.orderNumber||"-"}
í”„ë¡œì íŠ¸: ${a.projectName||"-"}
ë‚©ê¸°ì¼: ${a.deliveryDate?new Date(a.deliveryDate).toLocaleDateString("ko-KR"):"-"}

í™•ì¸ í›„ íšŒì‹  ë¶€íƒë“œë¦½ë‹ˆë‹¤.

ê°ì‚¬í•©ë‹ˆë‹¤.`);p.useEffect(()=>{D(`ì•ˆë…•í•˜ì„¸ìš”,

${a.vendorName||"ê±°ë˜ì²˜"} ë‹´ë‹¹ìë‹˜

ë°œì£¼ì„œë¥¼ ì²¨ë¶€í•˜ì—¬ ë³´ë‚´ë“œë¦½ë‹ˆë‹¤.

ë°œì£¼ë²ˆí˜¸: ${a.orderNumber||"-"}
í”„ë¡œì íŠ¸: ${a.projectName||"-"}
ë‚©ê¸°ì¼: ${a.deliveryDate?new Date(a.deliveryDate).toLocaleDateString("ko-KR"):"-"}

í™•ì¸ í›„ íšŒì‹  ë¶€íƒë“œë¦½ë‹ˆë‹¤.

ê°ì‚¬í•©ë‹ˆë‹¤.`)},[a.vendorName,a.orderNumber,a.projectName,a.deliveryDate]),p.useEffect(()=>{const t=[];a.processedExcelUrl&&t.push({id:"processed-excel",name:a.originalFileName||"ì²˜ë¦¬ëœ_Excel_íŒŒì¼.xlsx",size:0,type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",url:a.processedExcelUrl,isDefault:!0,isSelected:!0}),N&&i.pdf==="completed"&&t.push({id:"generated-pdf",name:`ë°œì£¼ì„œ_${a.orderNumber||"generated"}.pdf`,size:0,type:"application/pdf",url:N,isDefault:!0,isSelected:!0}),l(o=>{const h=o.filter(j=>!j.isDefault);return[...t,...h]})},[a.processedExcelUrl,N,i.pdf,a.orderNumber]);const O=t=>{t==="to"?b([...n,""]):u([...w,""])},I=(t,o)=>{t==="to"&&n.length>1?b(n.filter((h,j)=>j!==o)):t==="cc"&&u(w.filter((h,j)=>j!==o))},$=(t,o,h)=>{if(t==="to"){const j=[...n];j[o]=h,b(j)}else{const j=[...w];j[o]=h,u(j)}},z=async t=>{const o=Array.from(t);for(const h of o){const j=`custom-${Date.now()}-${Math.random()}`;d(E=>[...E,j]);try{const E={id:j,name:h.name,size:h.size,type:h.type,file:h,isDefault:!1,isSelected:!0};l(B=>[...B,E])}catch(E){console.error("íŒŒì¼ ì—…ë¡œë“œ ì‹¤íŒ¨:",E)}finally{d(E=>E.filter(B=>B!==j))}}},U=t=>{l(o=>o.map(h=>h.id===t?{...h,isSelected:!h.isSelected}:h))},s=t=>{l(o=>o.filter(h=>h.id!==t))},m=t=>{if(t===0)return"0 Bytes";const o=1024,h=["Bytes","KB","MB","GB"],j=Math.floor(Math.log(t)/Math.log(o));return parseFloat((t/Math.pow(o,j)).toFixed(2))+" "+h[j]},x=t=>t.includes("pdf")?e.jsx(M,{className:"w-4 h-4 text-red-600"}):t.includes("spreadsheet")||t.includes("excel")?e.jsx(M,{className:"w-4 h-4 text-green-600"}):e.jsx(De,{className:"w-4 h-4 text-gray-600"}),c=t=>{switch(t){case"completed":return e.jsx(_,{className:"w-4 h-4 text-green-600"});case"processing":return e.jsx(T,{className:"w-4 h-4 text-blue-600 animate-spin"});case"error":return e.jsx(K,{className:"w-4 h-4 text-red-600"});default:return null}};return e.jsxs(R,{className:"h-full",children:[e.jsx(ue,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(je,{children:"ì‹¤ì‹œê°„ ë¯¸ë¦¬ë³´ê¸°"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(A,{variant:i.pdf==="completed"?"success":"secondary",children:[c(i.pdf),e.jsx("span",{className:"ml-1",children:"PDF"})]}),e.jsxs(A,{variant:i.vendor==="completed"?"success":"secondary",children:[c(i.vendor),e.jsx("span",{className:"ml-1",children:"ê±°ë˜ì²˜"})]}),e.jsxs(A,{variant:i.email==="completed"?"success":"secondary",children:[c(i.email),e.jsx("span",{className:"ml-1",children:"ì´ë©”ì¼"})]})]})]})}),e.jsx(q,{className:"h-[calc(100%-5rem)]",children:e.jsxs(Ce,{value:y,onValueChange:F,className:"h-full",children:[e.jsxs(Se,{className:"grid w-full grid-cols-3",children:[e.jsxs(V,{value:"info",children:[e.jsx(ee,{className:"w-4 h-4 mr-2"}),"ë°œì£¼ì„œ ì •ë³´"]}),e.jsxs(V,{value:"pdf",children:[e.jsx(M,{className:"w-4 h-4 mr-2"}),"PDF ë¯¸ë¦¬ë³´ê¸°"]}),e.jsxs(V,{value:"email",children:[e.jsx(Fe,{className:"w-4 h-4 mr-2"}),"ì´ë©”ì¼ ì„¤ì •"]})]}),e.jsx(J,{value:"pdf",className:"h-[calc(100%-3rem)]",children:i.pdf==="processing"?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsxs("div",{className:"text-center space-y-3",children:[e.jsx(T,{className:"w-12 h-12 mx-auto text-blue-600 animate-spin"}),e.jsx("p",{className:"text-sm text-gray-600",children:"PDFë¥¼ ìƒì„±í•˜ê³  ìˆìŠµë‹ˆë‹¤..."})]})}):i.pdf==="error"?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsxs("div",{className:"text-center space-y-3",children:[e.jsx(K,{className:"w-12 h-12 mx-auto text-red-600"}),e.jsx("p",{className:"text-sm text-red-600",children:"PDF ìƒì„± ì‹¤íŒ¨"}),e.jsxs(f,{variant:"outline",size:"sm",children:[e.jsx(fe,{className:"w-4 h-4 mr-2"}),"ë‹¤ì‹œ ì‹œë„"]})]})}):N&&i.pdf==="completed"?e.jsx("div",{className:"w-full h-full flex flex-col",children:e.jsx("div",{className:"flex-1 bg-gray-50 rounded-lg p-8 flex items-center justify-center",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx(_,{className:"w-16 h-16 mx-auto text-green-600"}),e.jsx("h3",{className:"text-lg font-medium",children:"PDFê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤"}),e.jsx("p",{className:"text-sm text-gray-600",children:"ì•„ë˜ ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ PDFë¥¼ í™•ì¸í•˜ì„¸ìš”"}),e.jsxs("div",{className:"flex items-center justify-center gap-3 mt-6",children:[e.jsxs(f,{variant:"default",onClick:()=>window.open(N,"_blank"),children:[e.jsx(ee,{className:"w-4 h-4 mr-2"}),"PDF ë¯¸ë¦¬ë³´ê¸°"]}),e.jsxs(f,{variant:"outline",onClick:()=>window.open(`${N}?download=true`,"_blank"),children:[e.jsx(Z,{className:"w-4 h-4 mr-2"}),"PDF ë‹¤ìš´ë¡œë“œ"]})]})]})})}):e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsxs("div",{className:"text-center space-y-3",children:[e.jsx(M,{className:"w-12 h-12 mx-auto text-gray-400"}),e.jsx("p",{className:"text-sm text-gray-600",children:"ë°œì£¼ì„œ ì •ë³´ê°€ ì™„ì„±ë˜ë©´ PDFê°€ ìë™ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤"}),e.jsx("p",{className:"text-xs text-gray-500",children:"ë¨¼ì € 'ë°œì£¼ì„œ ì •ë³´' íƒ­ì—ì„œ ë‚´ìš©ì„ í™•ì¸í•´ì£¼ì„¸ìš”"})]})})}),e.jsxs(J,{value:"info",className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(g,{className:"text-xs text-gray-600",children:"ë°œì£¼ë²ˆí˜¸"}),e.jsx("p",{className:"font-medium",children:a.orderNumber||"-"})]}),e.jsxs("div",{children:[e.jsx(g,{className:"text-xs text-gray-600",children:"ë°œì£¼ì¼"}),e.jsx("p",{className:"font-medium",children:a.orderDate?new Date(a.orderDate).toLocaleDateString("ko-KR"):"-"})]}),e.jsxs("div",{children:[e.jsx(g,{className:"text-xs text-gray-600",children:"í”„ë¡œì íŠ¸"}),e.jsx("p",{className:"font-medium",children:a.projectName||"-"})]}),e.jsxs("div",{children:[e.jsx(g,{className:"text-xs text-gray-600",children:"ê±°ë˜ì²˜"}),e.jsx("p",{className:"font-medium",children:a.vendorName||"-"})]}),e.jsxs("div",{children:[e.jsx(g,{className:"text-xs text-gray-600",children:"ë‚©ê¸°ì¼"}),e.jsx("p",{className:"font-medium",children:a.deliveryDate?new Date(a.deliveryDate).toLocaleDateString("ko-KR"):"-"})]}),e.jsxs("div",{children:[e.jsx(g,{className:"text-xs text-gray-600",children:"ì´ì•¡"}),e.jsx("p",{className:"font-medium text-lg text-blue-600",children:a.totalAmount?`${Math.floor(a.totalAmount).toLocaleString()}ì›`:"-"})]})]}),a.items&&a.items.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{className:"text-xs text-gray-600",children:"í’ˆëª© ëª©ë¡"}),e.jsx("div",{className:"border rounded-lg overflow-hidden",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left p-2",children:"í’ˆëª©ëª…"}),e.jsx("th",{className:"text-right p-2",children:"ìˆ˜ëŸ‰"}),e.jsx("th",{className:"text-right p-2",children:"ë‹¨ê°€"}),e.jsx("th",{className:"text-right p-2",children:"ê¸ˆì•¡"})]})}),e.jsx("tbody",{children:a.items.map((t,o)=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"p-2",children:t.itemName||t.name}),e.jsx("td",{className:"text-right p-2",children:Math.floor(t.quantity||0).toLocaleString()}),e.jsxs("td",{className:"text-right p-2",children:[Math.floor(t.unitPrice||0).toLocaleString(),"ì›"]}),e.jsxs("td",{className:"text-right p-2",children:[Math.floor(t.totalAmount||t.quantity*t.unitPrice||0).toLocaleString(),"ì›"]})]},o))})]})})]})]}),e.jsx(J,{value:"email",className:"space-y-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(g,{children:"ë°›ëŠ” ì‚¬ëŒ"}),e.jsx(f,{variant:"ghost",size:"sm",onClick:()=>O("to"),children:e.jsx(H,{className:"w-4 h-4"})})]}),n.map((t,o)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(k,{type:"email",value:t,onChange:h=>$("to",o,h.target.value),placeholder:"email@example.com"}),n.length>1&&e.jsx(f,{variant:"ghost",size:"sm",onClick:()=>I("to",o),children:e.jsx(se,{className:"w-4 h-4"})})]},o))]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(g,{children:"ì°¸ì¡° (CC)"}),e.jsx(f,{variant:"ghost",size:"sm",onClick:()=>O("cc"),children:e.jsx(H,{className:"w-4 h-4"})})]}),w.map((t,o)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(k,{type:"email",value:t,onChange:h=>$("cc",o,h.target.value),placeholder:"cc@example.com"}),e.jsx(f,{variant:"ghost",size:"sm",onClick:()=>I("cc",o),children:e.jsx(se,{className:"w-4 h-4"})})]},o))]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{children:"ì œëª©"}),e.jsx(k,{value:C,onChange:t=>P(t.target.value),placeholder:"ì´ë©”ì¼ ì œëª©"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{children:"ë©”ì¼ ë³¸ë¬¸"}),e.jsx(ge,{value:v,onChange:t=>D(t.target.value),placeholder:"ì´ë©”ì¼ ë³¸ë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”",className:"min-h-[200px] font-mono text-sm",rows:10})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(g,{children:"ì²¨ë¶€íŒŒì¼"}),e.jsxs(f,{variant:"outline",size:"sm",onClick:()=>{const t=document.createElement("input");t.type="file",t.multiple=!0,t.accept=".pdf,.xlsx,.xls,.doc,.docx,.txt",t.onchange=o=>{const h=o.target;h.files&&h.files.length>0&&z(h.files)},t.click()},children:[e.jsx(X,{className:"w-4 h-4 mr-2"}),"íŒŒì¼ ì¶”ê°€"]})]}),e.jsx("div",{className:"space-y-3",children:S.length===0?e.jsx("p",{className:"text-sm text-gray-500 text-center py-4",children:"ì²¨ë¶€í•  íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤"}):S.map(t=>e.jsxs("div",{className:"flex items-center gap-3 p-3 border rounded-lg bg-gray-50",children:[e.jsx(Pe,{checked:t.isSelected,onCheckedChange:()=>U(t.id)}),e.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[x(t.type),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium truncate",children:t.name}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500",children:[e.jsx("span",{children:m(t.size)}),t.isDefault&&e.jsx(A,{variant:"secondary",className:"text-xs",children:"ê¸°ë³¸íŒŒì¼"})]})]})]}),r.includes(t.id)&&e.jsx(T,{className:"w-4 h-4 animate-spin text-blue-600"}),!t.isDefault&&!r.includes(t.id)&&e.jsx(f,{variant:"ghost",size:"sm",onClick:()=>s(t.id),children:e.jsx(Ne,{className:"w-4 h-4 text-red-600"})})]},t.id))}),S.length>0&&e.jsx("div",{className:"p-3 bg-blue-50 rounded-lg",children:e.jsxs("p",{className:"text-sm text-blue-800",children:["ì„ íƒëœ íŒŒì¼: ",S.filter(t=>t.isSelected).length,"/",S.length,"ê°œ"]})})]})]})})]})})]})},Le=({orderData:a,pdfUrl:N,processingStatus:i,onSave:n,onSend:b,onDownload:w,onCreateOrder:u})=>{const C=i.pdf==="completed"&&i.vendor==="completed"&&a.vendorEmail,P=a.orderNumber&&a.vendorName&&a.projectName&&a.items?.length>0,y=Object.values(i).some(F=>F==="processing");return e.jsx("div",{className:"fixed bottom-0 left-0 right-0 bg-white border-t shadow-lg z-30",children:e.jsxs("div",{className:"container mx-auto px-6 py-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(f,{variant:"outline",onClick:n,disabled:y,children:[e.jsx(Ee,{className:"w-4 h-4 mr-2"}),"ì„ì‹œ ì €ì¥"]}),e.jsxs(f,{variant:"outline",onClick:w,disabled:!N||i.pdf!=="completed",children:[e.jsx(Z,{className:"w-4 h-4 mr-2"}),"ë‹¤ìš´ë¡œë“œ"]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[y&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(T,{className:"w-4 h-4 animate-spin"}),"ì²˜ë¦¬ ì¤‘..."]}),e.jsx(f,{variant:"default",onClick:u,disabled:!P||i.order==="processing",className:L("min-w-[120px]",P?"bg-green-600 hover:bg-green-700":""),children:i.order==="processing"?e.jsxs(e.Fragment,{children:[e.jsx(T,{className:"w-4 h-4 mr-2 animate-spin"}),"ìƒì„± ì¤‘..."]}):e.jsxs(e.Fragment,{children:[e.jsx(M,{className:"w-4 h-4 mr-2"}),"ë°œì£¼ì„œ ìƒì„±"]})}),e.jsx(f,{onClick:b,disabled:!C||i.email==="processing",className:L("min-w-[120px]",C?"bg-blue-600 hover:bg-blue-700":""),children:i.email==="processing"?e.jsxs(e.Fragment,{children:[e.jsx(T,{className:"w-4 h-4 mr-2 animate-spin"}),"ë°œì†¡ ì¤‘..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ke,{className:"w-4 h-4 mr-2"}),"ë°œì†¡í•˜ê¸°"]})})]})]}),e.jsxs("div",{className:"mt-3 flex items-center gap-6 text-xs text-gray-600",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:L("w-2 h-2 rounded-full",i.pdf==="completed"?"bg-green-500":i.pdf==="processing"?"bg-blue-500 animate-pulse":i.pdf==="error"?"bg-red-500":"bg-gray-300")}),"PDF ìƒì„±"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:L("w-2 h-2 rounded-full",i.vendor==="completed"?"bg-green-500":i.vendor==="processing"?"bg-blue-500 animate-pulse":i.vendor==="error"?"bg-red-500":"bg-gray-300")}),"ê±°ë˜ì²˜ í™•ì¸"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:L("w-2 h-2 rounded-full",i.order==="completed"?"bg-green-500":i.order==="processing"?"bg-blue-500 animate-pulse":i.order==="error"?"bg-red-500":"bg-gray-300")}),"ë°œì£¼ì„œ ìƒì„±"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:L("w-2 h-2 rounded-full",i.email==="completed"?"bg-green-500":i.email==="processing"?"bg-blue-500 animate-pulse":i.email==="error"?"bg-red-500":"bg-gray-300")}),"ì´ë©”ì¼ ì¤€ë¹„"]})]})]})})},Me=({orderData:a,onSuggestionApply:N})=>{const[i,n]=p.useState([]),[b,w]=p.useState(new Set),[u,C]=p.useState(!1);p.useEffect(()=>{P()},[a]);const P=()=>{C(!0);const r=[];if(a.vendorName&&!a.vendorEmail&&r.push({id:"vendor-email",type:"autofill",title:"ê±°ë˜ì²˜ ì´ë©”ì¼ ìë™ ì™„ì„±",description:"ë“±ë¡ëœ ê±°ë˜ì²˜ ì •ë³´ì—ì„œ ì´ë©”ì¼ì„ ê°€ì ¸ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.",action:{label:"ì´ë©”ì¼ ìë™ ì…ë ¥",data:{vendorEmail:"vendor@example.com"}},priority:"high"}),a.deliveryDate){const d=new Date(a.deliveryDate),v=new Date,D=Math.ceil((d.getTime()-v.getTime())/(1e3*60*60*24));D<3&&r.push({id:"delivery-urgent",type:"warning",title:"ê¸´ê¸‰ ë‚©ê¸°",description:`ë‚©ê¸°ì¼ì´ ${D}ì¼ ë‚¨ì•˜ìŠµë‹ˆë‹¤. ê¸´ê¸‰ ì²˜ë¦¬ê°€ í•„ìš”í•©ë‹ˆë‹¤.`,priority:"high"})}a.projectName&&!a.notes&&r.push({id:"project-defaults",type:"recommendation",title:"í”„ë¡œì íŠ¸ ê¸°ë³¸ ì„¤ì •",description:"ì´ì „ ë°œì£¼ì„œë¥¼ ì°¸ê³ í•˜ì—¬ ìì£¼ ì‚¬ìš©í•˜ëŠ” ì„¤ì •ì„ ì ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.",action:{label:"ê¸°ë³¸ê°’ ì ìš©",data:{notes:"ìƒì°¨ í›„ ì—°ë½ ìš”ë§",deliveryLocation:"í˜„ì¥ ì§ë‚©"}},priority:"medium"}),a.totalAmount>1e7&&r.push({id:"amount-check",type:"info",title:"ê³ ì•¡ ë°œì£¼ì„œ",description:"1ì²œë§Œì› ì´ìƒì˜ ë°œì£¼ì„œì…ë‹ˆë‹¤. ê²°ì¬ ìŠ¹ì¸ì´ í•„ìš”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.",priority:"medium"}),a.vendorName&&a.vendorName.length>2&&["(ì£¼)ABCê±´ì„¤","(ì£¼)ABCì¢…í•©ê±´ì„¤"].length>0&&r.push({id:"similar-vendors",type:"recommendation",title:"ìœ ì‚¬ ê±°ë˜ì²˜ ë°œê²¬",description:`'${a.vendorName}'ì™€ ìœ ì‚¬í•œ ê±°ë˜ì²˜ê°€ ìˆìŠµë‹ˆë‹¤. í™•ì¸í•´ë³´ì„¸ìš”.`,priority:"low"}),n(r.filter(d=>!b.has(d.id))),C(!1)},y=r=>{r.action&&(N(r.action.data),F(r.id))},F=r=>{w(d=>new Set(d).add(r)),n(d=>d.filter(v=>v.id!==r))},S=r=>{switch(r){case"warning":return e.jsx(Oe,{className:"w-5 h-5 text-yellow-600"});case"info":return e.jsx(G,{className:"w-5 h-5 text-blue-600"});case"recommendation":return e.jsx(Te,{className:"w-5 h-5 text-green-600"});case"autofill":return e.jsx(pe,{className:"w-5 h-5 text-purple-600"});default:return e.jsx(G,{className:"w-5 h-5 text-gray-600"})}},l=r=>{switch(r){case"warning":return"bg-yellow-50 border-yellow-200";case"info":return"bg-blue-50 border-blue-200";case"recommendation":return"bg-green-50 border-green-200";case"autofill":return"bg-purple-50 border-purple-200";default:return"bg-gray-50 border-gray-200"}};return i.length===0&&!u?null:e.jsxs(R,{children:[e.jsx(ue,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(je,{className:"text-lg flex items-center gap-2",children:[e.jsx(pe,{className:"w-5 h-5 text-yellow-500"}),"ìŠ¤ë§ˆíŠ¸ ì–´ì‹œìŠ¤íŠ¸"]}),u&&e.jsx(fe,{className:"w-4 h-4 text-gray-500 animate-spin"})]})}),e.jsxs(q,{className:"space-y-3",children:[i.sort((r,d)=>{const v={high:0,medium:1,low:2};return v[r.priority]-v[d.priority]}).map(r=>e.jsx(W,{className:`${l(r.type)} border`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[S(r.type),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("p",{className:"font-medium text-sm",children:r.title}),r.priority==="high"&&e.jsx(A,{variant:"destructive",className:"text-xs",children:"ì¤‘ìš”"})]}),e.jsx(Q,{className:"text-xs",children:r.description}),r.action&&e.jsxs(f,{size:"sm",variant:"outline",className:"mt-2",onClick:()=>y(r),children:[r.action.label,e.jsx(Ae,{className:"w-3 h-3 ml-1"})]})]}),e.jsx(f,{size:"sm",variant:"ghost",className:"text-gray-400 hover:text-gray-600 h-6 w-6 p-0",onClick:()=>F(r.id),children:"Ã—"})]})},r.id)),i.length===0&&!u&&e.jsxs("div",{className:"text-center py-4 text-sm text-gray-500",children:[e.jsx(_,{className:"w-8 h-8 text-green-500 mx-auto mb-2"}),"ëª¨ë“  í•­ëª©ì´ ì˜¬ë°”ë¥´ê²Œ ì…ë ¥ë˜ì—ˆìŠµë‹ˆë‹¤"]})]})]})},ps=()=>{const{toast:a}=be(),[N,i]=p.useState(null),[n,b]=p.useState({}),[w,u]=p.useState({pdf:"idle",vendor:"idle",email:"idle",order:"idle"}),[C,P]=p.useState(null),[y,F]=p.useState(!1),[S,l]=p.useState(!1);p.useEffect(()=>{if(S&&n.orderNumber){const s=setTimeout(()=>{r()},2e3);return()=>clearTimeout(s)}},[n,S]),p.useEffect(()=>{if(n.orderNumber&&n.vendorName&&n.projectName&&n.items?.length>0){const s=setTimeout(()=>{d()},500);return()=>clearTimeout(s)}},[n.orderNumber,n.vendorName,n.projectName,n.items]);const r=async()=>{F(!0);try{localStorage.setItem("draftOrder",JSON.stringify(n)),l(!1)}catch(s){console.error("Auto-save failed:",s)}finally{F(!1)}},d=async()=>{if(n.orderNumber){console.log("ğŸ”µ PDF ìƒì„± ì‹œì‘:",n),u(s=>({...s,pdf:"processing"}));try{const s=n.totalAmount||(n.items||[]).reduce((c,t)=>c+(t.quantity||0)*(t.unitPrice||0),0),m={...n,totalAmount:s};console.log("ğŸ”µ PDF ìƒì„± ìš”ì²­ ë°ì´í„°:",m);const x=await fetch("/api/orders/generate-pdf",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({orderData:m})});if(x.ok){const c=await x.json();console.log("ğŸ”µ PDF ìƒì„± ì‘ë‹µ:",c);const t=c.pdfUrl.startsWith("http")?c.pdfUrl:`${window.location.origin}${c.pdfUrl}`;console.log("ğŸ”µ PDF URL:",t),P(t),u(o=>({...o,pdf:"completed"})),fetch(t,{method:"HEAD"}).then(o=>{console.log("ğŸ”µ PDF ì ‘ê·¼ì„± í…ŒìŠ¤íŠ¸:",o.status,o.headers.get("content-type"))}).catch(o=>{console.error("ğŸ”´ PDF ì ‘ê·¼ ì‹¤íŒ¨:",o)})}else{const c=await x.text();throw console.error("ğŸ”´ PDF ìƒì„± ì‹¤íŒ¨ ì‘ë‹µ:",x.status,c),new Error(`PDF ìƒì„± ì‹¤íŒ¨: ${x.status}`)}}catch(s){u(m=>({...m,pdf:"error"})),console.error("ğŸ”´ PDF generation error:",s)}}},v=s=>{i(s);const m=localStorage.getItem("draftOrder");if(m){const x=JSON.parse(m);window.confirm("ì €ì¥ëœ ì„ì‹œ ì‘ì—…ì´ ìˆìŠµë‹ˆë‹¤. ë¶ˆëŸ¬ì˜¤ì‹œê² ìŠµë‹ˆê¹Œ?")&&b(x)}},D=s=>{b(m=>({...m,...s})),l(!0),s.vendorName&&s.vendorName!==n.vendorName&&I(s.vendorName)},O=s=>{b(m=>({...m,processedExcelUrl:s.url,originalFileName:s.name}))},I=async s=>{u(m=>({...m,vendor:"processing"}));try{const m=await fetch("/api/vendors/validate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({vendorName:s})});if(m.ok){const x=await m.json();x.isValid?(u(c=>({...c,vendor:"completed"})),x.vendorEmail&&b(c=>({...c,vendorEmail:x.vendorEmail}))):u(c=>({...c,vendor:"error"}))}}catch{u(x=>({...x,vendor:"error"}))}},$=async()=>{if(!n.orderNumber||!n.vendorName||!n.projectName||!n.items?.length){a({title:"ìƒì„± ë¶ˆê°€",description:"í•„ìˆ˜ ì •ë³´ë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.",variant:"destructive"});return}u(s=>({...s,order:"processing"}));try{const s=await fetch("/api/auth/user");if(console.log("ğŸ” ì¸ì¦ ìƒíƒœ í™•ì¸:",s.status),!s.ok){console.error("ğŸ”´ ì¸ì¦ ì‹¤íŒ¨ - ë¡œê·¸ì¸ í•„ìš”"),a({title:"ì¸ì¦ í•„ìš”",description:"ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤. ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤.",variant:"destructive"}),setTimeout(()=>{window.location.href="/login"},2e3);return}const m=await s.json();console.log("ğŸ” í˜„ì¬ ì‚¬ìš©ì:",m)}catch(s){console.error("ğŸ”´ ì¸ì¦ í™•ì¸ ì‹¤íŒ¨:",s)}try{console.log("ğŸŸ¢ ë°œì£¼ì„œ ìƒì„± ì‹œì‘:",n);const s=new FormData;s.append("projectId","1"),s.append("vendorId","1"),s.append("deliveryDate",n.deliveryDate||new Date().toISOString()),s.append("notes",n.notes||`ë°œì£¼ì„œ ì‘ì„±ìœ¼ë¡œ ìƒì„±ëœ ë°œì£¼ì„œ - ${n.orderNumber}`);const m=(n.items||[]).map(c=>({itemName:c.name||c.itemName||"",quantity:parseFloat(c.quantity||"0"),unitPrice:parseFloat(c.unitPrice||"0"),unit:c.unit||"EA",totalAmount:parseFloat(c.quantity||"0")*parseFloat(c.unitPrice||"0")}));s.append("items",JSON.stringify(m)),console.log("ğŸŸ¢ ë°œì£¼ì„œ ìƒì„± ìš”ì²­ ë°ì´í„°:",{projectId:"1",vendorId:"1",deliveryDate:n.deliveryDate||new Date().toISOString(),notes:n.notes||`ë°œì£¼ì„œ ì‘ì„±ìœ¼ë¡œ ìƒì„±ëœ ë°œì£¼ì„œ - ${n.orderNumber}`,items:m});const x=await fetch("/api/orders",{method:"POST",body:s});if(console.log("ğŸŸ¢ ë°œì£¼ì„œ ìƒì„± ì‘ë‹µ ìƒíƒœ:",x.status),x.ok){const c=await x.json();console.log("ğŸŸ¢ ìƒì„±ëœ ë°œì£¼ì„œ:",c),u(t=>({...t,order:"completed"})),a({title:"ìƒì„± ì™„ë£Œ",description:`ë°œì£¼ì„œê°€ ì„±ê³µì ìœ¼ë¡œ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤. (${c.orderNumber||n.orderNumber})`}),localStorage.removeItem("draftOrder"),setTimeout(()=>{window.location.href="/orders"},3e3)}else{const c=await x.text();console.error("ğŸ”´ ë°œì£¼ì„œ ìƒì„± ì‹¤íŒ¨ ì‘ë‹µ:",x.status,c);let t="ë°œì£¼ì„œ ìƒì„± ì‹¤íŒ¨";try{t=JSON.parse(c).message||t}catch{t=`HTTP ${x.status}: ${c}`}throw new Error(t)}}catch(s){u(m=>({...m,order:"error"})),a({title:"ìƒì„± ì‹¤íŒ¨",description:s instanceof Error?s.message:"ë°œì£¼ì„œ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.",variant:"destructive"})}},z=async()=>{if(!n.vendorEmail){a({title:"ë°œì†¡ ë¶ˆê°€",description:"ìˆ˜ì‹ ì ì´ë©”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.",variant:"destructive"});return}u(s=>({...s,email:"processing"}));try{if((await fetch("/api/orders/send-email",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({orderData:n,pdfUrl:C||null,recipients:[n.vendorEmail]})})).ok)u(m=>({...m,email:"completed"})),a({title:"ë°œì†¡ ì™„ë£Œ",description:"ë°œì£¼ì„œê°€ ì„±ê³µì ìœ¼ë¡œ ë°œì†¡ë˜ì—ˆìŠµë‹ˆë‹¤."}),localStorage.removeItem("draftOrder"),setTimeout(()=>{window.location.href="/orders"},3e3);else throw new Error("ì´ë©”ì¼ ë°œì†¡ ì‹¤íŒ¨")}catch{u(m=>({...m,email:"error"})),a({title:"ë°œì†¡ ì‹¤íŒ¨",description:"ì´ë©”ì¼ ë°œì†¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.",variant:"destructive"})}},U=()=>{const s=Object.values(w);return s.filter(x=>x==="completed").length/s.length*100};return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-white border-b border-gray-200 sticky top-0 z-40",children:e.jsx("div",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"ë°œì£¼ì„œ ì‘ì„±"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"í•œ í™”ë©´ì—ì„œ ëª¨ë“  ì‘ì—…ì„ ì™„ë£Œí•˜ì„¸ìš”"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[y&&e.jsxs(A,{variant:"secondary",className:"animate-pulse",children:[e.jsx(T,{className:"w-3 h-3 mr-1 animate-spin"}),"ìë™ ì €ì¥ ì¤‘..."]}),!y&&!S&&n.orderNumber&&e.jsxs(A,{variant:"secondary",className:"bg-green-50 text-green-700",children:[e.jsx(_,{className:"w-3 h-3 mr-1"}),"ì €ì¥ë¨"]}),e.jsx(we,{value:U(),className:"w-32 h-2"})]})]})})}),e.jsxs("div",{className:"container mx-auto px-6 py-6",children:[!N&&e.jsx("div",{className:"mb-8",children:e.jsxs(W,{className:"mb-6 max-w-4xl mx-auto",children:[e.jsx(G,{className:"h-4 w-4"}),e.jsx(Q,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"font-medium",children:"ğŸ“‹ ì‚¬ìš©íŒ"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-blue-600",children:"ì—‘ì…€ íŒŒì¼ ì—…ë¡œë“œ:"})," ëŒ€ëŸ‰ ë°œì£¼ì„œ, ë°˜ë³µ ì—…ë¬´, ìë™í™” ì²˜ë¦¬ì— ì í•© (50ê±´+ ê¶Œì¥)"]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-green-600",children:"ì§ì ‘ ì…ë ¥:"})," ì†ŒëŸ‰ ë°œì£¼ì„œ, ì„¸ë°€í•œ ì¡°ì •, ì¦‰ì‹œ ì²˜ë¦¬ì— ì í•© (10ê±´ ì´í•˜ ê¶Œì¥)"]})]}),e.jsx("div",{className:"pt-2 border-t",children:e.jsxs(f,{variant:"outline",size:"sm",className:"text-blue-600 border-blue-200 hover:bg-blue-50",onClick:()=>{const s=document.createElement("a");s.href="/PO_Excel_Template.xlsx",s.download="PO_Excel_Template.xlsx",s.click()},children:[e.jsx(Z,{className:"h-4 w-4 mr-2"}),"ì—‘ì…€ í…œí”Œë¦¿ ë‹¤ìš´ë¡œë“œ"]})})]})})]})}),!N&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-8 max-w-4xl mx-auto",children:[e.jsx(R,{className:"cursor-pointer hover:shadow-lg transition-shadow border-2 hover:border-blue-500",onClick:()=>v("excel"),children:e.jsxs(q,{className:"p-8 text-center",children:[e.jsx(X,{className:"w-16 h-16 mx-auto mb-4 text-blue-600"}),e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"ì—‘ì…€ íŒŒì¼ ì—…ë¡œë“œ"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"ê¸°ì¡´ ì—‘ì…€ íŒŒì¼ì„ ì—…ë¡œë“œí•˜ì—¬ ë¹ ë¥´ê²Œ ì‘ì„±"}),e.jsxs("div",{className:"text-xs text-gray-500 space-y-1",children:[e.jsx("div",{children:"âœ… ëŒ€ëŸ‰ ì²˜ë¦¬ (50ê±´+)"}),e.jsx("div",{children:"âœ… ìë™í™” ì›Œí¬í”Œë¡œìš°"}),e.jsx("div",{children:"âœ… ê±°ë˜ì²˜ ìë™ ë§¤ì¹­"}),e.jsx("div",{children:"âœ… ì´ë©”ì¼ ìë™ ë°œì†¡"})]})]})}),e.jsx(R,{className:"cursor-pointer hover:shadow-lg transition-shadow border-2 hover:border-green-500",onClick:()=>v("direct"),children:e.jsxs(q,{className:"p-8 text-center",children:[e.jsx(M,{className:"w-16 h-16 mx-auto mb-4 text-green-600"}),e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"ì§ì ‘ ì…ë ¥"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"í¼ì„ í†µí•´ ì§ì ‘ ì •ë³´ ì…ë ¥"}),e.jsxs("div",{className:"text-xs text-gray-500 space-y-1",children:[e.jsx("div",{children:"âœ… ì†ŒëŸ‰ ì²˜ë¦¬ (10ê±´ ì´í•˜)"}),e.jsx("div",{children:"âœ… ì¦‰ì‹œ ì²˜ë¦¬"}),e.jsx("div",{children:"âœ… ì‹¤ì‹œê°„ ê²€ì¦"}),e.jsx("div",{children:"âœ… ì„¸ë°€í•œ ì¡°ì •"})]})]})})]}),N&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsx(R,{children:e.jsxs(q,{className:"p-6",children:[N==="excel"&&e.jsx(Ie,{onDataExtracted:D,onProcessedFileReady:O}),N==="direct"&&e.jsx($e,{initialData:n,onChange:D})]})}),e.jsx(Me,{orderData:n,onSuggestionApply:D})]}),e.jsx("div",{className:"space-y-6",children:e.jsx(ze,{orderData:n,pdfUrl:C,processingStatus:w})})]}),N&&n.orderNumber&&e.jsx(Le,{orderData:n,pdfUrl:C,processingStatus:w,onSave:r,onSend:z,onCreateOrder:$,onDownload:()=>{C&&window.open(`${C}?download=true`,"_blank")}})]})]})};export{ps as default};
