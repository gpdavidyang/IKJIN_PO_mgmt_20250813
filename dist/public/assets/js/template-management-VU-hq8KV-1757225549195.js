import{n as Y,e as Z,g as ee,r as m,q as se,s as j,j as e,o as v,B as t,P as b,y as ae,ad as te,w as L,x as le,a as re,aG as E,T as q,aD as K}from"./index-BKb22KH0-1757225549195.js";import{A as P,h as z,a as M,b as F,c as Q,d as $,e as B,f as I,g as R}from"./alert-dialog-95BKtuu_-1757225549195.js";import{T as ie}from"./template-builder-fixed-Cbs4aJ9k-1757225549195.js";import{a as ne}from"./use-ui-terms-C1-Qg3CQ-1757225549195.js";import{L as ce}from"./layers-CS9da9c6-1757225549195.js";import{G as _}from"./grid-3x3-bgOCl5c6-1757225549195.js";import{L as de}from"./list-PBVi3UiI-1757225549195.js";import{C as oe}from"./calendar-DHme3nQr-1757225549195.js";import{H as me}from"./hash-DhwCiBGj-1757225549195.js";import{S as H}from"./square-pen-DGnUHL3_-1757225549195.js";import"./index-C4QvfFnZ-1757225549195.js";import"./textarea-DwXAAXJU-1757225549195.js";import"./save-Cz9HOoWI-1757225549195.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xe=Y("Power",[["path",{d:"M12 2v10",key:"mnfbl"}],["path",{d:"M18.4 6.6a9 9 0 1 1-12.77.04",key:"obofu9"}]]);function Ae(){const{toast:l}=Z(),r=ee(),[i,O]=m.useState(""),[y,x]=m.useState(null),[G,c]=m.useState(!1),[J,h]=m.useState(!1),[N,w]=m.useState("card"),V=ne("template_type_label","시트폼"),{data:d=[],isLoading:C}=se({queryKey:["/api/admin/templates"],queryFn:async()=>{const a=await(await fetch("/api/admin/templates",{credentials:"include"})).json();return console.log("🔍 Templates API response:",a),Array.isArray(a)?a:[]}}),T=j({mutationFn:s=>fetch("/api/admin/templates",{method:"POST",body:JSON.stringify(s),headers:{"Content-Type":"application/json"},credentials:"include"}).then(a=>a.json()),onSuccess:()=>{r.invalidateQueries({queryKey:["/api/admin/templates"]}),c(!1),l({title:"성공",description:"템플릿이 생성되었습니다."})},onError:()=>{l({title:"오류",description:"템플릿 생성 중 오류가 발생했습니다.",variant:"destructive"})}}),U=j({mutationFn:({id:s,templateData:a})=>fetch(`/api/admin/templates/${s}`,{method:"PUT",body:JSON.stringify(a),headers:{"Content-Type":"application/json"},credentials:"include"}).then(n=>n.json()),onSuccess:()=>{r.invalidateQueries({queryKey:["/api/admin/templates"]}),c(!1),h(!1),x(null),l({title:"성공",description:"템플릿이 수정되었습니다."})},onError:()=>{l({title:"오류",description:"템플릿 수정 중 오류가 발생했습니다.",variant:"destructive"})}}),p=j({mutationFn:async s=>{if(!(await fetch(`/api/admin/templates/${s}`,{method:"DELETE",credentials:"include",headers:{"Cache-Control":"no-cache"}})).ok)throw new Error("Failed to delete template");return{id:s}},onSuccess:s=>{r.setQueryData(["/api/order-templates"],a=>a&&a.filter(n=>n.id!==s.id)),r.removeQueries({queryKey:["/api/order-templates"]}),r.invalidateQueries({queryKey:["/api/admin/templates"]}),r.refetchQueries({queryKey:["/api/order-templates"],type:"active",exact:!0}),l({title:"성공",description:"템플릿이 삭제되었습니다."})},onError:s=>{console.error("Delete template error:",s),l({title:"오류",description:"템플릿 삭제 중 오류가 발생했습니다.",variant:"destructive"})}}),A=j({mutationFn:({id:s,isActive:a})=>fetch(`/api/order-templates/${s}/toggle-status`,{method:"PATCH",body:JSON.stringify({isActive:a}),headers:{"Content-Type":"application/json"},credentials:"include"}).then(n=>n.json()),onSuccess:(s,a)=>{r.invalidateQueries({queryKey:["/api/admin/templates"]}),l({title:"성공",description:`템플릿이 ${a.isActive?"활성화":"비활성화"}되었습니다.`})},onError:()=>{l({title:"오류",description:"템플릿 상태 변경 중 오류가 발생했습니다.",variant:"destructive"})}}),o=Array.isArray(d)?d.filter(s=>s.templateName.toLowerCase().includes(i.toLowerCase())):[],k=s=>g(s)==="sheet"?"bg-blue-100 text-blue-800":"bg-purple-100 text-purple-800",g=s=>["handsontable","excel_like"].includes(s)?"sheet":"general",S=s=>g(s)==="sheet"?V:"일반폼",W=s=>{J&&y?U.mutate({id:y.id,templateData:s}):T.mutate(s)},u=s=>{x(s),h(!0),c(!0)},D=s=>{const a={...s,templateName:`${s.templateName} (복사본)`},{id:n,...X}=a;T.mutate(X)},f=()=>{x(null),h(!1),c(!0)};return G?e.jsx(ie,{templateId:y?.id,onSave:W,onCancel:()=>{c(!1),h(!1),x(null)}}):e.jsx("div",{className:"min-h-screen bg-gray-50",children:e.jsxs("div",{className:"max-w-[1366px] mx-auto p-6 space-y-6",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ce,{className:"h-5 w-5 text-blue-600"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"템플릿 관리"}),e.jsx("p",{className:"text-sm mt-1 text-gray-600",children:"발주서 템플릿을 생성하고 관리합니다"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(v,{variant:"outline",className:"text-sm",children:["총 ",o.length,"개"]}),e.jsxs(t,{onClick:f,className:"bg-blue-600 hover:bg-blue-700 text-white",children:[e.jsx(b,{className:"h-4 w-4 mr-2"}),"새 템플릿"]})]})]})}),e.jsx("div",{className:"rounded-lg p-4 mb-6 shadow-sm bg-white border-gray-200 border",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex-1 max-w-md",children:e.jsx(ae,{value:i,onChange:s=>O(s.target.value),placeholder:"템플릿 이름으로 검색...",className:"h-10 bg-white border-gray-300"})}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(te,{className:"w-4 h-4 text-blue-600"}),e.jsxs("span",{children:["시트 ",d.filter(s=>g(s.templateType)==="sheet").length]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(_,{className:"w-4 h-4 text-green-600"}),e.jsxs("span",{children:["폼 ",d.filter(s=>g(s.templateType)==="general").length]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(xe,{className:"w-4 h-4 text-emerald-600"}),e.jsxs("span",{children:["활성 ",d.filter(s=>s.isActive).length]})]})]}),e.jsxs("div",{className:"flex items-center rounded-lg p-1 bg-gray-100",children:[e.jsx(t,{variant:N==="list"?"default":"ghost",size:"sm",onClick:()=>w("list"),className:"h-8 w-8 p-0",title:"목록 보기",children:e.jsx(de,{className:"h-4 w-4"})}),e.jsx(t,{variant:N==="card"?"default":"ghost",size:"sm",onClick:()=>w("card"),className:"h-8 w-8 p-0",title:"카드 보기",children:e.jsx(_,{className:"h-4 w-4"})})]})]})]})}),N==="card"?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4",children:C?Array.from({length:6}).map((s,a)=>e.jsx(L,{className:"animate-pulse shadow-sm bg-white border-gray-200",children:e.jsxs(le,{className:"p-4",children:[e.jsx("div",{className:"h-4 rounded w-3/4 mb-2 bg-gray-200"}),e.jsx("div",{className:"h-3 rounded w-1/2 mb-3 bg-gray-200"}),e.jsx("div",{className:"h-2 rounded w-full mb-2 bg-gray-200"}),e.jsx("div",{className:"h-2 rounded w-2/3 bg-gray-200"})]})},a)):o.length===0?e.jsxs("div",{className:"col-span-full text-center py-12",children:[e.jsx("div",{className:"text-gray-600",children:i?"검색 결과가 없습니다":"등록된 템플릿이 없습니다"}),!i&&e.jsxs(t,{onClick:f,variant:"outline",className:"mt-4",size:"sm",children:[e.jsx(b,{className:"w-4 h-4 mr-2"}),"첫 템플릿 만들기"]})]}):o.map(s=>e.jsx(L,{className:"p-4 hover:shadow-md transition-shadow shadow-sm bg-white border-gray-200",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx("h3",{className:"font-semibold cursor-pointer truncate text-gray-900 hover:text-blue-600",onClick:()=>u(s),children:s.templateName})}),e.jsx(v,{variant:"secondary",className:`text-xs ml-2 flex-shrink-0 ${k(s.templateType)}`,children:S(s.templateType)})]}),e.jsxs("div",{className:"space-y-2 mb-3",children:[e.jsxs("div",{className:"flex items-center text-sm gap-2 text-gray-600",children:[e.jsx(oe,{className:"h-4 w-4"}),e.jsx("span",{className:"font-medium",children:"생성:"}),e.jsx("span",{children:new Date(s.createdAt).toLocaleDateString("ko-KR")})]}),e.jsxs("div",{className:"flex items-center text-sm gap-2 text-gray-600",children:[e.jsx(re,{className:"h-4 w-4"}),e.jsx("span",{className:"font-medium",children:"수정:"}),e.jsx("span",{children:new Date(s.updatedAt).toLocaleDateString("ko-KR")})]}),e.jsxs("div",{className:"flex items-center text-sm gap-2 text-gray-600",children:[e.jsx(me,{className:"h-4 w-4"}),e.jsx("span",{className:"font-medium",children:"구성:"}),s.templateType==="handsontable"&&s.fieldsConfig?.handsontable?e.jsxs("span",{className:"text-blue-600",children:["컬럼 ",s.fieldsConfig.handsontable.columns?.length||0,"개"]}):s.fieldsConfig?.fields?e.jsxs("span",{className:"text-green-600",children:["필드 ",s.fieldsConfig.fields.length||0,"개"]}):e.jsx("span",{className:"text-gray-500",children:"기본 템플릿"})]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-3 border-t border-gray-100",children:[e.jsxs("div",{className:"flex items-center -space-x-1",children:[e.jsx(t,{onClick:()=>u(s),variant:"ghost",size:"sm",className:"h-8 w-8 p-0 text-blue-600 hover:text-blue-700 hover:bg-blue-50",title:"수정",children:e.jsx(H,{className:"h-3 w-3"})}),e.jsx(t,{onClick:()=>D(s),variant:"ghost",size:"sm",className:"h-8 w-8 p-0 text-blue-600 hover:text-blue-700 hover:bg-blue-50",title:"복사",children:e.jsx(E,{className:"h-3 w-3"})}),e.jsxs(P,{children:[e.jsx(z,{asChild:!0,children:e.jsx(t,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 text-red-600 hover:text-red-700 hover:bg-red-50",disabled:p.isPending,title:"삭제",children:e.jsx(q,{className:"h-3 w-3"})})}),e.jsxs(M,{className:"bg-white border-gray-200",children:[e.jsxs(F,{children:[e.jsx(Q,{className:"text-gray-900",children:"템플릿 삭제"}),e.jsxs($,{className:"text-gray-600",children:["'",s.templateName,"' 템플릿을 정말 삭제하시겠습니까? 이 작업은 되돌릴 수 없습니다."]})]}),e.jsxs(B,{children:[e.jsx(I,{children:"취소"}),e.jsx(R,{onClick:()=>p.mutate(s.id),className:"bg-red-600 hover:bg-red-700",children:"삭제"})]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:s.isActive?"활성":"비활성"}),e.jsx(K,{checked:s.isActive,onCheckedChange:a=>A.mutate({id:s.id,isActive:a})})]})]})]})},s.id))}):e.jsx("div",{className:"rounded-lg overflow-hidden shadow-sm bg-white border-gray-200 border",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{className:"border-b border-gray-200",children:[e.jsx("th",{className:"text-left py-3 px-4 text-sm font-medium text-gray-900",children:"타입"}),e.jsx("th",{className:"text-left py-3 px-4 text-sm font-medium text-gray-900",children:"템플릿명"}),e.jsx("th",{className:"text-left py-3 px-4 text-sm font-medium text-gray-900",children:"생성일"}),e.jsx("th",{className:"text-left py-3 px-4 text-sm font-medium text-gray-900",children:"수정일"}),e.jsx("th",{className:"text-left py-3 px-4 text-sm font-medium text-gray-900",children:"구성"}),e.jsx("th",{className:"text-left py-3 px-4 text-sm font-medium text-gray-900",children:"상태"}),e.jsx("th",{className:"text-left py-3 px-4 text-sm font-medium text-gray-900",children:"액션"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:C?Array.from({length:6}).map((s,a)=>e.jsxs("tr",{className:"animate-pulse",children:[e.jsx("td",{className:"py-2 px-4",children:e.jsx("div",{className:"h-4 rounded w-16 bg-gray-200"})}),e.jsx("td",{className:"py-2 px-4",children:e.jsx("div",{className:"h-4 rounded w-32 bg-gray-200"})}),e.jsx("td",{className:"py-2 px-4",children:e.jsx("div",{className:"h-4 rounded w-20 bg-gray-200"})}),e.jsx("td",{className:"py-2 px-4",children:e.jsx("div",{className:"h-4 rounded w-20 bg-gray-200"})}),e.jsx("td",{className:"py-2 px-4",children:e.jsx("div",{className:"h-4 rounded w-16 bg-gray-200"})}),e.jsx("td",{className:"py-2 px-4",children:e.jsx("div",{className:"h-4 rounded w-12 bg-gray-200"})}),e.jsx("td",{className:"py-2 px-4",children:e.jsx("div",{className:"h-4 rounded w-20 bg-gray-200"})})]},a)):o.length===0?e.jsx("tr",{children:e.jsxs("td",{colSpan:7,className:"text-center py-12",children:[e.jsx("div",{className:"text-gray-600",children:i?"검색 결과가 없습니다":"등록된 템플릿이 없습니다"}),!i&&e.jsxs(t,{onClick:f,variant:"outline",className:"mt-4",size:"sm",children:[e.jsx(b,{className:"w-4 h-4 mr-2"}),"첫 템플릿 만들기"]})]})}):o.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"py-2 px-4",children:e.jsx(v,{variant:"secondary",className:`text-xs ${k(s.templateType)}`,children:S(s.templateType)})}),e.jsx("td",{className:"py-2 px-4",children:e.jsx("button",{onClick:()=>u(s),className:"text-sm font-medium text-left text-blue-600 hover:text-blue-800",children:s.templateName})}),e.jsx("td",{className:"py-2 px-4 text-sm text-gray-600",children:new Date(s.createdAt).toLocaleDateString("ko-KR")}),e.jsx("td",{className:"py-2 px-4 text-sm text-gray-600",children:new Date(s.updatedAt).toLocaleDateString("ko-KR")}),e.jsx("td",{className:"py-2 px-4 text-sm",children:s.templateType==="handsontable"&&s.fieldsConfig?.handsontable?e.jsxs("span",{className:"text-blue-600",children:["컬럼 ",s.fieldsConfig.handsontable.columns?.length||0,"개"]}):s.fieldsConfig?.fields?e.jsxs("span",{className:"text-green-600",children:["필드 ",s.fieldsConfig.fields.length||0,"개"]}):e.jsx("span",{className:"text-gray-500",children:"기본"})}),e.jsx("td",{className:"py-2 px-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:s.isActive?"활성":"비활성"}),e.jsx(K,{checked:s.isActive,onCheckedChange:a=>A.mutate({id:s.id,isActive:a})})]})}),e.jsx("td",{className:"py-2 px-4",children:e.jsxs("div",{className:"flex items-center -space-x-1",children:[e.jsx(t,{onClick:()=>u(s),variant:"ghost",size:"sm",className:"h-8 w-8 p-0 text-blue-600 hover:bg-blue-50",title:"수정",children:e.jsx(H,{className:"w-4 h-4"})}),e.jsx(t,{onClick:()=>D(s),variant:"ghost",size:"sm",className:"h-8 w-8 p-0 text-blue-600 hover:bg-blue-50",title:"복사",children:e.jsx(E,{className:"w-4 h-4"})}),e.jsxs(P,{children:[e.jsx(z,{asChild:!0,children:e.jsx(t,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 text-red-600 hover:bg-red-50",disabled:p.isPending,title:"삭제",children:e.jsx(q,{className:"w-4 h-4"})})}),e.jsxs(M,{className:"bg-white border-gray-200",children:[e.jsxs(F,{children:[e.jsx(Q,{className:"text-gray-900",children:"템플릿 삭제"}),e.jsxs($,{className:"text-gray-600",children:["'",s.templateName,"' 템플릿을 정말 삭제하시겠습니까? 이 작업은 되돌릴 수 없습니다."]})]}),e.jsxs(B,{children:[e.jsx(I,{children:"취소"}),e.jsx(R,{onClick:()=>p.mutate(s.id),className:"bg-red-600 hover:bg-red-700",children:"삭제"})]})]})]})]})})]},s.id))})]})})})]})})}export{Ae as default};
