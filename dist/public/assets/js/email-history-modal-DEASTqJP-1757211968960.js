import{c as p,k as l,p as S,j as e,s as j,a as P,U as A,E as T,S as U,B as k,n as H,x as h}from"./index-DSMc0hwj-1757211968960.js";import{D as L,a as B,b as C,c as O,d as R}from"./dialog-BZBxfzOI-1757211968960.js";import{T as $,a as F,b as g,c as _}from"./tabs-B1wMtWta-1757211968960.js";import{S as q}from"./separator-DzGZxbek-1757211968960.js";import{R as N}from"./refresh-cw-CGyvqlzX-1757211968960.js";import{f as d}from"./format-vTMqd3lv-1757211968960.js";import{M as x}from"./mail-DYn5OMuD-1757211968960.js";import{C as f}from"./circle-x-DfrynYHM-1757211968960.js";import{P as I}from"./paperclip-BsuDP0PA-1757211968960.js";import{S as z}from"./send-BPxPsjAz-1757211968960.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V=p("MailOpen",[["path",{d:"M21.2 8.4c.5.38.8.97.8 1.6v10a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V10a2 2 0 0 1 .8-1.6l8-6a2 2 0 0 1 2.4 0l8 6Z",key:"1jhwl8"}],["path",{d:"m22 10-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 10",key:"1qfld7"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=p("MailX",[["path",{d:"M22 13V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v12c0 1.1.9 2 2 2h9",key:"1j9vog"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}],["path",{d:"m17 17 4 4",key:"1b3523"}],["path",{d:"m21 17-4 4",key:"uinynz"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const y=p("MousePointer",[["path",{d:"M12.586 12.586 19 19",key:"ea5xo7"}],["path",{d:"M3.688 3.037a.497.497 0 0 0-.651.651l6.5 15.999a.501.501 0 0 0 .947-.062l1.569-6.083a2 2 0 0 1 1.448-1.479l6.124-1.579a.5.5 0 0 0 .063-.947z",key:"277e5u"}]]),u=class u{static async sendPurchaseOrderEmailOriginalFormat(s,a){try{return{success:!0,messageId:(await l("POST",`${this.BASE_URL}/send-email-original-format`,{filePath:s,...a})).data?.messageId}}catch(r){return console.error("ì›ë³¸ í˜•ì‹ ìœ ì§€ ì´ë©”ì¼ ë°œì†¡ ì˜¤ë¥˜:",r),{success:!1,error:r instanceof Error?r.message:"ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜"}}}static async sendPurchaseOrderEmail(s,a){if(s.filePath){const r={to:a.to,cc:a.cc,subject:a.subject,additionalMessage:a.message,poData:{orderNumber:s.orderNumber,orderDate:s.orderDate,siteName:s.siteName,vendorName:s.vendorName,totalAmount:s.totalAmount}};if(r.attachments=[],a.attachExcel&&r.attachments.push({path:s.filePath,filename:`ë°œì£¼ì„œ_${s.orderNumber}.xlsx`}),a.attachPDF){const c=s.filePath.replace(".xlsx",".pdf");r.attachments.push({path:c,filename:`ë°œì£¼ì„œ_${s.orderNumber}.pdf`})}try{return await l("POST",`${this.BASE_URL}/send-email`,r)}catch(c){throw console.error("Email send error:",c),new Error("ì´ë©”ì¼ ë°œì†¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.")}}try{const r={orderData:{orderNumber:s.orderNumber,vendorName:s.vendorName,orderDate:s.orderDate,totalAmount:s.totalAmount,siteName:s.siteName},to:a.to,cc:a.cc,subject:a.subject,message:a.message,attachPdf:a.attachPDF,attachExcel:a.attachExcel,emailSettings:{subject:a.subject,message:a.message,cc:a.cc}};return a.attachPDF&&s.pdfUrl&&(r.pdfUrl=s.pdfUrl,console.log("ğŸ“ PDF URL ì¶”ê°€:",s.pdfUrl)),a.attachExcel&&s.excelUrl&&(r.excelUrl=s.excelUrl,console.log("ğŸ“ Excel URL ì¶”ê°€:",s.excelUrl)),console.log("ğŸ“§ ì´ë©”ì¼ API ìš”ì²­ ë°ì´í„°:",r),{success:!0,messageId:(await l("POST","/api/orders/send-email",r)).messageId}}catch(r){throw console.error("Email send error:",r),new Error("ì´ë©”ì¼ ë°œì†¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.")}}static async testEmailConnection(){try{return await l("GET",`${this.BASE_URL}/test-email`)}catch(s){return console.error("Email connection test error:",s),{success:!1,message:"ì´ë©”ì¼ ì„œë²„ ì—°ê²° í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨"}}}static async extractSheets(s,a=["ê°‘ì§€","ì„ì§€"]){try{return await l("POST",`${this.BASE_URL}/extract-sheets`,{filePath:s,sheets:a})}catch(r){throw console.error("Sheet extraction error:",r),new Error("ì‹œíŠ¸ ì¶”ì¶œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.")}}static async convertToPDF(s,a){try{return await l("POST",`${this.BASE_URL}/convert-to-pdf`,{excelPath:s,sheets:a})}catch(r){throw console.error("PDF conversion error:",r),new Error("PDF ë³€í™˜ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.")}}static async processComplete(s,a){const r=new FormData;r.append("file",s),Object.entries(a).forEach(([c,n])=>{n!==void 0&&(Array.isArray(n)?r.append(c,n.join(",")):r.append(c,n.toString()))});try{return await l("POST",`${this.BASE_URL}/process-complete`,r)}catch(c){throw console.error("Complete process error:",c),new Error("í†µí•© ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.")}}};u.BASE_URL="/api/po-template";let w=u;function G(o){return S({queryKey:["/api/orders",o,"email-history"],queryFn:()=>l("GET",`/api/orders/${o}/email-history`),enabled:!!o,staleTime:30*1e3})}function ae({orderId:o,orderNumber:s,isOpen:a,onClose:r,onResend:c}){const{data:n,isLoading:b}=G(o),v=t=>{switch(t){case"sent":return e.jsx(z,{className:"h-4 w-4"});case"opened":return e.jsx(V,{className:"h-4 w-4"});case"clicked":return e.jsx(y,{className:"h-4 w-4"});case"failed":return e.jsx(X,{className:"h-4 w-4"});case"bounced":return e.jsx(f,{className:"h-4 w-4"});default:return e.jsx(x,{className:"h-4 w-4"})}},E=t=>{const i={sent:{variant:"default",label:"ë°œì†¡ë¨"},opened:{variant:"success",label:"ì—´ëŒë¨"},clicked:{variant:"secondary",label:"í´ë¦­ë¨"},failed:{variant:"destructive",label:"ì‹¤íŒ¨"},bounced:{variant:"warning",label:"ë°˜ì†¡ë¨"}},m=i[t]||i.sent;return e.jsxs(H,{variant:m.variant,children:[v(t),e.jsx("span",{className:"ml-1",children:m.label})]})};return e.jsx(L,{open:a,onOpenChange:r,children:e.jsxs(B,{className:"max-w-4xl max-h-[90vh]",children:[e.jsxs(C,{children:[e.jsx(O,{children:"ì´ë©”ì¼ ë°œì†¡ ì´ë ¥"}),e.jsxs(R,{children:["ë°œì£¼ì„œ ",s,"ì˜ ì´ë©”ì¼ ë°œì†¡ ë‚´ì—­ì…ë‹ˆë‹¤."]})]}),b?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(N,{className:"h-6 w-6 animate-spin text-gray-400"})}):n&&n.length>0?e.jsxs($,{defaultValue:"0",className:"w-full",children:[e.jsxs(F,{className:"grid w-full",style:{gridTemplateColumns:`repeat(${Math.min(n.length,5)}, 1fr)`},children:[n.slice(0,5).map((t,i)=>e.jsx(g,{value:i.toString(),children:d(new Date(t.sentAt),"MM/dd HH:mm")},t.id)),n.length>5&&e.jsxs(g,{value:"more",disabled:!0,children:["+",n.length-5," more"]})]}),n.map((t,i)=>e.jsxs(_,{value:i.toString(),className:"space-y-4",children:[e.jsxs(j,{className:"p-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(P,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"text-gray-600",children:"ë°œì†¡ ì‹œê°„:"}),e.jsx("span",{className:"font-medium",children:d(new Date(t.sentAt),"yyyyë…„ MMì›” ddì¼ HH:mm:ss",{locale:h})})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(A,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"text-gray-600",children:"ë°œì†¡ì:"}),e.jsxs("span",{className:"font-medium",children:[t.sentByName," (",t.sentByEmail,")"]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(x,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"text-gray-600",children:"ìˆ˜ì‹ ì:"}),e.jsx("span",{className:"font-medium",children:t.recipientName?`${t.recipientName} <${t.recipientEmail}>`:t.recipientEmail})]}),t.ccEmails&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(x,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"text-gray-600",children:"ì°¸ì¡°:"}),e.jsx("span",{className:"font-medium",children:t.ccEmails})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"ìƒíƒœ:"}),E(t.status)]}),t.openedAt&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(T,{className:"h-4 w-4 text-green-500"}),e.jsx("span",{className:"text-gray-600",children:"ì—´ëŒ ì‹œê°„:"}),e.jsx("span",{className:"font-medium",children:d(new Date(t.openedAt),"yyyyë…„ MMì›” ddì¼ HH:mm:ss",{locale:h})})]}),t.clickedAt&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(y,{className:"h-4 w-4 text-purple-500"}),e.jsx("span",{className:"text-gray-600",children:"í´ë¦­ ì‹œê°„:"}),e.jsx("span",{className:"font-medium",children:d(new Date(t.clickedAt),"yyyyë…„ MMì›” ddì¼ HH:mm:ss",{locale:h})})]}),t.errorMessage&&e.jsxs("div",{className:"flex items-start gap-2 text-sm",children:[e.jsx(f,{className:"h-4 w-4 text-red-500 mt-0.5"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"ì˜¤ë¥˜ ë©”ì‹œì§€:"}),e.jsx("p",{className:"text-red-600 text-xs mt-1",children:t.errorMessage})]})]})]})]}),t.attachments&&t.attachments.length>0&&e.jsxs("div",{className:"mt-4 pt-4 border-t",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm mb-2",children:[e.jsx(I,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"text-gray-600",children:"ì²¨ë¶€ íŒŒì¼:"})]}),e.jsx("div",{className:"space-y-1",children:t.attachments.map((m,M)=>e.jsxs("div",{className:"text-sm text-gray-700",children:[m.filename," (",(m.size/1024/1024).toFixed(2)," MB)"]},M))})]})]}),e.jsxs(j,{className:"p-4",children:[e.jsx("h4",{className:"font-medium mb-2",children:"ì œëª©"}),e.jsx("p",{className:"text-sm text-gray-700 mb-4",children:t.subject}),e.jsx(q,{}),e.jsx("h4",{className:"font-medium mt-4 mb-2",children:"ë‚´ìš©"}),e.jsx(U,{className:"h-[300px] w-full rounded-md border p-4",children:e.jsx("div",{className:"prose prose-sm max-w-none",dangerouslySetInnerHTML:{__html:t.body}})})]}),c&&t.status==="failed"&&e.jsx("div",{className:"flex justify-end",children:e.jsxs(k,{variant:"outline",size:"sm",onClick:()=>c(t.id),children:[e.jsx(N,{className:"h-4 w-4 mr-2"}),"ì¬ë°œì†¡"]})})]},t.id))]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(x,{className:"h-12 w-12 text-gray-300 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500",children:"ì´ë©”ì¼ ë°œì†¡ ì´ë ¥ì´ ì—†ìŠµë‹ˆë‹¤."})]})]})})}export{w as E,ae as a};
