import{n as ve,e as Ne,g as Pe,r as Q,q as te,s as F,j as e,w as K,L as me,N as xe,F as _,x as T,B as m,O as j,y as I,S as Y,z as X,A as ee,D as se,G as M,o as v,Q as L,X as de,k as b,R as H,U as fe,P as Ce,T as ke,a as Ie,d as Ae,u as Me,V as Ke,H as Te,W as Oe,Y as $e,Z as Ee,_ as Re,$ as He,a0 as Le,a1 as ze,a2 as Be,M as be,b as we,f as U,a3 as ce,a4 as De,K as d}from"./index-DXJvUTRh-1757331324924.js";import{T as J}from"./textarea-BsY1_zow-1757331324924.js";import{D as ue,f as Ve,a as pe,b as he,c as je}from"./dialog-BF1FjiHz-1757331324924.js";import{U as Ge}from"./upload-DbSQT5N0-1757331324924.js";import{C as ye}from"./calendar-CgenkOsJ-1757331324924.js";import{D as ge}from"./dollar-sign-eTgKBUDO-1757331324924.js";import{f as S}from"./format-ClWe0m6K-1757331324924.js";import{C as qe}from"./checkbox-CymOKxum-1757331324924.js";import{P as ae}from"./package-BdzUUYLw-1757331324924.js";import{T as Ue}from"./triangle-alert-DvvptCND-1757331324924.js";import{E as Je}from"./email-send-dialog-DWj6RBqI-1757331324924.js";import{E as _e}from"./email-history-modal-CMVVw8lo-1757331324924.js";import{A as We}from"./attached-files-info-BXrpv1t7-1757331324924.js";import{S as Ze}from"./square-pen-DvJRgc5a-1757331324924.js";import{M as Ye}from"./mail-check-B8Fq8J6u-1757331324924.js";import{P as Xe}from"./phone-BEeG7kfA-1757331324924.js";import{M as Se}from"./map-pin-CulHuQTV-1757331324924.js";import"./index-BfmdJv4D-1757331324924.js";import"./paperclip-B7FFu7t0-1757331324924.js";import"./send-SxKBA2HG-1757331324924.js";import"./refresh-cw-CG2kvxkw-1757331324924.js";import"./alert-dialog-BY0lso3P-1757331324924.js";import"./download-CAdqJKpM-1757331324924.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const es=ve("Pen",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=ve("ReceiptText",[["path",{d:"M4 2v20l2-1 2 1 2-1 2 1 2-1 2 1 2-1 2 1V2l-2 1-2-1-2 1-2-1-2 1-2-1-2 1Z",key:"q3az6g"}],["path",{d:"M14 8H8",key:"1l3xfs"}],["path",{d:"M16 12H8",key:"1fr5h0"}],["path",{d:"M13 16H8",key:"wsln4y"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fe=ve("Receipt",[["path",{d:"M4 2v20l2-1 2 1 2-1 2 1 2-1 2 1 2-1 2 1V2l-2 1-2-1-2 1-2-1-2 1-2-1-2 1Z",key:"q3az6g"}],["path",{d:"M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8",key:"1h4pet"}],["path",{d:"M12 17.5v-11",key:"1jc1ny"}]]);function ss({orderId:c}){const{toast:n}=Ne(),u=Pe(),[D,R]=Q.useState(!1),[P,q]=Q.useState(null),{data:y=[],isLoading:z}=te({queryKey:["/api/invoices",c],queryFn:async()=>await(await b("GET",`/api/invoices?orderId=${c}`)).json()}),{data:C=[]}=te({queryKey:["/api/verification-logs",c],queryFn:async()=>await(await b("GET",`/api/verification-logs?orderId=${c}`)).json()}),N=F({mutationFn:async t=>{const g=await fetch("/api/invoices",{method:"POST",body:t});if(!g.ok)throw new Error("Failed to upload invoice");return g.json()},onSuccess:()=>{u.invalidateQueries({queryKey:["/api/invoices",c]}),u.invalidateQueries({queryKey:["/api/verification-logs",c]}),R(!1),q(null),n({title:"ì„±ê³µ",description:"ì²­êµ¬ì„œê°€ ì—…ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤."})},onError:()=>{n({title:"ì˜¤ë¥˜",description:"ì²­êµ¬ì„œ ì—…ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.",variant:"destructive"})}}),O=F({mutationFn:async t=>await(await b("POST",`/api/invoices/${t}/verify`)).json(),onSuccess:()=>{u.invalidateQueries({queryKey:["/api/invoices",c]}),u.invalidateQueries({queryKey:["/api/verification-logs",c]}),n({title:"ì„±ê³µ",description:"ì²­êµ¬ì„œê°€ ê²€ì¦ë˜ì—ˆìŠµë‹ˆë‹¤."})},onError:()=>{n({title:"ì˜¤ë¥˜",description:"ì²­êµ¬ì„œ ê²€ì¦ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.",variant:"destructive"})}}),l=F({mutationFn:async t=>await(await b("POST",`/api/invoices/${t}/issue-tax`)).json(),onSuccess:()=>{u.invalidateQueries({queryKey:["/api/invoices",c]}),n({title:"ì„±ê³µ",description:"ì„¸ê¸ˆê³„ì‚°ì„œê°€ ë°œí–‰ë˜ì—ˆìŠµë‹ˆë‹¤."})},onError:()=>{n({title:"ì˜¤ë¥˜",description:"ì„¸ê¸ˆê³„ì‚°ì„œ ë°œí–‰ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.",variant:"destructive"})}}),s=F({mutationFn:async t=>await(await b("POST",`/api/invoices/${t}/cancel-tax`)).json(),onSuccess:()=>{u.invalidateQueries({queryKey:["/api/invoices",c]}),n({title:"ì„±ê³µ",description:"ì„¸ê¸ˆê³„ì‚°ì„œ ë°œí–‰ì´ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤."})},onError:()=>{n({title:"ì˜¤ë¥˜",description:"ì„¸ê¸ˆê³„ì‚°ì„œ ë°œí–‰ ì·¨ì†Œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.",variant:"destructive"})}}),B=t=>{t.preventDefault();const g=new FormData(t.currentTarget);g.set("orderId",c.toString()),P&&g.set("file",P),N.mutate(g)},$=t=>{switch(t){case"pending":return e.jsx(v,{variant:"secondary",children:"ê²€í† ì¤‘"});case"verified":return e.jsx(v,{variant:"default",children:"ê²€ì¦ì™„ë£Œ"});case"paid":return e.jsx(v,{variant:"outline",children:"ì§€ê¸‰ì™„ë£Œ"});default:return e.jsx(v,{variant:"secondary",children:t})}},A=t=>{switch(t){case"invoice":return e.jsx(v,{variant:"outline",children:"ì²­êµ¬ì„œ"});case"tax_invoice":return e.jsx(v,{variant:"outline",children:"ì„¸ê¸ˆê³„ì‚°ì„œ"});default:return e.jsx(v,{variant:"outline",children:t})}};return z?e.jsxs(K,{children:[e.jsx(me,{children:e.jsxs(xe,{className:"flex items-center gap-2",children:[e.jsx(_,{className:"h-5 w-5"}),"ì²­êµ¬ì„œ ê´€ë¦¬"]})}),e.jsx(T,{children:e.jsx("div",{className:"text-center py-4",children:"ë¡œë”© ì¤‘..."})})]}):e.jsxs(K,{children:[e.jsx(me,{className:"pb-2",children:e.jsxs(xe,{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[e.jsx(_,{className:"h-4 w-4"}),"ì²­êµ¬ì„œ ê´€ë¦¬"]}),e.jsxs(ue,{open:D,onOpenChange:R,children:[e.jsx(Ve,{asChild:!0,children:e.jsxs(m,{size:"sm",children:[e.jsx(Ge,{className:"h-3 w-3 mr-1"}),e.jsx("span",{className:"text-xs",children:"ì²­êµ¬ì„œ ì—…ë¡œë“œ"})]})}),e.jsxs(pe,{children:[e.jsx(he,{children:e.jsx(je,{children:"ì²­êµ¬ì„œ ì—…ë¡œë“œ"})}),e.jsxs("form",{onSubmit:B,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"invoiceNumber",children:"ì²­êµ¬ì„œ ë²ˆí˜¸"}),e.jsx(I,{id:"invoiceNumber",name:"invoiceNumber",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"invoiceType",children:"ìœ í˜•"}),e.jsxs(Y,{name:"invoiceType",defaultValue:"invoice",children:[e.jsx(X,{children:e.jsx(ee,{})}),e.jsxs(se,{children:[e.jsx(M,{value:"invoice",children:"ì²­êµ¬ì„œ"}),e.jsx(M,{value:"tax_invoice",children:"ì„¸ê¸ˆê³„ì‚°ì„œ"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"issueDate",children:"ë°œí–‰ì¼"}),e.jsx(I,{id:"issueDate",name:"issueDate",type:"date",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"dueDate",children:"ë§ˆê°ì¼"}),e.jsx(I,{id:"dueDate",name:"dueDate",type:"date"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"totalAmount",children:"ì´ê¸ˆì•¡"}),e.jsx(I,{id:"totalAmount",name:"totalAmount",type:"number",step:"0.01",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"vatAmount",children:"ë¶€ê°€ì„¸"}),e.jsx(I,{id:"vatAmount",name:"vatAmount",type:"number",step:"0.01",defaultValue:"0"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"file",children:"ì²¨ë¶€íŒŒì¼"}),e.jsx(I,{id:"file",type:"file",accept:".pdf,.jpg,.jpeg,.png",onChange:t=>q(t.target.files?.[0]||null)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"notes",children:"ë©”ëª¨"}),e.jsx(J,{id:"notes",name:"notes",rows:3})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(m,{type:"button",variant:"outline",onClick:()=>R(!1),children:"ì·¨ì†Œ"}),e.jsx(m,{type:"submit",disabled:N.isPending,children:N.isPending?"ì—…ë¡œë“œ ì¤‘...":"ì—…ë¡œë“œ"})]})]})]})]})]})}),e.jsxs(T,{className:"p-3",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"border-2 border-blue-200 rounded-lg p-3 bg-blue-50 dark:bg-blue-900/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(oe,{className:"h-4 w-4 text-blue-600"}),e.jsx("span",{className:"text-sm font-semibold text-blue-800 dark:text-blue-200",children:"ì„¸ê¸ˆê³„ì‚°ì„œ ë°œí–‰ ê´€ë¦¬"}),y.length===0?e.jsx(v,{variant:"outline",className:"text-xs border-blue-300 text-blue-700",children:"ì²­êµ¬ì„œ ì—…ë¡œë“œ í•„ìš”"}):y.some(t=>t.taxInvoiceIssued)?e.jsxs(v,{variant:"default",className:"text-xs bg-green-600",children:[e.jsx(Fe,{className:"h-2 w-2 mr-1"}),"ë°œí–‰ì™„ë£Œ"]}):e.jsx(v,{variant:"secondary",className:"text-xs",children:"ë¯¸ë°œí–‰"})]}),e.jsx("div",{className:"text-xs text-blue-600 dark:text-blue-300",children:y.length===0?"ì²­êµ¬ì„œë¥¼ ë¨¼ì € ì—…ë¡œë“œí•˜ê³  ê²€ì¦í•´ì£¼ì„¸ìš”":y.some(t=>t.status==="verified")?"ë°œí–‰ ì¤€ë¹„ ì™„ë£Œ":"ì²­êµ¬ì„œ ê²€ì¦ í•„ìš”"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-xs text-gray-600",children:y.length===0?"ì„¸ê¸ˆê³„ì‚°ì„œ ë°œí–‰ ê´€ë¦¬ë¥¼ ìœ„í•´ì„œëŠ” ì²­êµ¬ì„œë¥¼ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”.":y.some(t=>t.taxInvoiceIssued)?"ì„¸ê¸ˆê³„ì‚°ì„œê°€ ë°œí–‰ë˜ì—ˆìŠµë‹ˆë‹¤.":"ì„¸ê¸ˆê³„ì‚°ì„œ ë°œí–‰ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤."}),e.jsx("div",{className:"flex gap-2",children:y.length>0&&y.some(t=>t.status==="verified")?e.jsx(e.Fragment,{children:y.some(t=>t.taxInvoiceIssued)?e.jsxs(m,{size:"sm",variant:"destructive",onClick:()=>{const t=y.find(g=>g.taxInvoiceIssued);t&&s.mutate(t.id)},disabled:s.isPending,children:[e.jsx(de,{className:"h-3 w-3 mr-1"}),e.jsx("span",{className:"text-xs",children:"ë¯¸í™•ì¸"})]}):e.jsxs(m,{size:"sm",variant:"default",onClick:()=>{const t=y.find(g=>g.status==="verified"&&!g.taxInvoiceIssued);t&&l.mutate(t.id)},disabled:l.isPending,children:[e.jsx(L,{className:"h-3 w-3 mr-1"}),e.jsx("span",{className:"text-xs",children:"í™•ì¸"})]})}):e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(m,{size:"sm",variant:"outline",disabled:!0,children:[e.jsx(L,{className:"h-3 w-3 mr-1"}),e.jsx("span",{className:"text-xs",children:"í™•ì¸"})]}),e.jsxs(m,{size:"sm",variant:"outline",disabled:!0,children:[e.jsx(de,{className:"h-3 w-3 mr-1"}),e.jsx("span",{className:"text-xs",children:"ë¯¸í™•ì¸"})]})]})})]})]}),y.length===0?e.jsx("div",{className:"text-center py-4 text-muted-foreground text-xs",children:"ì•„ì§ ì—…ë¡œë“œëœ ì²­êµ¬ì„œê°€ ì—†ìŠµë‹ˆë‹¤."}):e.jsx("div",{className:"space-y-2",children:y.map(t=>e.jsxs("div",{className:"border rounded-lg p-2 space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("h4",{className:"font-medium text-xs",children:t.invoiceNumber}),A(t.invoiceType),$(t.status)]}),t.status==="pending"&&e.jsxs(m,{size:"sm",onClick:()=>O.mutate(t.id),disabled:O.isPending,children:[e.jsx(L,{className:"h-3 w-3 mr-1"}),e.jsx("span",{className:"text-xs",children:"ê²€ì¦"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2 text-xs text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ye,{className:"h-3 w-3 text-muted-foreground"}),e.jsxs("span",{children:["ë°œí–‰ì¼: ",S(new Date(t.issueDate),"yyyy-MM-dd",{locale:H})]})]}),t.dueDate&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ye,{className:"h-3 w-3 text-muted-foreground"}),e.jsxs("span",{children:["ë§ˆê°ì¼: ",S(new Date(t.dueDate),"yyyy-MM-dd",{locale:H})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ge,{className:"h-3 w-3 text-muted-foreground"}),e.jsxs("span",{children:["ì´ì•¡: â‚©",Math.round(t.totalAmount||0).toLocaleString("ko-KR")]})]}),t.vatAmount>0&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ge,{className:"h-3 w-3 text-muted-foreground"}),e.jsxs("span",{children:["ë¶€ê°€ì„¸: â‚©",Math.round(t.vatAmount||0).toLocaleString("ko-KR")]})]})]}),t.notes&&e.jsx("div",{className:"text-xs text-muted-foreground bg-muted p-2 rounded",children:t.notes}),e.jsxs("div",{className:"border-t pt-2 space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(oe,{className:"h-3 w-3 text-muted-foreground"}),e.jsx("span",{className:"text-xs font-medium",children:"ì„¸ê¸ˆê³„ì‚°ì„œ"}),t.taxInvoiceIssued?e.jsxs(v,{variant:"default",className:"text-xs",children:[e.jsx(Fe,{className:"h-2 w-2 mr-1"}),"ë°œí–‰ì™„ë£Œ"]}):e.jsx(v,{variant:"secondary",className:"text-xs",children:"ë¯¸ë°œí–‰"})]}),e.jsxs("div",{className:"flex gap-1",children:[t.status==="verified"&&e.jsx(e.Fragment,{children:t.taxInvoiceIssued?e.jsxs(m,{size:"sm",variant:"destructive",onClick:()=>s.mutate(t.id),disabled:s.isPending,children:[e.jsx(de,{className:"h-3 w-3 mr-1"}),e.jsx("span",{className:"text-xs",children:s.isPending?"ì·¨ì†Œ ì¤‘...":"ë°œí–‰ ì·¨ì†Œ"})]}):e.jsxs(m,{size:"sm",variant:"outline",onClick:()=>l.mutate(t.id),disabled:l.isPending,children:[e.jsx(oe,{className:"h-3 w-3 mr-1"}),e.jsx("span",{className:"text-xs",children:l.isPending?"ì²˜ë¦¬ ì¤‘...":"ë°œí–‰ í™•ì¸"})]})}),t.status!=="verified"&&e.jsx("div",{className:"text-xs text-muted-foreground",children:"ì²­êµ¬ì„œ ê²€ì¦ í›„ ë°œí–‰ ê°€ëŠ¥"})]})]}),t.status==="verified"&&t.taxInvoiceIssued&&t.taxInvoiceIssuedDate&&e.jsxs("div",{className:"text-xs text-muted-foreground bg-green-50 dark:bg-green-900/20 p-2 rounded",children:["ë°œí–‰ì¼: ",S(new Date(t.taxInvoiceIssuedDate),"yyyy-MM-dd HH:mm",{locale:H}),t.taxInvoiceIssuedBy&&` | ë°œí–‰ì: ${t.taxInvoiceIssuedBy}`]})]}),t.verifiedBy&&t.verifiedAt&&e.jsxs("div",{className:"text-xs text-muted-foreground border-t pt-1",children:["ê²€ì¦ì: ",t.verifiedBy," | ê²€ì¦ì¼: ",S(new Date(t.verifiedAt),"yyyy-MM-dd HH:mm",{locale:H})]})]},t.id))})]}),C.length>0&&e.jsxs("div",{className:"mt-3",children:[e.jsx("h4",{className:"font-medium mb-2 text-xs",children:"ê²€ì¦ ë¡œê·¸"}),e.jsx("div",{className:"space-y-1 max-h-32 overflow-y-auto",children:C.map(t=>e.jsxs("div",{className:"text-xs p-2 bg-muted rounded",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("span",{children:t.details}),e.jsx("span",{className:"text-xs text-muted-foreground",children:S(new Date(t.createdAt),"MM-dd HH:mm",{locale:H})})]}),e.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:t.performedBy})]},t.id))})]})]})]})}function ts({orderItems:c,orderId:n}){const{toast:u}=Ne(),D=Pe(),[R,P]=Q.useState(!1),[q,y]=Q.useState(null),[z,C]=Q.useState(!1),[N,O]=Q.useState(null),[,l]=Q.useState(0),s=fe(["/api/item-receipts",n],{queryFn:async()=>{const a=await b("GET","/api/item-receipts"),i=c.map(x=>x.id);return a.filter(x=>i.includes(x.orderItemId))},cacheType:"DYNAMIC",enabled:c.length>0}),{data:B=[]}=fe(["/api/invoices",n],{queryFn:()=>b("GET",`/api/invoices?orderId=${n}`),cacheType:"MASTER",enabled:!!n}),$=F({mutationFn:async a=>{console.log("Sending receipt data to API:",a);try{const i=await b("POST","/api/item-receipts",a);return console.log("API response:",i),i}catch(i){throw console.error("API request failed:",i),i}},onSuccess:async a=>{console.log("ğŸ’¥ Receipt creation successful, forcing refetch:",a),D.resetQueries({queryKey:["/api/item-receipts",n]}),D.invalidateQueries({queryKey:["/api/item-receipts"]}),await s.refetch(),l(i=>i+1),D.invalidateQueries({queryKey:["/api/verification-logs",n]}),P(!1),y(null),u({title:"ì„±ê³µ",description:"ìˆ˜ë ¹ í™•ì¸ì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤."})},onError:a=>{console.error("Receipt creation mutation error:",a);const i=a?.message||"ìˆ˜ë ¹ í™•ì¸ ë“±ë¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.";u({title:"ì˜¤ë¥˜",description:i,variant:"destructive"})}}),A=F({mutationFn:async a=>{const{id:i,...o}=a;return await(await b("PATCH",`/api/item-receipts/${i}`,o)).json()},onSuccess:async a=>{console.log("ğŸ’¥ Receipt update successful:",a),D.resetQueries({queryKey:["/api/item-receipts",n]}),D.invalidateQueries({queryKey:["/api/item-receipts"]}),await s.refetch(),l(i=>i+1),D.invalidateQueries({queryKey:["/api/verification-logs",n]}),C(!1),O(null),u({title:"ìˆ˜ë ¹ ì •ë³´ ìˆ˜ì • ì™„ë£Œ",description:"ìˆ˜ë ¹ ì •ë³´ê°€ ì„±ê³µì ìœ¼ë¡œ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤."})},onError:a=>{u({title:"ìˆ˜ì • ì‹¤íŒ¨",description:a.message||"ìˆ˜ë ¹ ì •ë³´ ìˆ˜ì • ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.",variant:"destructive"})}}),t=F({mutationFn:async a=>await b("DELETE",`/api/item-receipts/${a}`),onSuccess:async()=>{console.log("ğŸ’¥ Receipt deletion successful"),D.resetQueries({queryKey:["/api/item-receipts",n]}),D.invalidateQueries({queryKey:["/api/item-receipts"]}),await s.refetch(),l(a=>a+1),D.invalidateQueries({queryKey:["/api/verification-logs",n]}),u({title:"ìˆ˜ë ¹ ì •ë³´ ì‚­ì œ ì™„ë£Œ",description:"ìˆ˜ë ¹ ì •ë³´ê°€ ì„±ê³µì ìœ¼ë¡œ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤."})},onError:a=>{u({title:"ì‚­ì œ ì‹¤íŒ¨",description:a.message||"ìˆ˜ë ¹ ì •ë³´ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.",variant:"destructive"})}}),g=F({mutationFn:async a=>{const i=a.map(o=>b("POST","/api/item-receipts",o));return await Promise.all(i)},onSuccess:()=>{D.invalidateQueries({queryKey:["/api/item-receipts"]}),D.invalidateQueries({queryKey:["/api/verification-logs",n]}),u({title:"ì„±ê³µ",description:"ì¼ê´„ ìˆ˜ë ¹ ë“±ë¡ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤."})},onError:()=>{u({title:"ì˜¤ë¥˜",description:"ì¼ê´„ ìˆ˜ë ¹ ë“±ë¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.",variant:"destructive"})}}),re=a=>{a.preventDefault();const i=new FormData(a.currentTarget),o={orderItemId:q.id,invoiceId:i.get("invoiceId")?parseInt(i.get("invoiceId")):void 0,receivedQuantity:parseFloat(i.get("receivedQuantity")),receivedDate:i.get("receivedDate"),qualityCheck:i.get("qualityCheck")==="on",qualityNotes:i.get("qualityNotes")||"",status:i.get("status")||"approved",notes:i.get("notes")||""};console.log("Submitting receipt data:",o),$.mutate(o)},ie=a=>{if(a.preventDefault(),!N){u({title:"ì˜¤ë¥˜",description:"ì„ íƒëœ ìˆ˜ë ¹ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.",variant:"destructive"});return}const i=new FormData(a.currentTarget),o={id:N.id,receivedQuantity:parseFloat(i.get("receivedQuantity")),receivedDate:i.get("receivedDate"),qualityCheck:i.get("qualityCheck")==="on",qualityNotes:i.get("qualityNotes")||"",status:i.get("status")||"pending",notes:i.get("notes")||""};console.log("Submitting updated receipt data:",o),A.mutate(o)},ne=()=>{const a=new Date().toISOString().split("T")[0],i=c.filter(x=>w(x.id)<x.quantity);if(i.length===0){u({title:"ì•Œë¦¼",description:"ëª¨ë“  í•­ëª©ì´ ì´ë¯¸ ìˆ˜ë ¹ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤."});return}const o=i.map(x=>({orderItemId:x.id,receivedQuantity:x.quantity-w(x.id),receivedDate:a,qualityCheck:!0,status:"approved",notes:"ì¼ê´„ ìˆ˜ë ¹ ë“±ë¡"}));g.mutate(o)},W=a=>{if(s.status==="error")return console.log(`âŒ Query in error state for item ${a}, triggering fresh fetch`),s.refetch(),[];const i=s.data||[];console.log(`ğŸ” Looking for receipts for item ${a}`),console.log(`ğŸ” Current query data length: ${i.length}`),console.log(`ğŸ” Query status: ${s.status}, isFetching: ${s.isFetching}`);const o=i.filter(x=>x.orderItemId===a);return console.log(`ğŸ“‹ Found ${o.length} receipts for item ${a}:`,o),o},w=a=>{const o=W(a).reduce((x,k)=>{const p=typeof k.receivedQuantity=="string"?parseFloat(k.receivedQuantity):k.receivedQuantity;return x+(p||0)},0);return console.log(`ğŸ’¯ Total received for item ${a}: ${o}`),o},E=a=>{const x=(s.data||[]).filter(p=>p.orderItemId===a.id).reduce((p,r)=>{const h=typeof r.receivedQuantity=="string"?parseFloat(r.receivedQuantity):r.receivedQuantity;return p+(h||0)},0),k=a.quantity;return x===0?{status:"pending",label:"ë¯¸ìˆ˜ë ¹",icon:Ie,color:"secondary"}:x<k?{status:"partial",label:"ë¶€ë¶„ìˆ˜ë ¹",icon:Ue,color:"warning"}:{status:"complete",label:"ìˆ˜ë ¹ì™„ë£Œ",icon:L,color:"default"}},le=a=>{switch(a){case"pending":return e.jsx(v,{variant:"secondary",children:"ëŒ€ê¸°ì¤‘"});case"approved":return e.jsx(v,{variant:"default",children:"ìŠ¹ì¸ë¨"});case"rejected":return e.jsx(v,{variant:"destructive",children:"ë°˜ë ¤ë¨"});default:return e.jsx(v,{variant:"secondary",children:a})}};return e.jsxs(K,{children:[e.jsx(me,{className:"pb-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(xe,{className:"flex items-center gap-1 text-sm",children:[e.jsx(ae,{className:"h-4 w-4"}),"ìì¬ ìˆ˜ë ¹ í™•ì¸"]}),e.jsxs(m,{onClick:ne,disabled:g.isPending,className:"bg-blue-600 hover:bg-blue-700",size:"sm",children:[e.jsx(ae,{className:"h-3 w-3 mr-1"}),e.jsx("span",{className:"text-xs",children:"ì¼ê´„ ìˆ˜ë ¹ ë“±ë¡"})]})]})}),e.jsxs(T,{className:"p-3",children:[e.jsx("div",{className:"space-y-2",children:c.map(a=>{const i=W(a.id),o=w(a.id),x=E(a),k=x.icon;return e.jsxs("div",{className:"border rounded-lg p-2 space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-1 mb-1",children:[e.jsx("h4",{className:"font-medium text-xs",children:a.itemName}),e.jsxs(v,{variant:x.color,className:"flex items-center gap-1 text-xs",children:[e.jsx(k,{className:"h-3 w-3"}),x.label]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2 text-xs text-muted-foreground",children:[e.jsxs("div",{children:["ë°œì£¼ìˆ˜ëŸ‰: ",a.quantity.toLocaleString(),a.unit]}),e.jsxs("div",{children:["ìˆ˜ë ¹ìˆ˜ëŸ‰: ",o.toLocaleString(),a.unit]}),e.jsxs("div",{children:["ë¯¸ìˆ˜ë ¹: ",(a.quantity-o).toLocaleString(),a.unit]}),e.jsxs("div",{children:["ë‹¨ê°€: â‚©",Math.round(a.unitPrice||0).toLocaleString("ko-KR")]})]}),a.notes&&e.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:a.notes})]}),e.jsxs(m,{size:"sm",onClick:()=>{y(a),P(!0)},disabled:o>=a.quantity,children:[e.jsx(Ce,{className:"h-3 w-3 mr-1"}),e.jsx("span",{className:"text-xs",children:"ìˆ˜ë ¹ë“±ë¡"})]})]}),i.length>0&&e.jsxs("div",{className:"mt-2",children:[e.jsx("h5",{className:"text-xs font-medium mb-1",children:"ìˆ˜ë ¹ ì´ë ¥"}),e.jsx("div",{className:"space-y-1",children:i.map(p=>e.jsx("div",{className:"bg-muted p-2 rounded text-xs",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs("span",{className:"font-medium text-xs",children:[(typeof p.receivedQuantity=="string"?parseFloat(p.receivedQuantity):p.receivedQuantity).toLocaleString(),a.unit," ìˆ˜ë ¹"]}),le(p.status),p.qualityCheck&&e.jsxs(v,{variant:"outline",className:"text-xs",children:[e.jsx(L,{className:"h-2 w-2 mr-1"}),"í’ˆì§ˆê²€ì‚¬"]})]}),e.jsxs("div",{className:"text-muted-foreground text-xs",children:["ìˆ˜ë ¹ì¼: ",S(new Date(p.receivedDate),"yyyy-MM-dd",{locale:H})]}),p.qualityNotes&&e.jsxs("div",{className:"text-muted-foreground text-xs",children:["í’ˆì§ˆë©”ëª¨: ",p.qualityNotes]}),p.notes&&e.jsxs("div",{className:"text-muted-foreground text-xs",children:["ë©”ëª¨: ",p.notes]})]}),e.jsxs("div",{className:"flex flex-col items-end gap-1",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(m,{size:"sm",variant:"ghost",onClick:()=>{O(p),C(!0)},className:"h-6 w-6 p-0 hover:bg-blue-50",children:e.jsx(es,{className:"h-3 w-3 text-blue-600"})}),e.jsx(m,{size:"sm",variant:"ghost",onClick:()=>{confirm("ì´ ìˆ˜ë ¹ ê¸°ë¡ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")&&t.mutate(p.id)},className:"h-6 w-6 p-0 hover:bg-red-50",disabled:t.isPending,children:e.jsx(ke,{className:"h-3 w-3 text-red-600"})})]}),e.jsxs("div",{className:"text-xs text-muted-foreground text-right",children:[e.jsxs("div",{children:["ë“±ë¡ì: ",p.verifiedBy]}),e.jsx("div",{children:S(new Date(p.createdAt),"MM-dd HH:mm",{locale:H})})]})]})]})},p.id))})]})]},a.id)})}),e.jsx(ue,{open:R,onOpenChange:P,children:e.jsxs(pe,{children:[e.jsx(he,{children:e.jsx(je,{children:"ìì¬ ìˆ˜ë ¹ ë“±ë¡"})}),q&&e.jsxs("form",{onSubmit:re,className:"space-y-4",children:[e.jsxs("div",{className:"bg-muted p-3 rounded",children:[e.jsx("div",{className:"font-medium",children:q.itemName}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["ë°œì£¼ìˆ˜ëŸ‰: ",q.quantity.toLocaleString(),q.unit," | ìˆ˜ë ¹ê°€ëŠ¥: ",(q.quantity-w(q.id)).toLocaleString(),q.unit]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"receivedQuantity",children:"ìˆ˜ë ¹ ìˆ˜ëŸ‰"}),e.jsx(I,{id:"receivedQuantity",name:"receivedQuantity",type:"number",step:"0.01",max:q.quantity-w(q.id),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"receivedDate",children:"ìˆ˜ë ¹ ì¼ì"}),e.jsx(I,{id:"receivedDate",name:"receivedDate",type:"date",defaultValue:new Date().toISOString().split("T")[0],required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"invoiceId",children:"ì—°ê²°ëœ ì²­êµ¬ì„œ (ì„ íƒ)"}),e.jsxs(Y,{name:"invoiceId",children:[e.jsx(X,{children:e.jsx(ee,{placeholder:"ì²­êµ¬ì„œ ì„ íƒ"})}),e.jsx(se,{children:B.map(a=>e.jsxs(M,{value:a.id.toString(),children:[a.invoiceNumber," - â‚©",a.totalAmount.toLocaleString()]},a.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"status",children:"ìƒíƒœ"}),e.jsxs(Y,{name:"status",defaultValue:"pending",children:[e.jsx(X,{children:e.jsx(ee,{})}),e.jsxs(se,{children:[e.jsx(M,{value:"pending",children:"ëŒ€ê¸°ì¤‘"}),e.jsx(M,{value:"approved",children:"ìŠ¹ì¸ë¨"}),e.jsx(M,{value:"rejected",children:"ë°˜ë ¤ë¨"})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(qe,{id:"qualityCheck",name:"qualityCheck"}),e.jsx(j,{htmlFor:"qualityCheck",className:"text-sm",children:"í’ˆì§ˆ ê²€ì‚¬ ì™„ë£Œ"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"qualityNotes",children:"í’ˆì§ˆ ê²€ì‚¬ ë©”ëª¨"}),e.jsx(J,{id:"qualityNotes",name:"qualityNotes",rows:2,placeholder:"í’ˆì§ˆ ê²€ì‚¬ ê²°ê³¼ë‚˜ íŠ¹ì´ì‚¬í•­ì„ ì…ë ¥í•˜ì„¸ìš”"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"notes",children:"ì¶”ê°€ ë©”ëª¨"}),e.jsx(J,{id:"notes",name:"notes",rows:2,placeholder:"ê¸°íƒ€ ë©”ëª¨ì‚¬í•­ì„ ì…ë ¥í•˜ì„¸ìš”"})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(m,{type:"button",variant:"outline",onClick:()=>P(!1),children:"ì·¨ì†Œ"}),e.jsx(m,{type:"submit",disabled:$.isPending,children:$.isPending?"ë“±ë¡ ì¤‘...":"ë“±ë¡"})]})]})]})}),e.jsx(ue,{open:z,onOpenChange:C,children:e.jsxs(pe,{children:[e.jsx(he,{children:e.jsx(je,{children:"ìˆ˜ë ¹ ì •ë³´ ìˆ˜ì •"})}),N&&e.jsxs("form",{onSubmit:ie,className:"space-y-4",children:[e.jsx("div",{className:"bg-muted p-3 rounded",children:e.jsxs("div",{className:"text-sm text-muted-foreground",children:["ìˆ˜ë ¹ ê¸°ë¡ ID: ",N.id]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"edit-receivedQuantity",children:"ìˆ˜ë ¹ ìˆ˜ëŸ‰"}),e.jsx(I,{id:"edit-receivedQuantity",name:"receivedQuantity",type:"number",step:"0.01",defaultValue:N.receivedQuantity,required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"edit-receivedDate",children:"ìˆ˜ë ¹ ì¼ì"}),e.jsx(I,{id:"edit-receivedDate",name:"receivedDate",type:"date",defaultValue:new Date(N.receivedDate).toISOString().split("T")[0],required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"edit-status",children:"ìƒíƒœ"}),e.jsxs(Y,{name:"status",defaultValue:N.status,children:[e.jsx(X,{children:e.jsx(ee,{})}),e.jsxs(se,{children:[e.jsx(M,{value:"pending",children:"ëŒ€ê¸°ì¤‘"}),e.jsx(M,{value:"approved",children:"ìŠ¹ì¸ë¨"}),e.jsx(M,{value:"rejected",children:"ë°˜ë ¤ë¨"})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(qe,{id:"edit-qualityCheck",name:"qualityCheck",defaultChecked:N.qualityCheck}),e.jsx(j,{htmlFor:"edit-qualityCheck",className:"text-sm",children:"í’ˆì§ˆ ê²€ì‚¬ ì™„ë£Œ"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"edit-qualityNotes",children:"í’ˆì§ˆ ê²€ì‚¬ ë©”ëª¨"}),e.jsx(J,{id:"edit-qualityNotes",name:"qualityNotes",rows:2,defaultValue:N.qualityNotes,placeholder:"í’ˆì§ˆ ê²€ì‚¬ ê²°ê³¼ë‚˜ íŠ¹ì´ì‚¬í•­ì„ ì…ë ¥í•˜ì„¸ìš”"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"edit-notes",children:"ì¶”ê°€ ë©”ëª¨"}),e.jsx(J,{id:"edit-notes",name:"notes",rows:2,defaultValue:N.notes,placeholder:"ê¸°íƒ€ ë©”ëª¨ì‚¬í•­ì„ ì…ë ¥í•˜ì„¸ìš”"})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(m,{type:"button",variant:"outline",onClick:()=>C(!1),children:"ì·¨ì†Œ"}),e.jsx(m,{type:"submit",disabled:A.isPending,children:A.isPending?"ìˆ˜ì • ì¤‘...":"ìˆ˜ì • ì™„ë£Œ"})]})]})]})})]})]})}function Fs(){const{user:c}=Ae(),{toast:n}=Ne(),[,u]=Me(),D=Ke(),[R,P]=Q.useState(!1),[q,y]=Q.useState(null),[z,C]=Q.useState(!1),[N,O]=Q.useState(!1),l=parseInt(D.id),{data:s,isLoading:B}=te({queryKey:[`/api/orders/${l}`],queryFn:async()=>{console.log("ğŸ“˜ OrderDetailProfessional - Fetching order:",l);const r=await b("GET",`/api/orders/${l}`);return console.log("ğŸ“˜ OrderDetailProfessional - Order data received:",r),console.log("ğŸ“˜ OrderDetailProfessional - Attachments:",r?.attachments),r}});te({queryKey:["/api/order-statuses"]});const $=F({mutationFn:async()=>{await b("POST",`/api/orders/${l}/approve`)},onSuccess:()=>{n({title:"ë°œì£¼ì„œ ìŠ¹ì¸",description:"ë°œì£¼ì„œê°€ ì„±ê³µì ìœ¼ë¡œ ìŠ¹ì¸ë˜ì—ˆìŠµë‹ˆë‹¤."}),d.invalidateQueries({queryKey:["/api/orders"]}),d.invalidateQueries({queryKey:[`/api/orders/${l}`]}),d.invalidateQueries({queryKey:["orders-optimized"]}),d.invalidateQueries({queryKey:["orders-metadata"]}),d.invalidateQueries({queryKey:["/api/dashboard"]}),d.refetchQueries({queryKey:["orders-optimized"],type:"active",exact:!1})},onError:r=>{n({title:"ìŠ¹ì¸ ì‹¤íŒ¨",description:r.message,variant:"destructive"})}});F({mutationFn:async()=>{await b("POST",`/api/orders/${l}/send`)},onSuccess:()=>{n({title:"ë°œì£¼ì„œ ë°œì†¡",description:"ë°œì£¼ì„œê°€ ì„±ê³µì ìœ¼ë¡œ ë°œì†¡ë˜ì—ˆìŠµë‹ˆë‹¤."}),d.invalidateQueries({queryKey:["/api/orders"]}),d.invalidateQueries({queryKey:[`/api/orders/${l}`]}),d.invalidateQueries({queryKey:["orders-optimized"]}),d.invalidateQueries({queryKey:["orders-metadata"]}),d.invalidateQueries({queryKey:["/api/dashboard"]}),d.refetchQueries({queryKey:["orders-optimized"],type:"active",exact:!1})},onError:r=>{n({title:"ë°œì†¡ ì‹¤íŒ¨",description:r.message,variant:"destructive"})}});const A=F({mutationFn:async()=>await b("POST",`/api/orders/${l}/create-order`),onSuccess:r=>{n({title:"ë°œì£¼ì„œ ìƒì„± ì™„ë£Œ",description:"ë°œì£¼ì„œê°€ ì„±ê³µì ìœ¼ë¡œ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤. PDFê°€ ì²¨ë¶€ë˜ì—ˆìŠµë‹ˆë‹¤."}),d.invalidateQueries({queryKey:["/api/orders"]}),d.invalidateQueries({queryKey:[`/api/orders/${l}`]})},onError:r=>{n({title:"ë°œì£¼ì„œ ìƒì„± ì‹¤íŒ¨",description:r.message||"ë°œì£¼ì„œ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.",variant:"destructive"})}}),t=F({mutationFn:async()=>await b("POST",`/api/orders/${l}/complete-delivery`),onMutate:async()=>{await d.cancelQueries({queryKey:[`/api/orders/${l}`]});const r=d.getQueryData([`/api/orders/${l}`]);return d.setQueryData([`/api/orders/${l}`],h=>({...h,status:"completed",orderStatus:"delivered"})),{previousOrder:r}},onSuccess:r=>{n({title:"ë‚©í’ˆê²€ìˆ˜ì™„ë£Œ",description:"ë°œì£¼ì„œê°€ ë‚©í’ˆì™„ë£Œ ìƒíƒœë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤."}),d.invalidateQueries({queryKey:["/api/orders"]}),d.invalidateQueries({queryKey:[`/api/orders/${l}`]}),d.invalidateQueries({queryKey:["/api/dashboard/unified"]}),d.invalidateQueries({queryKey:["orders-optimized"]}),d.invalidateQueries({queryKey:["orders-metadata"]}),d.invalidateQueries({queryKey:["/api/dashboard"]}),d.refetchQueries({queryKey:["orders-optimized"],type:"active",exact:!1})},onError:(r,h,V)=>{d.setQueryData([`/api/orders/${l}`],V?.previousOrder),n({title:"ë‚©í’ˆê²€ìˆ˜ì™„ë£Œ ì‹¤íŒ¨",description:r.message||"ë‚©í’ˆê²€ìˆ˜ì™„ë£Œ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.",variant:"destructive"})},onSettled:()=>{d.invalidateQueries({queryKey:[`/api/orders/${l}`]})}}),g=async()=>{O(!0),n({title:"PDF ìƒì„± ì‹œì‘",description:"ë°œì£¼ì„œ ë°ì´í„°ë¥¼ ì¤€ë¹„í•˜ê³  ìˆìŠµë‹ˆë‹¤..."});try{setTimeout(()=>{n({title:"PDF ìƒì„± ì¤‘",description:"ProfessionalPDFGenerationServiceë¥¼ ì‚¬ìš©í•˜ì—¬ PDFë¥¼ ìƒì„±í•˜ê³  ìˆìŠµë‹ˆë‹¤..."})},1e3);const r=await b("POST",`/api/orders/${l}/regenerate-pdf`);if(r.success)n({title:"ë°ì´í„°ë² ì´ìŠ¤ ì €ì¥ ì™„ë£Œ",description:"ìƒì„±ëœ PDFê°€ ì²¨ë¶€íŒŒì¼ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤."}),await d.invalidateQueries({queryKey:[`/api/orders/${l}`]}),setTimeout(()=>{n({title:"âœ… PDF ë°œì£¼ì„œ ìƒì„± ì™„ë£Œ",description:"PDF ë°œì£¼ì„œê°€ ì„±ê³µì ìœ¼ë¡œ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤. í•˜ë‹¨ ì²¨ë¶€íŒŒì¼ì—ì„œ í™•ì¸í•˜ì„¸ìš”.",duration:5e3})},500);else throw new Error(r.message||"PDF ìƒì„± ì‹¤íŒ¨")}catch(r){n({title:"âŒ PDF ìƒì„± ì‹¤íŒ¨",description:r.message||"PDF ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.",variant:"destructive"})}finally{O(!1)}},re=()=>{confirm("ì´ ë°œì£¼ì„œë¥¼ ìŠ¹ì¸í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")&&$.mutate()},ie=()=>{confirm(`ë‚©í’ˆê²€ìˆ˜ë¥¼ ì™„ë£Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?

â€¢ ë°œì£¼ì„œ ìƒíƒœê°€ 'ë‚©í’ˆì™„ë£Œ'ë¡œ ë³€ê²½ë©ë‹ˆë‹¤
â€¢ ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤
â€¢ ë‚©í’ˆì´ ì™„ì „íˆ ê²€ìˆ˜ë˜ì—ˆì„ ë•Œë§Œ ì§„í–‰í•˜ì„¸ìš”`)&&t.mutate()},ne=async r=>{if(s)try{const h=[],V=r.customFiles||[];if(r.selectedAttachmentIds&&r.selectedAttachmentIds.length>0){console.log("ğŸ“ ì„ íƒëœ ì²¨ë¶€íŒŒì¼ ID:",r.selectedAttachmentIds);for(const f of r.selectedAttachmentIds)f>0&&h.push(f)}const G=[];for(const f of h){const Z=`/api/attachments/${f}/download`;G.push(Z),console.log("ğŸ“ ì„œë²„ ì²¨ë¶€íŒŒì¼ URL ìƒì„±:",Z)}if(V.length>0){console.log("ğŸ“ ì‚¬ìš©ì ì—…ë¡œë“œ íŒŒì¼ í¬í•¨:",V.length,"ê°œ");const f=new FormData;if(f.append("orderData",JSON.stringify({orderId:s.id,orderNumber:s.orderNumber,vendorName:s.vendor?.name||s.vendorName||"",orderDate:s.orderDate,totalAmount:s.totalAmount,siteName:s.project?.projectName||s.projectName||"",attachmentUrls:G})),f.append("to",JSON.stringify(r.to)),r.cc&&f.append("cc",JSON.stringify(r.cc)),f.append("subject",r.subject),r.message&&f.append("message",r.message),f.append("selectedAttachmentIds",JSON.stringify(h)),f.append("orderId",s.id.toString()),V.forEach((Qe,as)=>{f.append("customFiles",Qe)}),(await fetch("/api/orders/send-email",{method:"POST",body:f})).ok)n({title:"ì´ë©”ì¼ ë°œì†¡ ì™„ë£Œ",description:"ë°œì£¼ì„œê°€ ì„±ê³µì ìœ¼ë¡œ ì „ì†¡ë˜ì—ˆìŠµë‹ˆë‹¤."}),d.invalidateQueries({queryKey:["order",Number(l)]}),sendEmailMutation.mutate();else throw new Error("Failed to send email")}else{const f={orderId:s.id,orderNumber:s.orderNumber,vendorName:s.vendor?.name||s.vendorName||"",orderDate:s.orderDate,totalAmount:s.totalAmount,siteName:s.project?.projectName||s.projectName||"",attachmentUrls:G};if(console.log("ğŸ“§ ì´ë©”ì¼ ë°œì†¡ ë°ì´í„° (JSON):",{orderData:f,emailData:r,selectedAttachmentIds:h,attachmentUrls:G,hasAttachments:s.attachments?.length||0}),(await fetch("/api/orders/send-email",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({orderData:f,...r,orderId:s.id,attachmentUrls:G,selectedAttachmentIds:h})})).ok)n({title:"ì´ë©”ì¼ ë°œì†¡ ì™„ë£Œ",description:`${s.vendor?.name||s.vendorName}ì—ê²Œ ë°œì£¼ì„œ ${s.orderNumber}ë¥¼ ì „ì†¡í–ˆìŠµë‹ˆë‹¤.`}),P(!1),y(null),d.invalidateQueries({queryKey:["/api/orders"]}),d.invalidateQueries({queryKey:[`/api/orders/${l}`]}),d.invalidateQueries({queryKey:["orders-optimized"]}),d.invalidateQueries({queryKey:["orders-metadata"]}),d.invalidateQueries({queryKey:["/api/dashboard"]}),d.refetchQueries({queryKey:[`/api/orders/${l}`],type:"active"});else throw new Error("ì´ë©”ì¼ ë°œì†¡ ì‹¤íŒ¨")}}catch(h){n({title:"ì´ë©”ì¼ ë°œì†¡ ì‹¤íŒ¨",description:h instanceof Error?h.message:"ì´ë©”ì¼ ë°œì†¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.",variant:"destructive"})}},W=()=>{C(!0)};if(B)return e.jsx("div",{className:"min-h-screen bg-gray-50",children:e.jsx("div",{className:"max-w-[1366px] mx-auto p-6",children:e.jsxs("div",{className:"animate-pulse space-y-6",children:[e.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/3"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/2"}),e.jsx("div",{className:"grid grid-cols-4 gap-4",children:[...Array(4)].map((r,h)=>e.jsx("div",{className:"h-24 bg-gray-200 rounded-xl"},h))}),e.jsx("div",{className:"h-64 bg-gray-200 rounded-xl"})]})})});if(!s)return e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsx(K,{className:"max-w-md shadow-sm",children:e.jsxs(T,{className:"p-8 text-center",children:[e.jsx(Te,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h1",{className:"text-lg font-semibold text-gray-900 mb-2",children:"ë°œì£¼ì„œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤"}),e.jsx("p",{className:"text-sm text-gray-600 mb-6",children:"ìš”ì²­í•˜ì‹  ë°œì£¼ì„œê°€ ì¡´ì¬í•˜ì§€ ì•Šê±°ë‚˜ ì ‘ê·¼ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤."}),e.jsx(m,{onClick:()=>u("/orders"),className:"bg-blue-600 hover:bg-blue-700",children:"ë°œì£¼ì„œ ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸°"})]})})});const w=s.orderStatus||s.status,E=s.approvalStatus,le=w==="draft"&&(c?.role==="admin"||s.userId===c?.id),a=w==="draft"||w==="created",i=Oe(w,E)&&(c?.role==="admin"||s.userId===c?.id),o=$e(w)&&(c?.role==="admin"||s.userId===c?.id),x=Ee(w,E)&&(c?.role==="admin"||s.userId===c?.id),k=Re(E,c?.role),p=He(w,E)&&(c?.role==="admin"||s.userId===c?.id);return e.jsx("div",{className:"min-h-screen bg-gray-50",children:e.jsxs("div",{className:"max-w-[1366px] mx-auto p-6",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("button",{onClick:()=>u("/orders"),className:"inline-flex items-center text-sm text-gray-600 hover:text-gray-900 mb-4",children:[e.jsx(Le,{className:"h-4 w-4 mr-1"}),"ë°œì£¼ì„œ ëª©ë¡ìœ¼ë¡œ"]}),e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:s.orderNumber}),e.jsxs("div",{className:"flex items-center gap-4 mt-2",children:[e.jsx("span",{className:`inline-flex items-center px-3 py-1 rounded-full text-xs font-medium border ${ze(w,E)}`,children:Be(w,E)}),w==="draft"&&e.jsx("span",{className:"text-xs text-amber-600 bg-amber-50 px-2 py-1 rounded",children:"âš ï¸ ì„ì‹œì €ì¥ ìƒíƒœ - ë°œì£¼ì„œ ìƒì„± í•„ìš”"}),e.jsxs("p",{className:"text-sm text-gray-500",children:[s.vendor?.name," â€¢ ",s.orderDate?S(new Date(s.orderDate),"yyyyë…„ MMì›” ddì¼"):"ë‚ ì§œ ë¯¸ì •"]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[x&&e.jsxs(m,{variant:"outline",onClick:()=>u(`/orders/${l}/edit`),className:"flex items-center gap-2",children:[e.jsx(Ze,{className:"h-4 w-4"}),"ìˆ˜ì •"]}),le&&e.jsxs(m,{onClick:()=>{confirm(`ë°œì£¼ì„œë¥¼ ìƒì„±í•˜ì‹œê² ìŠµë‹ˆê¹Œ?

â€¢ PDF íŒŒì¼ì´ ìë™ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤
â€¢ ìƒíƒœê°€ 'ìƒì„±ë¨'ìœ¼ë¡œ ë³€ê²½ë©ë‹ˆë‹¤
â€¢ ìƒì„± í›„ PDF ë³´ê¸° ë° ì´ë©”ì¼ ë°œì†¡ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤`)&&A.mutate()},disabled:A.isPending,className:"bg-blue-600 hover:bg-blue-700 text-white flex items-center gap-2",children:[e.jsx(_,{className:"h-4 w-4"}),A.isPending?"ìƒì„± ì¤‘...":"ë°œì£¼ì„œ ìƒì„±"]}),k&&e.jsxs(m,{onClick:re,disabled:$.isPending,className:"bg-green-600 hover:bg-green-700 text-white flex items-center gap-2",children:[e.jsx(L,{className:"h-4 w-4"}),"ìŠ¹ì¸"]}),a&&e.jsx(m,{variant:"outline",onClick:g,disabled:N||!a,className:`flex items-center gap-2 ${a?"":"opacity-50 cursor-not-allowed"}`,title:a?"PDF ë°œì£¼ì„œë¥¼ ìƒˆë¡œ ìƒì„±í•©ë‹ˆë‹¤":"ë°œì£¼ì™„ë£Œ ë˜ëŠ” ë‚©í’ˆì™„ë£Œ ìƒíƒœì—ì„œëŠ” PDFë¥¼ ì¬ìƒì„±í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤",children:N?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin h-4 w-4 border-2 border-gray-300 border-t-transparent rounded-full"}),"ìƒì„± ì¤‘..."]}):e.jsxs(e.Fragment,{children:[e.jsx(_,{className:"h-4 w-4"}),"PDF ë°œì£¼ì„œ ìƒì„±"]})}),i&&e.jsxs(m,{variant:"outline",onClick:()=>{y(s),P(!0)},className:"flex items-center gap-2",children:[e.jsx(be,{className:"h-4 w-4"}),"ì´ë©”ì¼ ë°œì†¡"]}),o&&e.jsxs(m,{variant:"outline",onClick:W,className:"flex items-center gap-2",children:[e.jsx(Ye,{className:"h-4 w-4"}),"ì´ë©”ì¼ ê¸°ë¡"]}),p&&e.jsxs(m,{onClick:ie,disabled:t.isPending,className:"bg-purple-600 hover:bg-purple-700 text-white flex items-center gap-2",children:[e.jsx(we,{className:"h-4 w-4"}),t.isPending?"ì²˜ë¦¬ ì¤‘...":"ë‚©í’ˆê²€ìˆ˜ì™„ë£Œ"]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-8",children:[e.jsx("div",{className:"bg-blue-50/30 rounded-xl shadow-sm p-6 border border-blue-200",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"ì´ ë°œì£¼ê¸ˆì•¡"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600 mt-2",children:U(s.totalAmount)})]}),e.jsx("div",{className:"bg-blue-100 p-3 rounded-lg",children:e.jsx(ge,{className:"h-6 w-6 text-blue-600"})})]})}),e.jsx("div",{className:"bg-blue-50/30 rounded-xl shadow-sm p-6 border border-blue-200",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"ë°œì£¼ í’ˆëª©"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900 mt-2",children:[s.items?.length||0,"ê°œ"]})]}),e.jsx("div",{className:"bg-purple-100 p-3 rounded-lg",children:e.jsx(ae,{className:"h-6 w-6 text-purple-600"})})]})}),e.jsx("div",{className:"bg-blue-50/30 rounded-xl shadow-sm p-6 border border-blue-200",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"ë‚©ê¸°ì¼"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900 mt-2",children:s.deliveryDate?S(new Date(s.deliveryDate),"MMì›” ddì¼"):"ë¯¸ì •"}),(()=>{const r=s.notes?.split(`
`).find(h=>h.startsWith("ë‚©í’ˆì²˜: "))?.replace("ë‚©í’ˆì²˜: ","").trim();return r?e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["ğŸ“ ",r]}):null})()]}),e.jsx("div",{className:"bg-orange-100 p-3 rounded-lg",children:e.jsx(ye,{className:"h-6 w-6 text-orange-600"})})]})}),e.jsx("div",{className:"bg-blue-50/30 rounded-xl shadow-sm p-6 border border-blue-200",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"ì‘ì„±ì"}),e.jsx("p",{className:"text-sm font-medium text-gray-900 mt-2",children:s.user?.firstName&&s.user?.lastName?`${s.user.lastName}${s.user.firstName}`:s.user?.email||"ì•Œ ìˆ˜ ì—†ìŒ"})]}),e.jsx("div",{className:"bg-green-100 p-3 rounded-lg",children:e.jsx(ce,{className:"h-6 w-6 text-green-600"})})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8",children:[e.jsx(K,{className:"shadow-sm bg-white border-blue-200",children:e.jsxs(T,{className:"p-6 bg-blue-50/20",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(_,{className:"h-5 w-5 text-gray-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"ë°œì£¼ì„œ ì •ë³´"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"ë°œì£¼ë²ˆí˜¸"}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:s.orderNumber})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"ë°œì£¼ì¼"}),e.jsx("p",{className:"text-sm text-gray-900",children:s.orderDate?S(new Date(s.orderDate),"yyyyë…„ MMì›” ddì¼"):"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"ë‚©ê¸°ì¼"}),e.jsx("p",{className:"text-sm text-gray-900",children:s.deliveryDate?S(new Date(s.deliveryDate),"yyyyë…„ MMì›” ddì¼"):"-"})]}),(()=>{const r=s.notes?.split(`
`).find(h=>h.startsWith("ë‚©í’ˆì²˜: "))?.replace("ë‚©í’ˆì²˜: ","").trim();return r?e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"ë‚©í’ˆì¥ì†Œ"}),e.jsx("p",{className:"text-sm text-gray-900",children:r})]}):null})(),s.templateId&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"ì‚¬ìš© í…œí”Œë¦¿"}),e.jsxs("p",{className:"text-sm text-gray-900",children:["Template ID: ",s.templateId]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"ì‘ì„±ì¼ì‹œ"}),e.jsx("p",{className:"text-sm text-gray-900",children:s.createdAt?S(new Date(s.createdAt),"yyyyë…„ MMì›” ddì¼ HH:mm"):"-"})]}),s.updatedAt&&s.updatedAt!==s.createdAt&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"ìµœì¢… ìˆ˜ì •ì¼ì‹œ"}),e.jsx("p",{className:"text-sm text-gray-900",children:S(new Date(s.updatedAt),"yyyyë…„ MMì›” ddì¼ HH:mm")})]})]}),s.notes&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-100",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"ë¹„ê³ "}),e.jsx("div",{className:"p-3 bg-gray-50 rounded-lg text-sm text-gray-700",children:s.notes})]})]})}),s.vendor&&e.jsx(K,{className:"shadow-sm bg-white border-blue-200",children:e.jsxs(T,{className:"p-6 bg-blue-50/20",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(De,{className:"h-5 w-5 text-gray-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"ê±°ë˜ì²˜ ì •ë³´"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"ì—…ì²´ëª…"}),e.jsx("button",{className:"text-sm font-medium text-blue-600 hover:text-blue-700",onClick:()=>s.vendor?.id&&u(`/vendors/${s.vendor.id}`),children:s.vendor.name})]}),s.vendor.contact&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"ë‹´ë‹¹ì"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ce,{className:"h-4 w-4 text-gray-400"}),e.jsx("p",{className:"text-sm text-gray-900",children:s.vendor.contact})]})]}),s.vendor.phone&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"ì „í™”ë²ˆí˜¸"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Xe,{className:"h-4 w-4 text-gray-400"}),e.jsx("p",{className:"text-sm text-gray-900",children:s.vendor.phone})]})]}),s.vendor.email&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"ì´ë©”ì¼"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(be,{className:"h-4 w-4 text-gray-400"}),e.jsx("p",{className:"text-sm text-gray-900",children:s.vendor.email})]})]}),s.vendor.address&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"ì£¼ì†Œ"}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(Se,{className:"h-4 w-4 text-gray-400 mt-0.5"}),e.jsx("p",{className:"text-sm text-gray-900",children:s.vendor.address})]})]})]})]})}),s.project&&e.jsx(K,{className:"shadow-sm bg-white border-blue-200",children:e.jsxs(T,{className:"p-6 bg-blue-50/20",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(De,{className:"h-5 w-5 text-gray-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"í˜„ì¥ ì •ë³´"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"í˜„ì¥ëª…"}),e.jsx("button",{className:"text-sm font-medium text-blue-600 hover:text-blue-700",onClick:()=>u(`/projects/${s.project.id}`),children:s.project.projectName}),e.jsxs("p",{className:"text-xs text-gray-500",children:["(",s.project.projectCode,")"]})]}),s.project.projectManager&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"ë‹´ë‹¹ì"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ce,{className:"h-4 w-4 text-gray-400"}),e.jsx("p",{className:"text-sm text-gray-900",children:s.project.projectManager})]})]}),s.project.location&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"ìœ„ì¹˜"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Se,{className:"h-4 w-4 text-gray-400"}),e.jsx("p",{className:"text-sm text-gray-900",children:s.project.location})]})]}),s.project.description&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"ì„¤ëª…"}),e.jsx("div",{className:"p-3 bg-gray-50 rounded-lg text-sm text-gray-700",children:s.project.description})]})]})]})})]}),(s.approvedBy||s.approvedAt||s.currentApproverRole)&&e.jsx(K,{className:"shadow-sm mb-8 bg-white border-blue-200",children:e.jsxs(T,{className:"p-6 bg-blue-50/20",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(we,{className:"h-5 w-5 text-gray-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"ìŠ¹ì¸ ì •ë³´"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[s.approvedBy&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"ìŠ¹ì¸ì"}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:s.approvedBy})]}),s.approvedAt&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"ìŠ¹ì¸ì¼ì‹œ"}),e.jsx("p",{className:"text-sm text-gray-900",children:S(new Date(s.approvedAt),"yyyyë…„ MMì›” ddì¼ HH:mm")})]}),s.currentApproverRole&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"í˜„ì¬ ìŠ¹ì¸ ë‹¨ê³„"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-900",children:s.currentApproverRole==="admin"?"ê´€ë¦¬ì":s.currentApproverRole==="executive"?"ì„ì›":s.currentApproverRole==="hq_management"?"ë³¸ë¶€ì¥":s.currentApproverRole==="project_manager"?"í”„ë¡œì íŠ¸ë§¤ë‹ˆì €":s.currentApproverRole}),s.approvalLevel&&e.jsxs("span",{className:"text-xs text-gray-500",children:["(Level ",s.approvalLevel,")"]})]})]})]})]})}),e.jsx(K,{className:"shadow-sm mb-8 bg-white border-blue-200",children:e.jsxs(T,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"h-5 w-5 text-gray-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"ë°œì£¼ í’ˆëª©"}),e.jsxs("span",{className:"text-sm text-gray-500",children:["ì´ ",s.items?.length||0,"ê°œ í’ˆëª©"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"ì´ ë°œì£¼ê¸ˆì•¡"}),e.jsx("p",{className:"text-lg font-bold text-blue-600",children:U(s.totalAmount)})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-blue-50 border-b border-blue-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"í’ˆëª©ëª…"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"ëŒ€ë¶„ë¥˜"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"ì¤‘ë¶„ë¥˜"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"ì†Œë¶„ë¥˜"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"ê·œê²©"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"ìˆ˜ëŸ‰"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"ë‹¨ìœ„"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"ë‹¨ê°€"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"ê¸ˆì•¡"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"ë¹„ê³ "})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:s.items?.map((r,h)=>e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-4 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm font-medium text-gray-900",children:r.itemName})}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-700",children:r.majorCategory||"-"})}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-700",children:r.middleCategory||"-"})}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-700",children:r.minorCategory||"-"})}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap text-sm text-gray-700",children:r.specification||"-"}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap text-center",children:e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800",children:typeof r.quantity=="number"?r.quantity.toLocaleString():r.quantity||"-"})}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap text-sm text-gray-700",children:r.unit||"EA"}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap text-right text-sm font-medium text-gray-900",children:U(r.unitPrice)}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap text-right",children:e.jsx("span",{className:"text-sm font-semibold text-blue-600",children:U(r.totalAmount)})}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap text-sm text-gray-700",children:r.notes||"-"})]},h))}),e.jsx("tfoot",{className:"bg-blue-50",children:e.jsxs("tr",{children:[e.jsx("td",{colSpan:8,className:"px-4 py-4 text-right text-sm font-medium text-gray-900",children:"ì´ ë°œì£¼ê¸ˆì•¡"}),e.jsx("td",{className:"px-4 py-4 text-right",children:e.jsx("span",{className:"text-lg font-bold text-blue-600",children:U(s.totalAmount)})}),e.jsx("td",{})]})})]})})]})}),e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-6 mb-8",children:[e.jsx("div",{children:e.jsx(ss,{orderId:l})}),s.items&&s.items.length>0&&e.jsx("div",{children:e.jsx(ts,{orderItems:s.items,orderId:l})})]}),s.attachments&&s.attachments.length>0&&e.jsx(We,{attachments:s.attachments,orderId:l}),s&&e.jsx(Je,{open:R,onOpenChange:r=>{P(r),r||y(null)},orderData:{orderNumber:s.orderNumber,vendorName:s.vendor?.name||s.vendorName||"",vendorEmail:s.vendor?.email,orderDate:s.orderDate?new Date(s.orderDate).toLocaleDateString():"",totalAmount:s.totalAmount,siteName:s.project?.projectName||s.projectName||"",orderId:s.id},attachments:s.attachments?.map(r=>({id:r.id,originalName:r.originalName,filePath:r.filePath,fileSize:r.fileSize,mimeType:r.mimeType,isSelected:!1})),onSendEmail:ne}),s&&e.jsx(_e,{orderId:s.id,orderNumber:s.orderNumber,isOpen:z,onClose:()=>C(!1)})]})})}export{Fs as default};
