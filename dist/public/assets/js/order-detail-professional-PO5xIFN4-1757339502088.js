import{n as he,e as je,g as we,r as C,q as X,s as P,j as e,w as I,L as le,N as de,F as W,x as M,B as m,O as v,y as A,S as qe,z as Se,A as Pe,D as Qe,G as ae,o as y,Q as z,X as re,k as b,R as L,U as Ce,P as Fe,T as ke,a as Ie,d as Me,u as Ae,V as Ke,H as Oe,W as Te,Y as $e,Z as Ee,_ as Re,$ as He,a0 as Le,a1 as ze,a2 as Be,M as ye,b as ge,f as J,a3 as ie,a4 as ve,K as d}from"./index-BHt0qwks-1757339502088.js";import{T as _}from"./textarea-D6OEVGQ--1757339502088.js";import{D as ce,f as Ve,a as oe,b as me,c as xe}from"./dialog-Ccv_HLN2-1757339502088.js";import{U as Ue}from"./upload-DVLXCFVv-1757339502088.js";import{C as ue}from"./calendar-CCtYCGxB-1757339502088.js";import{D as pe}from"./dollar-sign-Cw68e5jJ-1757339502088.js";import{f as q}from"./format-DNthd0aY-1757339502088.js";import{C as Ne}from"./checkbox-jB9u-5Lp-1757339502088.js";import{P as ee}from"./package-BjkBv3OQ-1757339502088.js";import{T as Ge}from"./triangle-alert-Cak0OEN1-1757339502088.js";import{E as Je}from"./email-send-dialog-DOzInu6t-1757339502088.js";import{E as _e}from"./email-history-modal-SGySuzzy-1757339502088.js";import{A as We}from"./attached-files-info-BOV8lF-V-1757339502088.js";import{O as Ze}from"./order-status-history-BweGYtbc-1757339502088.js";import{S as Ye}from"./square-pen-C9nAC1Ev-1757339502088.js";import{M as Xe}from"./mail-check-C04yRxm2-1757339502088.js";import{P as es}from"./phone-CMAfI98P-1757339502088.js";import{M as fe}from"./map-pin-HJMxJvac-1757339502088.js";import{H as ss}from"./history-BMOz0vy5-1757339502088.js";import"./index-Bqg5ZJRK-1757339502088.js";import"./paperclip-jgiG0bQj-1757339502088.js";import"./send-c2KtboCf-1757339502088.js";import"./refresh-cw-DVZYynIf-1757339502088.js";import"./alert-dialog-MGvzlw11-1757339502088.js";import"./download-CoQkwo9B-1757339502088.js";import"./activity-DGQ3i4Ja-1757339502088.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ts=he("Pen",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=he("ReceiptText",[["path",{d:"M4 2v20l2-1 2 1 2-1 2 1 2-1 2 1 2-1 2 1V2l-2 1-2-1-2 1-2-1-2 1-2-1-2 1Z",key:"q3az6g"}],["path",{d:"M14 8H8",key:"1l3xfs"}],["path",{d:"M16 12H8",key:"1fr5h0"}],["path",{d:"M13 16H8",key:"wsln4y"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const be=he("Receipt",[["path",{d:"M4 2v20l2-1 2 1 2-1 2 1 2-1 2 1 2-1 2 1V2l-2 1-2-1-2 1-2-1-2 1-2-1-2 1Z",key:"q3az6g"}],["path",{d:"M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8",key:"1h4pet"}],["path",{d:"M12 17.5v-11",key:"1jc1ny"}]]);function as({orderId:c}){const{toast:l}=je(),u=we(),[w,E]=C.useState(!1),[Q,D]=C.useState(null),{data:h=[],isLoading:B}=X({queryKey:["/api/invoices",c],queryFn:async()=>await(await b("GET",`/api/invoices?orderId=${c}`)).json()}),{data:F=[]}=X({queryKey:["/api/verification-logs",c],queryFn:async()=>await(await b("GET",`/api/verification-logs?orderId=${c}`)).json()}),N=P({mutationFn:async t=>{const g=await fetch("/api/invoices",{method:"POST",body:t});if(!g.ok)throw new Error("Failed to upload invoice");return g.json()},onSuccess:()=>{u.invalidateQueries({queryKey:["/api/invoices",c]}),u.invalidateQueries({queryKey:["/api/verification-logs",c]}),E(!1),D(null),l({title:"성공",description:"청구서가 업로드되었습니다."})},onError:()=>{l({title:"오류",description:"청구서 업로드에 실패했습니다.",variant:"destructive"})}}),K=P({mutationFn:async t=>await(await b("POST",`/api/invoices/${t}/verify`)).json(),onSuccess:()=>{u.invalidateQueries({queryKey:["/api/invoices",c]}),u.invalidateQueries({queryKey:["/api/verification-logs",c]}),l({title:"성공",description:"청구서가 검증되었습니다."})},onError:()=>{l({title:"오류",description:"청구서 검증에 실패했습니다.",variant:"destructive"})}}),n=P({mutationFn:async t=>await(await b("POST",`/api/invoices/${t}/issue-tax`)).json(),onSuccess:()=>{u.invalidateQueries({queryKey:["/api/invoices",c]}),l({title:"성공",description:"세금계산서가 발행되었습니다."})},onError:()=>{l({title:"오류",description:"세금계산서 발행에 실패했습니다.",variant:"destructive"})}}),s=P({mutationFn:async t=>await(await b("POST",`/api/invoices/${t}/cancel-tax`)).json(),onSuccess:()=>{u.invalidateQueries({queryKey:["/api/invoices",c]}),l({title:"성공",description:"세금계산서 발행이 취소되었습니다."})},onError:()=>{l({title:"오류",description:"세금계산서 발행 취소에 실패했습니다.",variant:"destructive"})}}),R=t=>{t.preventDefault();const g=new FormData(t.currentTarget);g.set("orderId",c.toString()),Q&&g.set("file",Q),N.mutate(g)},O=t=>{switch(t){case"pending":return e.jsx(y,{variant:"secondary",children:"검토중"});case"verified":return e.jsx(y,{variant:"default",children:"검증완료"});case"paid":return e.jsx(y,{variant:"outline",children:"지급완료"});default:return e.jsx(y,{variant:"secondary",children:t})}},T=t=>{switch(t){case"invoice":return e.jsx(y,{variant:"outline",children:"청구서"});case"tax_invoice":return e.jsx(y,{variant:"outline",children:"세금계산서"});case"other":return e.jsx(y,{variant:"outline",children:"기타"});default:return e.jsx(y,{variant:"outline",children:t})}};return B?e.jsxs(I,{children:[e.jsx(le,{children:e.jsxs(de,{className:"flex items-center gap-2",children:[e.jsx(W,{className:"h-5 w-5"}),"청구서 관리"]})}),e.jsx(M,{children:e.jsx("div",{className:"text-center py-4",children:"로딩 중..."})})]}):e.jsxs(I,{children:[e.jsx(le,{className:"pb-2",children:e.jsxs(de,{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[e.jsx(W,{className:"h-4 w-4"}),"청구서 관리"]}),e.jsxs(ce,{open:w,onOpenChange:E,children:[e.jsx(Ve,{asChild:!0,children:e.jsxs(m,{size:"sm",children:[e.jsx(Ue,{className:"h-3 w-3 mr-1"}),e.jsx("span",{className:"text-xs",children:"청구서 업로드"})]})}),e.jsxs(oe,{children:[e.jsx(me,{children:e.jsx(xe,{children:"청구서 업로드"})}),e.jsxs("form",{onSubmit:R,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"invoiceNumber",children:"청구서 번호"}),e.jsx(A,{id:"invoiceNumber",name:"invoiceNumber",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"invoiceType",children:"유형"}),e.jsxs(qe,{name:"invoiceType",defaultValue:"invoice",children:[e.jsx(Se,{children:e.jsx(Pe,{})}),e.jsxs(Qe,{children:[e.jsx(ae,{value:"invoice",children:"청구서"}),e.jsx(ae,{value:"tax_invoice",children:"세금계산서"}),e.jsx(ae,{value:"other",children:"기타"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"issueDate",children:"발행일"}),e.jsx(A,{id:"issueDate",name:"issueDate",type:"date",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"dueDate",children:"마감일"}),e.jsx(A,{id:"dueDate",name:"dueDate",type:"date"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"totalAmount",children:"총금액"}),e.jsx(A,{id:"totalAmount",name:"totalAmount",type:"number",step:"0.01",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"vatAmount",children:"부가세"}),e.jsx(A,{id:"vatAmount",name:"vatAmount",type:"number",step:"0.01",defaultValue:"0"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"file",children:"첨부파일"}),e.jsx(A,{id:"file",type:"file",accept:".pdf,.jpg,.jpeg,.png",onChange:t=>D(t.target.files?.[0]||null)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"notes",children:"메모"}),e.jsx(_,{id:"notes",name:"notes",rows:3})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(m,{type:"button",variant:"outline",onClick:()=>E(!1),children:"취소"}),e.jsx(m,{type:"submit",disabled:N.isPending,children:N.isPending?"업로드 중...":"업로드"})]})]})]})]})]})}),e.jsxs(M,{className:"p-3",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"border-2 border-blue-200 rounded-lg p-3 bg-blue-50 dark:bg-blue-900/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ne,{className:"h-4 w-4 text-blue-600"}),e.jsx("span",{className:"text-sm font-semibold text-blue-800 dark:text-blue-200",children:"세금계산서 발행 관리"}),h.length===0?e.jsx(y,{variant:"outline",className:"text-xs border-blue-300 text-blue-700",children:"청구서 업로드 필요"}):h.some(t=>t.taxInvoiceIssued)?e.jsxs(y,{variant:"default",className:"text-xs bg-green-600",children:[e.jsx(be,{className:"h-2 w-2 mr-1"}),"발행완료"]}):e.jsx(y,{variant:"secondary",className:"text-xs",children:"미발행"})]}),e.jsx("div",{className:"text-xs text-blue-600 dark:text-blue-300",children:h.length===0?"청구서를 먼저 업로드하고 검증해주세요":h.some(t=>t.status==="verified")?"발행 준비 완료":"청구서 검증 필요"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-xs text-gray-600",children:h.length===0?"세금계산서 발행 관리를 위해서는 청구서를 업로드해주세요.":h.some(t=>t.taxInvoiceIssued)?"세금계산서가 발행되었습니다.":"세금계산서 발행이 가능합니다."}),e.jsx("div",{className:"flex gap-2",children:h.length>0&&h.some(t=>t.status==="verified")?e.jsx(e.Fragment,{children:h.some(t=>t.taxInvoiceIssued)?e.jsxs(m,{size:"sm",variant:"destructive",onClick:()=>{const t=h.find(g=>g.taxInvoiceIssued);t&&s.mutate(t.id)},disabled:s.isPending,children:[e.jsx(re,{className:"h-3 w-3 mr-1"}),e.jsx("span",{className:"text-xs",children:"미확인"})]}):e.jsxs(m,{size:"sm",variant:"default",onClick:()=>{const t=h.find(g=>g.status==="verified"&&!g.taxInvoiceIssued);t&&n.mutate(t.id)},disabled:n.isPending,children:[e.jsx(z,{className:"h-3 w-3 mr-1"}),e.jsx("span",{className:"text-xs",children:"확인"})]})}):e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(m,{size:"sm",variant:"outline",disabled:!0,children:[e.jsx(z,{className:"h-3 w-3 mr-1"}),e.jsx("span",{className:"text-xs",children:"확인"})]}),e.jsxs(m,{size:"sm",variant:"outline",disabled:!0,children:[e.jsx(re,{className:"h-3 w-3 mr-1"}),e.jsx("span",{className:"text-xs",children:"미확인"})]})]})})]})]}),h.length===0?e.jsx("div",{className:"text-center py-4 text-muted-foreground text-xs",children:"아직 업로드된 청구서가 없습니다."}):e.jsx("div",{className:"space-y-2",children:h.map(t=>e.jsxs("div",{className:"border rounded-lg p-2 space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("h4",{className:"font-medium text-xs",children:t.invoiceNumber}),T(t.invoiceType),O(t.status)]}),t.status==="pending"&&e.jsxs(m,{size:"sm",onClick:()=>K.mutate(t.id),disabled:K.isPending,children:[e.jsx(z,{className:"h-3 w-3 mr-1"}),e.jsx("span",{className:"text-xs",children:"검증"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2 text-xs text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ue,{className:"h-3 w-3 text-muted-foreground"}),e.jsxs("span",{children:["발행일: ",q(new Date(t.issueDate),"yyyy-MM-dd",{locale:L})]})]}),t.dueDate&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ue,{className:"h-3 w-3 text-muted-foreground"}),e.jsxs("span",{children:["마감일: ",q(new Date(t.dueDate),"yyyy-MM-dd",{locale:L})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(pe,{className:"h-3 w-3 text-muted-foreground"}),e.jsxs("span",{children:["총액: ₩",Math.round(t.totalAmount||0).toLocaleString("ko-KR")]})]}),t.vatAmount>0&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(pe,{className:"h-3 w-3 text-muted-foreground"}),e.jsxs("span",{children:["부가세: ₩",Math.round(t.vatAmount||0).toLocaleString("ko-KR")]})]})]}),t.notes&&e.jsx("div",{className:"text-xs text-muted-foreground bg-muted p-2 rounded",children:t.notes}),e.jsxs("div",{className:"border-t pt-2 space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ne,{className:"h-3 w-3 text-muted-foreground"}),e.jsx("span",{className:"text-xs font-medium",children:"세금계산서"}),t.taxInvoiceIssued?e.jsxs(y,{variant:"default",className:"text-xs",children:[e.jsx(be,{className:"h-2 w-2 mr-1"}),"발행완료"]}):e.jsx(y,{variant:"secondary",className:"text-xs",children:"미발행"})]}),e.jsxs("div",{className:"flex gap-1",children:[t.status==="verified"&&e.jsx(e.Fragment,{children:t.taxInvoiceIssued?e.jsxs(m,{size:"sm",variant:"destructive",onClick:()=>s.mutate(t.id),disabled:s.isPending,children:[e.jsx(re,{className:"h-3 w-3 mr-1"}),e.jsx("span",{className:"text-xs",children:s.isPending?"취소 중...":"발행 취소"})]}):e.jsxs(m,{size:"sm",variant:"outline",onClick:()=>n.mutate(t.id),disabled:n.isPending,children:[e.jsx(ne,{className:"h-3 w-3 mr-1"}),e.jsx("span",{className:"text-xs",children:n.isPending?"처리 중...":"발행 확인"})]})}),t.status!=="verified"&&e.jsx("div",{className:"text-xs text-muted-foreground",children:"청구서 검증 후 발행 가능"})]})]}),t.status==="verified"&&t.taxInvoiceIssued&&t.taxInvoiceIssuedDate&&e.jsxs("div",{className:"text-xs text-muted-foreground bg-green-50 dark:bg-green-900/20 p-2 rounded",children:["발행일: ",q(new Date(t.taxInvoiceIssuedDate),"yyyy-MM-dd HH:mm",{locale:L}),t.taxInvoiceIssuedBy&&` | 발행자: ${t.taxInvoiceIssuedBy}`]})]}),t.verifiedBy&&t.verifiedAt&&e.jsxs("div",{className:"text-xs text-muted-foreground border-t pt-1",children:["검증자: ",t.verifiedBy," | 검증일: ",q(new Date(t.verifiedAt),"yyyy-MM-dd HH:mm",{locale:L})]})]},t.id))})]}),F.length>0&&e.jsxs("div",{className:"mt-3",children:[e.jsx("h4",{className:"font-medium mb-2 text-xs",children:"검증 로그"}),e.jsx("div",{className:"space-y-1 max-h-32 overflow-y-auto",children:F.map(t=>e.jsxs("div",{className:"text-xs p-2 bg-muted rounded",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("span",{children:t.details}),e.jsx("span",{className:"text-xs text-muted-foreground",children:q(new Date(t.createdAt),"MM-dd HH:mm",{locale:L})})]}),e.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:t.performedBy})]},t.id))})]})]})]})}function rs({orderItems:c,orderId:l}){const{toast:u}=je(),w=we(),[E,Q]=C.useState(!1),[D,h]=C.useState(null),[B,F]=C.useState(!1),[N,K]=C.useState(null),[,n]=C.useState(0),s=Ce(["/api/item-receipts",l],{queryFn:async()=>{const r=await b("GET","/api/item-receipts"),i=c.map(x=>x.id);return r.filter(x=>i.includes(x.orderItemId))},cacheType:"DYNAMIC",enabled:c.length>0}),R=P({mutationFn:async r=>{console.log("Sending receipt data to API:",r);try{const i=await b("POST","/api/item-receipts",r);return console.log("API response:",i),i}catch(i){throw console.error("API request failed:",i),i}},onSuccess:async r=>{console.log("💥 Receipt creation successful, forcing refetch:",r),w.resetQueries({queryKey:["/api/item-receipts",l]}),w.invalidateQueries({queryKey:["/api/item-receipts"]}),await s.refetch(),n(i=>i+1),w.invalidateQueries({queryKey:["/api/verification-logs",l]}),Q(!1),h(null),u({title:"성공",description:"수령 확인이 등록되었습니다."})},onError:r=>{console.error("Receipt creation mutation error:",r);const i=r?.message||"수령 확인 등록에 실패했습니다.";u({title:"오류",description:i,variant:"destructive"})}}),O=P({mutationFn:async r=>{const{id:i,...o}=r;return await(await b("PATCH",`/api/item-receipts/${i}`,o)).json()},onSuccess:async r=>{console.log("💥 Receipt update successful:",r),w.resetQueries({queryKey:["/api/item-receipts",l]}),w.invalidateQueries({queryKey:["/api/item-receipts"]}),await s.refetch(),n(i=>i+1),w.invalidateQueries({queryKey:["/api/verification-logs",l]}),F(!1),K(null),u({title:"수령 정보 수정 완료",description:"수령 정보가 성공적으로 수정되었습니다."})},onError:r=>{u({title:"수정 실패",description:r.message||"수령 정보 수정 중 오류가 발생했습니다.",variant:"destructive"})}}),T=P({mutationFn:async r=>await b("DELETE",`/api/item-receipts/${r}`),onSuccess:async()=>{console.log("💥 Receipt deletion successful"),w.resetQueries({queryKey:["/api/item-receipts",l]}),w.invalidateQueries({queryKey:["/api/item-receipts"]}),await s.refetch(),n(r=>r+1),w.invalidateQueries({queryKey:["/api/verification-logs",l]}),u({title:"수령 정보 삭제 완료",description:"수령 정보가 성공적으로 삭제되었습니다."})},onError:r=>{u({title:"삭제 실패",description:r.message||"수령 정보 삭제 중 오류가 발생했습니다.",variant:"destructive"})}}),t=P({mutationFn:async r=>{const i=r.map(o=>b("POST","/api/item-receipts",o));return await Promise.all(i)},onSuccess:()=>{w.invalidateQueries({queryKey:["/api/item-receipts"]}),w.invalidateQueries({queryKey:["/api/verification-logs",l]}),u({title:"성공",description:"일괄 수령 등록이 완료되었습니다."})},onError:()=>{u({title:"오류",description:"일괄 수령 등록에 실패했습니다.",variant:"destructive"})}}),g=r=>{r.preventDefault();const i=new FormData(r.currentTarget),o={orderItemId:D.id,receivedQuantity:parseFloat(i.get("receivedQuantity")),receivedDate:i.get("receivedDate"),qualityCheck:i.get("qualityCheck")==="on",qualityNotes:i.get("qualityNotes")||"",status:"approved",notes:i.get("notes")||""};console.log("Submitting receipt data:",o),R.mutate(o)},se=r=>{if(r.preventDefault(),!N){u({title:"오류",description:"선택된 수령 정보가 없습니다.",variant:"destructive"});return}const i=new FormData(r.currentTarget),o={id:N.id,receivedQuantity:parseFloat(i.get("receivedQuantity")),receivedDate:i.get("receivedDate"),qualityCheck:i.get("qualityCheck")==="on",qualityNotes:i.get("qualityNotes")||"",status:N.status||"approved",notes:i.get("notes")||""};console.log("Submitting updated receipt data:",o),O.mutate(o)},te=()=>{const r=new Date().toISOString().split("T")[0],i=c.filter(x=>H(x.id)<x.quantity);if(i.length===0){u({title:"알림",description:"모든 항목이 이미 수령 완료되었습니다."});return}const o=i.map(x=>({orderItemId:x.id,receivedQuantity:x.quantity-H(x.id),receivedDate:r,qualityCheck:!0,status:"approved",notes:"일괄 수령 등록"}));t.mutate(o)},Z=r=>{if(s.status==="error")return console.log(`❌ Query in error state for item ${r}, triggering fresh fetch`),s.refetch(),[];const i=s.data||[];console.log(`🔍 Looking for receipts for item ${r}`),console.log(`🔍 Current query data length: ${i.length}`),console.log(`🔍 Query status: ${s.status}, isFetching: ${s.isFetching}`);const o=i.filter(x=>x.orderItemId===r);return console.log(`📋 Found ${o.length} receipts for item ${r}:`,o),o},H=r=>{const o=Z(r).reduce((x,k)=>{const p=typeof k.receivedQuantity=="string"?parseFloat(k.receivedQuantity):k.receivedQuantity;return x+(p||0)},0);return console.log(`💯 Total received for item ${r}: ${o}`),o},S=r=>{const x=(s.data||[]).filter(p=>p.orderItemId===r.id).reduce((p,V)=>{const a=typeof V.receivedQuantity=="string"?parseFloat(V.receivedQuantity):V.receivedQuantity;return p+(a||0)},0),k=r.quantity;return x===0?{status:"pending",label:"미수령",icon:Ie,color:"secondary"}:x<k?{status:"partial",label:"부분수령",icon:Ge,color:"warning"}:{status:"complete",label:"수령완료",icon:z,color:"default"}},$=r=>{switch(r){case"pending":return e.jsx(y,{variant:"secondary",children:"대기중"});case"approved":return e.jsx(y,{variant:"default",children:"승인됨"});case"rejected":return e.jsx(y,{variant:"destructive",children:"반려됨"});default:return e.jsx(y,{variant:"secondary",children:r})}};return e.jsxs(I,{children:[e.jsx(le,{className:"pb-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(de,{className:"flex items-center gap-1 text-sm",children:[e.jsx(ee,{className:"h-4 w-4"}),"자재 수령 확인"]}),e.jsxs(m,{onClick:te,disabled:t.isPending,className:"bg-blue-600 hover:bg-blue-700",size:"sm",children:[e.jsx(ee,{className:"h-3 w-3 mr-1"}),e.jsx("span",{className:"text-xs",children:"일괄 수령 등록"})]})]})}),e.jsxs(M,{className:"p-3",children:[e.jsx("div",{className:"space-y-2",children:c.map(r=>{const i=Z(r.id),o=H(r.id),x=S(r),k=x.icon;return e.jsxs("div",{className:"border rounded-lg p-2 space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-1 mb-1",children:[e.jsx("h4",{className:"font-medium text-xs",children:r.itemName}),e.jsxs(y,{variant:x.color,className:"flex items-center gap-1 text-xs",children:[e.jsx(k,{className:"h-3 w-3"}),x.label]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2 text-xs text-muted-foreground",children:[e.jsxs("div",{children:["발주수량: ",r.quantity.toLocaleString(),r.unit]}),e.jsxs("div",{children:["수령수량: ",o.toLocaleString(),r.unit]}),e.jsxs("div",{children:["미수령: ",(r.quantity-o).toLocaleString(),r.unit]}),e.jsxs("div",{children:["단가: ₩",Math.round(r.unitPrice||0).toLocaleString("ko-KR")]})]}),r.notes&&e.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:r.notes})]}),e.jsxs(m,{size:"sm",onClick:()=>{h(r),Q(!0)},disabled:o>=r.quantity,children:[e.jsx(Fe,{className:"h-3 w-3 mr-1"}),e.jsx("span",{className:"text-xs",children:"수령등록"})]})]}),i.length>0&&e.jsxs("div",{className:"mt-2",children:[e.jsx("h5",{className:"text-xs font-medium mb-1",children:"수령 이력"}),e.jsx("div",{className:"space-y-1",children:i.map(p=>e.jsx("div",{className:"bg-muted p-2 rounded text-xs",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs("span",{className:"font-medium text-xs",children:[(typeof p.receivedQuantity=="string"?parseFloat(p.receivedQuantity):p.receivedQuantity).toLocaleString(),r.unit," 수령"]}),$(p.status),p.qualityCheck&&e.jsxs(y,{variant:"outline",className:"text-xs",children:[e.jsx(z,{className:"h-2 w-2 mr-1"}),"품질검사"]})]}),e.jsxs("div",{className:"text-muted-foreground text-xs",children:["수령일: ",q(new Date(p.receivedDate),"yyyy-MM-dd",{locale:L})]}),p.qualityNotes&&e.jsxs("div",{className:"text-muted-foreground text-xs",children:["품질메모: ",p.qualityNotes]}),p.notes&&e.jsxs("div",{className:"text-muted-foreground text-xs",children:["메모: ",p.notes]})]}),e.jsxs("div",{className:"flex flex-col items-end gap-1",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(m,{size:"sm",variant:"ghost",onClick:()=>{K(p),F(!0)},className:"h-6 w-6 p-0 hover:bg-blue-50",children:e.jsx(ts,{className:"h-3 w-3 text-blue-600"})}),e.jsx(m,{size:"sm",variant:"ghost",onClick:()=>{confirm("이 수령 기록을 삭제하시겠습니까?")&&T.mutate(p.id)},className:"h-6 w-6 p-0 hover:bg-red-50",disabled:T.isPending,children:e.jsx(ke,{className:"h-3 w-3 text-red-600"})})]}),e.jsxs("div",{className:"text-xs text-muted-foreground text-right",children:[e.jsxs("div",{children:["등록자: ",p.verifiedBy]}),e.jsx("div",{children:q(new Date(p.createdAt),"MM-dd HH:mm",{locale:L})})]})]})]})},p.id))})]})]},r.id)})}),e.jsx(ce,{open:E,onOpenChange:Q,children:e.jsxs(oe,{children:[e.jsx(me,{children:e.jsx(xe,{children:"자재 수령 등록"})}),D&&e.jsxs("form",{onSubmit:g,className:"space-y-4",children:[e.jsxs("div",{className:"bg-muted p-3 rounded",children:[e.jsx("div",{className:"font-medium",children:D.itemName}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["발주수량: ",D.quantity.toLocaleString(),D.unit," | 수령가능: ",(D.quantity-H(D.id)).toLocaleString(),D.unit]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"receivedQuantity",children:"수령 수량"}),e.jsx(A,{id:"receivedQuantity",name:"receivedQuantity",type:"number",step:"0.01",max:D.quantity-H(D.id),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"receivedDate",children:"수령 일자"}),e.jsx(A,{id:"receivedDate",name:"receivedDate",type:"date",defaultValue:new Date().toISOString().split("T")[0],required:!0})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ne,{id:"qualityCheck",name:"qualityCheck"}),e.jsx(v,{htmlFor:"qualityCheck",className:"text-sm",children:"품질 검사 완료"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"qualityNotes",children:"품질 검사 메모"}),e.jsx(_,{id:"qualityNotes",name:"qualityNotes",rows:2,placeholder:"품질 검사 결과나 특이사항을 입력하세요"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"notes",children:"추가 메모"}),e.jsx(_,{id:"notes",name:"notes",rows:2,placeholder:"기타 메모사항을 입력하세요"})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(m,{type:"button",variant:"outline",onClick:()=>Q(!1),children:"취소"}),e.jsx(m,{type:"submit",disabled:R.isPending,children:R.isPending?"등록 중...":"등록"})]})]})]})}),e.jsx(ce,{open:B,onOpenChange:F,children:e.jsxs(oe,{children:[e.jsx(me,{children:e.jsx(xe,{children:"수령 정보 수정"})}),N&&e.jsxs("form",{onSubmit:se,className:"space-y-4",children:[e.jsx("div",{className:"bg-muted p-3 rounded",children:e.jsxs("div",{className:"text-sm text-muted-foreground",children:["수령 기록 ID: ",N.id]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"edit-receivedQuantity",children:"수령 수량"}),e.jsx(A,{id:"edit-receivedQuantity",name:"receivedQuantity",type:"number",step:"0.01",defaultValue:N.receivedQuantity,required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"edit-receivedDate",children:"수령 일자"}),e.jsx(A,{id:"edit-receivedDate",name:"receivedDate",type:"date",defaultValue:new Date(N.receivedDate).toISOString().split("T")[0],required:!0})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ne,{id:"edit-qualityCheck",name:"qualityCheck",defaultChecked:N.qualityCheck}),e.jsx(v,{htmlFor:"edit-qualityCheck",className:"text-sm",children:"품질 검사 완료"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"edit-qualityNotes",children:"품질 검사 메모"}),e.jsx(_,{id:"edit-qualityNotes",name:"qualityNotes",rows:2,defaultValue:N.qualityNotes,placeholder:"품질 검사 결과나 특이사항을 입력하세요"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"edit-notes",children:"추가 메모"}),e.jsx(_,{id:"edit-notes",name:"notes",rows:2,defaultValue:N.notes,placeholder:"기타 메모사항을 입력하세요"})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(m,{type:"button",variant:"outline",onClick:()=>F(!1),children:"취소"}),e.jsx(m,{type:"submit",disabled:O.isPending,children:O.isPending?"수정 중...":"수정 완료"})]})]})]})})]})]})}function Is(){const{user:c}=Me(),{toast:l}=je(),[,u]=Ae(),w=Ke(),[E,Q]=C.useState(!1),[D,h]=C.useState(null),[B,F]=C.useState(!1),[N,K]=C.useState(!1),n=parseInt(w.id),{data:s,isLoading:R}=X({queryKey:[`/api/orders/${n}`],queryFn:async()=>{console.log("📘 OrderDetailProfessional - Fetching order:",n);const a=await b("GET",`/api/orders/${n}`);return console.log("📘 OrderDetailProfessional - Order data received:",a),console.log("📘 OrderDetailProfessional - Attachments:",a?.attachments),a}});X({queryKey:["/api/order-statuses"]});const O=P({mutationFn:async()=>{await b("POST",`/api/orders/${n}/approve`)},onSuccess:()=>{l({title:"발주서 승인",description:"발주서가 성공적으로 승인되었습니다."}),d.invalidateQueries({queryKey:["/api/orders"]}),d.invalidateQueries({queryKey:[`/api/orders/${n}`]}),d.invalidateQueries({queryKey:["orders-optimized"]}),d.invalidateQueries({queryKey:["orders-metadata"]}),d.invalidateQueries({queryKey:["/api/dashboard"]}),d.refetchQueries({queryKey:["orders-optimized"],type:"active",exact:!1})},onError:a=>{l({title:"승인 실패",description:a.message,variant:"destructive"})}});P({mutationFn:async()=>{await b("POST",`/api/orders/${n}/send`)},onSuccess:()=>{l({title:"발주서 발송",description:"발주서가 성공적으로 발송되었습니다."}),d.invalidateQueries({queryKey:["/api/orders"]}),d.invalidateQueries({queryKey:[`/api/orders/${n}`]}),d.invalidateQueries({queryKey:["orders-optimized"]}),d.invalidateQueries({queryKey:["orders-metadata"]}),d.invalidateQueries({queryKey:["/api/dashboard"]}),d.refetchQueries({queryKey:["orders-optimized"],type:"active",exact:!1})},onError:a=>{l({title:"발송 실패",description:a.message,variant:"destructive"})}});const T=P({mutationFn:async()=>await b("POST",`/api/orders/${n}/create-order`),onSuccess:a=>{l({title:"발주서 생성 완료",description:"발주서가 성공적으로 생성되었습니다. PDF가 첨부되었습니다."}),d.invalidateQueries({queryKey:["/api/orders"]}),d.invalidateQueries({queryKey:[`/api/orders/${n}`]})},onError:a=>{l({title:"발주서 생성 실패",description:a.message||"발주서 생성 중 오류가 발생했습니다.",variant:"destructive"})}}),t=P({mutationFn:async()=>await b("POST",`/api/orders/${n}/complete-delivery`),onMutate:async()=>{await d.cancelQueries({queryKey:[`/api/orders/${n}`]});const a=d.getQueryData([`/api/orders/${n}`]);return d.setQueryData([`/api/orders/${n}`],j=>({...j,status:"completed",orderStatus:"delivered"})),{previousOrder:a}},onSuccess:a=>{l({title:"납품검수완료",description:"발주서가 납품완료 상태로 변경되었습니다."}),d.invalidateQueries({queryKey:["/api/orders"]}),d.invalidateQueries({queryKey:[`/api/orders/${n}`]}),d.invalidateQueries({queryKey:["/api/dashboard/unified"]}),d.invalidateQueries({queryKey:["orders-optimized"]}),d.invalidateQueries({queryKey:["orders-metadata"]}),d.invalidateQueries({queryKey:["/api/dashboard"]}),d.refetchQueries({queryKey:["orders-optimized"],type:"active",exact:!1})},onError:(a,j,U)=>{d.setQueryData([`/api/orders/${n}`],U?.previousOrder),l({title:"납품검수완료 실패",description:a.message||"납품검수완료 처리 중 오류가 발생했습니다.",variant:"destructive"})},onSettled:()=>{d.invalidateQueries({queryKey:[`/api/orders/${n}`]})}}),g=async()=>{K(!0),l({title:"PDF 생성 시작",description:"발주서 데이터를 준비하고 있습니다..."});try{setTimeout(()=>{l({title:"PDF 생성 중",description:"ProfessionalPDFGenerationService를 사용하여 PDF를 생성하고 있습니다..."})},1e3);const a=await b("POST",`/api/orders/${n}/regenerate-pdf`);if(a.success)l({title:"데이터베이스 저장 완료",description:"생성된 PDF가 첨부파일로 저장되었습니다."}),await d.invalidateQueries({queryKey:[`/api/orders/${n}`]}),setTimeout(()=>{l({title:"✅ PDF 발주서 생성 완료",description:"PDF 발주서가 성공적으로 생성되었습니다. 하단 첨부파일에서 확인하세요.",duration:5e3})},500);else throw new Error(a.message||"PDF 생성 실패")}catch(a){l({title:"❌ PDF 생성 실패",description:a.message||"PDF 생성 중 오류가 발생했습니다.",variant:"destructive"})}finally{K(!1)}},se=()=>{confirm("이 발주서를 승인하시겠습니까?")&&O.mutate()},te=()=>{confirm(`납품검수를 완료하시겠습니까?

• 발주서 상태가 '납품완료'로 변경됩니다
• 이 작업은 되돌릴 수 없습니다
• 납품이 완전히 검수되었을 때만 진행하세요`)&&t.mutate()},Z=async a=>{if(s)try{const j=[],U=a.customFiles||[];if(a.selectedAttachmentIds&&a.selectedAttachmentIds.length>0){console.log("📎 선택된 첨부파일 ID:",a.selectedAttachmentIds);for(const f of a.selectedAttachmentIds)f>0&&j.push(f)}const G=[];for(const f of j){const Y=`/api/attachments/${f}/download`;G.push(Y),console.log("📎 서버 첨부파일 URL 생성:",Y)}if(U.length>0){console.log("📎 사용자 업로드 파일 포함:",U.length,"개");const f=new FormData;if(f.append("orderData",JSON.stringify({orderId:s.id,orderNumber:s.orderNumber,vendorName:s.vendor?.name||s.vendorName||"",orderDate:s.orderDate,totalAmount:s.totalAmount,siteName:s.project?.projectName||s.projectName||"",attachmentUrls:G})),f.append("to",JSON.stringify(a.to)),a.cc&&f.append("cc",JSON.stringify(a.cc)),f.append("subject",a.subject),a.message&&f.append("message",a.message),f.append("selectedAttachmentIds",JSON.stringify(j)),f.append("orderId",s.id.toString()),U.forEach((De,is)=>{f.append("customFiles",De)}),(await fetch("/api/orders/send-email",{method:"POST",body:f})).ok)l({title:"이메일 발송 완료",description:"발주서가 성공적으로 전송되었습니다."}),d.invalidateQueries({queryKey:["order",Number(n)]}),sendEmailMutation.mutate();else throw new Error("Failed to send email")}else{const f={orderId:s.id,orderNumber:s.orderNumber,vendorName:s.vendor?.name||s.vendorName||"",orderDate:s.orderDate,totalAmount:s.totalAmount,siteName:s.project?.projectName||s.projectName||"",attachmentUrls:G};if(console.log("📧 이메일 발송 데이터 (JSON):",{orderData:f,emailData:a,selectedAttachmentIds:j,attachmentUrls:G,hasAttachments:s.attachments?.length||0}),(await fetch("/api/orders/send-email",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({orderData:f,...a,orderId:s.id,attachmentUrls:G,selectedAttachmentIds:j})})).ok)l({title:"이메일 발송 완료",description:`${s.vendor?.name||s.vendorName}에게 발주서 ${s.orderNumber}를 전송했습니다.`}),Q(!1),h(null),d.invalidateQueries({queryKey:["/api/orders"]}),d.invalidateQueries({queryKey:[`/api/orders/${n}`]}),d.invalidateQueries({queryKey:["orders-optimized"]}),d.invalidateQueries({queryKey:["orders-metadata"]}),d.invalidateQueries({queryKey:["/api/dashboard"]}),d.refetchQueries({queryKey:[`/api/orders/${n}`],type:"active"});else throw new Error("이메일 발송 실패")}}catch(j){l({title:"이메일 발송 실패",description:j instanceof Error?j.message:"이메일 발송 중 오류가 발생했습니다.",variant:"destructive"})}},H=()=>{F(!0)};if(R)return e.jsx("div",{className:"min-h-screen bg-gray-50",children:e.jsx("div",{className:"max-w-[1366px] mx-auto p-6",children:e.jsxs("div",{className:"animate-pulse space-y-6",children:[e.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/3"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/2"}),e.jsx("div",{className:"grid grid-cols-4 gap-4",children:[...Array(4)].map((a,j)=>e.jsx("div",{className:"h-24 bg-gray-200 rounded-xl"},j))}),e.jsx("div",{className:"h-64 bg-gray-200 rounded-xl"})]})})});if(!s)return e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsx(I,{className:"max-w-md shadow-sm",children:e.jsxs(M,{className:"p-8 text-center",children:[e.jsx(Oe,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h1",{className:"text-lg font-semibold text-gray-900 mb-2",children:"발주서를 찾을 수 없습니다"}),e.jsx("p",{className:"text-sm text-gray-600 mb-6",children:"요청하신 발주서가 존재하지 않거나 접근 권한이 없습니다."}),e.jsx(m,{onClick:()=>u("/orders"),className:"bg-blue-600 hover:bg-blue-700",children:"발주서 목록으로 돌아가기"})]})})});const S=s.orderStatus||s.status,$=s.approvalStatus,r=S==="draft"&&(c?.role==="admin"||s.userId===c?.id),i=S==="draft"||S==="created",o=Te(S,$)&&(c?.role==="admin"||s.userId===c?.id),x=$e(S)&&(c?.role==="admin"||s.userId===c?.id),k=Ee(S,$)&&(c?.role==="admin"||s.userId===c?.id),p=Re($,c?.role),V=He(S,$)&&(c?.role==="admin"||s.userId===c?.id);return e.jsx("div",{className:"min-h-screen bg-gray-50",children:e.jsxs("div",{className:"max-w-[1366px] mx-auto p-6",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("button",{onClick:()=>u("/orders"),className:"inline-flex items-center text-sm text-gray-600 hover:text-gray-900 mb-4",children:[e.jsx(Le,{className:"h-4 w-4 mr-1"}),"발주서 목록으로"]}),e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:s.orderNumber}),e.jsxs("div",{className:"flex items-center gap-4 mt-2",children:[e.jsx("span",{className:`inline-flex items-center px-3 py-1 rounded-full text-xs font-medium border ${ze(S,$)}`,children:Be(S,$)}),S==="draft"&&e.jsx("span",{className:"text-xs text-amber-600 bg-amber-50 px-2 py-1 rounded",children:"⚠️ 임시저장 상태 - 발주서 생성 필요"}),e.jsxs("p",{className:"text-sm text-gray-500",children:[s.vendor?.name," • ",s.orderDate?q(new Date(s.orderDate),"yyyy년 MM월 dd일"):"날짜 미정"]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[k&&e.jsxs(m,{variant:"outline",onClick:()=>u(`/orders/${n}/edit`),className:"flex items-center gap-2",children:[e.jsx(Ye,{className:"h-4 w-4"}),"수정"]}),r&&e.jsxs(m,{onClick:()=>{confirm(`발주서를 생성하시겠습니까?

• PDF 파일이 자동으로 생성됩니다
• 상태가 '생성됨'으로 변경됩니다
• 생성 후 PDF 보기 및 이메일 발송이 가능합니다`)&&T.mutate()},disabled:T.isPending,className:"bg-blue-600 hover:bg-blue-700 text-white flex items-center gap-2",children:[e.jsx(W,{className:"h-4 w-4"}),T.isPending?"생성 중...":"발주서 생성"]}),p&&e.jsxs(m,{onClick:se,disabled:O.isPending,className:"bg-green-600 hover:bg-green-700 text-white flex items-center gap-2",children:[e.jsx(z,{className:"h-4 w-4"}),"승인"]}),i&&e.jsx(m,{variant:"outline",onClick:g,disabled:N||!i,className:`flex items-center gap-2 ${i?"":"opacity-50 cursor-not-allowed"}`,title:i?"PDF 발주서를 새로 생성합니다":"발주완료 또는 납품완료 상태에서는 PDF를 재생성할 수 없습니다",children:N?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin h-4 w-4 border-2 border-gray-300 border-t-transparent rounded-full"}),"생성 중..."]}):e.jsxs(e.Fragment,{children:[e.jsx(W,{className:"h-4 w-4"}),"PDF 발주서 생성"]})}),o&&e.jsxs(m,{variant:"outline",onClick:()=>{h(s),Q(!0)},className:"flex items-center gap-2",children:[e.jsx(ye,{className:"h-4 w-4"}),"이메일 발송"]}),x&&e.jsxs(m,{variant:"outline",onClick:H,className:"flex items-center gap-2",children:[e.jsx(Xe,{className:"h-4 w-4"}),"이메일 기록"]}),V&&e.jsxs(m,{onClick:te,disabled:t.isPending,className:"bg-purple-600 hover:bg-purple-700 text-white flex items-center gap-2",children:[e.jsx(ge,{className:"h-4 w-4"}),t.isPending?"처리 중...":"납품검수완료"]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-8",children:[e.jsx("div",{className:"bg-blue-50/30 rounded-xl shadow-sm p-6 border border-blue-200",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"총 발주금액"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600 mt-2",children:J(s.totalAmount)})]}),e.jsx("div",{className:"bg-blue-100 p-3 rounded-lg",children:e.jsx(pe,{className:"h-6 w-6 text-blue-600"})})]})}),e.jsx("div",{className:"bg-blue-50/30 rounded-xl shadow-sm p-6 border border-blue-200",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"발주 품목"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900 mt-2",children:[s.items?.length||0,"개"]})]}),e.jsx("div",{className:"bg-purple-100 p-3 rounded-lg",children:e.jsx(ee,{className:"h-6 w-6 text-purple-600"})})]})}),e.jsx("div",{className:"bg-blue-50/30 rounded-xl shadow-sm p-6 border border-blue-200",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"납기일"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900 mt-2",children:s.deliveryDate?q(new Date(s.deliveryDate),"MM월 dd일"):"미정"}),(()=>{const a=s.notes?.split(`
`).find(j=>j.startsWith("납품처: "))?.replace("납품처: ","").trim();return a?e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["📍 ",a]}):null})()]}),e.jsx("div",{className:"bg-orange-100 p-3 rounded-lg",children:e.jsx(ue,{className:"h-6 w-6 text-orange-600"})})]})}),e.jsx("div",{className:"bg-blue-50/30 rounded-xl shadow-sm p-6 border border-blue-200",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"작성자"}),e.jsx("p",{className:"text-sm font-medium text-gray-900 mt-2",children:s.user?.firstName&&s.user?.lastName?`${s.user.lastName}${s.user.firstName}`:s.user?.email||"알 수 없음"})]}),e.jsx("div",{className:"bg-green-100 p-3 rounded-lg",children:e.jsx(ie,{className:"h-6 w-6 text-green-600"})})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8",children:[e.jsx(I,{className:"shadow-sm bg-white border-blue-200",children:e.jsxs(M,{className:"p-6 bg-blue-50/20",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(W,{className:"h-5 w-5 text-gray-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"발주서 정보"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"발주번호"}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:s.orderNumber})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"발주일"}),e.jsx("p",{className:"text-sm text-gray-900",children:s.orderDate?q(new Date(s.orderDate),"yyyy년 MM월 dd일"):"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"납기일"}),e.jsx("p",{className:"text-sm text-gray-900",children:s.deliveryDate?q(new Date(s.deliveryDate),"yyyy년 MM월 dd일"):"-"})]}),(()=>{const a=s.notes?.split(`
`).find(j=>j.startsWith("납품처: "))?.replace("납품처: ","").trim();return a?e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"납품장소"}),e.jsx("p",{className:"text-sm text-gray-900",children:a})]}):null})(),s.templateId&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"사용 템플릿"}),e.jsxs("p",{className:"text-sm text-gray-900",children:["Template ID: ",s.templateId]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"작성일시"}),e.jsx("p",{className:"text-sm text-gray-900",children:s.createdAt?q(new Date(s.createdAt),"yyyy년 MM월 dd일 HH:mm"):"-"})]}),s.updatedAt&&s.updatedAt!==s.createdAt&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"최종 수정일시"}),e.jsx("p",{className:"text-sm text-gray-900",children:q(new Date(s.updatedAt),"yyyy년 MM월 dd일 HH:mm")})]})]}),s.notes&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-100",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"비고"}),e.jsx("div",{className:"p-3 bg-gray-50 rounded-lg text-sm text-gray-700",children:s.notes})]})]})}),s.vendor&&e.jsx(I,{className:"shadow-sm bg-white border-blue-200",children:e.jsxs(M,{className:"p-6 bg-blue-50/20",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(ve,{className:"h-5 w-5 text-gray-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"거래처 정보"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"업체명"}),e.jsx("button",{className:"text-sm font-medium text-blue-600 hover:text-blue-700",onClick:()=>s.vendor?.id&&u(`/vendors/${s.vendor.id}`),children:s.vendor.name})]}),s.vendor.contact&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"담당자"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ie,{className:"h-4 w-4 text-gray-400"}),e.jsx("p",{className:"text-sm text-gray-900",children:s.vendor.contact})]})]}),s.vendor.phone&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"전화번호"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(es,{className:"h-4 w-4 text-gray-400"}),e.jsx("p",{className:"text-sm text-gray-900",children:s.vendor.phone})]})]}),s.vendor.email&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"이메일"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ye,{className:"h-4 w-4 text-gray-400"}),e.jsx("p",{className:"text-sm text-gray-900",children:s.vendor.email})]})]}),s.vendor.address&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"주소"}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(fe,{className:"h-4 w-4 text-gray-400 mt-0.5"}),e.jsx("p",{className:"text-sm text-gray-900",children:s.vendor.address})]})]})]})]})}),s.project&&e.jsx(I,{className:"shadow-sm bg-white border-blue-200",children:e.jsxs(M,{className:"p-6 bg-blue-50/20",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(ve,{className:"h-5 w-5 text-gray-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"현장 정보"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"현장명"}),e.jsx("button",{className:"text-sm font-medium text-blue-600 hover:text-blue-700",onClick:()=>u(`/projects/${s.project.id}`),children:s.project.projectName}),e.jsxs("p",{className:"text-xs text-gray-500",children:["(",s.project.projectCode,")"]})]}),s.project.projectManager&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"담당자"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ie,{className:"h-4 w-4 text-gray-400"}),e.jsx("p",{className:"text-sm text-gray-900",children:s.project.projectManager})]})]}),s.project.location&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"위치"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(fe,{className:"h-4 w-4 text-gray-400"}),e.jsx("p",{className:"text-sm text-gray-900",children:s.project.location})]})]}),s.project.description&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"설명"}),e.jsx("div",{className:"p-3 bg-gray-50 rounded-lg text-sm text-gray-700",children:s.project.description})]})]})]})})]}),(s.approvedBy||s.approvedAt||s.currentApproverRole)&&e.jsx(I,{className:"shadow-sm mb-8 bg-white border-blue-200",children:e.jsxs(M,{className:"p-6 bg-blue-50/20",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(ge,{className:"h-5 w-5 text-gray-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"승인 정보"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[s.approvedBy&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"승인자"}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:s.approvedBy})]}),s.approvedAt&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"승인일시"}),e.jsx("p",{className:"text-sm text-gray-900",children:q(new Date(s.approvedAt),"yyyy년 MM월 dd일 HH:mm")})]}),s.currentApproverRole&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"현재 승인 단계"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-900",children:s.currentApproverRole==="admin"?"관리자":s.currentApproverRole==="executive"?"임원":s.currentApproverRole==="hq_management"?"본부장":s.currentApproverRole==="project_manager"?"프로젝트매니저":s.currentApproverRole}),s.approvalLevel&&e.jsxs("span",{className:"text-xs text-gray-500",children:["(Level ",s.approvalLevel,")"]})]})]})]})]})}),e.jsx(I,{className:"shadow-sm mb-8 bg-white border-blue-200",children:e.jsxs(M,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ee,{className:"h-5 w-5 text-gray-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"발주 품목"}),e.jsxs("span",{className:"text-sm text-gray-500",children:["총 ",s.items?.length||0,"개 품목"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"총 발주금액"}),e.jsx("p",{className:"text-lg font-bold text-blue-600",children:J(s.totalAmount)})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-blue-50 border-b border-blue-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"품목명"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"대분류"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"중분류"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"소분류"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"규격"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"수량"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"단위"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"단가"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"금액"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"비고"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:s.items?.map((a,j)=>e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-4 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm font-medium text-gray-900",children:a.itemName})}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-700",children:a.majorCategory||"-"})}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-700",children:a.middleCategory||"-"})}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-700",children:a.minorCategory||"-"})}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap text-sm text-gray-700",children:a.specification||"-"}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap text-center",children:e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800",children:typeof a.quantity=="number"?a.quantity.toLocaleString():a.quantity||"-"})}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap text-sm text-gray-700",children:a.unit||"EA"}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap text-right text-sm font-medium text-gray-900",children:J(a.unitPrice)}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap text-right",children:e.jsx("span",{className:"text-sm font-semibold text-blue-600",children:J(a.totalAmount)})}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap text-sm text-gray-700",children:a.notes||"-"})]},j))}),e.jsx("tfoot",{className:"bg-blue-50",children:e.jsxs("tr",{children:[e.jsx("td",{colSpan:8,className:"px-4 py-4 text-right text-sm font-medium text-gray-900",children:"총 발주금액"}),e.jsx("td",{className:"px-4 py-4 text-right",children:e.jsx("span",{className:"text-lg font-bold text-blue-600",children:J(s.totalAmount)})}),e.jsx("td",{})]})})]})})]})}),e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-6 mb-8",children:[e.jsx("div",{children:e.jsx(as,{orderId:n})}),s.items&&s.items.length>0&&e.jsx("div",{children:e.jsx(rs,{orderItems:s.items,orderId:n})})]}),e.jsx(I,{className:"shadow-lg border-0 bg-gradient-to-r from-blue-50 to-indigo-50",children:e.jsxs(M,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(ss,{className:"h-5 w-5 text-blue-600"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"상태 변경 이력"})]}),e.jsx(Ze,{orderId:s.id})]})}),s.attachments&&s.attachments.length>0&&e.jsx(We,{attachments:s.attachments,orderId:n}),s&&e.jsx(Je,{open:E,onOpenChange:a=>{Q(a),a||h(null)},orderData:{orderNumber:s.orderNumber,vendorName:s.vendor?.name||s.vendorName||"",vendorEmail:s.vendor?.email,orderDate:s.orderDate?new Date(s.orderDate).toLocaleDateString():"",totalAmount:s.totalAmount,siteName:s.project?.projectName||s.projectName||"",orderId:s.id},attachments:s.attachments?.map(a=>({id:a.id,originalName:a.originalName,filePath:a.filePath,fileSize:a.fileSize,mimeType:a.mimeType,isSelected:!1})),onSendEmail:Z}),s&&e.jsx(_e,{orderId:s.id,orderNumber:s.orderNumber,isOpen:B,onClose:()=>F(!1)})]})})}export{Is as default};
