import{r as y,j as e,M as C,Q as V,V as $,N as k,B as d,at as D,s as P,i as _,X as c,P as q,I as N}from"./index-CdUdiWMQ.js";import{D as H,a as T,b as L,c as O,e as Q}from"./dialog-BfTL30te.js";import{S as U}from"./separator-BjyGt_Jb.js";import{C as M}from"./circle-check-DxEQZlvg.js";function W({isOpen:A,onClose:p,validationData:x,onConfirm:E}){const[g,z]=y.useState(new Map),[S,h]=y.useState(new Map),[m,f]=y.useState("vendors"),j=x.vendorValidations.filter(s=>!s.exists),v=x.deliveryValidations.filter(s=>!s.exists),b=x.emailConflicts.filter(s=>s.type==="conflict"),w=(s,i,n,t)=>{const r=`${i}-${s}`,a={originalName:s,type:i,action:n,existingVendorId:t};z(l=>new Map(l.set(r,a)))},u=(s,i,n)=>{const t=`${i}-${s}`;h(a=>new Map(a.set(t,n)));const r={originalName:s,type:i,action:"create_new",newVendorData:n};z(a=>new Map(a.set(t,r)))},B=()=>{const s=Array.from(g.values());E(s),p()},I=()=>{const s=j.length+v.length;return g.size>=s},F=(s,i)=>{const n=`${i}-${s.vendorName}`,t=g.get(n),r=S.get(n)||{name:s.vendorName,email:"",contactPerson:"",phone:""};return e.jsxs(C,{className:"mb-4",children:[e.jsx(V,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx($,{className:"text-lg",children:s.vendorName}),e.jsxs(D,{children:[e.jsx(P,{variant:"outline",children:i}),e.jsx("span",{className:"ml-2",children:"등록되지 않은 업체"})]})]}),e.jsx(_,{className:"h-5 w-5 text-amber-500"})]})}),e.jsxs(k,{children:[s.suggestions.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsxs(c,{className:"text-sm font-medium",children:["유사한 업체 (",s.suggestions.length,"개)"]}),e.jsx("div",{className:"mt-2 space-y-2",children:s.suggestions.map(a=>e.jsx("div",{className:`p-3 border rounded-lg cursor-pointer transition-colors ${t?.action==="use_existing"&&t?.existingVendorId===a.id?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,onClick:()=>w(s.vendorName,i,"use_existing",a.id),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:a.name}),e.jsx("div",{className:"text-sm text-gray-600",children:a.email}),e.jsxs("div",{className:"text-sm text-gray-500",children:["담당자: ",a.contactPerson]})]}),e.jsxs(P,{variant:"secondary",children:[(a.similarity*100).toFixed(0),"% 유사"]})]})},a.id))})]}),e.jsx(U,{className:"my-4"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(d,{variant:t?.action==="create_new"?"default":"outline",size:"sm",onClick:()=>w(s.vendorName,i,"create_new"),children:[e.jsx(q,{className:"h-4 w-4 mr-2"}),"신규 등록"]}),e.jsx(d,{variant:t?.action==="skip"?"default":"outline",size:"sm",onClick:()=>w(s.vendorName,i,"skip"),children:"건너뛰기"})]}),t?.action==="create_new"&&e.jsxs("div",{className:"border rounded-lg p-4 bg-gray-50",children:[e.jsx(c,{className:"text-sm font-medium mb-3 block",children:"신규 업체 정보"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx(c,{htmlFor:`name-${n}`,children:"업체명"}),e.jsx(N,{id:`name-${n}`,value:r.name,onChange:a=>{const l={...r,name:a.target.value};h(o=>new Map(o.set(n,l))),u(s.vendorName,i,l)}})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:`email-${n}`,children:"이메일 *"}),e.jsx(N,{id:`email-${n}`,type:"email",value:r.email,onChange:a=>{const l={...r,email:a.target.value};h(o=>new Map(o.set(n,l))),u(s.vendorName,i,l)},required:!0})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:`contact-${n}`,children:"담당자명 *"}),e.jsx(N,{id:`contact-${n}`,value:r.contactPerson,onChange:a=>{const l={...r,contactPerson:a.target.value};h(o=>new Map(o.set(n,l))),u(s.vendorName,i,l)},required:!0})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:`phone-${n}`,children:"연락처"}),e.jsx(N,{id:`phone-${n}`,value:r.phone,onChange:a=>{const l={...r,phone:a.target.value};h(o=>new Map(o.set(n,l))),u(s.vendorName,i,l)}})]})]})]})]})]})]},n)},R=s=>e.jsxs(C,{className:"mb-4",children:[e.jsx(V,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx($,{className:"text-lg",children:s.vendorName}),e.jsx(D,{children:"이메일 주소 불일치"})]}),e.jsx(_,{className:"h-5 w-5 text-red-500"})]})}),e.jsx(k,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx(c,{className:"text-sm font-medium",children:"엑셀 파일의 이메일"}),e.jsx("div",{className:"p-2 bg-blue-50 rounded border",children:s.excelEmail})]}),e.jsxs("div",{children:[e.jsx(c,{className:"text-sm font-medium",children:"데이터베이스의 이메일"}),e.jsx("div",{className:"p-2 bg-gray-50 rounded border",children:s.dbEmail})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(d,{variant:"outline",size:"sm",children:"엑셀 이메일 사용"}),e.jsx(d,{variant:"outline",size:"sm",children:"DB 이메일 사용"})]})]})})]},`conflict-${s.vendorName}`);return e.jsx(H,{open:A,onOpenChange:p,children:e.jsxs(T,{className:"max-w-4xl max-h-[80vh] overflow-y-auto",children:[e.jsx(L,{children:e.jsx(O,{children:"거래처/납품처 검증 결과"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs(C,{children:[e.jsx(V,{children:e.jsx($,{className:"text-lg",children:"검증 요약"})}),e.jsx(k,{children:e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-amber-600",children:x.summary.unregisteredVendors}),e.jsx("div",{className:"text-sm text-gray-600",children:"미등록 거래처"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-amber-600",children:x.summary.unregisteredDeliveries}),e.jsx("div",{className:"text-sm text-gray-600",children:"미등록 납품처"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:x.summary.emailConflicts}),e.jsx("div",{className:"text-sm text-gray-600",children:"이메일 충돌"})]})]})})]}),e.jsxs("div",{className:"flex space-x-1 bg-gray-100 p-1 rounded-lg",children:[e.jsxs(d,{variant:m==="vendors"?"default":"ghost",size:"sm",onClick:()=>f("vendors"),className:"flex-1",children:["미등록 거래처 (",j.length,")"]}),e.jsxs(d,{variant:m==="deliveries"?"default":"ghost",size:"sm",onClick:()=>f("deliveries"),className:"flex-1",children:["미등록 납품처 (",v.length,")"]}),e.jsxs(d,{variant:m==="conflicts"?"default":"ghost",size:"sm",onClick:()=>f("conflicts"),className:"flex-1",children:["이메일 충돌 (",b.length,")"]})]}),e.jsxs("div",{className:"min-h-[400px]",children:[m==="vendors"&&e.jsx("div",{children:j.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(M,{className:"h-12 w-12 mx-auto mb-3 text-green-500"}),"모든 거래처가 등록되어 있습니다."]}):j.map(s=>F(s,"거래처"))}),m==="deliveries"&&e.jsx("div",{children:v.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(M,{className:"h-12 w-12 mx-auto mb-3 text-green-500"}),"모든 납품처가 등록되어 있습니다."]}):v.map(s=>F(s,"납품처"))}),m==="conflicts"&&e.jsx("div",{children:b.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(M,{className:"h-12 w-12 mx-auto mb-3 text-green-500"}),"이메일 충돌이 없습니다."]}):b.map(s=>R(s))})]})]}),e.jsxs(Q,{children:[e.jsx(d,{variant:"outline",onClick:p,children:"취소"}),e.jsxs(d,{onClick:B,disabled:!I(),children:["확인 (",g.size,"/",j.length+v.length,")"]})]})]})})}export{W as V};
