import{q,h as le,u as W,r as v,j as e,t as ge,v as ue,F as R,H as I,al as B,f as w,o as p,bM as J,bd as z,a as A,aZ as Y,l as E,B as L,E as je,M as ye,T as pe,J as Z,c as ie,b as K,w as M,L as ee,N as se,af as te,m as H,x as ae,a9 as _,C as ce,aa as Ne,ai as fe,R as be,d as ve,e as we,g as $e,i as Ce,bN as re}from"./index-m7lAeqJO-1757300793671.js";import{b as oe}from"./orderStatusUtils-CB7kqbpQ-1757300793671.js";import{C as Se}from"./chevrons-up-down-bFsxeQBb-1757300793671.js";import{U as de}from"./users-S6RjriU1-1757300793671.js";import{S as ke}from"./square-pen-QwE0JyI4-1757300793671.js";import{D as Ae}from"./download-B78DDyTv-1757300793671.js";import{T as Oe}from"./truck-Ahn7k6ml-1757300793671.js";import{M as Te}from"./mail-check-QiRkSuNG-1757300793671.js";import{D as Le}from"./dashboard-skeleton-D8Feti5u-1757300793671.js";import{P as ne}from"./progress-DX71A2Mz-1757300793671.js";import{T as G}from"./trending-up-BvwYRad1-1757300793671.js";import{C as De}from"./calendar-DQGC2zZt-1757300793671.js";import{D as xe}from"./dollar-sign-DqxnvlQm-1757300793671.js";import{A as me}from"./activity-CXS5SjNA-1757300793671.js";import{AdvancedPieChart as Fe}from"./advanced-chart-w_-aVR6z-1757300793671.js";import{useRealTimeData as Pe}from"./dashboard-widgets-BcQCbmOO-1757300793671.js";import{P as X}from"./package-DMw2Nn8P-1757300793671.js";import{R as Re,B as Be,C as Ue,X as qe,Y as Ee,T as ze,a as Ke}from"./PieChart-CU1vKhYu-1757300793671.js";import"./AreaChart-C4wzgLpI-1757300793671.js";import"./refresh-cw-5U8Qa5bh-1757300793671.js";import"./index-D2sOakRS-1757300793671.js";function We(t={}){const o=new URLSearchParams;return Object.entries(t).forEach(([r,n])=>{n!=null&&n!==""&&o.append(r,String(n))}),o}function he(t={}){const{filters:o={},...r}=t;return q({queryKey:["unified-orders",o],queryFn:async()=>{const n=We(o);console.log("🔍 Unified Orders API request:",`/api/orders-optimized?${n.toString()}`);const d=await fetch(`/api/orders-optimized?${n}`,{credentials:"include"});if(!d.ok)throw new Error("Failed to fetch orders");const s=await d.json();return console.log("✅ Unified Orders received:",s.orders?.length,"orders"),s},staleTime:r.staleTime??1e3,gcTime:r.gcTime??6e4,refetchOnWindowFocus:!0,refetchOnMount:!0,enabled:r.enabled??!0,refetchInterval:r.refetchInterval,...r})}function Ie(t=10){return he({filters:{limit:t,sortBy:"createdAt",sortOrder:"desc"},staleTime:3e4,gcTime:3e5})}function Qe(t){return he({filters:t,staleTime:1e3,gcTime:6e4})}function Ve(t,o){switch(o||t){case"draft":return e.jsx(Z,{className:"h-3 w-3"});case"pending":return e.jsx(A,{className:"h-3 w-3"});case"approved":case"created":return e.jsx(K,{className:"h-3 w-3"});case"sent":return e.jsx(Te,{className:"h-3 w-3"});case"delivered":return e.jsx(Oe,{className:"h-3 w-3"});case"completed":return e.jsx(K,{className:"h-3 w-3"});case"rejected":return e.jsx(ie,{className:"h-3 w-3"});case"urgent":return e.jsx(I,{className:"h-3 w-3"});default:return e.jsx(Z,{className:"h-3 w-3"})}}function _e({order:t,onOrderClick:o,isDarkMode:r}){const n=v.useMemo(()=>oe(t),[t]);return e.jsxs("div",{className:`flex items-center justify-between p-1 rounded cursor-pointer transition-colors ${r?"hover:bg-gray-700":"hover:bg-gray-50"}`,children:[e.jsxs("div",{className:"min-w-0 flex-1",onClick:()=>o?.(t.id),children:[e.jsx("div",{className:`text-xs font-medium truncate transition-colors ${r?"text-gray-100":"text-gray-900"}`,children:t.orderNumber}),e.jsx("div",{className:`text-xs transition-colors ${r?"text-gray-400":"text-gray-500"}`,children:t.vendor?.name||t.vendorName})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"text-right",children:e.jsx("div",{className:`text-xs font-semibold transition-colors ${r?"text-blue-400":"text-blue-600"}`,children:w(t.totalAmount||0).replace("₩","").replace(",000,000","M")})}),n&&e.jsx("button",{onClick:d=>{d.stopPropagation(),window.open(`/api/orders/${t.id}/download-pdf`,"_blank")},className:`p-1 rounded transition-colors ${r?"text-orange-400 hover:bg-orange-900/20 hover:text-orange-300":"text-orange-500 hover:bg-orange-50 hover:text-orange-700"}`,title:"PDF 다운로드",children:e.jsx(R,{className:"h-3 w-3"})})]})]})}function Xe({order:t,onOrderClick:o,isDarkMode:r,sortBy:n,sortOrder:d,onSort:s,showActions:h=!0}){const g=v.useMemo(()=>oe(t),[t]);return e.jsxs("tr",{className:`hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors ${r?"border-gray-700":"border-gray-200"}`,children:[e.jsx("td",{className:"px-3 py-2",children:e.jsx("button",{onClick:()=>o?.(t.id),className:`text-xs font-medium transition-colors ${r?"text-blue-400 hover:text-blue-300":"text-blue-600 hover:text-blue-700"}`,children:t.orderNumber})}),e.jsx("td",{className:`px-3 py-2 text-xs ${r?"text-gray-300":"text-gray-700"}`,children:e.jsx("div",{className:"truncate max-w-[120px]",title:t.vendor?.name||t.vendorName,children:t.vendor?.name||t.vendorName||"-"})}),e.jsx("td",{className:`px-3 py-2 text-xs font-medium text-right ${r?"text-gray-100":"text-gray-900"}`,children:w(t.totalAmount||0).replace("₩","").replace(",000,000","M")}),e.jsx("td",{className:"px-3 py-2",children:e.jsx(p,{variant:"secondary",className:B("text-xs px-2 py-0",J(t.orderStatus||t.status)),children:z(t.orderStatus||t.status)})}),h&&e.jsx("td",{className:"px-3 py-2 text-center",children:g&&e.jsx("button",{onClick:x=>{x.stopPropagation(),window.open(`/api/orders/${t.id}/download-pdf`,"_blank")},className:`p-1 rounded transition-colors ${r?"text-orange-400 hover:bg-orange-900/20 hover:text-orange-300":"text-orange-500 hover:bg-orange-50 hover:text-orange-700"}`,title:"PDF 다운로드",children:e.jsx(R,{className:"h-3 w-3"})})})]})}function Ye({order:t,onOrderClick:o,isDarkMode:r}){return e.jsxs("div",{className:B("group flex items-center justify-between p-3 rounded-lg","hover:bg-gray-50 transition-all duration-200","cursor-pointer hover:shadow-sm",r&&"hover:bg-gray-800"),onClick:()=>o?.(t.id),children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("p",{className:`text-sm font-medium group-hover:text-primary-600 transition-colors ${r?"text-gray-100":"text-gray-900"}`,children:t.orderNumber}),e.jsx(p,{variant:"secondary",className:B("text-xs px-2 py-0",J(t.orderStatus||t.status)),children:z(t.orderStatus||t.status)})]}),e.jsxs("div",{className:`flex items-center gap-3 text-xs ${r?"text-gray-400":"text-gray-500"}`,children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(A,{className:"h-3 w-3"}),e.jsx("span",{children:Y(t.createdAt||t.orderDate)})]}),(t.vendor?.name||t.vendorName)&&e.jsx("span",{className:"truncate",children:t.vendor?.name||t.vendorName})]})]}),e.jsx("div",{className:"text-right ml-4",children:e.jsx("p",{className:`text-sm font-semibold ${r?"text-gray-100":"text-gray-900"}`,children:w(t.totalAmount)})})]})}function He({order:t,onOrderClick:o,onStatusChange:r,onDeleteOrder:n,isDarkMode:d,showActions:s=!0}){const[,h]=W(),g=(x,u)=>{x.stopPropagation(),u()};return e.jsxs("div",{className:`p-4 border rounded-lg transition-colors ${d?"border-gray-700 hover:bg-gray-800":"border-gray-200 hover:bg-gray-50"}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`p-2 rounded-full ${d?"bg-blue-900/30":"bg-blue-100"}`,children:Ve(t.status,t.orderStatus)}),e.jsxs("div",{children:[e.jsx("h3",{className:`font-semibold cursor-pointer transition-colors ${d?"text-gray-100 hover:text-blue-400":"text-gray-900 hover:text-blue-600"}`,onClick:()=>o?.(t.id),children:t.orderNumber}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(p,{variant:"secondary",className:B("text-xs px-2 py-0",J(t.orderStatus||t.status)),children:z(t.orderStatus||t.status)}),t.approvalStatus&&e.jsx(p,{variant:"outline",className:"text-xs px-2 py-0",children:z(t.approvalStatus)})]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:`text-lg font-bold ${d?"text-gray-100":"text-gray-900"}`,children:w(t.totalAmount)}),e.jsx("div",{className:`text-xs ${d?"text-gray-400":"text-gray-500"}`,children:Y(t.createdAt||t.orderDate)})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(E,{className:`h-4 w-4 ${d?"text-gray-400":"text-gray-500"}`}),e.jsx("span",{className:`text-sm ${d?"text-gray-300":"text-gray-700"}`,children:t.project?.projectName||t.projectName||"프로젝트 없음"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(de,{className:`h-4 w-4 ${d?"text-gray-400":"text-gray-500"}`}),e.jsx("span",{className:`text-sm ${d?"text-gray-300":"text-gray-700"}`,children:t.vendor?.name||t.vendorName||"거래처 없음"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(A,{className:`h-4 w-4 ${d?"text-gray-400":"text-gray-500"}`}),e.jsx("span",{className:`text-sm ${d?"text-gray-300":"text-gray-700"}`,children:t.deliveryDate?Y(t.deliveryDate):"배송일 미정"})]})]}),s&&e.jsxs("div",{className:"flex items-center gap-2 pt-3 border-t border-gray-200 dark:border-gray-700",children:[e.jsxs(L,{variant:"outline",size:"sm",onClick:x=>g(x,()=>h(`/orders/${t.id}`)),children:[e.jsx(je,{className:"h-4 w-4 mr-1"}),"상세보기"]}),e.jsxs(L,{variant:"outline",size:"sm",onClick:x=>g(x,()=>h(`/orders/${t.id}/edit`)),children:[e.jsx(ke,{className:"h-4 w-4 mr-1"}),"수정"]}),t.vendor?.email&&e.jsxs(L,{variant:"outline",size:"sm",onClick:x=>g(x,()=>{}),children:[e.jsx(ye,{className:"h-4 w-4 mr-1"}),"이메일"]}),t.filePath&&e.jsxs(L,{variant:"outline",size:"sm",onClick:x=>g(x,()=>window.open(`/api/orders/${t.id}/download-pdf`,"_blank")),children:[e.jsx(Ae,{className:"h-4 w-4 mr-1"}),"PDF"]}),e.jsxs(L,{variant:"destructive",size:"sm",onClick:x=>g(x,()=>n?.(t.id)),children:[e.jsx(pe,{className:"h-4 w-4 mr-1"}),"삭제"]})]})]})}function Ge({mode:t="detailed",maxItems:o,showActions:r=!0,showPagination:n=!1,filters:d,orders:s,onOrderClick:h,onStatusChange:g,onDeleteOrder:x,compact:u=!1,className:D="",enableSelection:C=!1,selectedOrders:a=[],onSelectionChange:O,sortBy:F,sortOrder:$,onSort:N}){const{theme:T}=le(),c=T==="dark",[,P]=W(),S=!s,Q=Ie(o||10),k=Qe(d||{}),l=t==="compact"?Q:k,{data:i,isLoading:f,error:V}=S?l:{data:null,isLoading:!1,error:null},b=v.useMemo(()=>{if(s)return o?s.slice(0,o):s;const m=i?.orders||[];return o?m.slice(0,o):m},[s,i?.orders,o]),j=m=>{h?h(m):P(`/orders/${m}`)},y=v.useCallback(m=>F!==m?e.jsx(Se,{className:"h-3 w-3 opacity-50"}):$==="asc"?e.jsx(ge,{className:"h-3 w-3"}):e.jsx(ue,{className:"h-3 w-3"}),[F,$]);if(S&&f)return e.jsxs("div",{className:`flex flex-col items-center justify-center py-8 ${c?"text-gray-400":"text-gray-500"}`,children:[e.jsx(R,{className:`h-12 w-12 mb-2 animate-pulse ${c?"text-gray-600":"text-gray-300"}`}),e.jsx("p",{className:"text-sm",children:"발주서를 불러오는 중..."})]});if(S&&V)return e.jsxs("div",{className:`flex flex-col items-center justify-center py-8 ${c?"text-red-400":"text-red-500"}`,children:[e.jsx(I,{className:"h-12 w-12 mb-2"}),e.jsx("p",{className:"text-sm",children:"발주서를 불러오는데 실패했습니다"})]});if(b.length===0)return e.jsxs("div",{className:`flex flex-col items-center justify-center py-8 ${c?"text-gray-400":"text-gray-500"}`,children:[e.jsx(R,{className:`h-12 w-12 mb-2 ${c?"text-gray-600":"text-gray-300"}`}),e.jsx("p",{className:"text-sm",children:"발주서가 없습니다"})]});const U=()=>{switch(t){case"compact":return e.jsx("div",{className:"space-y-1",children:b.map(m=>e.jsx(_e,{order:m,onOrderClick:j,isDarkMode:c},m.id))});case"compact-table":return e.jsx("div",{className:`overflow-x-auto rounded-lg border ${c?"border-gray-700":"border-gray-200"}`,children:e.jsxs("table",{className:"w-full min-w-full",children:[e.jsx("thead",{className:`${c?"bg-gray-700 border-gray-600":"bg-gray-50 border-gray-200"} border-b`,children:e.jsxs("tr",{children:[e.jsx("th",{className:`px-3 py-3 text-left text-xs font-medium uppercase tracking-wider ${c?"text-gray-300":"text-gray-500"}`,children:e.jsxs("button",{onClick:()=>N?.("orderNumber"),className:`flex items-center gap-1 transition-colors ${c?"hover:text-gray-100":"hover:text-gray-700"}`,children:["발주번호",y("orderNumber")]})}),e.jsx("th",{className:`px-3 py-3 text-left text-xs font-medium uppercase tracking-wider ${c?"text-gray-300":"text-gray-500"}`,children:e.jsxs("button",{onClick:()=>N?.("vendorName"),className:`flex items-center gap-1 transition-colors ${c?"hover:text-gray-100":"hover:text-gray-700"}`,children:["거래처",y("vendorName")]})}),e.jsx("th",{className:`px-3 py-3 text-right text-xs font-medium uppercase tracking-wider ${c?"text-gray-300":"text-gray-500"}`,children:e.jsxs("button",{onClick:()=>N?.("totalAmount"),className:`flex items-center gap-1 justify-end transition-colors ${c?"hover:text-gray-100":"hover:text-gray-700"}`,children:["금액",y("totalAmount")]})}),e.jsx("th",{className:`px-3 py-3 text-left text-xs font-medium uppercase tracking-wider ${c?"text-gray-300":"text-gray-500"}`,children:e.jsxs("button",{onClick:()=>N?.("orderStatus"),className:`flex items-center gap-1 transition-colors ${c?"hover:text-gray-100":"hover:text-gray-700"}`,children:["발주상태",y("orderStatus")]})}),r&&e.jsx("th",{className:`px-3 py-3 text-center text-xs font-medium uppercase tracking-wider ${c?"text-gray-300":"text-gray-500"}`,children:e.jsxs("button",{onClick:()=>N?.("actions"),className:`flex items-center gap-1 justify-center transition-colors ${c?"hover:text-gray-100":"hover:text-gray-700"}`,children:["액션",y("actions")]})})]})}),e.jsx("tbody",{className:`divide-y ${c?"bg-gray-800 divide-gray-700":"bg-white divide-gray-200"}`,children:b.map(m=>e.jsx(Xe,{order:m,onOrderClick:j,isDarkMode:c,sortBy:F,sortOrder:$,onSort:N,showActions:r},m.id))})]})});case"detailed":return e.jsx("div",{className:"space-y-2",children:b.map(m=>e.jsx(Ye,{order:m,onOrderClick:j,isDarkMode:c},m.id))});case"full":return e.jsx("div",{className:"space-y-4",children:b.map(m=>e.jsx(He,{order:m,onOrderClick:j,onStatusChange:g,onDeleteOrder:x,isDarkMode:c,showActions:r},m.id))});default:return null}};return e.jsxs("div",{className:B("unified-orders-list",D),children:[U(),t==="compact"&&i&&i.total>b.length&&e.jsx("div",{className:"text-center pt-2",children:e.jsxs("p",{className:`text-xs ${c?"text-gray-400":"text-gray-500"}`,children:["외 ",i.total-b.length,"개 발주서"]})})]})}function Je({className:t="",showDetails:o=!0}){const[,r]=W(),{data:n,isLoading:d}=q({queryKey:["/api/approvals/dashboard-stats"],queryFn:async()=>{const a=await fetch("/api/approvals/dashboard-stats",{credentials:"include"});if(!a.ok)throw new Error("Failed to fetch approval stats");return a.json()},refetchInterval:6e4}),{data:s,isLoading:h}=q({queryKey:["/api/approvals/pending-summary"],queryFn:async()=>{const a=await fetch("/api/approvals/pending-summary?limit=5",{credentials:"include"});if(!a.ok)throw new Error("Failed to fetch pending approvals");return a.json()},refetchInterval:6e4}),{data:g,isLoading:x}=q({queryKey:["/api/approvals/recent-activity"],queryFn:async()=>{const a=await fetch("/api/approvals/recent-activity?limit=5",{credentials:"include"});if(!a.ok)throw new Error("Failed to fetch recent activity");return a.json()},refetchInterval:6e4}),u=a=>{switch(a){case"approved":return e.jsx(K,{className:"h-4 w-4 text-green-600"});case"rejected":return e.jsx(ie,{className:"h-4 w-4 text-red-600"});default:return e.jsx(A,{className:"h-4 w-4 text-yellow-600"})}},D=a=>{switch(a){case"approved":return e.jsx(p,{className:"bg-green-100 text-green-700 border-green-200",children:"승인"});case"rejected":return e.jsx(p,{className:"bg-red-100 text-red-700 border-red-200",children:"반려"});default:return e.jsx(p,{className:"bg-yellow-100 text-yellow-700 border-yellow-200",children:"대기"})}},C=(a,O)=>a?e.jsx(p,{variant:"destructive",className:"text-xs",children:"긴급"}):O>3?e.jsx(p,{className:"bg-orange-100 text-orange-700 border-orange-200 text-xs",children:"지연"}):null;return o?e.jsxs(M,{className:`shadow-sm ${t}`,children:[e.jsx(ee,{children:e.jsxs(se,{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(te,{className:"h-5 w-5 text-blue-600"}),e.jsx("span",{children:"승인 관리 현황"})]}),e.jsxs(L,{size:"sm",variant:"outline",onClick:()=>r("/approvals"),children:[e.jsx(H,{className:"h-4 w-4 mr-1"}),"전체보기"]})]})}),e.jsxs(ae,{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(A,{className:"h-4 w-4 text-yellow-500"}),e.jsx("p",{className:"text-xs text-gray-500",children:"승인 대기"})]}),e.jsx("p",{className:"text-2xl font-bold",children:n?.pendingCount||0}),n?.urgentCount?e.jsxs(p,{variant:"destructive",className:"text-xs",children:[n.urgentCount,"건 긴급"]}):null]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(De,{className:"h-4 w-4 text-blue-500"}),e.jsx("p",{className:"text-xs text-gray-500",children:"오늘 처리"})]}),e.jsx("p",{className:"text-2xl font-bold",children:n?.todayCount||0}),e.jsxs("p",{className:"text-xs text-gray-400",children:["주간 ",n?.weekCount||0,"건"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(xe,{className:"h-4 w-4 text-green-500"}),e.jsx("p",{className:"text-xs text-gray-500",children:"대기 금액"})]}),e.jsx("p",{className:"text-lg font-bold text-blue-600",children:w(n?.pendingAmount||0)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ce,{className:"h-4 w-4 text-purple-500"}),e.jsx("p",{className:"text-xs text-gray-500",children:"승인율"})]}),e.jsxs("p",{className:"text-2xl font-bold",children:[n?.approvalRate||0,"%"]}),e.jsx(ne,{value:n?.approvalRate||0,className:"h-1"})]})]}),e.jsx(_,{}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(I,{className:"h-4 w-4 text-yellow-500"}),"승인 대기 목록"]}),e.jsxs(p,{variant:"outline",children:["평균 대기: ",n?.averageWaitDays||0,"일"]})]}),e.jsx(Ne,{className:"h-48",children:h?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("p",{className:"text-sm text-gray-400",children:"로딩 중..."})}):s&&s.length>0?e.jsx("div",{className:"space-y-2",children:s.map(a=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 hover:bg-gray-100 rounded-lg cursor-pointer transition-colors",onClick:()=>r(`/orders/${a.id}/standard`),children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium",children:a.orderNumber}),C(a.isUrgent,a.daysWaiting)]}),e.jsx("span",{className:"text-xs text-gray-500",children:a.projectName})]})}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm font-medium text-blue-600",children:w(a.totalAmount)}),e.jsxs("p",{className:"text-xs text-gray-400",children:[a.daysWaiting,"일 대기"]})]})]},a.id))}):e.jsxs("div",{className:"flex flex-col items-center justify-center py-8",children:[e.jsx(K,{className:"h-8 w-8 text-green-500 mb-2"}),e.jsx("p",{className:"text-sm text-gray-500",children:"승인 대기 중인 발주서가 없습니다"})]})})]}),e.jsx(_,{}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h3",{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(me,{className:"h-4 w-4 text-blue-500"}),"최근 활동"]}),x?e.jsx("div",{className:"text-center py-4",children:e.jsx("p",{className:"text-xs text-gray-400",children:"로딩 중..."})}):g&&g.length>0?e.jsx("div",{className:"space-y-2",children:g.map(a=>e.jsxs("div",{className:"flex items-center justify-between py-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[u(a.action),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium",children:a.orderNumber}),e.jsxs("p",{className:"text-xs text-gray-500",children:[a.performedBy," • ",fe(new Date(a.performedAt),{addSuffix:!0,locale:be})]})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:D(a.action)})]},a.id))}):e.jsx("p",{className:"text-xs text-gray-400 text-center py-4",children:"최근 활동이 없습니다"})]})]})]}):e.jsxs(M,{className:`shadow-sm hover:shadow-md transition-shadow cursor-pointer ${t}`,onClick:()=>r("/approvals"),children:[e.jsx(ee,{className:"pb-3",children:e.jsxs(se,{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(te,{className:"h-5 w-5 text-blue-600"}),e.jsx("span",{className:"text-lg",children:"승인 관리"})]}),e.jsx(H,{className:"h-4 w-4 text-gray-400"})]})}),e.jsxs(ae,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"승인 대기"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-2xl font-bold",children:n?.pendingCount||0}),n?.urgentCount?e.jsxs(p,{variant:"destructive",className:"text-xs",children:[n.urgentCount," 긴급"]}):null]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"이번 주 처리"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-2xl font-bold text-green-600",children:n?.approvedThisWeek||0}),e.jsx(G,{className:"h-4 w-4 text-green-600"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"text-gray-500",children:"승인율"}),e.jsxs("span",{className:"font-medium",children:[n?.approvalRate||0,"%"]})]}),e.jsx(ne,{value:n?.approvalRate||0,className:"h-2"})]}),e.jsx(_,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs font-medium text-gray-700",children:"최근 대기 중"}),h?e.jsx("div",{className:"text-center py-2",children:e.jsx("p",{className:"text-xs text-gray-400",children:"로딩 중..."})}):s&&s.length>0?e.jsx("div",{className:"space-y-1",children:s.slice(0,3).map(a=>e.jsxs("div",{className:"flex items-center justify-between py-1 text-xs hover:bg-gray-50 rounded px-1",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsx(A,{className:"h-3 w-3 text-gray-400 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:a.orderNumber}),C(a.isUrgent,a.daysWaiting)]}),e.jsxs("span",{className:"text-gray-500 flex-shrink-0",children:[a.daysWaiting,"일 전"]})]},a.id))}):e.jsx("p",{className:"text-xs text-gray-400 text-center py-2",children:"대기 중인 승인이 없습니다"})]})]})]})}function Ns(){const{user:t,isLoading:o}=ve(),{toast:r}=we(),[,n]=W();$e();const{theme:d}=le(),s=d==="dark",[h,g]=v.useState({sortBy:"createdAt",sortOrder:"desc"}),x=v.useCallback(l=>{g(i=>({sortBy:l,sortOrder:i.sortBy===l&&i.sortOrder==="desc"?"asc":"desc"}))},[]);v.useEffect(()=>{if(!o&&!t){r({title:"Unauthorized",description:"You are logged out. Redirecting to login...",variant:"destructive"}),setTimeout(()=>{n("/login")},500);return}},[t,o,r]);const{data:u,isLoading:D,error:C}=Ce();v.useEffect(()=>{C&&console.error("Dashboard data fetch error:",C),u&&console.log("Dashboard data loaded:",u)},[u,C]);const a=u?.statistics||{},O=u?.recentOrders||[],F=v.useMemo(()=>O.length?[...O].sort((i,f)=>{const{sortBy:V,sortOrder:b}=h;let j,y;switch(V){case"orderNumber":j=i.orderNumber||"",y=f.orderNumber||"";break;case"vendorName":j=i.vendor?.name||i.vendorName||"",y=f.vendor?.name||f.vendorName||"";break;case"totalAmount":j=i.totalAmount||0,y=f.totalAmount||0;break;case"orderStatus":j=i.orderStatus||i.status||"",y=f.orderStatus||f.status||"";break;case"createdAt":default:j=new Date(i.createdAt||i.orderDate).getTime(),y=new Date(f.createdAt||f.orderDate).getTime();break}if(typeof j=="string"){const U=j.localeCompare(y);return b==="asc"?U:-U}else return b==="asc"?j-y:y-j}):[],[O,h]),$=u?.monthlyStats||[];u?.statusStats;const N=u?.orderStatusStats||[],T=u?.projectStats||[],c=u?.categoryStats||[];a.activeProjects;const{data:P,loading:S,refresh:Q}=Pe(a,async()=>(await(await fetch("/api/dashboard/unified")).json()).statistics||{},3e4,!!t);P.totalOrders||a.totalOrders,a.totalOrders,P.totalAmount||a.totalAmount,a.totalAmount,P.completedOrders||a.completedOrders,a.completedOrders;const k=D;return k?e.jsx(Le,{}):t?e.jsx("div",{className:`p-2 min-h-screen transition-colors ${s?"bg-gray-900":"bg-gray-50"}`,children:e.jsxs("div",{className:"max-w-[1366px] mx-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("div",{children:e.jsx("h1",{className:`text-sm font-semibold transition-colors ${s?"text-gray-100":"text-gray-900"}`,children:"대시보드"})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:Q,disabled:S,className:`text-xs flex items-center gap-1 px-1 py-0.5 rounded transition-colors ${s?"text-gray-400 hover:text-gray-300 hover:bg-gray-700":"text-gray-500 hover:text-gray-700 hover:bg-gray-100"}`,children:[e.jsx(me,{className:`h-3 w-3 ${S?"animate-spin":""}`}),S?"업데이트":"새로고침"]}),e.jsx("span",{className:`text-xs transition-colors ${s?"text-gray-400":"text-gray-500"}`,children:new Date().toLocaleTimeString("ko-KR",{hour:"2-digit",minute:"2-digit"})})]})]}),e.jsxs("div",{className:"grid grid-cols-6 gap-1 mb-2",children:[e.jsx("div",{className:`rounded border p-2 hover:shadow-sm transition-all cursor-pointer ${s?"bg-blue-900/20 border-blue-700 hover:bg-blue-900/30":"bg-blue-50/30 border-blue-300 hover:bg-blue-50/50"}`,onClick:()=>n("/orders?status=completed"),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:`w-6 h-6 rounded-full flex items-center justify-center ${s?"bg-green-900/30":"bg-green-100"}`,children:e.jsx(X,{className:`h-3 w-3 ${s?"text-green-400":"text-green-600"}`})}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:`text-lg font-bold transition-colors ${s?"text-gray-100":"text-gray-900"}`,children:a.completedOrders||0}),e.jsx("div",{className:`text-xs transition-colors ${s?"text-gray-400":"text-gray-500"}`,children:"발주완료"})]})]})}),e.jsx("div",{className:`rounded border p-2 hover:shadow-sm transition-all cursor-pointer ${s?"bg-blue-900/20 border-blue-700 hover:bg-blue-900/30":"bg-blue-50/30 border-blue-300 hover:bg-blue-50/50"}`,onClick:()=>n("/orders?filter=urgent"),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:`w-6 h-6 rounded-full flex items-center justify-center ${s?"bg-red-900/30":"bg-red-100"}`,children:e.jsx(I,{className:`h-3 w-3 ${s?"text-red-400":"text-red-600"}`})}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:`text-lg font-bold transition-colors ${s?"text-gray-100":"text-gray-900"}`,children:a.urgentOrders||0}),e.jsx("div",{className:`text-xs transition-colors ${s?"text-gray-400":"text-gray-500"}`,children:"긴급발주"})]})]})}),e.jsx("div",{className:`rounded border p-2 transition-colors ${s?"bg-blue-900/20 border-blue-700":"bg-blue-50/30 border-blue-300"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:`w-6 h-6 rounded-full flex items-center justify-center ${s?"bg-blue-800/30":"bg-blue-100"}`,children:e.jsx(R,{className:`h-3 w-3 ${s?"text-blue-400":"text-blue-600"}`})}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:`text-lg font-bold transition-colors ${s?"text-gray-100":"text-gray-900"}`,children:a.totalOrders||0}),e.jsx("div",{className:`text-xs transition-colors ${s?"text-gray-400":"text-gray-500"}`,children:"총발주서"})]})]})}),e.jsx("div",{className:`rounded border p-2 transition-colors ${s?"bg-blue-900/20 border-blue-700":"bg-blue-50/30 border-blue-300"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:`w-6 h-6 rounded-full flex items-center justify-center ${s?"bg-emerald-900/30":"bg-emerald-100"}`,children:e.jsx(xe,{className:`h-3 w-3 ${s?"text-emerald-400":"text-emerald-600"}`})}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:`text-sm font-bold transition-colors ${s?"text-blue-400":"text-blue-600"}`,children:w(a.totalAmount||0).replace("₩","").replace(",000,000","M")}),e.jsx("div",{className:`text-xs transition-colors ${s?"text-gray-400":"text-gray-500"}`,children:"총금액"})]})]})}),e.jsx("div",{className:`rounded border p-2 transition-colors ${s?"bg-blue-900/20 border-blue-700":"bg-blue-50/30 border-blue-300"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:`w-6 h-6 rounded-full flex items-center justify-center ${s?"bg-purple-900/30":"bg-purple-100"}`,children:e.jsx(E,{className:`h-3 w-3 ${s?"text-purple-400":"text-purple-600"}`})}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:`text-lg font-bold transition-colors ${s?"text-gray-100":"text-gray-900"}`,children:a.activeProjects||0}),e.jsx("div",{className:`text-xs transition-colors ${s?"text-gray-400":"text-gray-500"}`,children:"활성현장"})]})]})}),e.jsx("div",{className:`rounded border p-2 transition-colors ${s?"bg-blue-900/20 border-blue-700":"bg-blue-50/30 border-blue-300"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:`w-6 h-6 rounded-full flex items-center justify-center ${s?"bg-indigo-900/30":"bg-indigo-100"}`,children:e.jsx(de,{className:`h-3 w-3 ${s?"text-indigo-400":"text-indigo-600"}`})}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:`text-lg font-bold transition-colors ${s?"text-gray-100":"text-gray-900"}`,children:a.activeVendors||0}),e.jsx("div",{className:`text-xs transition-colors ${s?"text-gray-400":"text-gray-500"}`,children:"활성거래처"})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-1",children:[e.jsxs("div",{className:"space-y-1",children:[!k&&$&&Array.isArray($)&&$.length>0?(()=>{const l=$.map(i=>({month:i.month.replace("-","/"),orders:Number(i.count)||0}));return e.jsxs("div",{className:`rounded border p-2 transition-colors ${s?"bg-gray-800 border-gray-600":"bg-white border-blue-300"}`,children:[e.jsxs("div",{className:"flex items-center gap-1 mb-2",children:[e.jsx(G,{className:`h-3 w-3 transition-colors ${s?"text-gray-400":"text-gray-600"}`}),e.jsx("h3",{className:`text-xs font-semibold transition-colors ${s?"text-gray-100":"text-gray-900"}`,children:"월별 발주 통계"})]}),e.jsx("div",{className:"h-[140px] w-full",children:e.jsx(Re,{width:"100%",height:"100%",children:e.jsxs(Be,{data:l,margin:{top:5,right:5,left:5,bottom:5},children:[e.jsx(Ue,{strokeDasharray:"2 2",stroke:"#f3f4f6"}),e.jsx(qe,{dataKey:"month",fontSize:9,axisLine:!1,tickLine:!1}),e.jsx(Ee,{fontSize:9,axisLine:!1,tickLine:!1}),e.jsx(ze,{formatter:i=>[`${i}건`,"발주 건수"]}),e.jsx(Ke,{dataKey:"orders",fill:"#3b82f6",radius:[2,2,0,0]})]})})})]})})():e.jsxs("div",{className:`rounded border p-2 transition-colors ${s?"bg-gray-800 border-gray-600":"bg-white border-blue-300"}`,children:[e.jsxs("div",{className:"flex items-center gap-1 mb-2",children:[e.jsx(G,{className:`h-3 w-3 transition-colors ${s?"text-gray-400":"text-gray-600"}`}),e.jsx("h3",{className:`text-xs font-semibold transition-colors ${s?"text-gray-100":"text-gray-900"}`,children:"월별 발주 통계"})]}),e.jsx("div",{className:`h-[140px] flex items-center justify-center transition-colors ${s?"text-gray-400":"text-gray-500"}`,children:e.jsxs("div",{className:"text-center",children:[e.jsx(ce,{className:`h-6 w-6 mx-auto mb-1 transition-colors ${s?"text-gray-600":"text-gray-300"}`}),e.jsx("p",{className:"text-xs",children:"데이터 준비 중..."})]})})]}),e.jsxs("div",{className:`rounded border p-2 transition-colors ${s?"bg-gray-800 border-gray-600":"bg-white border-blue-300"}`,children:[e.jsxs("div",{className:"flex items-center gap-1 mb-2",children:[e.jsx(X,{className:`h-3 w-3 transition-colors ${s?"text-gray-400":"text-gray-600"}`}),e.jsx("h3",{className:`text-xs font-semibold transition-colors ${s?"text-gray-100":"text-gray-900"}`,children:"발주상태분포"})]}),k?e.jsx("div",{className:`h-[140px] flex items-center justify-center transition-colors ${s?"text-gray-400":"text-gray-500"}`,children:e.jsxs("div",{className:"text-center",children:[e.jsx(X,{className:`h-6 w-6 mx-auto mb-1 transition-colors ${s?"text-gray-600":"text-gray-300"}`}),e.jsx("p",{className:"text-xs",children:"데이터 준비 중..."})]})}):e.jsx("div",{className:"h-[140px] w-full",children:e.jsx(Fe,{data:[{name:"임시저장",value:N.find(l=>l.status==="draft")?.count||0,status:"draft"},{name:"발주생성",value:N.find(l=>l.status==="created")?.count||0,status:"created"},{name:"발주완료",value:N.find(l=>l.status==="sent")?.count||0,status:"sent"},{name:"납품완료",value:N.find(l=>l.status==="delivered")?.count||0,status:"delivered"}],dataKey:"value",nameKey:"name",height:140,showExport:!1,showLabels:!1,showLegend:!1,innerRadius:20,outerRadius:45,colors:["#6b7280","#f59e0b","#3b82f6","#10b981"],formatValue:l=>`${l}건`})})]})]}),e.jsxs("div",{className:`rounded border p-2 transition-colors ${s?"bg-gray-800 border-gray-600":"bg-white border-gray-200"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(E,{className:`h-3 w-3 transition-colors ${s?"text-gray-400":"text-gray-600"}`}),e.jsx("h3",{className:`text-xs font-semibold transition-colors ${s?"text-gray-100":"text-gray-900"}`,children:"현장별 발주 현황"})]}),e.jsx("span",{className:`text-xs transition-colors ${s?"text-gray-400":"text-gray-500"}`,children:"상위 10개"})]}),e.jsx("div",{className:"h-[260px] overflow-y-auto",children:!k&&T&&Array.isArray(T)&&T.length>0?e.jsx("div",{className:"space-y-1",children:T.slice(0,10).map((l,i)=>e.jsxs("div",{className:`flex items-center justify-between p-1.5 rounded cursor-pointer transition-colors ${s?"hover:bg-gray-700":"hover:bg-gray-50"}`,onClick:()=>n(`/projects/${l.id}`),children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-1",children:[e.jsx("span",{className:`text-xs font-medium w-4 text-center transition-colors ${s?"text-gray-400":"text-gray-600"}`,children:i+1}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("div",{className:`text-xs font-medium truncate transition-colors ${s?"text-gray-100":"text-gray-900"}`,title:l.projectName,children:l.projectName}),e.jsxs("div",{className:`text-xs transition-colors ${s?"text-gray-400":"text-gray-500"}`,children:[l.orderCount,"건"]})]})]}),e.jsx("div",{className:"text-right",children:e.jsx("div",{className:`text-xs font-semibold transition-colors ${s?"text-blue-400":"text-blue-600"}`,children:w(l.totalAmount||0).replace("₩","").replace(",000,000","M")})})]},i))}):e.jsx("div",{className:`h-[240px] flex items-center justify-center transition-colors ${s?"text-gray-400":"text-gray-500"}`,children:e.jsxs("div",{className:"text-center",children:[e.jsx(E,{className:`h-6 w-6 mx-auto mb-1 transition-colors ${s?"text-gray-600":"text-gray-300"}`}),e.jsx("p",{className:"text-xs",children:"데이터 준비 중..."})]})})})]}),e.jsxs("div",{className:"space-y-1",children:[t&&["admin","executive","hq_management","project_manager"].includes(t.role)&&e.jsx(Je,{className:"mb-1",showDetails:!1}),e.jsxs("div",{className:`rounded border p-2 transition-colors ${s?"bg-gray-800 border-gray-600":"bg-white border-gray-200"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(A,{className:`h-3 w-3 transition-colors ${s?"text-gray-400":"text-gray-600"}`}),e.jsx("h3",{className:`text-xs font-semibold transition-colors ${s?"text-gray-100":"text-gray-900"}`,children:"최근 발주서"})]}),e.jsx("button",{onClick:()=>n("/orders"),className:`text-xs font-medium transition-colors ${s?"text-blue-400 hover:text-blue-300":"text-blue-600 hover:text-blue-800"}`,children:"전체보기"})]}),e.jsx("div",{className:"h-[140px] overflow-y-auto",children:e.jsx(Ge,{mode:"compact-table",maxItems:6,orders:F,onOrderClick:l=>n(`/orders/${l}`),showActions:!1,sortBy:h.sortBy,sortOrder:h.sortOrder,onSort:x})})]}),e.jsxs("div",{className:`rounded border p-2 transition-colors ${s?"bg-gray-800 border-gray-600":"bg-white border-gray-200"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(re,{className:`h-3 w-3 transition-colors ${s?"text-gray-400":"text-gray-600"}`}),e.jsx("h3",{className:`text-xs font-semibold transition-colors ${s?"text-gray-100":"text-gray-900"}`,children:"품목 분류"})]}),e.jsx("button",{onClick:()=>n("/category-management"),className:`text-xs font-medium transition-colors ${s?"text-blue-400 hover:text-blue-300":"text-blue-600 hover:text-blue-800"}`,children:"관리"})]}),e.jsx("div",{className:"h-[120px] overflow-y-auto",children:!k&&c&&Array.isArray(c)&&c.length>0?e.jsx("div",{className:"space-y-1",children:c.slice(0,6).sort((l,i)=>i.totalAmount-l.totalAmount).map((l,i)=>e.jsxs("div",{className:`flex items-center justify-between p-1 rounded cursor-pointer transition-colors ${s?"hover:bg-gray-700":"hover:bg-gray-50"}`,children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:`text-xs font-medium transition-colors ${s?"text-gray-100":"text-gray-900"}`,children:l.majorCategory}),l.middleCategory!=="미분류"&&e.jsxs(e.Fragment,{children:[e.jsx(H,{className:`h-2 w-2 transition-colors ${s?"text-gray-500":"text-gray-400"}`}),e.jsx("span",{className:`text-xs truncate transition-colors ${s?"text-gray-400":"text-gray-600"}`,children:l.middleCategory})]})]}),e.jsxs("div",{className:`text-xs transition-colors ${s?"text-gray-400":"text-gray-500"}`,children:[l.orderCount,"건"]})]}),e.jsx("div",{className:"text-right",children:e.jsx("div",{className:`text-xs font-semibold transition-colors ${s?"text-blue-400":"text-blue-600"}`,children:w(l.totalAmount).replace("₩","").replace(",000,000","M")})})]},i))}):e.jsx("div",{className:`h-[100px] flex items-center justify-center transition-colors ${s?"text-gray-400":"text-gray-500"}`,children:e.jsxs("div",{className:"text-center",children:[e.jsx(re,{className:`h-6 w-6 mx-auto mb-1 transition-colors ${s?"text-gray-600":"text-gray-300"}`}),e.jsx("p",{className:"text-xs",children:"데이터 준비 중..."})]})})})]})]})]})]})}):null}export{Ns as default};
