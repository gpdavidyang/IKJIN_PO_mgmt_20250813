import{d as X,e as Y,u as Z,L as ee,r as w,q as S,s as j,j as e,w as x,x as p,H as se,B as c,N as te,O as ae,Q as re,R as ie,U as le,V as de,W as ne,X as ce,F as C,Y as oe,M as Q,b as K,f as u,Z as D,_ as M,K as a,$ as me,k as y}from"./index-B6PfVuJG-1757255469111.js";import{d as xe,s as pe,A as he}from"./attached-files-info-BLTGj-FV-1757255469111.js";import{I as ue,R as ye}from"./receipt-manager-DFVbn1gc-1757255469111.js";import{E as ge}from"./email-send-dialog-ClRF3u8t-1757255469111.js";import{E as je}from"./email-history-modal-C1Mogpgt-1757255469111.js";import{S as Ne}from"./square-pen-DyBVWzx8-1757255469111.js";import{E as ve}from"./external-link-CIjYPXbv-1757255469111.js";import{M as fe}from"./mail-check-CRzwbj8Q-1757255469111.js";import{D as be}from"./dollar-sign-CgweYVuU-1757255469111.js";import{P as $}from"./package-DjicV7Di-1757255469111.js";import{C as we}from"./calendar-B7PHruvB-1757255469111.js";import{P as De}from"./phone-DhASqRIY-1757255469111.js";import{M as E}from"./map-pin-DGNEVlux-1757255469111.js";import{f as o}from"./format-DjHd4Xxv-1757255469111.js";import"./alert-dialog-viw5s7T1-1757255469111.js";import"./index-S91broQv-1757255469111.js";import"./download-DQvBtQey-1757255469111.js";import"./textarea-BwoTpdq9-1757255469111.js";import"./dialog-ZqcOkCty-1757255469111.js";import"./upload-LHcTrINV-1757255469111.js";import"./checkbox-CXdqNVGq-1757255469111.js";import"./triangle-alert-CHcTWW94-1757255469111.js";import"./send-CiluzqBb-1757255469111.js";import"./refresh-cw-CdIVxnAd-1757255469111.js";import"./paperclip-B3KAkFuZ-1757255469111.js";function Ye(){const{user:d}=X(),{toast:l}=Y(),[,h]=Z(),k=ee(),[O,N]=w.useState(!1),[Ae,v]=w.useState(null),[I,A]=w.useState(!1),i=parseInt(k.id),{data:s,isLoading:F}=S({queryKey:[`/api/orders/${i}`],queryFn:async()=>{console.log("📘 OrderDetailProfessional - Fetching order:",i);const t=await y("GET",`/api/orders/${i}`);return console.log("📘 OrderDetailProfessional - Order data received:",t),console.log("📘 OrderDetailProfessional - Attachments:",t?.attachments),t}});S({queryKey:["/api/order-statuses"]});const q=j({mutationFn:async()=>{await y("POST",`/api/orders/${i}/approve`)},onSuccess:()=>{l({title:"발주서 승인",description:"발주서가 성공적으로 승인되었습니다."}),a.invalidateQueries({queryKey:["/api/orders"]}),a.invalidateQueries({queryKey:[`/api/orders/${i}`]}),a.invalidateQueries({queryKey:["orders-optimized"]}),a.invalidateQueries({queryKey:["orders-metadata"]}),a.invalidateQueries({queryKey:["/api/dashboard"]}),a.refetchQueries({queryKey:["orders-optimized"],type:"active",exact:!1})},onError:t=>{l({title:"승인 실패",description:t.message,variant:"destructive"})}});j({mutationFn:async()=>{await y("POST",`/api/orders/${i}/send`)},onSuccess:()=>{l({title:"발주서 발송",description:"발주서가 성공적으로 발송되었습니다."}),a.invalidateQueries({queryKey:["/api/orders"]}),a.invalidateQueries({queryKey:[`/api/orders/${i}`]}),a.invalidateQueries({queryKey:["orders-optimized"]}),a.invalidateQueries({queryKey:["orders-metadata"]}),a.invalidateQueries({queryKey:["/api/dashboard"]}),a.refetchQueries({queryKey:["orders-optimized"],type:"active",exact:!1})},onError:t=>{l({title:"발송 실패",description:t.message,variant:"destructive"})}});const f=j({mutationFn:async()=>await y("POST",`/api/orders/${i}/create-order`),onSuccess:t=>{l({title:"발주서 생성 완료",description:"발주서가 성공적으로 생성되었습니다. PDF가 첨부되었습니다."}),a.invalidateQueries({queryKey:["/api/orders"]}),a.invalidateQueries({queryKey:[`/api/orders/${i}`]})},onError:t=>{l({title:"발주서 생성 실패",description:t.message||"발주서 생성 중 오류가 발생했습니다.",variant:"destructive"})}}),b=j({mutationFn:async()=>await y("POST",`/api/orders/${i}/complete-delivery`),onMutate:async()=>{await a.cancelQueries({queryKey:[`/api/orders/${i}`]});const t=a.getQueryData([`/api/orders/${i}`]);return a.setQueryData([`/api/orders/${i}`],r=>({...r,status:"completed",orderStatus:"delivered"})),{previousOrder:t}},onSuccess:t=>{l({title:"납품검수완료",description:"발주서가 납품완료 상태로 변경되었습니다."}),a.invalidateQueries({queryKey:["/api/orders"]}),a.invalidateQueries({queryKey:[`/api/orders/${i}`]}),a.invalidateQueries({queryKey:["/api/dashboard/unified"]}),a.invalidateQueries({queryKey:["orders-optimized"]}),a.invalidateQueries({queryKey:["orders-metadata"]}),a.invalidateQueries({queryKey:["/api/dashboard"]}),a.refetchQueries({queryKey:["orders-optimized"],type:"active",exact:!1})},onError:(t,r,g)=>{a.setQueryData([`/api/orders/${i}`],g?.previousOrder),l({title:"납품검수완료 실패",description:t.message||"납품검수완료 처리 중 오류가 발생했습니다.",variant:"destructive"})},onSettled:()=>{a.invalidateQueries({queryKey:[`/api/orders/${i}`]})}}),H=()=>{confirm("이 발주서를 승인하시겠습니까?")&&q.mutate()},R=()=>{confirm(`납품검수를 완료하시겠습니까?

• 발주서 상태가 '납품완료'로 변경됩니다
• 이 작업은 되돌릴 수 없습니다
• 납품이 완전히 검수되었을 때만 진행하세요`)&&b.mutate()},T=async t=>{if(s)try{const r=[];if(t.selectedAttachmentIds&&t.selectedAttachmentIds.length>0){console.log("📎 선택된 첨부파일 ID:",t.selectedAttachmentIds);for(const J of t.selectedAttachmentIds){const P=`/api/attachments/${J}/download`;r.push(P),console.log("📎 첨부파일 URL 생성:",P)}}const g={orderNumber:s.orderNumber,vendorName:s.vendor?.name||s.vendorName||"",orderDate:s.orderDate,totalAmount:s.totalAmount,siteName:s.project?.projectName||s.projectName||"",filePath:s.filePath||"",attachmentUrls:r};if(console.log("📧 이메일 발송 데이터:",{orderData:g,emailData:t,selectedAttachmentIds:t.selectedAttachmentIds,attachmentUrls:r,hasAttachments:s.attachments?.length||0}),(await fetch("/api/orders/send-email",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({orderData:g,...t,orderId:s.id,attachmentUrls:r})})).ok)l({title:"이메일 발송 완료",description:`${s.vendor?.name||s.vendorName}에게 발주서 ${s.orderNumber}를 전송했습니다.`}),N(!1),v(null),a.invalidateQueries({queryKey:["/api/orders"]}),a.invalidateQueries({queryKey:[`/api/orders/${i}`]}),a.invalidateQueries({queryKey:["orders-optimized"]}),a.invalidateQueries({queryKey:["orders-metadata"]}),a.invalidateQueries({queryKey:["/api/dashboard"]}),a.refetchQueries({queryKey:[`/api/orders/${i}`],type:"active"});else throw new Error("이메일 발송 실패")}catch(r){l({title:"이메일 발송 실패",description:r instanceof Error?r.message:"이메일 발송 중 오류가 발생했습니다.",variant:"destructive"})}},L=()=>{A(!0)};if(F)return e.jsx("div",{className:"min-h-screen bg-gray-50",children:e.jsx("div",{className:"max-w-[1366px] mx-auto p-6",children:e.jsxs("div",{className:"animate-pulse space-y-6",children:[e.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/3"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/2"}),e.jsx("div",{className:"grid grid-cols-4 gap-4",children:[...Array(4)].map((t,r)=>e.jsx("div",{className:"h-24 bg-gray-200 rounded-xl"},r))}),e.jsx("div",{className:"h-64 bg-gray-200 rounded-xl"})]})})});if(!s)return e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsx(x,{className:"max-w-md shadow-sm",children:e.jsxs(p,{className:"p-8 text-center",children:[e.jsx(se,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h1",{className:"text-lg font-semibold text-gray-900 mb-2",children:"발주서를 찾을 수 없습니다"}),e.jsx("p",{className:"text-sm text-gray-600 mb-6",children:"요청하신 발주서가 존재하지 않거나 접근 권한이 없습니다."}),e.jsx(c,{onClick:()=>h("/orders"),className:"bg-blue-600 hover:bg-blue-700",children:"발주서 목록으로 돌아가기"})]})})});const n=s.orderStatus||s.status,m=s.approvalStatus,z=n==="draft"&&(d?.role==="admin"||s.userId===d?.id),B=me(n),U=te(n,m)&&(d?.role==="admin"||s.userId===d?.id),W=ae(n)&&(d?.role==="admin"||s.userId===d?.id),_=re(n,m)&&(d?.role==="admin"||s.userId===d?.id),V=ie(m,d?.role),G=le(n,m)&&(d?.role==="admin"||s.userId===d?.id);return e.jsx("div",{className:"min-h-screen bg-gray-50",children:e.jsxs("div",{className:"max-w-[1366px] mx-auto p-6",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("button",{onClick:()=>h("/orders"),className:"inline-flex items-center text-sm text-gray-600 hover:text-gray-900 mb-4",children:[e.jsx(de,{className:"h-4 w-4 mr-1"}),"발주서 목록으로"]}),e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:s.orderNumber}),e.jsxs("div",{className:"flex items-center gap-4 mt-2",children:[e.jsx("span",{className:`inline-flex items-center px-3 py-1 rounded-full text-xs font-medium border ${ne(n,m)}`,children:ce(n,m)}),n==="draft"&&e.jsx("span",{className:"text-xs text-amber-600 bg-amber-50 px-2 py-1 rounded",children:"⚠️ 임시저장 상태 - 발주서 생성 필요"}),e.jsxs("p",{className:"text-sm text-gray-500",children:[s.vendor?.name," • ",s.orderDate?o(new Date(s.orderDate),"yyyy년 MM월 dd일"):"날짜 미정"]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[_&&e.jsxs(c,{variant:"outline",onClick:()=>h(`/orders/${i}/edit`),className:"flex items-center gap-2",children:[e.jsx(Ne,{className:"h-4 w-4"}),"수정"]}),z&&e.jsxs(c,{onClick:()=>{confirm(`발주서를 생성하시겠습니까?

• PDF 파일이 자동으로 생성됩니다
• 상태가 '생성됨'으로 변경됩니다
• 생성 후 PDF 보기 및 이메일 발송이 가능합니다`)&&f.mutate()},disabled:f.isPending,className:"bg-blue-600 hover:bg-blue-700 text-white flex items-center gap-2",children:[e.jsx(C,{className:"h-4 w-4"}),f.isPending?"생성 중...":"발주서 생성"]}),V&&e.jsxs(c,{onClick:H,disabled:q.isPending,className:"bg-green-600 hover:bg-green-700 text-white flex items-center gap-2",children:[e.jsx(oe,{className:"h-4 w-4"}),"승인"]}),B&&e.jsxs(c,{variant:"outline",onClick:async()=>{const t=s.attachments?.find(r=>r.mimeType?.includes("pdf")||r.originalName?.toLowerCase().endsWith(".pdf"));if(t)try{const r=t.originalName||`발주서_${s.orderNumber}.pdf`;await xe(t.id,r),pe(r,l)}catch(r){console.error("PDF download error:",r),l({title:"PDF 다운로드 실패",description:r instanceof Error?r.message:"알 수 없는 오류가 발생했습니다.",variant:"destructive"})}else l({title:"PDF 파일이 없습니다",description:"관리자에 의해 삭제되었거나 PDF가 생성이 안 된 발주서입니다."})},className:"flex items-center gap-2",title:"새 탭에서 PDF 열기",children:[e.jsx(ve,{className:"h-4 w-4"}),"PDF 다운로드"]}),U&&e.jsxs(c,{variant:"outline",onClick:()=>{v(s),N(!0)},className:"flex items-center gap-2",children:[e.jsx(Q,{className:"h-4 w-4"}),"이메일 발송"]}),W&&e.jsxs(c,{variant:"outline",onClick:L,className:"flex items-center gap-2",children:[e.jsx(fe,{className:"h-4 w-4"}),"이메일 기록"]}),G&&e.jsxs(c,{onClick:R,disabled:b.isPending,className:"bg-purple-600 hover:bg-purple-700 text-white flex items-center gap-2",children:[e.jsx(K,{className:"h-4 w-4"}),b.isPending?"처리 중...":"납품검수완료"]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-8",children:[e.jsx("div",{className:"bg-blue-50/30 rounded-xl shadow-sm p-6 border border-blue-200",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"총 발주금액"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600 mt-2",children:u(s.totalAmount)})]}),e.jsx("div",{className:"bg-blue-100 p-3 rounded-lg",children:e.jsx(be,{className:"h-6 w-6 text-blue-600"})})]})}),e.jsx("div",{className:"bg-blue-50/30 rounded-xl shadow-sm p-6 border border-blue-200",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"발주 품목"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900 mt-2",children:[s.items?.length||0,"개"]})]}),e.jsx("div",{className:"bg-purple-100 p-3 rounded-lg",children:e.jsx($,{className:"h-6 w-6 text-purple-600"})})]})}),e.jsx("div",{className:"bg-blue-50/30 rounded-xl shadow-sm p-6 border border-blue-200",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"납기일"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900 mt-2",children:s.deliveryDate?o(new Date(s.deliveryDate),"MM월 dd일"):"미정"}),(()=>{const t=s.notes?.split(`
`).find(r=>r.startsWith("납품처: "))?.replace("납품처: ","").trim();return t?e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["📍 ",t]}):null})()]}),e.jsx("div",{className:"bg-orange-100 p-3 rounded-lg",children:e.jsx(we,{className:"h-6 w-6 text-orange-600"})})]})}),e.jsx("div",{className:"bg-blue-50/30 rounded-xl shadow-sm p-6 border border-blue-200",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"작성자"}),e.jsx("p",{className:"text-sm font-medium text-gray-900 mt-2",children:s.user?.firstName&&s.user?.lastName?`${s.user.lastName}${s.user.firstName}`:s.user?.email||"알 수 없음"})]}),e.jsx("div",{className:"bg-green-100 p-3 rounded-lg",children:e.jsx(D,{className:"h-6 w-6 text-green-600"})})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8",children:[e.jsx(x,{className:"shadow-sm bg-white border-blue-200",children:e.jsxs(p,{className:"p-6 bg-blue-50/20",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(C,{className:"h-5 w-5 text-gray-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"발주서 정보"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"발주번호"}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:s.orderNumber})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"발주일"}),e.jsx("p",{className:"text-sm text-gray-900",children:s.orderDate?o(new Date(s.orderDate),"yyyy년 MM월 dd일"):"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"납기일"}),e.jsx("p",{className:"text-sm text-gray-900",children:s.deliveryDate?o(new Date(s.deliveryDate),"yyyy년 MM월 dd일"):"-"})]}),(()=>{const t=s.notes?.split(`
`).find(r=>r.startsWith("납품처: "))?.replace("납품처: ","").trim();return t?e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"납품장소"}),e.jsx("p",{className:"text-sm text-gray-900",children:t})]}):null})(),s.templateId&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"사용 템플릿"}),e.jsxs("p",{className:"text-sm text-gray-900",children:["Template ID: ",s.templateId]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"작성일시"}),e.jsx("p",{className:"text-sm text-gray-900",children:s.createdAt?o(new Date(s.createdAt),"yyyy년 MM월 dd일 HH:mm"):"-"})]}),s.updatedAt&&s.updatedAt!==s.createdAt&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"최종 수정일시"}),e.jsx("p",{className:"text-sm text-gray-900",children:o(new Date(s.updatedAt),"yyyy년 MM월 dd일 HH:mm")})]})]}),s.notes&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-100",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"비고"}),e.jsx("div",{className:"p-3 bg-gray-50 rounded-lg text-sm text-gray-700",children:s.notes})]})]})}),s.vendor&&e.jsx(x,{className:"shadow-sm bg-white border-blue-200",children:e.jsxs(p,{className:"p-6 bg-blue-50/20",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(M,{className:"h-5 w-5 text-gray-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"거래처 정보"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"업체명"}),e.jsx("button",{className:"text-sm font-medium text-blue-600 hover:text-blue-700",onClick:()=>s.vendor?.id&&h(`/vendors/${s.vendor.id}`),children:s.vendor.name})]}),s.vendor.contact&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"담당자"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(D,{className:"h-4 w-4 text-gray-400"}),e.jsx("p",{className:"text-sm text-gray-900",children:s.vendor.contact})]})]}),s.vendor.phone&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"전화번호"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(De,{className:"h-4 w-4 text-gray-400"}),e.jsx("p",{className:"text-sm text-gray-900",children:s.vendor.phone})]})]}),s.vendor.email&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"이메일"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Q,{className:"h-4 w-4 text-gray-400"}),e.jsx("p",{className:"text-sm text-gray-900",children:s.vendor.email})]})]}),s.vendor.address&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"주소"}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(E,{className:"h-4 w-4 text-gray-400 mt-0.5"}),e.jsx("p",{className:"text-sm text-gray-900",children:s.vendor.address})]})]})]})]})}),s.project&&e.jsx(x,{className:"shadow-sm bg-white border-blue-200",children:e.jsxs(p,{className:"p-6 bg-blue-50/20",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(M,{className:"h-5 w-5 text-gray-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"현장 정보"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"현장명"}),e.jsx("button",{className:"text-sm font-medium text-blue-600 hover:text-blue-700",onClick:()=>h(`/projects/${s.project.id}`),children:s.project.projectName}),e.jsxs("p",{className:"text-xs text-gray-500",children:["(",s.project.projectCode,")"]})]}),s.project.projectManager&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"담당자"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(D,{className:"h-4 w-4 text-gray-400"}),e.jsx("p",{className:"text-sm text-gray-900",children:s.project.projectManager})]})]}),s.project.location&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"위치"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(E,{className:"h-4 w-4 text-gray-400"}),e.jsx("p",{className:"text-sm text-gray-900",children:s.project.location})]})]}),s.project.description&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"설명"}),e.jsx("div",{className:"p-3 bg-gray-50 rounded-lg text-sm text-gray-700",children:s.project.description})]})]})]})})]}),(s.approvedBy||s.approvedAt||s.currentApproverRole)&&e.jsx(x,{className:"shadow-sm mb-8 bg-white border-blue-200",children:e.jsxs(p,{className:"p-6 bg-blue-50/20",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(K,{className:"h-5 w-5 text-gray-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"승인 정보"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[s.approvedBy&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"승인자"}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:s.approvedBy})]}),s.approvedAt&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"승인일시"}),e.jsx("p",{className:"text-sm text-gray-900",children:o(new Date(s.approvedAt),"yyyy년 MM월 dd일 HH:mm")})]}),s.currentApproverRole&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"현재 승인 단계"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-900",children:s.currentApproverRole==="admin"?"관리자":s.currentApproverRole==="executive"?"임원":s.currentApproverRole==="hq_management"?"본부장":s.currentApproverRole==="project_manager"?"프로젝트매니저":s.currentApproverRole}),s.approvalLevel&&e.jsxs("span",{className:"text-xs text-gray-500",children:["(Level ",s.approvalLevel,")"]})]})]})]})]})}),e.jsx(x,{className:"shadow-sm mb-8 bg-white border-blue-200",children:e.jsxs(p,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($,{className:"h-5 w-5 text-gray-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"발주 품목"}),e.jsxs("span",{className:"text-sm text-gray-500",children:["총 ",s.items?.length||0,"개 품목"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"총 발주금액"}),e.jsx("p",{className:"text-lg font-bold text-blue-600",children:u(s.totalAmount)})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-blue-50 border-b border-blue-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"품목명"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"대분류"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"중분류"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"소분류"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"규격"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"수량"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"단위"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"단가"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"금액"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"비고"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:s.items?.map((t,r)=>e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-4 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm font-medium text-gray-900",children:t.itemName})}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-700",children:t.majorCategory||"-"})}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-700",children:t.middleCategory||"-"})}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-700",children:t.minorCategory||"-"})}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap text-sm text-gray-700",children:t.specification||"-"}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap text-center",children:e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800",children:typeof t.quantity=="number"?t.quantity.toLocaleString():t.quantity||"-"})}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap text-sm text-gray-700",children:t.unit||"EA"}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap text-right text-sm font-medium text-gray-900",children:u(t.unitPrice)}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap text-right",children:e.jsx("span",{className:"text-sm font-semibold text-blue-600",children:u(t.totalAmount)})}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap text-sm text-gray-700",children:t.notes||"-"})]},r))}),e.jsx("tfoot",{className:"bg-blue-50",children:e.jsxs("tr",{children:[e.jsx("td",{colSpan:8,className:"px-4 py-4 text-right text-sm font-medium text-gray-900",children:"총 발주금액"}),e.jsx("td",{className:"px-4 py-4 text-right",children:e.jsx("span",{className:"text-lg font-bold text-blue-600",children:u(s.totalAmount)})}),e.jsx("td",{})]})})]})})]})}),e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-6 mb-8",children:[e.jsx("div",{children:e.jsx(ue,{orderId:i})}),s.items&&s.items.length>0&&e.jsx("div",{children:e.jsx(ye,{orderItems:s.items,orderId:i})})]}),s.attachments&&s.attachments.length>0&&e.jsx(he,{attachments:s.attachments,orderId:i}),s&&e.jsx(ge,{open:O,onOpenChange:t=>{N(t),t||v(null)},orderData:{orderNumber:s.orderNumber,vendorName:s.vendor?.name||s.vendorName||"",vendorEmail:s.vendor?.email,orderDate:s.orderDate?new Date(s.orderDate).toLocaleDateString():"",totalAmount:s.totalAmount,siteName:s.project?.projectName||s.projectName||"",orderId:s.id},attachments:s.attachments?.map(t=>({id:t.id,originalName:t.originalName,filePath:t.filePath,fileSize:t.fileSize,mimeType:t.mimeType,isSelected:!1})),onSendEmail:T}),s&&e.jsx(je,{orderId:s.id,orderNumber:s.orderNumber,isOpen:I,onClose:()=>A(!1)})]})})}export{Ye as default};
