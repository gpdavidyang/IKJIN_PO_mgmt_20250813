import{r as x,j as e,E as P,w as D,p as B,A as L,D as R,s as z,a as p,B as i,F as f,ae as I,af as U,h as H,ah as _}from"./index-DyuWuW3j.js";import{a as J,b as K,c as Z,D as k,f as q}from"./dialog-hovYlODY.js";import{T as V,a as W,b as F,c as C}from"./tabs-RgCA-uix.js";import{S as G}from"./separator-DyAEMpR8.js";import{P as Q}from"./printer-BaZsaZBJ.js";import{D as T}from"./download-BWUsefu8.js";import{R as S}from"./refresh-cw-BeQ9xfD3.js";const ie=({orderData:s,isOpen:h,onClose:u,trigger:N,onDownload:w})=>{const[r,d]=x.useState({status:"idle"}),[o,y]=x.useState(100),[E,X]=x.useState(1),[A,Y]=x.useState(1),j=async()=>{d({status:"generating",progress:0});try{if(console.log("PDF ìƒì„± ì‹œì‘ - orderData:",s),!s||Object.keys(s).length===0)throw new Error("ë°œì£¼ì„œ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. ë°œì£¼ì„œë¥¼ ë¨¼ì € ìƒì„±í•´ì£¼ì„¸ìš”.");const t=[{message:"ë°œì£¼ì„œ ë°ì´í„° ì¤€ë¹„ ì¤‘...",progress:15},{message:"PDF í…œí”Œë¦¿ ë¡œë”© ì¤‘...",progress:30},{message:"HTML ì½˜í…ì¸  ìƒì„± ì¤‘...",progress:50},{message:"PDF ë³€í™˜ ì¤‘...",progress:75},{message:"ìµœì¢… ê²€ì¦ ì¤‘...",progress:90},{message:"ì™„ë£Œ",progress:100}];for(let n=0;n<t.length-1;n++){const c=t[n];d({status:"generating",progress:c.progress}),await new Promise(g=>setTimeout(g,n===0?300:600))}console.log("ğŸ“„ API í˜¸ì¶œ ì‹œì‘...");const l={orderData:{orderNumber:s.orderNumber||"PO-TEMP-001",projectName:s.projectName||s.project?.name||s.project?.projectName||"í”„ë¡œì íŠ¸ ë¯¸ì§€ì •",vendorName:s.vendorName||s.vendor?.name||"ê±°ë˜ì²˜ ë¯¸ì§€ì •",items:Array.isArray(s.items)?s.items:[],totalAmount:Number(s.totalAmount)||0,notes:s.notes||s.remarks||"",orderDate:s.orderDate||new Date().toISOString(),deliveryDate:s.deliveryDate||s.dueDate||null,createdBy:s.createdBy||s.user?.name||"ì‹œìŠ¤í…œ"},options:{includeWatermark:!0,format:"A4",orientation:"portrait"}};console.log("ğŸ“¤ ì „ì†¡í•  ë°ì´í„°:",JSON.stringify(l,null,2));const a=await fetch("/api/orders/generate-pdf",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},credentials:"include",body:JSON.stringify(l)});if(console.log("ğŸ“¨ ì‘ë‹µ ìƒíƒœ:",a.status,a.statusText),!a.ok){let n=`ì„œë²„ ì˜¤ë¥˜ (${a.status})`;try{const c=await a.json();console.error("ğŸ“¨ ì„œë²„ ì—ëŸ¬ ì‘ë‹µ:",c),n=c.error||c.details||n}catch(c){console.error("ğŸ“¨ ì—ëŸ¬ ì‘ë‹µ íŒŒì‹± ì‹¤íŒ¨:",c);const g=await a.text();console.error("ğŸ“¨ í…ìŠ¤íŠ¸ ì‘ë‹µ:",g)}throw new Error(n)}const m=await a.json();if(console.log("âœ… PDF ìƒì„± ì„±ê³µ ì‘ë‹µ:",m),!m.success)throw new Error(m.error||"PDF ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");if(!m.pdfUrl)throw new Error("PDF URLì´ ì‘ë‹µì— í¬í•¨ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.");d({status:"generating",progress:100}),await new Promise(n=>setTimeout(n,200)),d({status:"ready",url:m.pdfUrl,message:m.message})}catch(t){console.error("âŒ PDF ìƒì„± ì˜¤ë¥˜:",t);let l="PDF ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.";t instanceof Error&&(t.message.includes("fetch")?l="ì„œë²„ì— ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë„¤íŠ¸ì›Œí¬ ìƒíƒœë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.":t.message.includes("timeout")?l="ì²˜ë¦¬ ì‹œê°„ì´ ì´ˆê³¼ë˜ì—ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.":t.message.includes("ë°œì£¼ì„œ ë°ì´í„°")?l=t.message:t.message.includes("puppeteer")||t.message.includes("PDF ìƒì„± ì‹¤íŒ¨")?l="PDF ë³€í™˜ ë„êµ¬ì— ë¬¸ì œê°€ ìˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.":l=t.message),d({status:"error",error:l})}};x.useEffect(()=>{h&&r.status==="idle"&&j()},[h]);const O=()=>{if(r.url&&w)w(r.url);else if(r.url){const t=document.createElement("a");t.href=r.url,t.download=`ë°œì£¼ì„œ_${s?.orderNumber||"unknown"}.pdf`,document.body.appendChild(t),t.click(),document.body.removeChild(t)}},M=()=>{r.url&&window.open(r.url,"_blank")},v=async()=>{try{console.log("ğŸ”„ ëŒ€ì•ˆ PDF ë‹¤ìš´ë¡œë“œ ì‹œì‘...");const t={orderData:{orderNumber:s?.orderNumber||"PO-TEMP-001",projectName:s?.projectName||s?.project?.name||"í”„ë¡œì íŠ¸ ë¯¸ì§€ì •",vendorName:s?.vendorName||s?.vendor?.name||"ê±°ë˜ì²˜ ë¯¸ì§€ì •",items:Array.isArray(s?.items)?s.items:[],totalAmount:Number(s?.totalAmount)||0,notes:s?.notes||s?.remarks||"",orderDate:s?.orderDate||new Date().toISOString(),deliveryDate:s?.deliveryDate||s?.dueDate||null,createdBy:s?.createdBy||s?.user?.name||"ì‹œìŠ¤í…œ"}},l=await fetch("/api/orders/generate-pdf",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(t)});if(l.ok){const a=await l.json();if(a.success&&a.pdfUrl)window.open(`${a.pdfUrl}?download=true`,"_blank");else throw new Error(a.error||"ëŒ€ì•ˆ PDF ìƒì„± ì‹¤íŒ¨")}else throw new Error(`ì„œë²„ ì˜¤ë¥˜ (${l.status})`)}catch(t){console.error("âŒ ëŒ€ì•ˆ PDF ë‹¤ìš´ë¡œë“œ ì˜¤ë¥˜:",t),alert("ëŒ€ì•ˆ PDF ë‹¤ìš´ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë¸Œë¼ìš°ì € ì¸ì‡„ ê¸°ëŠ¥ì„ ì´ìš©í•´ë³´ì„¸ìš”.")}},$=()=>{switch(r.status){case"generating":return e.jsxs("div",{className:"flex flex-col items-center justify-center py-16 space-y-4",children:[e.jsx(_,{className:"w-12 h-12 text-blue-600 animate-spin"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"PDF ìƒì„± ì¤‘..."}),e.jsx("div",{className:"w-80 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${r.progress||0}%`}})}),e.jsxs("p",{className:"text-sm text-gray-600",children:[r.progress||0,"% ì™„ë£Œ"]})]});case"error":return e.jsxs("div",{className:"flex flex-col items-center justify-center py-16 space-y-6",children:[e.jsx(H,{className:"w-16 h-16 text-red-500"}),e.jsxs("div",{className:"text-center space-y-3",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900 dark:text-gray-100",children:"PDF ìƒì„± ì‹¤íŒ¨"}),e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400 max-w-md",children:r.error})]}),e.jsxs("div",{className:"w-full max-w-2xl space-y-4",children:[e.jsxs("div",{className:"p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-blue-900 dark:text-blue-100 mb-2",children:"ğŸ’¡ í•´ê²° ë°©ë²•"}),e.jsxs("ul",{className:"text-sm text-blue-800 dark:text-blue-200 space-y-1",children:[e.jsx("li",{children:"â€¢ ë¸Œë¼ìš°ì €ë¥¼ ìƒˆë¡œê³ ì¹¨í•˜ê³  ë‹¤ì‹œ ì‹œë„í•´ë³´ì„¸ìš”"}),e.jsx("li",{children:"â€¢ ë‹¤ë¥¸ ë¸Œë¼ìš°ì €(Chrome, Firefox ë“±)ë¥¼ ì‚¬ìš©í•´ë³´ì„¸ìš”"}),e.jsx("li",{children:"â€¢ í˜ì´ì§€ë¥¼ ì ì‹œ ê¸°ë‹¤ë¦° í›„ ì¬ì‹œë„í•´ë³´ì„¸ìš”"}),e.jsx("li",{children:"â€¢ ë°œì£¼ì„œ ë°ì´í„°ê°€ ì™„ì „íˆ ë¡œë“œëœ í›„ ì‹œë„í•´ë³´ì„¸ìš”"})]})]}),e.jsxs("div",{className:"p-4 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-green-900 dark:text-green-100 mb-2",children:"âœ¨ ëŒ€ì•ˆ ë°©ë²•"}),e.jsxs("ul",{className:"text-sm text-green-800 dark:text-green-200 space-y-1",children:[e.jsx("li",{children:'â€¢ "ë‹¨ìˆœ PDF ìƒì„±" ë²„íŠ¼ìœ¼ë¡œ ì§ì ‘ ë‹¤ìš´ë¡œë“œ ì‹œë„'}),e.jsx("li",{children:"â€¢ ë°œì£¼ì„œ ìƒì„¸ í˜ì´ì§€ì—ì„œ ì§ì ‘ ë‹¤ìš´ë¡œë“œ"}),e.jsx("li",{children:"â€¢ ë¸Œë¼ìš°ì €ì˜ ì¸ì‡„ ê¸°ëŠ¥(Ctrl+P)ì„ ì´ìš©í•´ PDFë¡œ ì €ì¥"}),e.jsx("li",{children:"â€¢ Excel í˜•íƒœë¡œ ë‚´ë³´ë‚´ê¸° í›„ ìˆ˜ë™ìœ¼ë¡œ PDF ë³€í™˜"})]})]}),!1]}),e.jsxs("div",{className:"flex flex-wrap gap-3 justify-center",children:[e.jsxs(i,{onClick:j,variant:"outline",className:"flex items-center gap-2",children:[e.jsx(S,{className:"w-4 h-4"}),"ë‹¤ì‹œ ì‹œë„"]}),e.jsxs(i,{onClick:()=>window.location.reload(),variant:"secondary",className:"flex items-center gap-2",children:[e.jsx(S,{className:"w-4 h-4"}),"í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨"]}),s?.id&&e.jsxs(i,{onClick:()=>{u&&u(),window.location.href=`/orders/${s.id}`},variant:"secondary",className:"flex items-center gap-2",children:[e.jsx(P,{className:"w-4 h-4"}),"ìƒì„¸ í˜ì´ì§€ë¡œ"]}),e.jsxs(i,{onClick:()=>{s?.id?window.open(`/api/orders/${s.id}/download`,"_blank"):v()},disabled:!s?.orderNumber,className:"flex items-center gap-2",children:[e.jsx(T,{className:"w-4 h-4"}),"ì§ì ‘ ë‹¤ìš´ë¡œë“œ"]}),e.jsxs(i,{onClick:v,variant:"secondary",className:"flex items-center gap-2",children:[e.jsx(f,{className:"w-4 h-4"}),"ë‹¨ìˆœ PDF ìƒì„±"]})]})]});case"ready":return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(i,{variant:"outline",size:"sm",onClick:()=>y(Math.max(50,o-25)),disabled:o<=50,children:e.jsx(I,{className:"w-4 h-4"})}),e.jsxs("span",{className:"text-sm font-medium px-2",children:[o,"%"]}),e.jsx(i,{variant:"outline",size:"sm",onClick:()=>y(Math.min(200,o+25)),disabled:o>=200,children:e.jsx(U,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("span",{className:"text-sm text-gray-600",children:[E," / ",A]}),e.jsxs(i,{variant:"outline",size:"sm",onClick:M,children:[e.jsx(Q,{className:"w-4 h-4 mr-1"}),"ì¸ì‡„"]}),e.jsxs(i,{variant:"outline",size:"sm",onClick:O,children:[e.jsx(T,{className:"w-4 h-4 mr-1"}),"ë‹¤ìš´ë¡œë“œ"]})]})]}),e.jsx("div",{className:"bg-gray-100 rounded-lg p-4 min-h-[600px] flex items-center justify-center",children:r.url?e.jsx("iframe",{src:`${r.url}#view=FitH&zoom=${o}`,className:"w-full h-[600px] border-0 rounded",title:"PDF ë¯¸ë¦¬ë³´ê¸°"}):e.jsxs("div",{className:"text-center py-16",children:[e.jsx(f,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"PDF ë¡œë”© ì¤‘..."})]})})]});default:return e.jsx("div",{className:"flex items-center justify-center py-16",children:e.jsxs(i,{onClick:j,children:[e.jsx(f,{className:"w-4 h-4 mr-2"}),"PDF ë¯¸ë¦¬ë³´ê¸° ì‹œì‘"]})})}},b=e.jsxs(J,{className:"max-w-5xl h-[90vh] overflow-hidden",children:[e.jsx(K,{children:e.jsxs(Z,{className:"flex items-center gap-2",children:[e.jsx(P,{className:"w-5 h-5"}),"PDF ë¯¸ë¦¬ë³´ê¸°",s?.orderNumber&&e.jsx(D,{variant:"outline",children:s.orderNumber})]})}),e.jsxs(V,{defaultValue:"preview",className:"h-full flex flex-col",children:[e.jsxs(W,{className:"grid w-full grid-cols-2",children:[e.jsx(F,{value:"preview",children:"ë¯¸ë¦¬ë³´ê¸°"}),e.jsx(F,{value:"details",children:"ë°œì£¼ì„œ ì •ë³´"})]}),e.jsx(C,{value:"preview",className:"flex-1 overflow-auto",children:$()}),e.jsx(C,{value:"details",className:"flex-1 overflow-auto",children:e.jsxs(B,{children:[e.jsx(L,{children:e.jsx(R,{children:"ë°œì£¼ì„œ ìƒì„¸ ì •ë³´"})}),e.jsxs(z,{className:"space-y-4",children:[s?e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-600",children:"ë°œì£¼ì„œ ë²ˆí˜¸:"}),e.jsx("p",{className:"mt-1",children:s.orderNumber||"PO-TEMP-001"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-600",children:"í”„ë¡œì íŠ¸:"}),e.jsx("p",{className:"mt-1",children:s.projectName||s.project?.name||"í”„ë¡œì íŠ¸ ë¯¸ì§€ì •"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-600",children:"ê±°ë˜ì²˜:"}),e.jsx("p",{className:"mt-1",children:s.vendorName||s.vendor?.name||"ê±°ë˜ì²˜ ë¯¸ì§€ì •"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-600",children:"ì´ ê¸ˆì•¡:"}),e.jsx("p",{className:"mt-1",children:s.totalAmount?`â‚©${s.totalAmount.toLocaleString()}`:"â‚©0"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-600",children:"í’ˆëª© ìˆ˜:"}),e.jsxs("p",{className:"mt-1",children:[s.totalItems||s.items?.length||0,"ê°œ"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-600",children:"ì‘ì„± ë°©ì‹:"}),e.jsx("p",{className:"mt-1",children:s.type==="excel"||s.creationMethod==="excel"?"Excel ì—…ë¡œë“œ":"í‘œì¤€ ì…ë ¥"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-600",children:"ë°œì£¼ì¼ì:"}),e.jsx("p",{className:"mt-1",children:s.orderDate?new Date(s.orderDate).toLocaleDateString("ko-KR"):new Date().toLocaleDateString("ko-KR")})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-600",children:"ë‚©ê¸°ì¼ì:"}),e.jsx("p",{className:"mt-1",children:s.deliveryDate||s.dueDate?new Date(s.deliveryDate||s.dueDate).toLocaleDateString("ko-KR"):"ë¯¸ì§€ì •"})]})]}):e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx("p",{children:"ë°œì£¼ì„œ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤."}),e.jsx("p",{className:"text-sm mt-2",children:"ë°œì£¼ì„œë¥¼ ë¨¼ì € ìƒì„±í•´ì£¼ì„¸ìš”."})]}),e.jsx(G,{}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"PDF ìƒì„± ì˜µì…˜"}),e.jsxs("div",{className:"space-y-2 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(p,{className:"w-4 h-4 text-green-600"}),"ì›Œí„°ë§ˆí¬ í¬í•¨"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(p,{className:"w-4 h-4 text-green-600"}),"A4 í¬ê¸°"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(p,{className:"w-4 h-4 text-green-600"}),"ì„¸ë¡œ ë°©í–¥"]})]})]})]})]})})]})]});return N?e.jsxs(k,{open:h,onOpenChange:u,children:[e.jsx(q,{asChild:!0,children:N}),b]}):e.jsx(k,{open:h,onOpenChange:u,children:b})};export{ie as P};
