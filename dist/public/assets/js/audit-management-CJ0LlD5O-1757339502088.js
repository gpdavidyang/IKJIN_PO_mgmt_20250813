import{n as ss,j as e,w as b,x as E,L as T,N as P,ag as W,o as A,R as U,r as m,B as _,a3 as ts,bk as ke,bl as Ie,F as he,l as je,ad as Ee,bm as ns,ae as De,bc as ge,E as ie,bn as as,bo as rs,ao as is,aI as ls,as as Y,bi as re,bp as cs,ar as le,bq as ds,br as os,bs as Le,an as xs,b6 as ne,O as v,S as pe,z as Ne,A as ve,D as ye,G as M,I as ms,aN as V,T as Fe,d as us,e as hs,q as fe,k as te,s as Pe,a6 as js,a7 as fs,a8 as G,a9 as J,y as gs,m as ps,ab as Ns,aa as vs,H as ys,K as ws}from"./index-BHt0qwks-1757339502088.js";import{T as ce,a as de,b as L,c as y,d as oe,e as f}from"./table-8_TWbBP2-1757339502088.js";import{D as bs,a as Ss,b as Cs,c as Es,d as Ds}from"./dialog-Ccv_HLN2-1757339502088.js";import{U as we}from"./users-CDyJhj0U-1757339502088.js";import{A as Oe}from"./activity-DGQ3i4Ja-1757339502088.js";import{T as ae}from"./triangle-alert-Cak0OEN1-1757339502088.js";import{f as $}from"./format-DNthd0aY-1757339502088.js";import{R as K}from"./refresh-cw-DVZYynIf-1757339502088.js";import{D as Ae}from"./download-CoQkwo9B-1757339502088.js";import{P as Me}from"./package-BjkBv3OQ-1757339502088.js";import{S as As}from"./square-pen-C9nAC1Ev-1757339502088.js";import{U as _e}from"./user-x-BDaC1YdX-1757339502088.js";import{A as Ve}from"./archive-B--hO8Ju-1757339502088.js";import{S as Rs}from"./save-CTNdeaqt-1757339502088.js";import{C as Ts}from"./chevron-left-DkNx-0aI-1757339502088.js";import"./index-Bqg5ZJRK-1757339502088.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ps=ss("Ban",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m4.9 4.9 14.2 14.2",key:"1m5liu"}]]);function Ms({stats:t,loading:n}){return n?e.jsx(b,{children:e.jsx(E,{className:"flex items-center justify-center py-8",children:e.jsx("p",{className:"text-muted-foreground",children:"대시보드를 불러오는 중..."})})}):t?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs(b,{children:[e.jsxs(T,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(P,{className:"text-sm font-medium",children:"활성 사용자"}),e.jsx(we,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(E,{children:[e.jsx("div",{className:"text-2xl font-bold",children:t.activeUserCount||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"지난 24시간"})]})]}),e.jsxs(b,{children:[e.jsxs(T,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(P,{className:"text-sm font-medium",children:"총 이벤트"}),e.jsx(Oe,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(E,{children:[e.jsx("div",{className:"text-2xl font-bold",children:t.eventStats?.reduce((a,i)=>a+i.count,0)||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"지난 24시간"})]})]}),e.jsxs(b,{children:[e.jsxs(T,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(P,{className:"text-sm font-medium",children:"보안 이벤트"}),e.jsx(W,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(E,{children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:t.securityEvents?.length||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"경고 및 실패"})]})]}),e.jsxs(b,{children:[e.jsxs(T,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(P,{className:"text-sm font-medium",children:"에러"}),e.jsx(ae,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(E,{children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:t.recentErrors?.length||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"최근 오류"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs(b,{children:[e.jsx(T,{children:e.jsx(P,{className:"text-sm",children:"이벤트 유형별 분포"})}),e.jsx(E,{children:e.jsx("div",{className:"space-y-2",children:t.eventStats?.slice(0,5).map(a=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(A,{variant:"outline",className:"text-xs",children:a.eventType})}),e.jsx("span",{className:"text-sm font-medium",children:a.count})]},a.eventType))})})]}),e.jsxs(b,{children:[e.jsx(T,{children:e.jsx(P,{className:"text-sm",children:"카테고리별 활동"})}),e.jsx(E,{children:e.jsx("div",{className:"space-y-2",children:t.categoryStats?.map(a=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm capitalize",children:a.category}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-24 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full",style:{width:`${a.count/Math.max(...t.categoryStats.map(i=>i.count))*100}%`}})}),e.jsx("span",{className:"text-sm font-medium w-10 text-right",children:a.count})]})]},a.category))})})]})]}),t.securityEvents&&t.securityEvents.length>0&&e.jsxs(b,{children:[e.jsx(T,{children:e.jsx(P,{className:"text-sm",children:"최근 보안 이벤트"})}),e.jsx(E,{children:e.jsx("div",{className:"space-y-2",children:t.securityEvents.slice(0,5).map(a=>e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(W,{className:"h-4 w-4 text-orange-500"}),e.jsx("span",{children:a.action})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-muted-foreground",children:a.userName||"Unknown"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:$(new Date(a.createdAt),"HH:mm",{locale:U})})]})]},a.id))})})]}),t.recentErrors&&t.recentErrors.length>0&&e.jsxs(b,{children:[e.jsx(T,{children:e.jsx(P,{className:"text-sm",children:"최근 에러"})}),e.jsx(E,{children:e.jsx("div",{className:"space-y-2",children:t.recentErrors.slice(0,5).map(a=>e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"h-4 w-4 text-red-500"}),e.jsx("span",{className:"font-medium",children:a.action})]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:$(new Date(a.createdAt),"HH:mm",{locale:U})})]}),a.errorMessage&&e.jsx("p",{className:"text-xs text-muted-foreground pl-6",children:a.errorMessage})]},a.id))})})]})]}):e.jsx(b,{children:e.jsx(E,{className:"flex items-center justify-center py-8",children:e.jsx("p",{className:"text-muted-foreground",children:"데이터가 없습니다."})})})}function _s({filters:t}){const[n,a]=m.useState([]),[i,o]=m.useState(!0);m.useEffect(()=>{u()},[t]);const u=async()=>{try{o(!0);const d=new URLSearchParams({eventCategory:"auth",...t}),w=await fetch(`/api/audit/logs?${d}`,{credentials:"include"});if(w.ok){const p=await w.json();a(p.logs||[])}}catch(d){console.error("Failed to fetch login history:",d)}finally{o(!1)}},x=d=>{switch(d){case"login":return e.jsx(Ie,{className:"h-4 w-4 text-green-500"});case"logout":return e.jsx(ke,{className:"h-4 w-4 text-blue-500"});case"login_failed":return e.jsx(ae,{className:"h-4 w-4 text-red-500"});case"password_change":return e.jsx(W,{className:"h-4 w-4 text-orange-500"});default:return e.jsx(ts,{className:"h-4 w-4 text-gray-500"})}},j=d=>{switch(d){case"login":return e.jsx(A,{className:"bg-green-100 text-green-800",children:"로그인"});case"logout":return e.jsx(A,{className:"bg-blue-100 text-blue-800",children:"로그아웃"});case"login_failed":return e.jsx(A,{className:"bg-red-100 text-red-800",children:"로그인 실패"});case"password_change":return e.jsx(A,{className:"bg-orange-100 text-orange-800",children:"비밀번호 변경"});default:return e.jsx(A,{variant:"outline",children:d})}};return i?e.jsx(b,{children:e.jsxs(E,{className:"flex items-center justify-center py-8",children:[e.jsx(K,{className:"h-6 w-6 animate-spin text-muted-foreground"}),e.jsx("span",{className:"ml-2 text-muted-foreground",children:"로그인 기록을 불러오는 중..."})]})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-lg font-medium",children:"로그인 기록"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(_,{size:"sm",variant:"outline",onClick:u,children:[e.jsx(K,{className:"h-4 w-4 mr-1"}),"새로고침"]}),e.jsxs(_,{size:"sm",variant:"outline",children:[e.jsx(Ae,{className:"h-4 w-4 mr-1"}),"다운로드"]})]})]}),e.jsx(b,{children:e.jsxs(ce,{children:[e.jsx(de,{children:e.jsxs(L,{children:[e.jsx(y,{children:"시간"}),e.jsx(y,{children:"이벤트"}),e.jsx(y,{children:"사용자"}),e.jsx(y,{children:"역할"}),e.jsx(y,{children:"IP 주소"}),e.jsx(y,{children:"브라우저"}),e.jsx(y,{children:"상태"})]})}),e.jsx(oe,{children:n.length===0?e.jsx(L,{children:e.jsx(f,{colSpan:7,className:"text-center text-muted-foreground",children:"로그인 기록이 없습니다"})}):n.map(d=>e.jsxs(L,{children:[e.jsx(f,{className:"text-sm",children:$(new Date(d.createdAt),"MM/dd HH:mm:ss",{locale:U})}),e.jsx(f,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[x(d.eventType),j(d.eventType)]})}),e.jsx(f,{className:"text-sm",children:d.userName||"Unknown"}),e.jsx(f,{className:"text-sm",children:e.jsx(A,{variant:"outline",children:d.userRole||"N/A"})}),e.jsx(f,{className:"text-sm text-muted-foreground",children:d.ipAddress||"N/A"}),e.jsx(f,{className:"text-sm text-muted-foreground",children:d.userAgent?d.userAgent.substring(0,30)+"...":"N/A"}),e.jsx(f,{children:d.eventType==="login"?e.jsx(A,{className:"bg-green-100 text-green-800",children:"성공"}):d.eventType==="login_failed"?e.jsx(A,{className:"bg-red-100 text-red-800",children:"실패"}):e.jsx(A,{variant:"outline",children:"N/A"})})]},d.id))})]})})]})}function ks({filters:t}){const[n,a]=m.useState([]),[i,o]=m.useState(!0);m.useEffect(()=>{u()},[t]);const u=async()=>{try{o(!0);const s=new URLSearchParams({eventCategory:"data",...t}),r=await fetch(`/api/audit/logs?${s}`,{credentials:"include"});if(r.ok){const l=await r.json();a(l.logs||[])}}catch(s){console.error("Failed to fetch data changes:",s)}finally{o(!1)}},x=(s,r)=>({purchase_orders:e.jsx(he,{className:"h-4 w-4 text-blue-500"}),vendors:e.jsx(je,{className:"h-4 w-4 text-green-500"}),items:e.jsx(Me,{className:"h-4 w-4 text-purple-500"}),users:e.jsx(we,{className:"h-4 w-4 text-orange-500"}),projects:e.jsx(je,{className:"h-4 w-4 text-teal-500"}),companies:e.jsx(je,{className:"h-4 w-4 text-indigo-500"}),approvals:e.jsx(he,{className:"h-4 w-4 text-amber-500"}),templates:e.jsx(As,{className:"h-4 w-4 text-pink-500"}),item_categories:e.jsx(Me,{className:"h-4 w-4 text-violet-500"}),positions:e.jsx(we,{className:"h-4 w-4 text-cyan-500"})})[s||r]||e.jsx(he,{className:"h-4 w-4 text-gray-500"}),j=(s,r)=>{const l={purchase_orders:"발주서",purchase_order:"발주서",vendors:"거래처",vendor:"거래처",items:"품목",item:"품목",users:"사용자",user:"사용자",projects:"프로젝트",project:"프로젝트",companies:"회사",company:"회사",approvals:"승인",approval:"승인",templates:"템플릿",template:"템플릿",item_categories:"품목분류",category:"품목분류",positions:"직급",position:"직급"};return l[s]||l[r]||s||r||"알 수 없음"},d=s=>s.includes("생성")||s.includes("추가")?e.jsx(A,{className:"bg-green-100 text-green-800",children:"생성"}):s.includes("수정")||s.includes("업데이트")?e.jsx(A,{className:"bg-blue-100 text-blue-800",children:"수정"}):s.includes("삭제")?e.jsx(A,{className:"bg-red-100 text-red-800",children:"삭제"}):s.includes("승인")?e.jsx(A,{className:"bg-purple-100 text-purple-800",children:"승인"}):e.jsx(A,{variant:"outline",children:"변경"}),w={orderStatus:"발주상태",approvalStatus:"승인상태",orderNumber:"발주번호",totalAmount:"총금액",projectId:"프로젝트",vendorId:"거래처",deliveryDate:"납기일",notes:"비고",priority:"우선순위",name:"명칭",businessNumber:"사업자번호",contactPerson:"담당자",phone:"연락처",email:"이메일",address:"주소",businessType:"업종",code:"품목코드",category:"분류",unit:"단위",price:"단가",description:"설명",isActive:"사용여부",username:"사용자명",role:"권한",department:"부서",position:"직급",createdAt:"생성일시",updatedAt:"수정일시",status:"상태"},p=(s,r)=>{if(r==null)return"N/A";if(s.includes("Amount")||s==="price")return typeof r=="number"?`${r.toLocaleString()}원`:r;if(s.includes("Date")||s.includes("At"))try{return new Date(r).toLocaleDateString("ko-KR")}catch{return r}return typeof r=="boolean"?r?"예":"아니오":String(r)},h=(s,r)=>{if(!s&&!r)return null;try{const l=s?typeof s=="string"?JSON.parse(s):s:{},S=r?typeof r=="string"?JSON.parse(r):r:{},g=[];return new Set([...Object.keys(l),...Object.keys(S)]).forEach(C=>{if(l[C]!==S[C]&&!C.includes("Id")&&C!=="id"&&C!=="createdAt"&&C!=="updatedAt"){const R=w[C]||C,D=p(C,l[C]),F=p(C,S[C]);D!==F&&g.push(`${R}: ${D} → ${F}`)}}),g.length>0?e.jsxs("div",{className:"text-xs text-muted-foreground space-y-1",children:[g.slice(0,3).map((C,R)=>e.jsx("div",{className:"truncate",children:C},R)),g.length>3&&e.jsxs("div",{className:"text-xs text-muted-foreground/70",children:["... 외 ",g.length-3,"개 항목"]})]}):e.jsx("div",{className:"text-xs text-muted-foreground",children:"변경 내용 없음"})}catch(l){return console.error("Error parsing change data:",l),e.jsx("div",{className:"text-xs text-red-500",children:"변경 내용 파싱 오류"})}};return i?e.jsx(b,{children:e.jsxs(E,{className:"flex items-center justify-center py-8",children:[e.jsx(K,{className:"h-6 w-6 animate-spin text-muted-foreground"}),e.jsx("span",{className:"ml-2 text-muted-foreground",children:"데이터 변경 기록을 불러오는 중..."})]})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-lg font-medium",children:"데이터 변경 기록"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(_,{size:"sm",variant:"outline",onClick:u,children:[e.jsx(K,{className:"h-4 w-4 mr-1"}),"새로고침"]}),e.jsxs(_,{size:"sm",variant:"outline",children:[e.jsx(Ae,{className:"h-4 w-4 mr-1"}),"다운로드"]})]})]}),e.jsx(b,{children:e.jsxs(ce,{children:[e.jsx(de,{children:e.jsxs(L,{children:[e.jsx(y,{children:"시간"}),e.jsx(y,{children:"대상"}),e.jsx(y,{children:"작업"}),e.jsx(y,{children:"사용자"}),e.jsx(y,{children:"변경 내용"}),e.jsx(y,{children:"IP 주소"})]})}),e.jsx(oe,{children:n.length===0?e.jsx(L,{children:e.jsx(f,{colSpan:6,className:"text-center text-muted-foreground",children:"데이터 변경 기록이 없습니다"})}):n.map(s=>e.jsxs(L,{children:[e.jsx(f,{className:"text-sm",children:$(new Date(s.createdAt),"MM/dd HH:mm",{locale:U})}),e.jsx(f,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[x(s.tableName,s.entityType),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm font-medium",children:j(s.tableName,s.entityType)}),s.entityId&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:["ID: ",s.entityId]})]})]})}),e.jsx(f,{children:e.jsxs("div",{className:"flex flex-col gap-1",children:[d(s.action),s.action&&e.jsx("span",{className:"text-xs text-muted-foreground max-w-[200px] truncate",title:s.action,children:s.action})]})}),e.jsx(f,{className:"text-sm",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium",children:s.userName||"System"}),s.userRole&&e.jsx("span",{className:"text-xs text-muted-foreground",children:s.userRole})]})}),e.jsx(f,{className:"max-w-[250px]",children:h(s.oldData,s.newData)}),e.jsx(f,{className:"text-sm text-muted-foreground",children:s.ipAddress||"N/A"})]},s.id))})]})})]})}function Is({filters:t}){const[n,a]=m.useState([]),[i,o]=m.useState(!0),[u,x]=m.useState([]);m.useEffect(()=>{j(),d()},[t]);const j=async()=>{try{o(!0);const s=new URLSearchParams({eventCategory:"security",...t}),r=await fetch(`/api/audit/logs?${s}`,{credentials:"include"});if(r.ok){const l=await r.json();a(l.logs||[])}}catch(s){console.error("Failed to fetch security events:",s)}finally{o(!1)}},d=async()=>{try{const s=await fetch("/api/audit/alert-rules",{credentials:"include"});if(s.ok){const r=await s.json();x(r||[])}}catch(s){console.error("Failed to fetch alert rules:",s)}},w=s=>{switch(s){case"critical":return e.jsx(A,{className:"bg-red-600 text-white",children:"긴급"});case"high":return e.jsx(A,{className:"bg-orange-500 text-white",children:"높음"});case"medium":return e.jsx(A,{className:"bg-yellow-500 text-white",children:"중간"});case"low":return e.jsx(A,{className:"bg-green-500 text-white",children:"낮음"});default:return e.jsx(A,{variant:"outline",children:"정보"})}},p=s=>({unauthorized_access:e.jsx(Ps,{className:"h-4 w-4 text-red-500"}),login_failed:e.jsx(_e,{className:"h-4 w-4 text-orange-500"}),permission_denied:e.jsx(ge,{className:"h-4 w-4 text-red-500"}),suspicious_activity:e.jsx(ie,{className:"h-4 w-4 text-yellow-500"}),password_reset:e.jsx(as,{className:"h-4 w-4 text-blue-500"})})[s]||e.jsx(W,{className:"h-4 w-4 text-gray-500"}),h=n.filter(s=>s.action?.includes("실패")||s.action?.includes("차단")||s.action?.includes("거부"));return i?e.jsx(b,{children:e.jsxs(E,{className:"flex items-center justify-center py-8",children:[e.jsx(K,{className:"h-6 w-6 animate-spin text-muted-foreground"}),e.jsx("span",{className:"ml-2 text-muted-foreground",children:"보안 이벤트를 불러오는 중..."})]})}):e.jsxs("div",{className:"space-y-4",children:[h.length>0&&e.jsxs(Ee,{className:"border-red-200 bg-red-50",children:[e.jsx(ae,{className:"h-4 w-4 text-red-600"}),e.jsx(ns,{className:"text-red-800",children:"보안 경고"}),e.jsxs(De,{className:"text-red-700",children:["최근 24시간 동안 ",h.length,"건의 보안 이벤트가 감지되었습니다."]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs(b,{children:[e.jsxs(T,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(P,{className:"text-sm font-medium",children:"실패한 로그인"}),e.jsx(_e,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(E,{children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:n.filter(s=>s.eventType==="login_failed").length}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"지난 24시간"})]})]}),e.jsxs(b,{children:[e.jsxs(T,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(P,{className:"text-sm font-medium",children:"권한 거부"}),e.jsx(ge,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(E,{children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:n.filter(s=>s.action?.includes("권한")).length}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"지난 24시간"})]})]}),e.jsxs(b,{children:[e.jsxs(T,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(P,{className:"text-sm font-medium",children:"의심스러운 활동"}),e.jsx(ie,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(E,{children:[e.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:n.filter(s=>s.action?.includes("의심")).length}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"지난 24시간"})]})]}),e.jsxs(b,{children:[e.jsxs(T,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(P,{className:"text-sm font-medium",children:"활성 경고 규칙"}),e.jsx(W,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(E,{children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:u.filter(s=>s.isActive).length}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["전체 ",u.length,"개"]})]})]})]}),e.jsxs(b,{children:[e.jsx(T,{children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(P,{children:"보안 이벤트 상세"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(_,{size:"sm",variant:"outline",onClick:j,children:[e.jsx(K,{className:"h-4 w-4 mr-1"}),"새로고침"]}),e.jsxs(_,{size:"sm",variant:"outline",children:[e.jsx(Ae,{className:"h-4 w-4 mr-1"}),"다운로드"]})]})]})}),e.jsx(E,{children:e.jsxs(ce,{children:[e.jsx(de,{children:e.jsxs(L,{children:[e.jsx(y,{children:"시간"}),e.jsx(y,{children:"이벤트"}),e.jsx(y,{children:"심각도"}),e.jsx(y,{children:"사용자"}),e.jsx(y,{children:"상세 내용"}),e.jsx(y,{children:"IP 주소"}),e.jsx(y,{children:"조치"})]})}),e.jsx(oe,{children:n.length===0?e.jsx(L,{children:e.jsx(f,{colSpan:7,className:"text-center text-muted-foreground",children:"보안 이벤트가 없습니다"})}):n.map(s=>e.jsxs(L,{children:[e.jsx(f,{className:"text-sm",children:$(new Date(s.createdAt),"MM/dd HH:mm",{locale:U})}),e.jsx(f,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[p(s.eventType),e.jsx("span",{className:"text-sm",children:s.eventType})]})}),e.jsx(f,{children:w(s.action?.includes("실패")?"high":s.action?.includes("거부")?"medium":"low")}),e.jsx(f,{className:"text-sm",children:s.userName||"Unknown"}),e.jsxs(f,{className:"text-sm",children:[s.action,s.errorMessage&&e.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:s.errorMessage})]}),e.jsx(f,{className:"text-sm text-muted-foreground",children:s.ipAddress||"N/A"}),e.jsx(f,{children:e.jsx(_,{size:"sm",variant:"ghost",children:e.jsx(ie,{className:"h-4 w-4"})})})]},s.id))})]})})]})]})}var Ke=["PageUp","PageDown"],Be=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],ze={"from-left":["Home","PageDown","ArrowDown","ArrowLeft"],"from-right":["Home","PageDown","ArrowDown","ArrowRight"],"from-bottom":["Home","PageDown","ArrowDown","ArrowLeft"],"from-top":["Home","PageDown","ArrowUp","ArrowLeft"]},X="Slider",[be,Ls,Fs]=rs(X),[He,gt]=is(X,[Fs]),[Os,xe]=He(X),Ue=m.forwardRef((t,n)=>{const{name:a,min:i=0,max:o=100,step:u=1,orientation:x="horizontal",disabled:j=!1,minStepsBetweenThumbs:d=0,defaultValue:w=[i],value:p,onValueChange:h=()=>{},onValueCommit:s=()=>{},inverted:r=!1,form:l,...S}=t,g=m.useRef(new Set),N=m.useRef(0),R=x==="horizontal"?Vs:Ks,[D=[],F]=ls({prop:p,defaultProp:w,onChange:k=>{[...g.current][N.current]?.focus(),h(k)}}),Q=m.useRef(D);function Z(k){const I=$s(D,k);B(k,I)}function me(k){B(k,N.current)}function ue(){const k=Q.current[N.current];D[N.current]!==k&&s(D)}function B(k,I,{commit:c}={commit:!1}){const ee=Ys(u),O=Ws(Math.round((k-i)/u)*u+i,ee),se=Le(O,[i,o]);F((q=[])=>{const z=Hs(q,se,I);if(Js(z,d*u)){N.current=z.indexOf(se);const Te=String(z)!==String(q);return Te&&c&&s(z),Te?z:q}else return q})}return e.jsx(Os,{scope:t.__scopeSlider,name:a,disabled:j,min:i,max:o,valueIndexToChangeRef:N,thumbs:g.current,values:D,orientation:x,form:l,children:e.jsx(be.Provider,{scope:t.__scopeSlider,children:e.jsx(be.Slot,{scope:t.__scopeSlider,children:e.jsx(R,{"aria-disabled":j,"data-disabled":j?"":void 0,...S,ref:n,onPointerDown:Y(S.onPointerDown,()=>{j||(Q.current=D)}),min:i,max:o,inverted:r,onSlideStart:j?void 0:Z,onSlideMove:j?void 0:me,onSlideEnd:j?void 0:ue,onHomeKeyDown:()=>!j&&B(i,0,{commit:!0}),onEndKeyDown:()=>!j&&B(o,D.length-1,{commit:!0}),onStepKeyDown:({event:k,direction:I})=>{if(!j){const O=Ke.includes(k.key)||k.shiftKey&&Be.includes(k.key)?10:1,se=N.current,q=D[se],z=u*O*I;B(q+z,se,{commit:!0})}}})})})})});Ue.displayName=X;var[$e,qe]=He(X,{startEdge:"left",endEdge:"right",size:"width",direction:1}),Vs=m.forwardRef((t,n)=>{const{min:a,max:i,dir:o,inverted:u,onSlideStart:x,onSlideMove:j,onSlideEnd:d,onStepKeyDown:w,...p}=t,[h,s]=m.useState(null),r=re(n,R=>s(R)),l=m.useRef(void 0),S=cs(o),g=S==="ltr",N=g&&!u||!g&&u;function C(R){const D=l.current||h.getBoundingClientRect(),F=[0,D.width],Z=Re(F,N?[a,i]:[i,a]);return l.current=D,Z(R-D.left)}return e.jsx($e,{scope:t.__scopeSlider,startEdge:N?"left":"right",endEdge:N?"right":"left",direction:N?1:-1,size:"width",children:e.jsx(Ge,{dir:S,"data-orientation":"horizontal",...p,ref:r,style:{...p.style,"--radix-slider-thumb-transform":"translateX(-50%)"},onSlideStart:R=>{const D=C(R.clientX);x?.(D)},onSlideMove:R=>{const D=C(R.clientX);j?.(D)},onSlideEnd:()=>{l.current=void 0,d?.()},onStepKeyDown:R=>{const F=ze[N?"from-left":"from-right"].includes(R.key);w?.({event:R,direction:F?-1:1})}})})}),Ks=m.forwardRef((t,n)=>{const{min:a,max:i,inverted:o,onSlideStart:u,onSlideMove:x,onSlideEnd:j,onStepKeyDown:d,...w}=t,p=m.useRef(null),h=re(n,p),s=m.useRef(void 0),r=!o;function l(S){const g=s.current||p.current.getBoundingClientRect(),N=[0,g.height],R=Re(N,r?[i,a]:[a,i]);return s.current=g,R(S-g.top)}return e.jsx($e,{scope:t.__scopeSlider,startEdge:r?"bottom":"top",endEdge:r?"top":"bottom",size:"height",direction:r?1:-1,children:e.jsx(Ge,{"data-orientation":"vertical",...w,ref:h,style:{...w.style,"--radix-slider-thumb-transform":"translateY(50%)"},onSlideStart:S=>{const g=l(S.clientY);u?.(g)},onSlideMove:S=>{const g=l(S.clientY);x?.(g)},onSlideEnd:()=>{s.current=void 0,j?.()},onStepKeyDown:S=>{const N=ze[r?"from-bottom":"from-top"].includes(S.key);d?.({event:S,direction:N?-1:1})}})})}),Ge=m.forwardRef((t,n)=>{const{__scopeSlider:a,onSlideStart:i,onSlideMove:o,onSlideEnd:u,onHomeKeyDown:x,onEndKeyDown:j,onStepKeyDown:d,...w}=t,p=xe(X,a);return e.jsx(le.span,{...w,ref:n,onKeyDown:Y(t.onKeyDown,h=>{h.key==="Home"?(x(h),h.preventDefault()):h.key==="End"?(j(h),h.preventDefault()):Ke.concat(Be).includes(h.key)&&(d(h),h.preventDefault())}),onPointerDown:Y(t.onPointerDown,h=>{const s=h.target;s.setPointerCapture(h.pointerId),h.preventDefault(),p.thumbs.has(s)?s.focus():i(h)}),onPointerMove:Y(t.onPointerMove,h=>{h.target.hasPointerCapture(h.pointerId)&&o(h)}),onPointerUp:Y(t.onPointerUp,h=>{const s=h.target;s.hasPointerCapture(h.pointerId)&&(s.releasePointerCapture(h.pointerId),u(h))})})}),Je="SliderTrack",Ye=m.forwardRef((t,n)=>{const{__scopeSlider:a,...i}=t,o=xe(Je,a);return e.jsx(le.span,{"data-disabled":o.disabled?"":void 0,"data-orientation":o.orientation,...i,ref:n})});Ye.displayName=Je;var Se="SliderRange",We=m.forwardRef((t,n)=>{const{__scopeSlider:a,...i}=t,o=xe(Se,a),u=qe(Se,a),x=m.useRef(null),j=re(n,x),d=o.values.length,w=o.values.map(s=>Qe(s,o.min,o.max)),p=d>1?Math.min(...w):0,h=100-Math.max(...w);return e.jsx(le.span,{"data-orientation":o.orientation,"data-disabled":o.disabled?"":void 0,...i,ref:j,style:{...t.style,[u.startEdge]:p+"%",[u.endEdge]:h+"%"}})});We.displayName=Se;var Ce="SliderThumb",Xe=m.forwardRef((t,n)=>{const a=Ls(t.__scopeSlider),[i,o]=m.useState(null),u=re(n,j=>o(j)),x=m.useMemo(()=>i?a().findIndex(j=>j.ref.current===i):-1,[a,i]);return e.jsx(Bs,{...t,ref:u,index:x})}),Bs=m.forwardRef((t,n)=>{const{__scopeSlider:a,index:i,name:o,...u}=t,x=xe(Ce,a),j=qe(Ce,a),[d,w]=m.useState(null),p=re(n,C=>w(C)),h=d?x.form||!!d.closest("form"):!0,s=ds(d),r=x.values[i],l=r===void 0?0:Qe(r,x.min,x.max),S=Us(i,x.values.length),g=s?.[j.size],N=g?qs(g,l,j.direction):0;return m.useEffect(()=>{if(d)return x.thumbs.add(d),()=>{x.thumbs.delete(d)}},[d,x.thumbs]),e.jsxs("span",{style:{transform:"var(--radix-slider-thumb-transform)",position:"absolute",[j.startEdge]:`calc(${l}% + ${N}px)`},children:[e.jsx(be.ItemSlot,{scope:t.__scopeSlider,children:e.jsx(le.span,{role:"slider","aria-label":t["aria-label"]||S,"aria-valuemin":x.min,"aria-valuenow":r,"aria-valuemax":x.max,"aria-orientation":x.orientation,"data-orientation":x.orientation,"data-disabled":x.disabled?"":void 0,tabIndex:x.disabled?void 0:0,...u,ref:p,style:r===void 0?{display:"none"}:t.style,onFocus:Y(t.onFocus,()=>{x.valueIndexToChangeRef.current=i})})}),h&&e.jsx(zs,{name:o??(x.name?x.name+(x.values.length>1?"[]":""):void 0),form:x.form,value:r},i)]})});Xe.displayName=Ce;var zs=t=>{const{value:n,...a}=t,i=m.useRef(null),o=os(n);return m.useEffect(()=>{const u=i.current,x=window.HTMLInputElement.prototype,d=Object.getOwnPropertyDescriptor(x,"value").set;if(o!==n&&d){const w=new Event("input",{bubbles:!0});d.call(u,n),u.dispatchEvent(w)}},[o,n]),e.jsx("input",{style:{display:"none"},...a,ref:i,defaultValue:n})};function Hs(t=[],n,a){const i=[...t];return i[a]=n,i.sort((o,u)=>o-u)}function Qe(t,n,a){const u=100/(a-n)*(t-n);return Le(u,[0,100])}function Us(t,n){return n>2?`Value ${t+1} of ${n}`:n===2?["Minimum","Maximum"][t]:void 0}function $s(t,n){if(t.length===1)return 0;const a=t.map(o=>Math.abs(o-n)),i=Math.min(...a);return a.indexOf(i)}function qs(t,n,a){const i=t/2,u=Re([0,50],[0,i]);return(i-u(n)*a)*a}function Gs(t){return t.slice(0,-1).map((n,a)=>t[a+1]-n)}function Js(t,n){if(n>0){const a=Gs(t);return Math.min(...a)>=n}return!0}function Re(t,n){return a=>{if(t[0]===t[1]||n[0]===n[1])return n[0];const i=(n[1]-n[0])/(t[1]-t[0]);return n[0]+i*(a-t[0])}}function Ys(t){return(String(t).split(".")[1]||"").length}function Ws(t,n){const a=Math.pow(10,n);return Math.round(t*a)/a}var Ze=Ue,Xs=Ye,Qs=We,Zs=Xe;const es=m.forwardRef(({className:t,...n},a)=>e.jsxs(Ze,{ref:a,className:xs("relative flex w-full touch-none select-none items-center",t),...n,children:[e.jsx(Xs,{className:"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary",children:e.jsx(Qs,{className:"absolute h-full bg-primary"})}),e.jsx(Zs,{className:"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50"})]}));es.displayName=Ze.displayName;const H={success:t=>console.log("✅ SUCCESS:",t),error:t=>console.log("❌ ERROR:",t)};function et({onSettingsChange:t}){const[n,a]=m.useState({logLevel:"INFO",enableAuth:!0,enableData:!0,enableSystem:!0,enableSecurity:!0,retentionDays:30,archiveEnabled:!0,maxLogSize:1e6,autoCleanup:!0,alertsEnabled:!0,emailNotifications:!1,realTimeMonitoring:!1}),[i,o]=m.useState(!1),[u,x]=m.useState(!1);m.useEffect(()=>{j()},[]);const j=async()=>{try{o(!0);const s=await fetch("/api/audit/settings",{credentials:"include"});if(s.ok){const r=await s.json();a(l=>({...l,...r}))}}catch(s){console.error("Failed to fetch settings:",s),H.error("설정을 불러올 수 없습니다")}finally{o(!1)}},d=async()=>{try{if(x(!0),(await fetch("/api/audit/settings",{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(n)})).ok)H.success("설정이 저장되었습니다"),t?.();else throw new Error("Failed to save settings")}catch(s){console.error("Failed to save settings:",s),H.error("설정 저장에 실패했습니다")}finally{x(!1)}},w=async()=>{if(confirm("30일 이전의 로그를 아카이브하시겠습니까?"))try{const s=await fetch("/api/audit/archive",{method:"POST",credentials:"include"});if(s.ok){const r=await s.json();H.success(`${r.archived}개의 로그가 아카이브되었습니다`)}else throw new Error("Archive failed")}catch(s){console.error("Archive failed:",s),H.error("아카이브에 실패했습니다")}},p=async()=>{if(confirm("오래된 로그를 정리하시겠습니까? 이 작업은 되돌릴 수 없습니다."))try{const s=await fetch("/api/audit/cleanup",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({days:n.retentionDays})});if(s.ok){const r=await s.json();H.success(`${r.deleted}개의 로그가 정리되었습니다`)}else throw new Error("Cleanup failed")}catch(s){console.error("Cleanup failed:",s),H.error("정리 작업에 실패했습니다")}},h={OFF:"로그를 기록하지 않습니다",ERROR:"오류만 기록합니다",WARNING:"경고 및 오류를 기록합니다",INFO:"일반 정보, 경고, 오류를 기록합니다",DEBUG:"모든 상세 정보를 기록합니다"};return i?e.jsx(b,{children:e.jsxs(E,{className:"flex items-center justify-center py-8",children:[e.jsx(K,{className:"h-6 w-6 animate-spin text-muted-foreground"}),e.jsx("span",{className:"ml-2 text-muted-foreground",children:"설정을 불러오는 중..."})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs(b,{children:[e.jsxs(T,{children:[e.jsx(P,{children:"로그 레벨 설정"}),e.jsx(ne,{children:"시스템 로그 기록 수준을 설정합니다"})]}),e.jsxs(E,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"log-level",children:"전역 로그 레벨"}),e.jsxs(pe,{value:n.logLevel,onValueChange:s=>a(r=>({...r,logLevel:s})),children:[e.jsx(Ne,{id:"log-level",children:e.jsx(ve,{})}),e.jsxs(ye,{children:[e.jsx(M,{value:"OFF",children:"OFF - 로그 없음"}),e.jsx(M,{value:"ERROR",children:"ERROR - 오류만"}),e.jsx(M,{value:"WARNING",children:"WARNING - 경고 이상"}),e.jsx(M,{value:"INFO",children:"INFO - 일반 정보 이상"}),e.jsx(M,{value:"DEBUG",children:"DEBUG - 모든 정보"})]})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:h[n.logLevel]})]}),e.jsxs(Ee,{children:[e.jsx(ms,{className:"h-4 w-4"}),e.jsx(De,{children:"DEBUG 레벨은 시스템 성능에 영향을 줄 수 있으므로 개발 환경에서만 사용을 권장합니다."})]})]})]}),e.jsxs(b,{children:[e.jsxs(T,{children:[e.jsx(P,{children:"카테고리별 설정"}),e.jsx(ne,{children:"각 카테고리의 로그 기록 여부를 설정합니다"})]}),e.jsxs(E,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(v,{htmlFor:"auth-logs",children:"인증 로그"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"로그인, 로그아웃, 권한 관련"})]}),e.jsx(V,{id:"auth-logs",checked:n.enableAuth,onCheckedChange:s=>a(r=>({...r,enableAuth:s}))})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(v,{htmlFor:"data-logs",children:"데이터 변경 로그"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"생성, 수정, 삭제 작업"})]}),e.jsx(V,{id:"data-logs",checked:n.enableData,onCheckedChange:s=>a(r=>({...r,enableData:s}))})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(v,{htmlFor:"system-logs",children:"시스템 로그"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"시스템 이벤트, 오류, 성능"})]}),e.jsx(V,{id:"system-logs",checked:n.enableSystem,onCheckedChange:s=>a(r=>({...r,enableSystem:s}))})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(v,{htmlFor:"security-logs",children:"보안 로그"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"보안 이벤트, 접근 시도"})]}),e.jsx(V,{id:"security-logs",checked:n.enableSecurity,onCheckedChange:s=>a(r=>({...r,enableSecurity:s}))})]})]})]}),e.jsxs(b,{children:[e.jsxs(T,{children:[e.jsx(P,{children:"저장소 설정"}),e.jsx(ne,{children:"로그 보관 및 정리 정책을 설정합니다"})]}),e.jsxs(E,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"retention",children:"로그 보관 기간"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(es,{id:"retention",min:7,max:365,step:1,value:[n.retentionDays],onValueChange:([s])=>a(r=>({...r,retentionDays:s})),className:"flex-1"}),e.jsxs("span",{className:"w-20 text-sm font-medium",children:[n.retentionDays,"일"]})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[n.retentionDays,"일 이후의 로그는 자동으로 삭제됩니다"]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(v,{htmlFor:"archive",children:"자동 아카이브"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"오래된 로그를 자동으로 아카이브"})]}),e.jsx(V,{id:"archive",checked:n.archiveEnabled,onCheckedChange:s=>a(r=>({...r,archiveEnabled:s}))})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(v,{htmlFor:"cleanup",children:"자동 정리"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"보관 기간이 지난 로그 자동 삭제"})]}),e.jsx(V,{id:"cleanup",checked:n.autoCleanup,onCheckedChange:s=>a(r=>({...r,autoCleanup:s}))})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(_,{variant:"outline",onClick:w,children:[e.jsx(Ve,{className:"h-4 w-4 mr-2"}),"수동 아카이브"]}),e.jsxs(_,{variant:"outline",onClick:p,children:[e.jsx(Fe,{className:"h-4 w-4 mr-2"}),"수동 정리"]})]})]})]}),e.jsxs(b,{children:[e.jsxs(T,{children:[e.jsx(P,{children:"알림 설정"}),e.jsx(ne,{children:"보안 이벤트 및 시스템 알림을 설정합니다"})]}),e.jsxs(E,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(v,{htmlFor:"alerts",children:"보안 알림"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"중요 보안 이벤트 발생 시 알림"})]}),e.jsx(V,{id:"alerts",checked:n.alertsEnabled,onCheckedChange:s=>a(r=>({...r,alertsEnabled:s}))})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(v,{htmlFor:"email",children:"이메일 알림"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"중요 이벤트를 이메일로 전송"})]}),e.jsx(V,{id:"email",checked:n.emailNotifications,onCheckedChange:s=>a(r=>({...r,emailNotifications:s}))})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(v,{htmlFor:"realtime",children:"실시간 모니터링"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"실시간으로 로그를 모니터링"})]}),e.jsx(V,{id:"realtime",checked:n.realTimeMonitoring,onCheckedChange:s=>a(r=>({...r,realTimeMonitoring:s}))})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsxs(_,{variant:"outline",onClick:j,disabled:u,children:[e.jsx(K,{className:"h-4 w-4 mr-2"}),"초기화"]}),e.jsxs(_,{onClick:d,disabled:u,children:[e.jsx(Rs,{className:"h-4 w-4 mr-2"}),u?"저장 중...":"설정 저장"]})]})]})}function pt(){const{user:t}=us(),{toast:n}=hs(),[a,i]=m.useState("dashboard"),[o,u]=m.useState(""),[x,j]=m.useState("all"),[d,w]=m.useState("all"),[p,h]=m.useState({start:"",end:""}),[s,r]=m.useState(1),[l,S]=m.useState(null),g=50,{data:N,isLoading:C,refetch:R}=fe({queryKey:["audit-logs",s,x,d,p,o],queryFn:async()=>{const c=new URLSearchParams({limit:String(g),offset:String((s-1)*g),sortOrder:"desc"});return x!=="all"&&c.append("eventType",x),d!=="all"&&c.append("eventCategory",d),p.start&&c.append("startDate",p.start),p.end&&c.append("endDate",p.end),o&&c.append("search",o),te(`/api/audit/logs?${c}`,{method:"GET"})},enabled:t?.role==="admin"}),{data:D,isLoading:F}=fe({queryKey:["audit-settings"],queryFn:()=>te("/api/audit/settings",{method:"GET"}),enabled:t?.role==="admin"}),{data:Q,isLoading:Z}=fe({queryKey:["audit-dashboard"],queryFn:()=>te("/api/audit/dashboard?hours=24",{method:"GET"}),enabled:t?.role==="admin"&&a==="dashboard",refetchInterval:6e4}),me=Pe({mutationFn:c=>te("/api/audit/settings",{method:"PUT",body:JSON.stringify(c)}),onSuccess:()=>{n({title:"설정 업데이트",description:"감사 설정이 성공적으로 업데이트되었습니다."}),ws.invalidateQueries({queryKey:["audit-settings"]})},onError:c=>{n({title:"오류",description:c.message||"설정 업데이트에 실패했습니다.",variant:"destructive"})}}),ue=Pe({mutationFn:c=>te("/api/audit/archive",{method:"POST",body:JSON.stringify({beforeDate:c})}),onSuccess:c=>{n({title:"아카이빙 완료",description:`${c.archived}개의 로그가 아카이빙되었습니다.`}),R()},onError:c=>{n({title:"오류",description:c.message||"아카이빙에 실패했습니다.",variant:"destructive"})}}),B=c=>({login:"bg-green-500",logout:"bg-blue-500",login_failed:"bg-red-500",data_create:"bg-purple-500",data_update:"bg-yellow-500",data_delete:"bg-red-600",permission_change:"bg-orange-500",security_alert:"bg-red-700",error:"bg-red-800"})[c]||"bg-gray-500",k=c=>{switch(c){case"login":return e.jsx(Ie,{className:"h-4 w-4"});case"logout":return e.jsx(ke,{className:"h-4 w-4"});case"login_failed":return e.jsx(ys,{className:"h-4 w-4"});case"permission_change":return e.jsx(ge,{className:"h-4 w-4"});case"data_delete":return e.jsx(Fe,{className:"h-4 w-4"});case"security_alert":return e.jsx(W,{className:"h-4 w-4"});default:return e.jsx(Oe,{className:"h-4 w-4"})}};if(t?.role!=="admin"&&t?.role!=="executive"&&t?.role!=="hq_management")return e.jsx("div",{className:"container mx-auto p-6",children:e.jsxs(Ee,{children:[e.jsx(ae,{className:"h-4 w-4"}),e.jsx(De,{children:"이 페이지에 접근할 권한이 없습니다."})]})});const I=N?Math.ceil(N.total/g):1;return e.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"로그 관리"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"시스템 활동 로그 및 보안 이벤트 모니터링"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(_,{variant:"outline",size:"sm",onClick:()=>R(),disabled:C,children:[e.jsx(K,{className:"h-4 w-4 mr-2"}),"새로고침"]}),t?.role==="admin"&&e.jsxs(_,{variant:"outline",size:"sm",onClick:()=>{const c=new Date;c.setDate(c.getDate()-30),confirm("30일 이전 로그를 아카이빙하시겠습니까?")&&ue.mutate(c.toISOString())},children:[e.jsx(Ve,{className:"h-4 w-4 mr-2"}),"아카이빙"]})]})]}),e.jsxs(js,{value:a,onValueChange:i,children:[e.jsxs(fs,{className:"grid grid-cols-6 w-full",children:[e.jsx(G,{value:"dashboard",children:"대시보드"}),e.jsx(G,{value:"logs",children:"활동 로그"}),e.jsx(G,{value:"login",children:"로그인 기록"}),e.jsx(G,{value:"changes",children:"데이터 변경"}),e.jsx(G,{value:"security",children:"보안 이벤트"}),t?.role==="admin"&&e.jsx(G,{value:"settings",children:"설정"})]}),e.jsx(J,{value:"dashboard",children:e.jsx(Ms,{stats:Q,loading:Z})}),e.jsx(J,{value:"logs",className:"space-y-4",children:e.jsxs(b,{children:[e.jsxs(T,{children:[e.jsx(P,{children:"시스템 활동 로그"}),e.jsx(ne,{children:"모든 시스템 활동 및 사용자 작업 기록"})]}),e.jsxs(E,{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-4 flex-wrap",children:[e.jsx("div",{className:"flex-1 min-w-[200px]",children:e.jsx(gs,{placeholder:"검색 (사용자, 작업, IP 등)...",value:o,onChange:c=>u(c.target.value),className:"w-full"})}),e.jsxs(pe,{value:x,onValueChange:j,children:[e.jsx(Ne,{className:"w-[180px]",children:e.jsx(ve,{placeholder:"이벤트 유형"})}),e.jsxs(ye,{children:[e.jsx(M,{value:"all",children:"모든 이벤트"}),e.jsx(M,{value:"login",children:"로그인"}),e.jsx(M,{value:"logout",children:"로그아웃"}),e.jsx(M,{value:"data_create",children:"생성"}),e.jsx(M,{value:"data_update",children:"수정"}),e.jsx(M,{value:"data_delete",children:"삭제"}),e.jsx(M,{value:"security_alert",children:"보안 경고"})]})]}),e.jsxs(pe,{value:d,onValueChange:w,children:[e.jsx(Ne,{className:"w-[180px]",children:e.jsx(ve,{placeholder:"카테고리"})}),e.jsxs(ye,{children:[e.jsx(M,{value:"all",children:"모든 카테고리"}),e.jsx(M,{value:"auth",children:"인증"}),e.jsx(M,{value:"data",children:"데이터"}),e.jsx(M,{value:"system",children:"시스템"}),e.jsx(M,{value:"security",children:"보안"})]})]})]}),e.jsx("div",{className:"rounded-md border",children:e.jsxs(ce,{children:[e.jsx(de,{children:e.jsxs(L,{children:[e.jsx(y,{children:"시간"}),e.jsx(y,{children:"이벤트"}),e.jsx(y,{children:"사용자"}),e.jsx(y,{children:"작업"}),e.jsx(y,{children:"IP 주소"}),e.jsx(y,{children:"상태"}),e.jsx(y,{className:"w-[100px]",children:"상세"})]})}),e.jsx(oe,{children:C?e.jsx(L,{children:e.jsx(f,{colSpan:7,className:"text-center py-8",children:"로딩 중..."})}):N?.logs?.length===0?e.jsx(L,{children:e.jsx(f,{colSpan:7,className:"text-center py-8 text-muted-foreground",children:"로그가 없습니다."})}):N?.logs?.map(c=>e.jsxs(L,{children:[e.jsx(f,{className:"text-sm",children:$(new Date(c.createdAt),"PPp",{locale:U})}),e.jsx(f,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[k(c.eventType),e.jsx(A,{className:`${B(c.eventType)} text-white`,children:c.eventType})]})}),e.jsx(f,{children:e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"font-medium",children:c.userName||"System"}),c.userRole&&e.jsx("div",{className:"text-muted-foreground text-xs",children:c.userRole})]})}),e.jsx(f,{className:"max-w-[300px] truncate",children:c.action}),e.jsx(f,{className:"text-sm text-muted-foreground",children:c.ipAddress||"-"}),e.jsx(f,{children:c.responseStatus&&e.jsx(A,{variant:c.responseStatus>=400?"destructive":"default",children:c.responseStatus})}),e.jsx(f,{children:e.jsx(_,{variant:"ghost",size:"sm",onClick:()=>S(c),children:e.jsx(ie,{className:"h-4 w-4"})})})]},c.id))})]})}),I>1&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:["총 ",N?.total||0,"개 중 ",(s-1)*g+1,"-",Math.min(s*g,N?.total||0),"개 표시"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(_,{variant:"outline",size:"sm",onClick:()=>r(c=>Math.max(1,c-1)),disabled:s===1,children:[e.jsx(Ts,{className:"h-4 w-4"}),"이전"]}),e.jsx("div",{className:"flex items-center gap-1",children:Array.from({length:Math.min(5,I)},(c,ee)=>{const O=s-2+ee;return O>0&&O<=I?e.jsx(_,{variant:O===s?"default":"outline",size:"sm",onClick:()=>r(O),children:O},O):null})}),e.jsxs(_,{variant:"outline",size:"sm",onClick:()=>r(c=>Math.min(I,c+1)),disabled:s===I,children:["다음",e.jsx(ps,{className:"h-4 w-4"})]})]})]})]})]})}),e.jsx(J,{value:"login",children:e.jsx(_s,{userId:t?.role==="admin"?void 0:t?.id})}),e.jsx(J,{value:"changes",children:e.jsx(ks,{})}),e.jsx(J,{value:"security",children:e.jsx(Is,{})}),t?.role==="admin"&&e.jsx(J,{value:"settings",children:e.jsx(et,{settings:D,onUpdate:c=>me.mutate(c),loading:F})})]}),e.jsx(bs,{open:!!l,onOpenChange:c=>!c&&S(null),children:e.jsxs(Ss,{className:"max-w-3xl max-h-[80vh]",children:[e.jsxs(Cs,{children:[e.jsx(Es,{children:"로그 상세 정보"}),e.jsx(Ds,{children:l&&$(new Date(l.createdAt),"PPpp",{locale:U})})]}),e.jsx(Ns,{className:"h-[500px] pr-4",children:l&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(v,{className:"text-muted-foreground",children:"이벤트 유형"}),e.jsx("p",{className:"font-medium",children:l.eventType})]}),e.jsxs("div",{children:[e.jsx(v,{className:"text-muted-foreground",children:"카테고리"}),e.jsx("p",{className:"font-medium",children:l.eventCategory})]}),e.jsxs("div",{children:[e.jsx(v,{className:"text-muted-foreground",children:"사용자"}),e.jsx("p",{className:"font-medium",children:l.userName||"System"})]}),e.jsxs("div",{children:[e.jsx(v,{className:"text-muted-foreground",children:"역할"}),e.jsx("p",{className:"font-medium",children:l.userRole||"-"})]}),e.jsxs("div",{children:[e.jsx(v,{className:"text-muted-foreground",children:"IP 주소"}),e.jsx("p",{className:"font-medium",children:l.ipAddress||"-"})]}),e.jsxs("div",{children:[e.jsx(v,{className:"text-muted-foreground",children:"세션 ID"}),e.jsx("p",{className:"font-medium text-xs",children:l.sessionId||"-"})]})]}),e.jsx(vs,{}),e.jsxs("div",{children:[e.jsx(v,{className:"text-muted-foreground",children:"작업"}),e.jsx("p",{className:"font-medium",children:l.action})]}),l.requestPath&&e.jsxs("div",{children:[e.jsx(v,{className:"text-muted-foreground",children:"요청 경로"}),e.jsxs("p",{className:"font-medium",children:[l.requestMethod," ",l.requestPath]})]}),l.entityType&&e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(v,{className:"text-muted-foreground",children:"엔티티 유형"}),e.jsx("p",{className:"font-medium",children:l.entityType})]}),e.jsxs("div",{children:[e.jsx(v,{className:"text-muted-foreground",children:"엔티티 ID"}),e.jsx("p",{className:"font-medium",children:l.entityId})]})]}),l.details&&e.jsxs("div",{children:[e.jsx(v,{className:"text-muted-foreground",children:"추가 정보"}),e.jsx("pre",{className:"mt-2 p-3 bg-muted rounded-md text-sm overflow-x-auto",children:JSON.stringify(l.details,null,2)})]}),l.oldValue&&e.jsxs("div",{children:[e.jsx(v,{className:"text-muted-foreground",children:"이전 값"}),e.jsx("pre",{className:"mt-2 p-3 bg-muted rounded-md text-sm overflow-x-auto",children:JSON.stringify(l.oldValue,null,2)})]}),l.newValue&&e.jsxs("div",{children:[e.jsx(v,{className:"text-muted-foreground",children:"새 값"}),e.jsx("pre",{className:"mt-2 p-3 bg-muted rounded-md text-sm overflow-x-auto",children:JSON.stringify(l.newValue,null,2)})]}),l.errorMessage&&e.jsxs("div",{children:[e.jsx(v,{className:"text-muted-foreground text-red-500",children:"에러 메시지"}),e.jsx("p",{className:"mt-2 p-3 bg-red-50 rounded-md text-sm",children:l.errorMessage})]}),l.executionTime&&e.jsxs("div",{children:[e.jsx(v,{className:"text-muted-foreground",children:"실행 시간"}),e.jsxs("p",{className:"font-medium",children:[l.executionTime,"ms"]})]}),l.userAgent&&e.jsxs("div",{children:[e.jsx(v,{className:"text-muted-foreground",children:"User Agent"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:l.userAgent})]})]})})]})})]})}export{pt as default};
