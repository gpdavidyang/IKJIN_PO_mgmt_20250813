import{q as v,k as w,j as s,a5 as b,a6 as C,a7 as i,a8 as A,w as d,a as x,a3 as M,M as c,c as m,a9 as T,aa as B,B as D,o as H,R as E,b as S}from"./index-GjFQBII2-1757333712922.js";import{D as k,a as $,b as q,c as R,d as z}from"./dialog-CQkP5LA1-1757333712922.js";import{R as h}from"./refresh-cw-22U_W9a1-1757333712922.js";import{f as o}from"./format-zMvmHgOJ-1757333712922.js";import{P as L}from"./paperclip-0c_PJbHH-1757333712922.js";function F(r){return v({queryKey:["/api/email-history/orders",r,"email-history"],queryFn:()=>w("GET",`/api/email-history/orders/${r}/email-history`),enabled:!!r,staleTime:30*1e3})}function Q({orderId:r,orderNumber:j,isOpen:p,onClose:g,onResend:l}){const{data:t,isLoading:y}=F(r),N=e=>{switch(e){case"sent":return s.jsx(S,{className:"h-4 w-4"});case"pending":return s.jsx(x,{className:"h-4 w-4"});case"failed":return s.jsx(m,{className:"h-4 w-4"});default:return s.jsx(c,{className:"h-4 w-4"})}},u=e=>{const a={sent:{variant:"default",label:"발송완료"},pending:{variant:"secondary",label:"발송대기"},failed:{variant:"destructive",label:"발송실패"}}[e]||{variant:"secondary",label:e||"알 수 없음"};return s.jsxs(H,{variant:a.variant,children:[N(e),s.jsx("span",{className:"ml-1",children:a.label})]})};return s.jsx(k,{open:p,onOpenChange:g,children:s.jsxs($,{className:"max-w-4xl max-h-[90vh]",children:[s.jsxs(q,{children:[s.jsx(R,{children:"이메일 발송 이력"}),s.jsxs(z,{children:["발주서 ",j,"의 이메일 발송 내역입니다."]})]}),y?s.jsx("div",{className:"flex items-center justify-center py-8",children:s.jsx(h,{className:"h-6 w-6 animate-spin text-gray-400"})}):t&&t.length>0?s.jsxs(b,{defaultValue:"0",className:"w-full",children:[s.jsxs(C,{className:"grid w-full",style:{gridTemplateColumns:`repeat(${Math.min(t.length,5)}, 1fr)`},children:[t.slice(0,5).map((e,n)=>s.jsx(i,{value:n.toString(),children:e.sentAt?o(new Date(e.sentAt),"MM/dd HH:mm"):`#${n+1}`},e.id)),t.length>5&&s.jsxs(i,{value:"more",disabled:!0,children:["+",t.length-5," more"]})]}),t.map((e,n)=>s.jsxs(A,{value:n.toString(),className:"space-y-4",children:[s.jsxs(d,{className:"p-4",children:[s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[s.jsx(x,{className:"h-4 w-4 text-gray-500"}),s.jsx("span",{className:"text-gray-600",children:"발송 시간:"}),s.jsx("span",{className:"font-medium",children:e.sentAt?o(new Date(e.sentAt),"yyyy년 MM월 dd일 HH:mm:ss",{locale:E}):"대기 중"})]}),s.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[s.jsx(M,{className:"h-4 w-4 text-gray-500"}),s.jsx("span",{className:"text-gray-600",children:"발송자:"}),s.jsxs("span",{className:"font-medium",children:[e.sentByName||"시스템",e.sentByEmail&&`(${e.sentByEmail})`]})]}),s.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[s.jsx(c,{className:"h-4 w-4 text-gray-500"}),s.jsx("span",{className:"text-gray-600",children:"수신자:"}),s.jsx("span",{className:"font-medium",children:Array.isArray(e.recipients)?e.recipients.join(", "):typeof e.recipients=="string"?e.recipients:"N/A"})]}),e.cc&&e.cc.length>0&&s.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[s.jsx(c,{className:"h-4 w-4 text-gray-500"}),s.jsx("span",{className:"text-gray-600",children:"참조:"}),s.jsx("span",{className:"font-medium",children:Array.isArray(e.cc)?e.cc.join(", "):e.cc})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:"text-sm text-gray-600",children:"상태:"}),u(e.status)]}),e.errorMessage&&s.jsxs("div",{className:"flex items-start gap-2 text-sm",children:[s.jsx(m,{className:"h-4 w-4 text-red-500 mt-0.5"}),s.jsxs("div",{children:[s.jsx("span",{className:"text-gray-600",children:"오류 메시지:"}),s.jsx("p",{className:"text-red-600 text-xs mt-1",children:e.errorMessage})]})]})]})]}),e.attachments&&Array.isArray(e.attachments)&&e.attachments.length>0&&s.jsxs("div",{className:"mt-4 pt-4 border-t",children:[s.jsxs("div",{className:"flex items-center gap-2 text-sm mb-2",children:[s.jsx(L,{className:"h-4 w-4 text-gray-500"}),s.jsx("span",{className:"text-gray-600",children:"첨부 파일:"})]}),s.jsx("div",{className:"space-y-1",children:e.attachments.map((a,f)=>s.jsxs("div",{className:"text-sm text-gray-700",children:[typeof a=="string"?a:a.filename||a.name||"첨부파일",a.size&&` (${(a.size/1024/1024).toFixed(2)} MB)`]},f))})]})]}),s.jsxs(d,{className:"p-4",children:[s.jsx("h4",{className:"font-medium mb-2",children:"제목"}),s.jsx("p",{className:"text-sm text-gray-700 mb-4",children:e.subject}),s.jsx(T,{}),s.jsx("h4",{className:"font-medium mt-4 mb-2",children:"내용"}),s.jsx(B,{className:"h-[300px] w-full rounded-md border p-4",children:s.jsx("div",{className:"prose prose-sm max-w-none",dangerouslySetInnerHTML:{__html:e.body}})})]}),l&&e.status==="failed"&&s.jsx("div",{className:"flex justify-end",children:s.jsxs(D,{variant:"outline",size:"sm",onClick:()=>l(e.id),children:[s.jsx(h,{className:"h-4 w-4 mr-2"}),"재발송"]})})]},e.id))]}):s.jsxs("div",{className:"text-center py-8",children:[s.jsx(c,{className:"h-12 w-12 text-gray-300 mx-auto mb-3"}),s.jsx("p",{className:"text-gray-500",children:"이메일 발송 이력이 없습니다."})]})]})})}export{Q as E};
