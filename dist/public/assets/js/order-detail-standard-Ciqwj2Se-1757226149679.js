import{n as oe,r as v,q as $,j as e,w as i,x,$ as Q,a0 as T,L as ce,a1 as _,a2 as we,a3 as m,a4 as o,a5 as U,o as C,F as D,f as g,a as Ce,c as V,a6 as ae,a7 as te,B as c,H as ke,_ as G,a8 as he,e as je,g as Se,s as J,R as Pe,V as De,W as B,Z as Ae,X as E,a9 as S,l as re,U as pe,M as qe,E as le,b as xe,d as Fe,u as Me,K as Te,N as _e,O as ze,k as Y,J as K}from"./index-Dtjc1GsS-1757226149679.js";import{D as L,a as O,b as R,c as H,d as I,e as ee}from"./dialog-DgPtIFAK-1757226149679.js";import{P as $e}from"./progress-rhLglOlZ-1757226149679.js";import{D as Be}from"./dollar-sign-p-TBgGss-1757226149679.js";import{C as Ee}from"./calendar-CswiPgDN-1757226149679.js";import{C as Ke}from"./circle-check-CBtpvVid-1757226149679.js";import{f as z}from"./format-DakPARGR-1757226149679.js";import{T as de}from"./textarea-CcylfWLE-1757226149679.js";import{P as Le}from"./phone-But5V43J-1757226149679.js";import{M as Ne}from"./map-pin-oz-Kf17V-1757226149679.js";import{P as Oe}from"./paperclip-DfGSd6RA-1757226149679.js";import{D as ue}from"./download-CG1hI9p--1757226149679.js";import{H as Re}from"./history-BwVGCRri-1757226149679.js";import{P as me}from"./package-CuxU_FjZ-1757226149679.js";import{S as He}from"./send-2LkdBQZ6-1757226149679.js";import{S as Qe}from"./square-pen-FfsuNmyb-1757226149679.js";import{P as Ue}from"./printer-Bk7Pm5AQ-1757226149679.js";import{E as Ve}from"./external-link-xjrNzV8S-1757226149679.js";import"./index-LwJ1bs9n-1757226149679.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ge=oe("FileCheck",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"m9 15 2 2 4-4",key:"1grp1n"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Je=oe("SkipForward",[["polygon",{points:"5 4 15 12 5 20 5 4",key:"16p6eg"}],["line",{x1:"19",x2:"19",y1:"5",y2:"19",key:"futhcm"}]]),se={admin:"관리자",executive:"임원",hq_management:"본사 관리",project_manager:"프로젝트 매니저",field_worker:"현장 작업자"},We={admin:"bg-purple-100 text-purple-700 border-purple-200",executive:"bg-red-100 text-red-700 border-red-200",hq_management:"bg-blue-100 text-blue-700 border-blue-200",project_manager:"bg-green-100 text-green-700 border-green-200",field_worker:"bg-gray-100 text-gray-700 border-gray-200"};function ge({orderId:p,onApprove:y,onReject:d,showActions:M=!1,className:k=""}){const[n,h]=v.useState(null),{data:l,isLoading:A,error:P,refetch:q}=$({queryKey:["approval-progress",p],queryFn:async()=>{const s=await fetch(`/api/approvals/${p}/progress`,{credentials:"include"});if(!s.ok)throw new Error("Failed to fetch approval progress");return s.json()},refetchInterval:3e4}),f=s=>{switch(s.status){case"approved":return e.jsx(Ke,{className:"h-5 w-5 text-green-600"});case"rejected":return e.jsx(V,{className:"h-5 w-5 text-red-600"});case"in_progress":return e.jsx(Q,{className:"h-5 w-5 text-blue-600 animate-spin"});case"skipped":return e.jsx(Je,{className:"h-5 w-5 text-gray-400"});default:return e.jsx(ke,{className:"h-5 w-5 text-gray-300"})}},j=s=>{const r={pending:{label:"대기",variant:"outline",className:"border-gray-300"},in_progress:{label:"진행중",variant:"default",className:"bg-blue-500"},approved:{label:"승인",variant:"default",className:"bg-green-500"},rejected:{label:"반려",variant:"destructive",className:""},skipped:{label:"건너뜀",variant:"secondary",className:""}}[s];return e.jsx(C,{variant:r.variant,className:r.className,children:r.label})},t=s=>{if(!s)return"-";const u=new Date(s);return z(u,"yyyy-MM-dd HH:mm",{locale:G})},b=s=>s?he(new Date(s),{addSuffix:!0,locale:G}):"";if(A)return e.jsx(i,{className:k,children:e.jsx(x,{className:"flex items-center justify-center py-8",children:e.jsx(Q,{className:"h-8 w-8 animate-spin text-gray-400"})})});if(P||!l)return e.jsx(i,{className:k,children:e.jsx(x,{className:"py-8",children:e.jsxs(T,{variant:"destructive",children:[e.jsx(ce,{className:"h-4 w-4"}),e.jsx(_,{children:"승인 진행 상황을 불러올 수 없습니다."})]})})});const F=l.steps.find(s=>s.status==="in_progress"),N=l.steps.some(s=>s.status==="rejected");return e.jsx(we,{children:e.jsxs(i,{className:k,children:[e.jsx(m,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(o,{className:"flex items-center gap-2",children:[e.jsx(U,{className:"h-5 w-5 text-blue-600"}),"승인 진행 상황"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[l.approvalMode==="staged"&&e.jsx(C,{variant:"outline",className:"bg-blue-50",children:"단계별 승인"}),e.jsxs(C,{variant:"outline",children:[l.currentStep,"/",l.totalSteps," 단계"]})]})]})}),e.jsxs(x,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"진행률"}),e.jsxs("span",{className:"font-medium",children:[l.progressPercentage,"%"]})]}),e.jsx($e,{value:l.progressPercentage,className:"h-2"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(D,{className:"h-4 w-4 text-gray-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"발주번호"}),e.jsx("p",{className:"text-sm font-medium",children:l.orderNumber})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Be,{className:"h-4 w-4 text-gray-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"총 금액"}),e.jsx("p",{className:"text-sm font-medium text-blue-600",children:g(l.totalAmount)})]})]})]}),F&&!N&&e.jsxs(T,{className:"bg-blue-50 border-blue-200",children:[e.jsx(Ce,{className:"h-4 w-4 text-blue-600"}),e.jsxs(_,{className:"text-blue-800",children:[e.jsx("strong",{children:se[F.requiredRole]})," 승인 대기 중",l.nextApprover&&e.jsxs("span",{className:"block mt-1 text-sm",children:["담당자: ",l.nextApprover.name," (",l.nextApprover.email,")"]})]})]}),N&&e.jsxs(T,{variant:"destructive",children:[e.jsx(V,{className:"h-4 w-4"}),e.jsx(_,{children:"승인이 반려되었습니다. 반려 사유를 확인하고 재신청해주세요."})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700",children:"승인 단계"}),e.jsx("div",{className:"relative",children:l.steps.map((s,u)=>e.jsxs("div",{className:"relative",children:[u>0&&e.jsx("div",{className:`absolute left-5 top-0 w-0.5 h-full -translate-y-full ${l.steps[u-1].status==="approved"?"bg-green-300":l.steps[u-1].status==="rejected"?"bg-red-300":"bg-gray-200"}`}),e.jsxs("div",{className:`flex items-start gap-3 p-3 rounded-lg transition-colors cursor-pointer ${n?.id===s.id?"bg-blue-50 border border-blue-200":"hover:bg-gray-50"}`,onClick:()=>h(s),children:[e.jsx("div",{className:"flex-shrink-0 mt-0.5",children:f(s)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsxs("span",{className:"text-sm font-medium",children:[s.stepOrder,"단계: ",se[s.requiredRole]]}),j(s.status),s.isOptional&&e.jsx(C,{variant:"outline",className:"text-xs",children:"선택"})]}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-gray-500",children:[e.jsxs("span",{children:["승인 한도: ",g(s.minAmount),s.maxAmount&&` ~ ${g(s.maxAmount)}`]}),s.canSkip&&e.jsx("span",{className:"text-blue-600",children:"건너뛸 수 있음"})]}),s.approverName&&e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx(ae,{className:"h-6 w-6",children:e.jsx(te,{className:"text-xs",children:s.approverName[0]})}),e.jsx("span",{className:"text-xs text-gray-600",children:s.approverName}),s.approvedAt&&e.jsxs("span",{className:"text-xs text-gray-400",children:["• ",b(s.approvedAt)]})]}),s.note&&e.jsx("div",{className:"mt-2 p-2 bg-gray-50 rounded text-xs text-gray-600",children:s.note})]}),M&&s.status==="in_progress"&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx(c,{size:"sm",variant:"outline",className:"text-green-600",onClick:r=>{r.stopPropagation(),y?.(s.id)},children:"승인"}),e.jsx(c,{size:"sm",variant:"outline",className:"text-red-600",onClick:r=>{r.stopPropagation(),d?.(s.id)},children:"반려"})]})]})]},s.id))})]}),l.estimatedCompletionTime&&!N&&e.jsx("div",{className:"p-3 bg-gray-50 rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(Ee,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"text-gray-600",children:"예상 완료 시간:"}),e.jsx("span",{className:"font-medium",children:t(l.estimatedCompletionTime)})]})}),n&&e.jsxs("div",{className:"mt-4 p-4 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsx("h5",{className:"text-sm font-medium text-blue-900 mb-2",children:"상세 정보"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-blue-700",children:"역할:"}),e.jsx(C,{className:We[n.requiredRole],children:se[n.requiredRole]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-blue-700",children:"상태:"}),e.jsx("span",{children:j(n.status)})]}),n.approverName&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-blue-700",children:"승인자:"}),e.jsx("span",{children:n.approverName})]}),n.approvedAt&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-blue-700",children:"승인 시간:"}),e.jsx("span",{children:t(n.approvedAt)})]}),n.rejectedAt&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-blue-700",children:"반려 시간:"}),e.jsx("span",{children:t(n.rejectedAt)})]})]})]})]})]})})}function Xe({isOpen:p,onClose:y,orderId:d,orderNumber:M,canApprove:k=!1}){const{toast:n}=je(),h=Se(),[l,A]=v.useState("overview"),[P,q]=v.useState(""),[f,j]=v.useState(""),[t,b]=v.useState(!1),[F,N]=v.useState(!1),{data:s,isLoading:u}=$({queryKey:["order-detail",d],queryFn:async()=>{const a=await fetch(`/api/orders/${d}`,{credentials:"include"});if(!a.ok)throw new Error("Failed to fetch order details");return a.json()},enabled:p}),{data:r,isLoading:W}=$({queryKey:["approval-history",d],queryFn:async()=>{const a=await fetch(`/api/approvals/${d}/history`,{credentials:"include"});if(!a.ok)throw new Error("Failed to fetch approval history");return a.json()},enabled:p}),X=J({mutationFn:async()=>{const a=await fetch(`/api/approvals/${d}/approve`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({note:P})});if(!a.ok)throw new Error("Failed to approve order");return a.json()},onSuccess:()=>{n({title:"승인 완료",description:"발주서가 승인되었습니다."}),h.invalidateQueries({queryKey:["approval-progress",d]}),h.invalidateQueries({queryKey:["approval-history",d]}),b(!1),q("")},onError:a=>{n({title:"승인 실패",description:a.message,variant:"destructive"})}}),Z=J({mutationFn:async()=>{const a=await fetch(`/api/approvals/${d}/reject`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({note:f})});if(!a.ok)throw new Error("Failed to reject order");return a.json()},onSuccess:()=>{n({title:"반려 완료",description:"발주서가 반려되었습니다."}),h.invalidateQueries({queryKey:["approval-progress",d]}),h.invalidateQueries({queryKey:["approval-history",d]}),N(!1),j("")},onError:a=>{n({title:"반려 실패",description:a.message,variant:"destructive"})}}),ne=a=>z(new Date(a),"yyyy-MM-dd HH:mm",{locale:G}),ye=a=>{if(a===0)return"0 Bytes";const w=1024,be=["Bytes","KB","MB","GB"],ie=Math.floor(Math.log(a)/Math.log(w));return Math.round(a/Math.pow(w,ie)*100)/100+" "+be[ie]},ve=a=>{switch(a){case"created":return e.jsx(D,{className:"h-4 w-4 text-blue-600"});case"approved":return e.jsx(xe,{className:"h-4 w-4 text-green-600"});case"rejected":return e.jsx(V,{className:"h-4 w-4 text-red-600"});case"updated":return e.jsx(Ge,{className:"h-4 w-4 text-yellow-600"});default:return e.jsx(Re,{className:"h-4 w-4 text-gray-600"})}},fe=a=>({created:"발주서 생성",approved:"승인",rejected:"반려",updated:"수정",sent:"발송"})[a]||a;return e.jsxs(e.Fragment,{children:[e.jsx(L,{open:p,onOpenChange:y,children:e.jsxs(O,{className:"max-w-5xl max-h-[90vh] overflow-hidden",children:[e.jsxs(R,{children:[e.jsxs(H,{className:"flex items-center gap-2",children:[e.jsx(U,{className:"h-5 w-5 text-blue-600"}),"발주서 상세 정보 - ",M]}),e.jsx(I,{children:"발주서의 상세 내용과 승인 진행 상황을 확인할 수 있습니다."})]}),e.jsxs(Pe,{value:l,onValueChange:A,className:"flex-1",children:[e.jsxs(De,{className:"grid w-full grid-cols-4",children:[e.jsx(B,{value:"overview",children:"개요"}),e.jsx(B,{value:"progress",children:"승인 진행"}),e.jsx(B,{value:"history",children:"이력"}),e.jsx(B,{value:"attachments",children:"첨부파일"})]}),e.jsxs(Ae,{className:"h-[calc(90vh-200px)] mt-4",children:[e.jsx(E,{value:"overview",className:"space-y-4",children:u?e.jsx("div",{className:"text-center py-8",children:"로딩 중..."}):s?e.jsxs(e.Fragment,{children:[e.jsxs(i,{children:[e.jsx(m,{children:e.jsx(o,{className:"text-sm",children:"발주 정보"})}),e.jsx(x,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(S,{className:"text-xs text-gray-500",children:"프로젝트"}),e.jsx("p",{className:"text-sm font-medium",children:s.projectName})]}),e.jsxs("div",{children:[e.jsx(S,{className:"text-xs text-gray-500",children:"거래처"}),e.jsx("p",{className:"text-sm font-medium",children:s.vendorName})]}),e.jsxs("div",{children:[e.jsx(S,{className:"text-xs text-gray-500",children:"총 금액"}),e.jsx("p",{className:"text-sm font-medium text-blue-600",children:g(s.totalAmount)})]}),e.jsxs("div",{children:[e.jsx(S,{className:"text-xs text-gray-500",children:"상태"}),e.jsx(C,{className:"mt-1",children:s.status})]}),e.jsxs("div",{children:[e.jsx(S,{className:"text-xs text-gray-500",children:"작성자"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(ae,{className:"h-6 w-6",children:e.jsx(te,{className:"text-xs",children:s.createdBy.name[0]})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:s.createdBy.name}),e.jsx("p",{className:"text-xs text-gray-500",children:s.createdBy.email})]})]})]}),e.jsxs("div",{children:[e.jsx(S,{className:"text-xs text-gray-500",children:"작성일"}),e.jsx("p",{className:"text-sm",children:ne(s.createdAt)})]})]})})]}),e.jsxs(i,{children:[e.jsx(m,{children:e.jsx(o,{className:"text-sm",children:"거래처 정보"})}),e.jsxs(x,{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(re,{className:"h-4 w-4 text-gray-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"업체명"}),e.jsx("p",{className:"text-sm font-medium",children:s.vendor.vendorName})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(pe,{className:"h-4 w-4 text-gray-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"담당자"}),e.jsx("p",{className:"text-sm font-medium",children:s.vendor.contactPerson})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Le,{className:"h-4 w-4 text-gray-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"연락처"}),e.jsx("p",{className:"text-sm",children:s.vendor.contactPhone})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(qe,{className:"h-4 w-4 text-gray-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"이메일"}),e.jsx("p",{className:"text-sm",children:s.vendor.contactEmail})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ne,{className:"h-4 w-4 text-gray-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500",children:"주소"}),e.jsx("p",{className:"text-sm",children:s.vendor.address})]})]})]})]}),e.jsxs(i,{children:[e.jsx(m,{children:e.jsx(o,{className:"text-sm",children:"발주 품목"})}),e.jsx(x,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"text-left py-2",children:"품목명"}),e.jsx("th",{className:"text-left py-2",children:"규격"}),e.jsx("th",{className:"text-right py-2",children:"수량"}),e.jsx("th",{className:"text-right py-2",children:"단가"}),e.jsx("th",{className:"text-right py-2",children:"금액"})]})}),e.jsx("tbody",{children:s.items.map(a=>e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"py-2",children:a.itemName}),e.jsx("td",{className:"py-2 text-gray-600",children:a.specification}),e.jsx("td",{className:"py-2 text-right",children:a.quantity}),e.jsx("td",{className:"py-2 text-right",children:g(a.unitPrice)}),e.jsx("td",{className:"py-2 text-right font-medium",children:g(a.totalPrice)})]},a.id))}),e.jsx("tfoot",{children:e.jsxs("tr",{children:[e.jsx("td",{colSpan:4,className:"py-2 text-right font-medium",children:"총 합계:"}),e.jsx("td",{className:"py-2 text-right font-bold text-blue-600",children:g(s.totalAmount)})]})})]})})})]})]}):e.jsxs(T,{variant:"destructive",children:[e.jsx(ce,{className:"h-4 w-4"}),e.jsx(_,{children:"발주서 정보를 불러올 수 없습니다."})]})}),e.jsx(E,{value:"progress",children:e.jsx(ge,{orderId:d,showActions:k,onApprove:a=>b(!0),onReject:a=>N(!0)})}),e.jsx(E,{value:"history",className:"space-y-4",children:e.jsxs(i,{children:[e.jsx(m,{children:e.jsx(o,{className:"text-sm",children:"승인 이력"})}),e.jsx(x,{children:W?e.jsx("div",{className:"text-center py-8",children:"로딩 중..."}):r&&r.length>0?e.jsx("div",{className:"space-y-4",children:r.map((a,w)=>e.jsxs("div",{className:"relative",children:[w<r.length-1&&e.jsx("div",{className:"absolute left-4 top-8 w-0.5 h-full bg-gray-200"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"flex-shrink-0",children:ve(a.action)}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"text-sm font-medium",children:fe(a.action)}),e.jsx("span",{className:"text-xs text-gray-500",children:he(new Date(a.performedAt),{addSuffix:!0,locale:G})})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-600",children:[e.jsx(ae,{className:"h-5 w-5",children:e.jsx(te,{className:"text-xs",children:a.performedBy.name[0]})}),e.jsx("span",{children:a.performedBy.name}),e.jsx(C,{variant:"outline",className:"text-xs",children:a.performedBy.role})]}),a.note&&e.jsx("div",{className:"mt-2 p-2 bg-gray-50 rounded text-xs",children:a.note})]})]})]},a.id))}):e.jsx("p",{className:"text-center text-gray-500 py-8",children:"승인 이력이 없습니다."})})]})}),e.jsx(E,{value:"attachments",className:"space-y-4",children:e.jsxs(i,{children:[e.jsx(m,{children:e.jsx(o,{className:"text-sm",children:"첨부파일"})}),e.jsx(x,{children:s&&s.attachments.length>0?e.jsx("div",{className:"space-y-2",children:s.attachments.map(a=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg hover:bg-gray-50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Oe,{className:"h-4 w-4 text-gray-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:a.fileName}),e.jsxs("p",{className:"text-xs text-gray-500",children:[ye(a.fileSize)," • ",ne(a.uploadedAt)]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(c,{size:"sm",variant:"outline",onClick:()=>window.open(a.url,"_blank"),children:[e.jsx(le,{className:"h-4 w-4 mr-1"}),"보기"]}),e.jsxs(c,{size:"sm",variant:"outline",onClick:()=>{const w=document.createElement("a");w.href=a.url,w.download=a.fileName,w.click()},children:[e.jsx(ue,{className:"h-4 w-4 mr-1"}),"다운로드"]})]})]},a.id))}):e.jsx("p",{className:"text-center text-gray-500 py-8",children:"첨부파일이 없습니다."})})]})})]})]}),e.jsxs(ee,{className:"gap-2",children:[k&&e.jsxs(e.Fragment,{children:[e.jsxs(c,{variant:"outline",className:"text-red-600",onClick:()=>N(!0),children:[e.jsx(V,{className:"h-4 w-4 mr-1"}),"반려"]}),e.jsxs(c,{className:"bg-green-600 hover:bg-green-700",onClick:()=>b(!0),children:[e.jsx(xe,{className:"h-4 w-4 mr-1"}),"승인"]})]}),e.jsx(c,{variant:"outline",onClick:y,children:"닫기"})]})]})}),e.jsx(L,{open:t,onOpenChange:b,children:e.jsxs(O,{children:[e.jsxs(R,{children:[e.jsx(H,{children:"발주서 승인"}),e.jsx(I,{children:"이 발주서를 승인하시겠습니까?"})]}),e.jsx("div",{className:"space-y-4 py-4",children:e.jsxs("div",{children:[e.jsx(S,{children:"승인 메모 (선택)"}),e.jsx(de,{value:P,onChange:a=>q(a.target.value),placeholder:"승인과 관련된 메모를 입력하세요...",rows:3})]})}),e.jsxs(ee,{children:[e.jsx(c,{variant:"outline",onClick:()=>b(!1),children:"취소"}),e.jsx(c,{className:"bg-green-600 hover:bg-green-700",onClick:()=>X.mutate(),disabled:X.isPending,children:X.isPending?"처리 중...":"승인"})]})]})}),e.jsx(L,{open:F,onOpenChange:N,children:e.jsxs(O,{children:[e.jsxs(R,{children:[e.jsx(H,{children:"발주서 반려"}),e.jsx(I,{children:"이 발주서를 반려하시겠습니까?"})]}),e.jsx("div",{className:"space-y-4 py-4",children:e.jsxs("div",{children:[e.jsx(S,{children:"반려 사유 (필수)"}),e.jsx(de,{value:f,onChange:a=>j(a.target.value),placeholder:"반려 사유를 입력하세요...",rows:3,required:!0})]})}),e.jsxs(ee,{children:[e.jsx(c,{variant:"outline",onClick:()=>N(!1),children:"취소"}),e.jsx(c,{variant:"destructive",onClick:()=>Z.mutate(),disabled:!f.trim()||Z.isPending,children:Z.isPending?"처리 중...":"반려"})]})]})})]})}function Ns(){const{user:p}=Fe(),{toast:y}=je(),[,d]=Me(),M=Te(),[k,n]=v.useState(!1),[h,l]=v.useState(null),[A,P]=v.useState(!1),[q,f]=v.useState(!1),j=parseInt(M.id),{data:t,isLoading:b}=$({queryKey:[`/api/orders/${j}`]}),{data:F}=$({queryKey:["/api/order-statuses"]});J({mutationFn:async()=>{await Y("POST",`/api/orders/${j}/approve`)},onSuccess:()=>{y({title:"발주서 승인",description:"발주서가 성공적으로 승인되었습니다."}),K.invalidateQueries({queryKey:["/api/orders"]}),K.invalidateQueries({queryKey:[`/api/orders/${j}`]})},onError:r=>{y({title:"승인 실패",description:"발주서 승인 중 오류가 발생했습니다.",variant:"destructive"})}});const N=J({mutationFn:async()=>{await Y("POST",`/api/orders/${j}/send`)},onSuccess:()=>{y({title:"발주서 전송",description:"발주서가 성공적으로 전송되었습니다."}),K.invalidateQueries({queryKey:["/api/orders"]}),K.invalidateQueries({queryKey:[`/api/orders/${j}`]})},onError:r=>{y({title:"전송 실패",description:"발주서 전송 중 오류가 발생했습니다.",variant:"destructive"})}});if(b)return e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"text-lg",children:"로딩 중..."})});if(!t)return e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"text-lg text-gray-500",children:"발주서를 찾을 수 없습니다."})});const s=t.status==="draft"?"bg-gray-500":t.status==="pending"?"bg-yellow-500":t.status==="approved"?"bg-green-500":t.status==="sent"?"bg-blue-500":"bg-gray-500",u=F?.find(r=>r.code===t.status)?.name||t.status;return e.jsx("div",{className:"min-h-screen bg-gray-50",children:e.jsxs("div",{className:"max-w-[1366px] mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs(c,{variant:"ghost",size:"sm",onClick:()=>d("/orders"),className:"flex items-center space-x-2 h-8",children:[e.jsx(_e,{className:"h-4 w-4"}),e.jsx("span",{children:"돌아가기"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(D,{className:"h-5 w-5 text-blue-600"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:t.orderNumber}),e.jsx("p",{className:"text-sm text-gray-500",children:"표준 발주서 상세"})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(C,{className:`${s} text-white text-xs px-2 py-1`,children:u}),e.jsx("span",{className:"text-xs text-gray-500",children:t.orderDate?z(new Date(t.orderDate),"yyyy. M. d."):""})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-4",children:[e.jsxs(i,{className:"shadow-sm",children:[e.jsx(m,{className:"bg-gray-50 py-3 px-4",children:e.jsxs(o,{className:"flex items-center space-x-2 text-lg font-semibold",children:[e.jsx(re,{className:"h-5 w-5 text-blue-600"}),e.jsx("span",{children:"기본 정보"})]})}),e.jsx(x,{className:"px-4 py-3",children:e.jsxs("div",{className:"grid grid-cols-2 gap-x-8 gap-y-2 text-xs",children:[e.jsxs("div",{className:"flex",children:[e.jsx("span",{className:"text-gray-600 w-20",children:"발주번호:"}),e.jsx("span",{className:"font-medium",children:t.orderNumber})]}),e.jsxs("div",{className:"flex",children:[e.jsx("span",{className:"text-gray-600 w-20",children:"발주일:"}),e.jsx("span",{children:t.orderDate?z(new Date(t.orderDate),"yyyy-MM-dd"):"-"})]}),e.jsxs("div",{className:"flex",children:[e.jsx("span",{className:"text-gray-600 w-20",children:"납기희망일:"}),e.jsx("span",{children:t.deliveryDate?z(new Date(t.deliveryDate),"yyyy-MM-dd"):"-"})]}),e.jsxs("div",{className:"flex",children:[e.jsx("span",{className:"text-gray-600 w-20",children:"합계:"}),e.jsx("span",{className:"font-semibold text-blue-600",children:g(t.totalAmount)})]})]})})]}),e.jsxs(i,{className:"shadow-sm",children:[e.jsx(m,{className:"bg-gray-50 py-3 px-4",children:e.jsxs(o,{className:"flex items-center space-x-2 text-lg font-semibold",children:[e.jsx(Ne,{className:"h-5 w-5 text-blue-600"}),e.jsx("span",{children:"현장 정보"})]})}),e.jsx(x,{className:"px-4 py-3",children:t.project?e.jsxs("div",{className:"grid grid-cols-2 gap-x-8 gap-y-2 text-xs",children:[e.jsxs("div",{className:"flex",children:[e.jsx("span",{className:"text-gray-600 w-20",children:"현장명:"}),e.jsx("span",{className:"font-medium",children:t.project.projectName})]}),e.jsxs("div",{className:"flex",children:[e.jsx("span",{className:"text-gray-600 w-20",children:"현장코드:"}),e.jsx("span",{children:t.project.projectCode})]}),e.jsxs("div",{className:"flex col-span-2",children:[e.jsx("span",{className:"text-gray-600 w-20",children:"현장주소:"}),e.jsx("span",{children:t.project.location})]})]}):e.jsx("p",{className:"text-xs text-gray-500",children:"현장 정보가 없습니다."})})]}),e.jsxs(i,{className:"shadow-sm",children:[e.jsx(m,{className:"bg-gray-50 py-3 px-4",children:e.jsxs(o,{className:"flex items-center space-x-2 text-lg font-semibold",children:[e.jsx(re,{className:"h-5 w-5 text-blue-600"}),e.jsx("span",{children:"납품처"})]})}),e.jsx(x,{className:"px-4 py-3",children:t.vendor?e.jsxs("div",{className:"grid grid-cols-2 gap-x-8 gap-y-2 text-xs",children:[e.jsxs("div",{className:"flex",children:[e.jsx("span",{className:"text-gray-600 w-20",children:"업체명:"}),e.jsx("span",{className:"font-medium",children:t.vendor.name})]}),e.jsxs("div",{className:"flex",children:[e.jsx("span",{className:"text-gray-600 w-20",children:"대표자:"}),e.jsx("span",{children:t.vendor.representative||"-"})]}),e.jsxs("div",{className:"flex",children:[e.jsx("span",{className:"text-gray-600 w-20",children:"사업자번호:"}),e.jsx("span",{children:t.vendor.businessNumber})]}),e.jsxs("div",{className:"flex",children:[e.jsx("span",{className:"text-gray-600 w-20",children:"연락처:"}),e.jsx("span",{children:t.vendor.phone})]})]}):e.jsx("p",{className:"text-xs text-gray-500",children:"거래처 정보가 없습니다."})})]}),e.jsxs(i,{className:"shadow-sm",children:[e.jsx(m,{className:"bg-gray-50 py-3 px-4",children:e.jsxs(o,{className:"flex items-center space-x-2 text-lg font-semibold",children:[e.jsx(pe,{className:"h-5 w-5 text-blue-600"}),e.jsx("span",{children:"담당자"})]})}),e.jsx(x,{className:"px-4 py-3",children:e.jsxs("div",{className:"grid grid-cols-2 gap-x-8 gap-y-2 text-xs",children:[e.jsxs("div",{className:"flex",children:[e.jsx("span",{className:"text-gray-600 w-20",children:"본사 담당자:"}),e.jsx("span",{className:"font-medium",children:t.user?.name||"-"})]}),e.jsxs("div",{className:"flex",children:[e.jsx("span",{className:"text-gray-600 w-20",children:"인수 담당자:"}),e.jsx("span",{children:"현장 담당자"})]})]})})]}),e.jsxs(i,{className:"shadow-sm",children:[e.jsx(m,{className:"bg-gray-50 py-3 px-4",children:e.jsxs(o,{className:"flex items-center justify-between text-sm font-semibold",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(me,{className:"h-5 w-5 text-blue-600"}),e.jsx("span",{children:"품목 리스트"})]}),e.jsxs("span",{className:"text-blue-600",children:["총 합계 ",g(t.totalAmount)]})]})}),e.jsx(x,{className:"px-0 py-3",children:t.items&&t.items.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-xs",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{className:"border-b border-gray-200",children:[e.jsx("th",{className:"text-left py-2 px-4 font-medium text-gray-600",children:"품목명"}),e.jsx("th",{className:"text-center py-2 px-4 font-medium text-gray-600",children:"규격"}),e.jsx("th",{className:"text-center py-2 px-4 font-medium text-gray-600",children:"수량"}),e.jsx("th",{className:"text-center py-2 px-4 font-medium text-gray-600",children:"단위"}),e.jsx("th",{className:"text-right py-2 px-4 font-medium text-gray-600",children:"단가"}),e.jsx("th",{className:"text-right py-2 px-4 font-medium text-gray-600",children:"금액"}),e.jsx("th",{className:"text-center py-2 px-4 font-medium text-gray-600",children:"비고"})]})}),e.jsx("tbody",{children:t.items.map((r,W)=>e.jsxs("tr",{className:"border-b border-gray-100 hover:bg-gray-50",children:[e.jsx("td",{className:"py-2 px-4 font-medium",children:r.itemName||r.item_name}),e.jsx("td",{className:"py-2 px-4 text-center",children:r.specification||"-"}),e.jsx("td",{className:"py-2 px-4 text-center",children:typeof r.quantity=="number"?r.quantity.toLocaleString():r.quantity||"-"}),e.jsx("td",{className:"py-2 px-4 text-center",children:"개"}),e.jsx("td",{className:"py-2 px-4 text-right font-semibold text-blue-600",children:g(r.unitPrice||r.unit_price)}),e.jsx("td",{className:"py-2 px-4 text-right font-semibold text-blue-600",children:g(r.totalAmount||r.total_amount)}),e.jsx("td",{className:"py-2 px-4 text-center text-gray-500",children:r.notes?r.notes.split("/").join(" "):"-"})]},W))})]})}):e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(me,{className:"h-8 w-8 mx-auto mb-2 text-gray-300"}),e.jsx("p",{className:"text-xs",children:"등록된 품목이 없습니다."})]})})]}),t.notes&&e.jsxs(i,{className:"shadow-sm",children:[e.jsx(m,{className:"bg-gray-50 py-3 px-4",children:e.jsxs(o,{className:"flex items-center space-x-2 text-lg font-semibold",children:[e.jsx(D,{className:"h-5 w-5 text-blue-600"}),e.jsx("span",{children:"특이사항"})]})}),e.jsx(x,{className:"px-4 py-3",children:e.jsx("p",{className:"text-xs text-gray-700 leading-relaxed",children:t.notes})})]}),e.jsxs(i,{className:"shadow-sm",children:[e.jsx(m,{className:"bg-gray-50 py-3 px-4",children:e.jsxs(o,{className:"flex items-center space-x-2 text-lg font-semibold",children:[e.jsx(D,{className:"h-5 w-5 text-blue-600"}),e.jsx("span",{children:"첨부파일"})]})}),e.jsx(x,{className:"px-4 py-3",children:t.attachments&&t.attachments.length>0?e.jsx("div",{className:"space-y-2",children:t.attachments.map(r=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded text-xs",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(D,{className:"h-3 w-3 text-blue-600"}),e.jsx("span",{children:r.originalName}),e.jsxs("span",{className:"text-gray-500",children:["(",(r.fileSize/1024).toFixed(1)," KB)"]})]}),e.jsx(c,{size:"sm",variant:"outline",className:"h-6 px-2 text-xs",onClick:()=>window.open(`/api/attachments/${r.id}`,"_blank"),children:"다운로드"})]},r.id))}):e.jsx("p",{className:"text-xs text-gray-500",children:"첨부된 파일이 없습니다."})})]})]}),e.jsxs("div",{className:"space-y-4",children:[(t.status==="pending"||t.status==="approved")&&e.jsxs(i,{className:"shadow-sm border-blue-200 bg-blue-50/30",children:[e.jsx(m,{className:"bg-blue-50 py-3 px-4",children:e.jsxs(o,{className:"flex items-center justify-between text-sm font-semibold",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(U,{className:"h-5 w-5 text-blue-600"}),e.jsx("span",{children:"승인 진행 상황"})]}),e.jsxs(c,{size:"sm",variant:"ghost",className:"h-6 px-2 text-xs",onClick:()=>f(!0),children:[e.jsx(le,{className:"h-3 w-3 mr-1"}),"상세보기"]})]})}),e.jsx(x,{className:"px-4 py-3",children:e.jsx(ge,{orderId:j,className:"border-0 shadow-none"})})]}),t.status==="pending"&&p&&["admin","executive","hq_management","project_manager"].includes(p.role)&&e.jsxs(T,{className:"bg-yellow-50 border-yellow-200",children:[e.jsx(ce,{className:"h-4 w-4 text-yellow-600"}),e.jsxs(_,{className:"text-xs text-yellow-800",children:[e.jsx("strong",{children:"승인 대기 중"}),e.jsx("p",{className:"mt-1",children:"이 발주서는 승인이 필요합니다."})]})]}),e.jsxs(i,{className:"shadow-sm",children:[e.jsx(m,{className:"bg-gray-50 py-3 px-4",children:e.jsxs(o,{className:"flex items-center space-x-2 text-lg font-semibold",children:[e.jsx(ze,{className:"h-5 w-5 text-blue-600"}),e.jsx("span",{children:"발주 상태"})]})}),e.jsx(x,{className:"px-4 py-3",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-gray-600 block mb-1",children:"현재 상태"}),e.jsx(C,{className:`${s} text-white text-xs`,children:u})]}),t.status==="pending"&&p&&["admin","executive","hq_management","project_manager"].includes(p.role)&&e.jsxs(c,{onClick:()=>f(!0),className:"w-full h-8 text-xs bg-blue-600 hover:bg-blue-700",size:"sm",children:[e.jsx(U,{className:"h-3 w-3 mr-1"}),"승인 관리"]}),t.status==="approved"&&e.jsxs(c,{onClick:()=>N.mutate(),disabled:N.isPending,className:"w-full h-8 text-xs",size:"sm",children:[e.jsx(He,{className:"h-3 w-3 mr-1"}),"전송"]})]})})]}),e.jsxs(i,{className:"shadow-sm",children:[e.jsx(m,{className:"bg-gray-50 py-3 px-4",children:e.jsxs(o,{className:"flex items-center space-x-2 text-lg font-semibold",children:[e.jsx(D,{className:"h-5 w-5 text-blue-600"}),e.jsx("span",{children:"작업"})]})}),e.jsxs(x,{className:"px-4 py-3 space-y-2",children:[e.jsx(c,{variant:"outline",size:"sm",onClick:async()=>{P(!0);try{const r=await Y("POST","/api/orders/generate-pdf",{orderData:t});r.pdfUrl&&(l(r.pdfUrl),n(!0))}catch(r){console.error("PDF 생성 오류:",r),y({title:"PDF 생성 실패",description:"PDF 생성 중 오류가 발생했습니다.",variant:"destructive"})}finally{P(!1)}},disabled:A,className:"w-full h-8 text-xs justify-start",children:A?e.jsxs(e.Fragment,{children:[e.jsx(Q,{className:"h-3 w-3 mr-2 animate-spin"})," PDF 생성 중..."]}):e.jsxs(e.Fragment,{children:[e.jsx(le,{className:"h-3 w-3 mr-2"})," PDF 미리보기"]})}),e.jsxs(c,{variant:"outline",size:"sm",onClick:()=>d(`/orders/${j}/edit`),className:"w-full h-8 text-xs justify-start",children:[e.jsx(Qe,{className:"h-3 w-3 mr-2"}),"발주서 수정"]}),e.jsxs(c,{variant:"outline",size:"sm",onClick:()=>window.print(),className:"w-full h-8 text-xs justify-start",children:[e.jsx(Ue,{className:"h-3 w-3 mr-2"}),"인쇄"]})]})]})]})]}),e.jsx(L,{open:k,onOpenChange:r=>{n(r),r||l(null)},children:e.jsxs(O,{className:"max-w-5xl max-h-[90vh] p-0",children:[e.jsx(R,{className:"px-6 py-4 border-b",children:e.jsxs(H,{className:"flex items-center justify-between",children:[e.jsx("span",{children:"발주서 미리보기"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(c,{variant:"outline",size:"sm",onClick:()=>{h&&window.open(`${h}?download=true`,"_blank")},disabled:!h,children:[e.jsx(ue,{className:"h-4 w-4 mr-2"}),"다운로드"]}),e.jsxs(c,{variant:"outline",size:"sm",onClick:()=>{h&&window.open(h,"_blank")},disabled:!h,children:[e.jsx(Ve,{className:"h-4 w-4 mr-2"}),"새 탭에서 열기"]})]})]})}),e.jsx("div",{className:"w-full h-[75vh] bg-gray-100",children:h?e.jsx("iframe",{src:h,className:"w-full h-full border-0",title:"PDF Preview"}):e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx(Q,{className:"h-8 w-8 animate-spin text-gray-400"})})})]})}),q&&e.jsx(Xe,{isOpen:q,onClose:()=>f(!1),orderId:j,orderNumber:t.orderNumber,canApprove:p&&["admin","executive","hq_management","project_manager"].includes(p.role)})]})})}export{Ns as default};
