import{d as A,e as T,h as C,r as j,j as e,$ as N,n as v,F as m,U as E,B as f,k,G as p}from"./index-DZPcK5E3-1757222410790.js";import{A as L,f as P,a as M,b as B,c as S,d as U,e as z,g as W,h as q}from"./alert-dialog-CFqQLsBh-1757222410790.js";import{C as I}from"./calendar-INpcuTt0-1757222410790.js";import{D as R}from"./download-Brq0zOWd-1757222410790.js";import{T as K}from"./trash-2-BRzLIUzK-1757222410790.js";import{I as H}from"./info-BgXa-3v0-1757222410790.js";import{f as O}from"./format-CTqwdt1V-1757222410790.js";const Q=async(n,i,c)=>{console.log(`🔽 Starting download for attachment ${n}, filename: ${i}, mimeType: ${c}`);try{const a=window.location.origin,g=`${a}/api/attachments/${n}/download?download=true`,s=`${a}/api/attachments/${n}/download`;if(console.log("📎 Download URL:",g),console.log("👁️ View URL:",s),c?.toLowerCase().includes("pdf")||i.toLowerCase().endsWith(".pdf"))console.log("📄 File is PDF - opening in new tab and downloading"),window.open(s,"_blank"),console.log("✅ Opened PDF in new tab for viewing"),setTimeout(()=>{const o=document.createElement("a");o.href=g,o.download=i,o.style.display="none",document.body.appendChild(o),o.click(),document.body.removeChild(o),console.log("✅ PDF download triggered via anchor element")},500);else{console.log("📁 File is not PDF - downloading only");const o=document.createElement("a");o.href=g,o.download=i,o.style.display="none",document.body.appendChild(o),o.click(),document.body.removeChild(o),console.log("✅ File download triggered via anchor element")}return!0}catch(a){throw console.error("❌ Download error:",a),a}},G=(n,i,c)=>{const a=c?.toLowerCase().includes("pdf")||n.toLowerCase().endsWith(".pdf");i(a?{title:"다운로드 및 미리보기",description:`${n} 파일이 새 탭에서 열리고 다운로드 폴더에 저장됩니다.`}:{title:"다운로드 완료",description:`${n} 파일이 다운로드 폴더에 저장됩니다.`})};function re({attachments:n,orderId:i}){const{user:c}=A(),{toast:a}=T(),{theme:g}=C(),s=g==="dark",[h,o]=j.useState(null),[b,u]=j.useState(null),w=c?.role==="admin";console.log("🔍 AttachedFilesInfo - COMPONENT CALLED!",{attachments:n,orderId:i}),console.log("🔍 AttachedFilesInfo - received attachments:",n);const x=n.map(r=>{const t=r.mimeType?.toLowerCase()||"",l=r.originalName?.toLowerCase()||"";let d="other",y=m;return t.includes("excel")||t.includes("spreadsheet")||l.endsWith(".xlsx")||l.endsWith(".xls")||l.endsWith(".xlsm")?(d="excel",y=N):(t.includes("pdf")||l.endsWith(".pdf"))&&(d="pdf",y=m),console.log("🔍 Processing attachment:",{originalName:r.originalName,mimeType:r.mimeType,fileName:l,fileType:d}),{...r,fileType:d,icon:y}});if(console.log("📊 AttachedFilesInfo - attached files:",x),x.length===0)return console.log("⚠️ AttachedFilesInfo - No attached files found, component will not render"),null;console.log("✅ AttachedFilesInfo - Rendering component with",x.length,"attached files");const $=async r=>{o(r.id);try{await Q(r.id,r.originalName,r.mimeType),G(r.originalName,a,r.mimeType)}catch(t){console.error("Download error:",t),a({title:"다운로드 실패",description:t instanceof Error?t.message:"알 수 없는 오류가 발생했습니다.",variant:"destructive"})}finally{o(null)}},D=async r=>{if(!w){a({title:"권한 없음",description:"관리자만 파일을 삭제할 수 있습니다.",variant:"destructive"});return}u(r.id);try{await k("DELETE",`/api/attachments/${r.id}`),await p.invalidateQueries({queryKey:[`/api/orders/${i}`]}),await p.invalidateQueries({queryKey:["orders-optimized"]}),await p.invalidateQueries({queryKey:["/api/orders"]}),a({title:"파일 삭제 완료",description:`${r.originalName} 파일이 삭제되었습니다.`})}catch(t){console.error("Delete error:",t),a({title:"파일 삭제 실패",description:t instanceof Error?t.message:"알 수 없는 오류가 발생했습니다.",variant:"destructive"})}finally{u(null)}},F=r=>{if(r===0)return"0 B";const t=1024,l=["B","KB","MB","GB"],d=Math.floor(Math.log(r)/Math.log(t));return parseFloat((r/Math.pow(t,d)).toFixed(2))+" "+l[d]};return e.jsxs("div",{className:`shadow-sm rounded-lg border transition-colors ${s?"bg-gray-800 border-gray-700":"bg-white border-gray-200"}`,children:[e.jsx("div",{className:`p-6 border-b transition-colors ${s?"border-gray-700":"border-gray-200"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:`p-2 rounded-lg mr-3 transition-colors ${s?"bg-green-900/20":"bg-green-50"}`,children:e.jsx(N,{className:`h-5 w-5 transition-colors ${s?"text-green-400":"text-green-600"}`})}),e.jsxs("div",{children:[e.jsx("h3",{className:`text-lg font-semibold transition-colors ${s?"text-white":"text-gray-900"}`,children:"첨부 된 파일"}),e.jsxs("span",{className:`text-sm transition-colors ${s?"text-gray-400":"text-gray-500"}`,children:["발주서와 관련된 첨부 파일 (",x.length,"개)"]})]})]}),e.jsxs(v,{variant:"outline",className:`transition-colors ${s?"border-blue-600 text-blue-400":"border-blue-200 text-blue-700 bg-blue-50"}`,children:[e.jsx(m,{className:"h-3 w-3 mr-1"}),"첨부파일"]})]})}),e.jsxs("div",{className:"p-6 space-y-4",children:[x.map(r=>e.jsx("div",{className:`border rounded-lg p-4 transition-all hover:shadow-md ${s?"border-gray-600 hover:border-gray-500 bg-gray-750":"border-gray-200 hover:border-gray-300 bg-gray-50/50"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0 flex-1",children:[e.jsx("div",{className:`p-2 rounded-lg transition-colors ${r.fileType==="excel"?s?"bg-green-900/30":"bg-green-100":r.fileType==="pdf"?s?"bg-red-900/30":"bg-red-100":s?"bg-gray-900/30":"bg-gray-100"}`,children:e.jsx(r.icon,{className:`h-5 w-5 transition-colors ${r.fileType==="excel"?s?"text-green-400":"text-green-600":r.fileType==="pdf"?s?"text-red-400":"text-red-600":s?"text-gray-400":"text-gray-600"}`})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:`font-medium text-sm truncate transition-colors ${s?"text-gray-200":"text-gray-900"}`,title:r.originalName,children:r.originalName}),e.jsx(v,{variant:"secondary",className:"text-xs",children:r.fileType==="excel"?"Excel":r.fileType==="pdf"?"PDF":"파일"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-2 text-xs",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(m,{className:`h-3 w-3 transition-colors ${s?"text-gray-500":"text-gray-400"}`}),e.jsx("span",{className:`transition-colors ${s?"text-gray-400":"text-gray-600"}`,children:F(r.fileSize)})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(E,{className:`h-3 w-3 transition-colors ${s?"text-gray-500":"text-gray-400"}`}),e.jsx("span",{className:`transition-colors ${s?"text-gray-400":"text-gray-600"}`,children:r.uploadedBy||"알 수 없음"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(I,{className:`h-3 w-3 transition-colors ${s?"text-gray-500":"text-gray-400"}`}),e.jsx("span",{className:`transition-colors ${s?"text-gray-400":"text-gray-600"}`,children:O(new Date(r.uploadedAt),"yyyy.MM.dd HH:mm")})]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 ml-4",children:[e.jsx(f,{variant:"outline",size:"sm",onClick:()=>$(r),disabled:h===r.id,className:`h-8 px-3 text-xs transition-colors ${s?"border-gray-600 text-gray-300 hover:bg-gray-700 hover:border-green-500 hover:text-green-400":"border-gray-300 text-gray-700 hover:bg-green-50 hover:border-green-300 hover:text-green-700"}`,children:h===r.id?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-current mr-1"}),"다운로드 중..."]}):e.jsxs(e.Fragment,{children:[e.jsx(R,{className:"h-3 w-3 mr-1"}),"다운로드"]})}),w&&e.jsxs(L,{children:[e.jsx(P,{asChild:!0,children:e.jsx(f,{variant:"outline",size:"sm",disabled:b===r.id,className:`h-8 px-3 text-xs transition-colors ${s?"border-red-600 text-red-400 hover:bg-red-900/20 hover:border-red-500":"border-red-300 text-red-700 hover:bg-red-50 hover:border-red-400"}`,children:b===r.id?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-current mr-1"}),"삭제 중..."]}):e.jsxs(e.Fragment,{children:[e.jsx(K,{className:"h-3 w-3 mr-1"}),"삭제"]})})}),e.jsxs(M,{className:s?"bg-gray-800 border-gray-700":"",children:[e.jsxs(B,{children:[e.jsx(S,{className:s?"text-white":"",children:"파일 삭제 확인"}),e.jsxs(U,{className:s?"text-gray-400":"",children:[e.jsx("strong",{children:r.originalName})," 파일을 삭제하시겠습니까?",e.jsx("br",{}),"이 작업은 되돌릴 수 없으며, 파일이 영구적으로 삭제됩니다."]})]}),e.jsxs(z,{children:[e.jsx(W,{className:s?"border-gray-600 text-gray-300 hover:bg-gray-700":"",children:"취소"}),e.jsx(q,{onClick:()=>D(r),className:"bg-red-600 hover:bg-red-700 text-white",children:"삭제"})]})]})]})]})]})},r.id)),e.jsx("div",{className:`mt-4 p-3 rounded-lg border border-dashed transition-colors ${s?"border-gray-600 bg-gray-750":"border-gray-300 bg-gray-50"}`,children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(H,{className:`h-4 w-4 mt-0.5 flex-shrink-0 transition-colors ${s?"text-blue-400":"text-blue-600"}`}),e.jsxs("div",{className:"text-xs space-y-1",children:[e.jsx("p",{className:`font-medium transition-colors ${s?"text-blue-400":"text-blue-600"}`,children:"첨부 파일 정보"}),e.jsx("p",{className:`transition-colors ${s?"text-gray-400":"text-gray-600"}`,children:"이 섹션에는 발주서와 관련된 모든 첨부 파일이 표시됩니다. Excel 파일, PDF 문서 등 다양한 형태의 파일을 다운로드하여 사용할 수 있습니다."})]})]})})]})]})}export{re as A,Q as d,G as s};
